var res = {'data':'HTTP/1.1 200 Partial Content\x0aDate: Sun, 20 Sep 2020 14:53:05 GMT\x0aServer: Apache/2.4.29 (Ubuntu)\x0aLast-Modified: Sat, 26 Jan 2019 12:59:49 GMT\x0aETag: \x2251e0-5805c04c63b40-gzip\x22\x0aAccept-Ranges: bytes\x0aVary: Accept-Encoding\x0aContent-Encoding: gzip\x0aContent-Range: bytes 0-5937/5938\x0aContent-Length: 5938\x0aKeep-Alive: timeout=5, max=70\x0aConnection: Keep-Alive\x0aContent-Type: application/javascript\x0a\x0a/**\x0a * @output wp-includes/js/wplink.js\x0a */\x0a\x0a /* global wpLink */\x0a\x0a( function( $, wpLinkL10n, wp ) {\x0a\x09var editor, searchTimer, River, Query, correctedURL,\x0a\x09\x09emailRegexp = /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\x5c.[A-Z]{2,63}$/i,\x0a\x09\x09urlRegexp = /^(https?|ftp):\x5c/\x5c/[A-Z0-9.-]+\x5c.[A-Z]{2,63}[^ \x22]*$/i,\x0a\x09\x09inputs = {},\x0a\x09\x09rivers = {},\x0a\x09\x09isTouch = ( \x27ontouchend\x27 in document );\x0a\x0a\x09function getLink() {\x0a\x09\x09if ( editor ) {\x0a\x09\x09\x09return editor.$( \x27a[data-wplink-edit=\x22true\x22]\x27 );\x0a\x09\x09}\x0a\x0a\x09\x09return null;\x0a\x09}\x0a\x0a\x09window.wpLink = {\x0a\x09\x09timeToTriggerRiver: 150,\x0a\x09\x09minRiverAJAXDuration: 200,\x0a\x09\x09riverBottomThreshold: 5,\x0a\x09\x09keySensitivity: 100,\x0a\x09\x09lastSearch: \x27\x27,\x0a\x09\x09textarea: \x27\x27,\x0a\x09\x09modalOpen: false,\x0a\x0a\x09\x09init: function() {\x0a\x09\x09\x09inputs.wrap = $(\x27#wp-link-wrap\x27);\x0a\x09\x09\x09inputs.dialog = $( \x27#wp-link\x27 );\x0a\x09\x09\x09inputs.backdrop = $( \x27#wp-link-backdrop\x27 );\x0a\x09\x09\x09inputs.submit = $( \x27#wp-link-submit\x27 );\x0a\x09\x09\x09inputs.close = $( \x27#wp-link-close\x27 );\x0a\x0a\x09\x09\x09// Input\x0a\x09\x09\x09inputs.text = $( \x27#wp-link-text\x27 );\x0a\x09\x09\x09inputs.url = $( \x27#wp-link-url\x27 );\x0a\x09\x09\x09inputs.nonce = $( \x27#_ajax_linking_nonce\x27 );\x0a\x09\x09\x09inputs.openInNewTab = $( \x27#wp-link-target\x27 );\x0a\x09\x09\x09inputs.search = $( \x27#wp-link-search\x27 );\x0a\x0a\x09\x09\x09// Build Rivers\x0a\x09\x09\x09rivers.search = new River( $( \x27#search-results\x27 ) );\x0a\x09\x09\x09rivers.recent = new River( $( \x27#most-recent-results\x27 ) );\x0a\x09\x09\x09rivers.elements = inputs.dialog.find( \x27.query-results\x27 );\x0a\x0a\x09\x09\x09// Get search notice text\x0a\x09\x09\x09inputs.queryNotice = $( \x27#query-notice-message\x27 );\x0a\x09\x09\x09inputs.queryNoticeTextDefault = inputs.queryNotice.find( \x27.query-notice-default\x27 );\x0a\x09\x09\x09inputs.queryNoticeTextHint = inputs.queryNotice.find( \x27.query-notice-hint\x27 );\x0a\x0a\x09\x09\x09// Bind event handlers\x0a\x09\x09\x09inputs.dialog.keydown( wpLink.keydown );\x0a\x09\x09\x09inputs.dialog.keyup( wpLink.keyup );\x0a\x09\x09\x09inputs.submit.click( function( event ) {\x0a\x09\x09\x09\x09event.preventDefault();\x0a\x09\x09\x09\x09wpLink.update();\x0a\x09\x09\x09});\x0a\x0a\x09\x09\x09inputs.close.add( inputs.backdrop ).add( \x27#wp-link-cancel button\x27 ).click( function( event ) {\x0a\x09\x09\x09\x09event.preventDefault();\x0a\x09\x09\x09\x09wpLink.close();\x0a\x09\x09\x09});\x0a\x0a\x09\x09\x09rivers.elements.on( \x27river-select\x27, wpLink.updateFields );\x0a\x0a\x09\x09\x09// Display \x27hint\x27 message when search field or \x27query-results\x27 box are focused\x0a\x09\x09\x09inputs.search.on( \x27focus.wplink\x27, function() {\x0a\x09\x09\x09\x09inputs.queryNoticeTextDefault.hide();\x0a\x09\x09\x09\x09inputs.queryNoticeTextHint.removeClass( \x27screen-reader-text\x27 ).show();\x0a\x09\x09\x09} ).on( \x27blur.wplink\x27, function() {\x0a\x09\x09\x09\x09inputs.queryNoticeTextDefault.show();\x0a\x09\x09\x09\x09inputs.queryNoticeTextHint.addClass( \x27screen-reader-text\x27 ).hide();\x0a\x09\x09\x09} );\x0a\x0a\x09\x09\x09inputs.search.on( \x27keyup input\x27, function() {\x0a\x09\x09\x09\x09window.clearTimeout( searchTimer );\x0a\x09\x09\x09\x09searchTimer = window.setTimeout( function() {\x0a\x09\x09\x09\x09\x09wpLink.searchInternalLinks();\x0a\x09\x09\x09\x09}, 500 );\x0a\x09\x09\x09});\x0a\x0a\x09\x09\x09inputs.url.on( \x27paste\x27, function() {\x0a\x09\x09\x09\x09setTimeout( wpLink.correctURL, 0 );\x0a\x09\x09\x09} );\x0a\x0a\x09\x09\x09inputs.url.on( \x27blur\x27, wpLink.correctURL );\x0a\x09\x09},\x0a\x0a\x09\x09// If URL wasn\x27t corrected last time and doesn\x27t start with http:, https:, ? # or /, prepend http://\x0a\x09\x09correctURL: function () {\x0a\x09\x09\x09var url = $.trim( inputs.url.val() );\x0a\x0a\x09\x09\x09if ( url && correctedURL !== url && ! /^(?:[a-z]+:|#|\x5c?|\x5c.|\x5c/)/.test( url ) ) {\x0a\x09\x09\x09\x09inputs.url.val( \x27http://\x27 + url );\x0a\x09\x09\x09\x09correctedURL = url;\x0a\x09\x09\x09}\x0a\x09\x09},\x0a\x0a\x09\x09open: function( editorId, url, text ) {\x0a\x09\x09\x09var ed,\x0a\x09\x09\x09\x09$body = $( document.body );\x0a\x0a\x09\x09\x09$body.addClass( \x27modal-open\x27 );\x0a\x09\x09\x09wpLink.modalOpen = true;\x0a\x0a\x09\x09\x09wpLink.range = null;\x0a\x0a\x09\x09\x09if ( editorId ) {\x0a\x09\x09\x09\x09window.wpActiveEditor = editorId;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09if ( ! window.wpActiveEditor ) {\x0a\x09\x09\x09\x09return;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09this.textarea = $( \x27#\x27 + window.wpActiveEditor ).get( 0 );\x0a\x0a\x09\x09\x09if ( typeof window.tinymce !== \x27undefined\x27 ) {\x0a\x09\x09\x09\x09// Make sure the link wrapper is the last element in the body,\x0a\x09\x09\x09\x09// or the inline editor toolbar may show above the backdrop.\x0a\x09\x09\x09\x09$body.append( inputs.backdrop, inputs.wrap );\x0a\x0a\x09\x09\x09\x09ed = window.tinymce.get( window.wpActiveEditor );\x0a\x0a\x09\x09\x09\x09if ( ed && ! ed.isHidden() ) {\x0a\x09\x09\x09\x09\x09editor = ed;\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09editor = null;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09if ( ! wpLink.isMCE() && document.selection ) {\x0a\x09\x09\x09\x09this.textarea.focus();\x0a\x09\x09\x09\x09this.range = document.selection.createRange();\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09inputs.wrap.show();\x0a\x09\x09\x09inputs.backdrop.show();\x0a\x0a\x09\x09\x09wpLink.refresh( url, text );\x0a\x0a\x09\x09\x09$( document ).trigger( \x27wplink-open\x27, inputs.wrap );\x0a\x09\x09},\x0a\x0a\x09\x09isMCE: function() {\x0a\x09\x09\x09return editor && ! editor.isHidden();\x0a\x09\x09},\x0a\x0a\x09\x09refresh: function( url, text ) {\x0a\x09\x09\x09var linkText = \x27\x27;\x0a\x0a\x09\x09\x09// Refresh rivers (clear links, check visibility)\x0a\x09\x09\x09rivers.search.refresh();\x0a\x09\x09\x09rivers.recent.refresh();\x0a\x0a\x09\x09\x09if ( wpLink.isMCE() ) {\x0a\x09\x09\x09\x09wpLink.mceRefresh( url, text );\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09// For the Text editor the \x22Link text\x22 field is always shown\x0a\x09\x09\x09\x09if ( ! inputs.wrap.hasClass( \x27has-text-field\x27 ) ) {\x0a\x09\x09\x09\x09\x09inputs.wrap.addClass( \x27has-text-field\x27 );\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if ( document.selection ) {\x0a\x09\x09\x09\x09\x09// Old IE\x0a\x09\x09\x09\x09\x09linkText = document.selection.createRange().text || text || \x27\x27;\x0a\x09\x09\x09\x09} else if ( typeof this.textarea.selectionStart !== \x27undefined\x27 &&\x0a\x09\x09\x09\x09\x09( this.textarea.selectionStart !== this.textarea.selectionEnd ) ) {\x0a\x09\x09\x09\x09\x09// W3C\x0a\x09\x09\x09\x09\x09text = this.textarea.value.substring( this.textarea.selectionStart, this.textarea.selectionEnd ) || text || \x27\x27;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09inputs.text.val( text );\x0a\x09\x09\x09\x09wpLink.setDefaultValues();\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09if ( isTouch ) {\x0a\x09\x09\x09\x09// Close the onscreen keyboard\x0a\x09\x09\x09\x09inputs.url.focus().blur();\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09// Focus the URL field and highlight its contents.\x0a\x09\x09\x09\x09// If this is moved above the selection changes,\x0a\x09\x09\x09\x09// IE will show a flashing cursor over the dialog.\x0a\x09\x09\x09\x09window.setTimeout( function() {\x0a\x09\x09\x09\x09\x09inputs.url[0].select();\x0a\x09\x09\x09\x09\x09inputs.url.focus();\x0a\x09\x09\x09\x09} );\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09// Load the most recent results if this is the first time opening the panel.\x0a\x09\x09\x09if ( ! rivers.recent.ul.children().length ) {\x0a\x09\x09\x09\x09rivers.recent.ajax();\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09correctedURL = inputs.url.val().replace( /^http:\x5c/\x5c//, \x27\x27 );\x0a\x09\x09},\x0a\x0a\x09\x09hasSelectedText: function( linkNode ) {\x0a\x09\x09\x09var node, nodes, i, html = editor.selection.getContent();\x0a\x0a\x09\x09\x09// Partial html and not a fully selected anchor element\x0a\x09\x09\x09if ( /\x3c/.test( html ) && ( ! /^\x3ca [^\x3e]+\x3e[^\x3c]+\x3c\x5c/a\x3e$/.test( html ) || html.indexOf(\x27href=\x27) === -1 ) ) {\x0a\x09\x09\x09\x09return false;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09if ( linkNode.length ) {\x0a\x09\x09\x09\x09nodes = linkNode[0].childNodes;\x0a\x0a\x09\x09\x09\x09if ( ! nodes || ! nodes.length ) {\x0a\x09\x09\x09\x09\x09return false;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09for ( i = nodes.length - 1; i \x3e= 0; i-- ) {\x0a\x09\x09\x09\x09\x09node = nodes[i];\x0a\x0a\x09\x09\x09\x09\x09if ( node.nodeType != 3 && ! window.tinymce.dom.BookmarkManager.isBookmarkNode( node ) ) {\x0a\x09\x09\x09\x09\x09\x09return false;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09return true;\x0a\x09\x09},\x0a\x0a\x09\x09mceRefresh: function( searchStr, text ) {\x0a\x09\x09\x09var linkText, href,\x0a\x09\x09\x09\x09linkNode = getLink(),\x0a\x09\x09\x09\x09onlyText = this.hasSelectedText( linkNode );\x0a\x0a\x09\x09\x09if ( linkNode.length ) {\x0a\x09\x09\x09\x09linkText = linkNode.text();\x0a\x09\x09\x09\x09href = linkNode.attr( \x27href\x27 );\x0a\x0a\x09\x09\x09\x09if ( ! $.trim( linkText ) ) {\x0a\x09\x09\x09\x09\x09linkText = text || \x27\x27;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if ( searchStr && ( urlRegexp.test( searchStr ) || emailRegexp.test( searchStr ) ) ) {\x0a\x09\x09\x09\x09\x09href = searchStr;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if ( href !== \x27_wp_link_placeholder\x27 ) {\x0a\x09\x09\x09\x09\x09inputs.url.val( href );\x0a\x09\x09\x09\x09\x09inputs.openInNewTab.prop( \x27checked\x27, \x27_blank\x27 === linkNode.attr( \x27target\x27 ) );\x0a\x09\x09\x09\x09\x09inputs.submit.val( wpLinkL10n.update );\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09this.setDefaultValues( linkText );\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if ( searchStr && searchStr !== href ) {\x0a\x09\x09\x09\x09\x09// The user has typed something in the inline dialog. Trigger a search with it.\x0a\x09\x09\x09\x09\x09inputs.search.val( searchStr );\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09inputs.search.val( \x27\x27 );\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// Always reset the search\x0a\x09\x09\x09\x09window.setTimeout( function() {\x0a\x09\x09\x09\x09\x09wpLink.searchInternalLinks();\x0a\x09\x09\x09\x09} );\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09linkText = editor.selection.getContent({ format: \x27text\x27 }) || text || \x27\x27;\x0a\x09\x09\x09\x09this.setDefaultValues( linkText );\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09if ( onlyText ) {\x0a\x09\x09\x09\x09inputs.text.val( linkText );\x0a\x09\x09\x09\x09inputs.wrap.addClass( \x27has-text-field\x27 );\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09inputs.text.val( \x27\x27 );\x0a\x09\x09\x09\x09inputs.wrap.removeClass( \x27has-text-field\x27 );\x0a\x09\x09\x09}\x0a\x09\x09},\x0a\x0a\x09\x09close: function( reset ) {\x0a\x09\x09\x09$( document.body ).removeClass( \x27modal-open\x27 );\x0a\x09\x09\x09wpLink.modalOpen = false;\x0a\x0a\x09\x09\x09if ( reset !== \x27noReset\x27 ) {\x0a\x09\x09\x09\x09if ( ! wpLink.isMCE() ) {\x0a\x09\x09\x09\x09\x09wpLink.textarea.focus();\x0a\x0a\x09\x09\x09\x09\x09if ( wpLink.range ) {\x0a\x09\x09\x09\x09\x09\x09wpLink.range.moveToBookmark( wpLink.range.getBookmark() );\x0a\x09\x09\x09\x09\x09\x09wpLink.range.select();\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09if ( editor.plugins.wplink ) {\x0a\x09\x09\x09\x09\x09\x09editor.plugins.wplink.close();\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09editor.focus();\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09inputs.backdrop.hide();\x0a\x09\x09\x09inputs.wrap.hide();\x0a\x0a\x09\x09\x09correctedURL = false;\x0a\x0a\x09\x09\x09$( document ).trigger( \x27wplink-close\x27, inputs.wrap );\x0a\x09\x09},\x0a\x0a\x09\x09getAttrs: function() {\x0a\x09\x09\x09wpLink.correctURL();\x0a\x0a\x09\x09\x09return {\x0a\x09\x09\x09\x09href: $.trim( inputs.url.val() ),\x0a\x09\x09\x09\x09target: inputs.openInNewTab.prop( \x27checked\x27 ) ? \x27_blank\x27 : null\x0a\x09\x09\x09};\x0a\x09\x09},\x0a\x0a\x09\x09buildHtml: function(attrs) {\x0a\x09\x09\x09var html = \x27\x3ca href=\x22\x27 + attrs.href + \x27\x22\x27;\x0a\x0a\x09\x09\x09if ( attrs.target ) {\x0a\x09\x09\x09\x09html += \x27 rel=\x22noopener\x22 target=\x22\x27 + attrs.target + \x27\x22\x27;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09return html + \x27\x3e\x27;\x0a\x09\x09},\x0a\x0a\x09\x09update: function() {\x0a\x09\x09\x09if ( wpLink.isMCE() ) {\x0a\x09\x09\x09\x09wpLink.mceUpdate();\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09wpLink.htmlUpdate();\x0a\x09\x09\x09}\x0a\x09\x09},\x0a\x0a\x09\x09htmlUpdate: function() {\x0a\x09\x09\x09var attrs, text, html, begin, end, cursor, selection,\x0a\x09\x09\x09\x09textarea = wpLink.textarea;\x0a\x0a\x09\x09\x09if ( ! textarea ) {\x0a\x09\x09\x09\x09return;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09attrs = wpLink.getAttrs();\x0a\x09\x09\x09text = inputs.text.val();\x0a\x0a\x09\x09\x09var parser = document.createElement( \x27a\x27 );\x0a\x09\x09\x09parser.href = attrs.href;\x0a\x0a\x09\x09\x09if ( \x27javascript:\x27 === parser.protocol || \x27data:\x27 === parser.protocol ) { // jshint ignore:line\x0a\x09\x09\x09\x09attrs.href = \x27\x27;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09// If there\x27s no href, return.\x0a\x09\x09\x09if ( ! attrs.href ) {\x0a\x09\x09\x09\x09return;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09html = wpLink.buildHtml(attrs);\x0a\x0a\x09\x09\x09// Insert HTML\x0a\x09\x09\x09if ( document.selection && wpLink.range ) {\x0a\x09\x09\x09\x09// IE\x0a\x09\x09\x09\x09// Note: If no text is selected, IE will not place the cursor\x0a\x09\x09\x09\x09//       inside the closing tag.\x0a\x09\x09\x09\x09textarea.focus();\x0a\x09\x09\x09\x09wpLink.range.text = html + ( text || wpLink.range.text ) + \x27\x3c/a\x3e\x27;\x0a\x09\x09\x09\x09wpLink.range.moveToBookmark( wpLink.range.getBookmark() );\x0a\x09\x09\x09\x09wpLink.range.select();\x0a\x0a\x09\x09\x09\x09wpLink.range = null;\x0a\x09\x09\x09} else if ( typeof textarea.selectionStart !== \x27undefined\x27 ) {\x0a\x09\x09\x09\x09// W3C\x0a\x09\x09\x09\x09begin = textarea.selectionStart;\x0a\x09\x09\x09\x09end = textarea.selectionEnd;\x0a\x09\x09\x09\x09selection = text || textarea.value.substring( begin, end );\x0a\x09\x09\x09\x09html = html + selection + \x27\x3c/a\x3e\x27;\x0a\x09\x09\x09\x09cursor = begin + html.length;\x0a\x0a\x09\x09\x09\x09// If no text is selected, place the cursor inside the closing tag.\x0a\x09\x09\x09\x09if ( begin === end && ! selection ) {\x0a\x09\x09\x09\x09\x09cursor -= 4;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09textarea.value = (\x0a\x09\x09\x09\x09\x09textarea.value.substring( 0, begin ) +\x0a\x09\x09\x09\x09\x09html +\x0a\x09\x09\x09\x09\x09textarea.value.substring( end, textarea.value.length )\x0a\x09\x09\x09\x09);\x0a\x0a\x09\x09\x09\x09// Update cursor position\x0a\x09\x09\x09\x09textarea.selectionStart = textarea.selectionEnd = cursor;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09wpLink.close();\x0a\x09\x09\x09textarea.focus();\x0a\x09\x09\x09$( textarea ).trigger( \x27change\x27 );\x0a\x0a\x09\x09\x09// Audible confirmation message when a link has been inserted in the Editor.\x0a\x09\x09\x09wp.a11y.speak( wpLinkL10n.linkInserted );\x0a\x09\x09},\x0a\x0a\x09\x09mceUpdate: function() {\x0a\x09\x09\x09var attrs = wpLink.getAttrs(),\x0a\x09\x09\x09\x09$link, text, hasText;\x0a\x0a\x09\x09\x09var parser = document.createElement( \x27a\x27 );\x0a\x09\x09\x09parser.href = attrs.href;\x0a\x0a\x09\x09\x09if ( \x27javascript:\x27 === parser.protocol || \x27data:\x27 === parser.protocol ) { // jshint ignore:line\x0a\x09\x09\x09\x09attrs.href = \x27\x27;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09if ( ! attrs.href ) {\x0a\x09\x09\x09\x09editor.execCommand( \x27unlink\x27 );\x0a\x09\x09\x09\x09wpLink.close();\x0a\x09\x09\x09\x09return;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09$link = getLink();\x0a\x0a\x09\x09\x09editor.undoManager.transact( function() {\x0a\x09\x09\x09\x09if ( ! $link.length ) {\x0a\x09\x09\x09\x09\x09editor.execCommand( \x27mceInsertLink\x27, false, { href: \x27_wp_link_placeholder\x27, \x27data-wp-temp-link\x27: 1 } );\x0a\x09\x09\x09\x09\x09$link = editor.$( \x27a[data-wp-temp-link=\x221\x22]\x27 ).removeAttr( \x27data-wp-temp-link\x27 );\x0a\x09\x09\x09\x09\x09hasText = $.trim( $link.text() );\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if ( ! $link.length ) {\x0a\x09\x09\x09\x09\x09editor.execCommand( \x27unlink\x27 );\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09if ( inputs.wrap.hasClass( \x27has-text-field\x27 ) ) {\x0a\x09\x09\x09\x09\x09\x09text = inputs.text.val();\x0a\x0a\x09\x09\x09\x09\x09\x09if ( text ) {\x0a\x09\x09\x09\x09\x09\x09\x09$link.text( text );\x0a\x09\x09\x09\x09\x09\x09} else if ( ! hasText ) {\x0a\x09\x09\x09\x09\x09\x09\x09$link.text( attrs.href );\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09attrs[\x27data-wplink-edit\x27] = null;\x0a\x09\x09\x09\x09\x09attrs[\x27data-mce-href\x27] = attrs.href;\x0a\x09\x09\x09\x09\x09$link.attr( attrs );\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09} );\x0a\x0a\x09\x09\x09wpLink.close( \x27noReset\x27 );\x0a\x09\x09\x09editor.focus();\x0a\x0a\x09\x09\x09if ( $link.length ) {\x0a\x09\x09\x09\x09editor.selection.select( $link[0] );\x0a\x0a\x09\x09\x09\x09if ( editor.plugins.wplink ) {\x0a\x09\x09\x09\x09\x09editor.plugins.wplink.checkLink( $link[0] );\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09editor.nodeChanged();\x0a\x0a\x09\x09\x09// Audible confirmation message when a link has been inserted in the Editor.\x0a\x09\x09\x09wp.a11y.speak( wpLinkL10n.linkInserted );\x0a\x09\x09},\x0a\x0a\x09\x09updateFields: function( e, li ) {\x0a\x09\x09\x09inputs.url.val( li.children( \x27.item-permalink\x27 ).val() );\x0a\x0a\x09\x09\x09if ( inputs.wrap.hasClass( \x27has-text-field\x27 ) && ! inputs.text.val() ) {\x0a\x09\x09\x09\x09inputs.text.val( li.children( \x27.item-title\x27 ).text() );\x0a\x09\x09\x09}\x0a\x09\x09},\x0a\x0a\x09\x09getUrlFromSelection: function( selection ) {\x0a\x09\x09\x09if ( ! selection ) {\x0a\x09\x09\x09\x09if ( this.isMCE() ) {\x0a\x09\x09\x09\x09\x09selection = editor.selection.getContent({ format: \x27text\x27 });\x0a\x09\x09\x09\x09} else if ( document.selection && wpLink.range ) {\x0a\x09\x09\x09\x09\x09selection = wpLink.range.text;\x0a\x09\x09\x09\x09} else if ( typeof this.textarea.selectionStart !== \x27undefined\x27 ) {\x0a\x09\x09\x09\x09\x09selection = this.textarea.value.substring( this.textarea.selectionStart, this.textarea.selectionEnd );\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09selection = $.trim( selection );\x0a\x0a\x09\x09\x09if ( selection && emailRegexp.test( selection ) ) {\x0a\x09\x09\x09\x09// Selection is email address\x0a\x09\x09\x09\x09return \x27mailto:\x27 + selection;\x0a\x09\x09\x09} else if ( selection && urlRegexp.test( selection ) ) {\x0a\x09\x09\x09\x09// Selection is URL\x0a\x09\x09\x09\x09return selection.replace( /&amp;|&#0?38;/gi, \x27&\x27 );\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09return \x27\x27;\x0a\x09\x09},\x0a\x0a\x09\x09setDefaultValues: function( selection ) {\x0a\x09\x09\x09inputs.url.val( this.getUrlFromSelection( selection ) );\x0a\x0a\x09\x09\x09// Empty the search field and swap the \x22rivers\x22.\x0a\x09\x09\x09inputs.search.val(\x27\x27);\x0a\x09\x09\x09wpLink.searchInternalLinks();\x0a\x0a\x09\x09\x09// Update save prompt.\x0a\x09\x09\x09inputs.submit.val( wpLinkL10n.save );\x0a\x09\x09},\x0a\x0a\x09\x09searchInternalLinks: function() {\x0a\x09\x09\x09var waiting,\x0a\x09\x09\x09\x09search = inputs.search.val() || \x27\x27;\x0a\x0a\x09\x09\x09if ( search.length \x3e 2 ) {\x0a\x09\x09\x09\x09rivers.recent.hide();\x0a\x09\x09\x09\x09rivers.search.show();\x0a\x0a\x09\x09\x09\x09// Don\x27t search if the keypress didn\x27t change the title.\x0a\x09\x09\x09\x09if ( wpLink.lastSearch == search )\x0a\x09\x09\x09\x09\x09return;\x0a\x0a\x09\x09\x09\x09wpLink.lastSearch = search;\x0a\x09\x09\x09\x09waiting = inputs.search.parent().find( \x27.spinner\x27 ).addClass( \x27is-active\x27 );\x0a\x0a\x09\x09\x09\x09rivers.search.change( search );\x0a\x09\x09\x09\x09rivers.search.ajax( function() {\x0a\x09\x09\x09\x09\x09waiting.removeClass( \x27is-active\x27 );\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09rivers.search.hide();\x0a\x09\x09\x09\x09rivers.recent.show();\x0a\x09\x09\x09}\x0a\x09\x09},\x0a\x0a\x09\x09next: function() {\x0a\x09\x09\x09rivers.search.next();\x0a\x09\x09\x09rivers.recent.next();\x0a\x09\x09},\x0a\x0a\x09\x09prev: function() {\x0a\x09\x09\x09rivers.search.prev();\x0a\x09\x09\x09rivers.recent.prev();\x0a\x09\x09},\x0a\x0a\x09\x09keydown: function( event ) {\x0a\x09\x09\x09var fn, id;\x0a\x0a\x09\x09\x09// Escape key.\x0a\x09\x09\x09if ( 27 === event.keyCode ) {\x0a\x09\x09\x09\x09wpLink.close();\x0a\x09\x09\x09\x09event.stopImmediatePropagation();\x0a\x09\x09\x09// Tab key.\x0a\x09\x09\x09} else if ( 9 === event.keyCode ) {\x0a\x09\x09\x09\x09id = event.target.id;\x0a\x0a\x09\x09\x09\x09// wp-link-submit must always be the last focusable element in the dialog.\x0a\x09\x09\x09\x09// following focusable elements will be skipped on keyboard navigation.\x0a\x09\x09\x09\x09if ( id === \x27wp-link-submit\x27 && ! event.shiftKey ) {\x0a\x09\x09\x09\x09\x09inputs.close.focus();\x0a\x09\x09\x09\x09\x09event.preventDefault();\x0a\x09\x09\x09\x09} else if ( id === \x27wp-link-close\x27 && event.shiftKey ) {\x0a\x09\x09\x09\x09\x09inputs.submit.focus();\x0a\x09\x09\x09\x09\x09event.preventDefault();\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09// Up Arrow and Down Arrow keys.\x0a\x09\x09\x09if ( event.shiftKey || ( 38 !== event.keyCode && 40 !== event.keyCode ) ) {\x0a\x09\x09\x09\x09return;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09if ( document.activeElement &&\x0a\x09\x09\x09\x09( document.activeElement.id === \x27link-title-field\x27 || document.activeElement.id === \x27url-field\x27 ) ) {\x0a\x09\x09\x09\x09return;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09// Up Arrow key.\x0a\x09\x09\x09fn = 38 === event.keyCode ? \x27prev\x27 : \x27next\x27;\x0a\x09\x09\x09clearInterval( wpLink.keyInterval );\x0a\x09\x09\x09wpLink[ fn ]();\x0a\x09\x09\x09wpLink.keyInterval = setInterval( wpLink[ fn ], wpLink.keySensitivity );\x0a\x09\x09\x09event.preventDefault();\x0a\x09\x09},\x0a\x0a\x09\x09keyup: function( event ) {\x0a\x09\x09\x09// Up Arrow and Down Arrow keys.\x0a\x09\x09\x09if ( 38 === event.keyCode || 40 === event.keyCode ) {\x0a\x09\x09\x09\x09clearInterval( wpLink.keyInterval );\x0a\x09\x09\x09\x09event.preventDefault();\x0a\x09\x09\x09}\x0a\x09\x09},\x0a\x0a\x09\x09delayedCallback: function( func, delay ) {\x0a\x09\x09\x09var timeoutTriggered, funcTriggered, funcArgs, funcContext;\x0a\x0a\x09\x09\x09if ( ! delay )\x0a\x09\x09\x09\x09return func;\x0a\x0a\x09\x09\x09setTimeout( function() {\x0a\x09\x09\x09\x09if ( funcTriggered )\x0a\x09\x09\x09\x09\x09return func.apply( funcContext, funcArgs );\x0a\x09\x09\x09\x09// Otherwise, wait.\x0a\x09\x09\x09\x09timeoutTriggered = true;\x0a\x09\x09\x09}, delay );\x0a\x0a\x09\x09\x09return function() {\x0a\x09\x09\x09\x09if ( timeoutTriggered )\x0a\x09\x09\x09\x09\x09return func.apply( this, arguments );\x0a\x09\x09\x09\x09// Otherwise, wait.\x0a\x09\x09\x09\x09funcArgs = arguments;\x0a\x09\x09\x09\x09funcContext = this;\x0a\x09\x09\x09\x09funcTriggered = true;\x0a\x09\x09\x09};\x0a\x09\x09}\x0a\x09};\x0a\x0a\x09River = function( element, search ) {\x0a\x09\x09var self = this;\x0a\x09\x09this.element = element;\x0a\x09\x09this.ul = element.children( \x27ul\x27 );\x0a\x09\x09this.contentHeight = element.children( \x27#link-selector-height\x27 );\x0a\x09\x09this.waiting = element.find(\x27.river-waiting\x27);\x0a\x0a\x09\x09this.change( search );\x0a\x09\x09this.refresh();\x0a\x0a\x09\x09$( \x27#wp-link .query-results, #wp-link #link-selector\x27 ).scroll( function() {\x0a\x09\x09\x09self.maybeLoad();\x0a\x09\x09});\x0a\x09\x09element.on( \x27click\x27, \x27li\x27, function( event ) {\x0a\x09\x09\x09self.select( $( this ), event );\x0a\x09\x09});\x0a\x09};\x0a\x0a\x09$.extend( River.prototype, {\x0a\x09\x09refresh: function() {\x0a\x09\x09\x09this.deselect();\x0a\x09\x09\x09this.visible = this.element.is( \x27:visible\x27 );\x0a\x09\x09},\x0a\x09\x09show: function() {\x0a\x09\x09\x09if ( ! this.visible ) {\x0a\x09\x09\x09\x09this.deselect();\x0a\x09\x09\x09\x09this.element.show();\x0a\x09\x09\x09\x09this.visible = true;\x0a\x09\x09\x09}\x0a\x09\x09},\x0a\x09\x09hide: function() {\x0a\x09\x09\x09this.element.hide();\x0a\x09\x09\x09this.visible = false;\x0a\x09\x09},\x0a\x09\x09// Selects a list item and triggers the river-select event.\x0a\x09\x09select: function( li, event ) {\x0a\x09\x09\x09var liHeight, elHeight, liTop, elTop;\x0a\x0a\x09\x09\x09if ( li.hasClass( \x27unselectable\x27 ) || li == this.selected )\x0a\x09\x09\x09\x09return;\x0a\x0a\x09\x09\x09this.deselect();\x0a\x09\x09\x09this.selected = li.addClass( \x27selected\x27 );\x0a\x09\x09\x09// Make sure the element is visible\x0a\x09\x09\x09liHeight = li.outerHeight();\x0a\x09\x09\x09elHeight = this.element.height();\x0a\x09\x09\x09liTop = li.position().top;\x0a\x09\x09\x09elTop = this.element.scrollTop();\x0a\x0a\x09\x09\x09if ( liTop \x3c 0 ) // Make first visible element\x0a\x09\x09\x09\x09this.element.scrollTop( elTop + liTop );\x0a\x09\x09\x09else if ( liTop + liHeight \x3e elHeight ) // Make last visible element\x0a\x09\x09\x09\x09this.element.scrollTop( elTop + liTop - elHeight + liHeight );\x0a\x0a\x09\x09\x09// Trigger the river-select event\x0a\x09\x09\x09this.element.trigger( \x27river-select\x27, [ li, event, this ] );\x0a\x09\x09},\x0a\x09\x09deselect: function() {\x0a\x09\x09\x09if ( this.selected )\x0a\x09\x09\x09\x09this.selected.removeClass( \x27selected\x27 );\x0a\x09\x09\x09this.selected = false;\x0a\x09\x09},\x0a\x09\x09prev: function() {\x0a\x09\x09\x09if ( ! this.visible )\x0a\x09\x09\x09\x09return;\x0a\x0a\x09\x09\x09var to;\x0a\x09\x09\x09if ( this.selected ) {\x0a\x09\x09\x09\x09to = this.selected.prev( \x27li\x27 );\x0a\x09\x09\x09\x09if ( to.length )\x0a\x09\x09\x09\x09\x09this.select( to );\x0a\x09\x09\x09}\x0a\x09\x09},\x0a\x09\x09next: function() {\x0a\x09\x09\x09if ( ! this.visible )\x0a\x09\x09\x09\x09return;\x0a\x0a\x09\x09\x09var to = this.selected ? this.selected.next( \x27li\x27 ) : $( \x27li:not(.unselectable):first\x27, this.element );\x0a\x09\x09\x09if ( to.length )\x0a\x09\x09\x09\x09this.select( to );\x0a\x09\x09},\x0a\x09\x09ajax: function( callback ) {\x0a\x09\x09\x09var self = this,\x0a\x09\x09\x09\x09delay = this.query.page == 1 ? 0 : wpLink.minRiverAJAXDuration,\x0a\x09\x09\x09\x09response = wpLink.delayedCallback( function( results, params ) {\x0a\x09\x09\x09\x09\x09self.process( results, params );\x0a\x09\x09\x09\x09\x09if ( callback )\x0a\x09\x09\x09\x09\x09\x09callback( results, params );\x0a\x09\x09\x09\x09}, delay );\x0a\x0a\x09\x09\x09this.query.ajax( response );\x0a\x09\x09},\x0a\x09\x09change: function( search ) {\x0a\x09\x09\x09if ( this.query && this._search == search )\x0a\x09\x09\x09\x09return;\x0a\x0a\x09\x09\x09this._search = search;\x0a\x09\x09\x09this.query = new Query( search );\x0a\x09\x09\x09this.element.scrollTop( 0 );\x0a\x09\x09},\x0a\x09\x09process: function( results, params ) {\x0a\x09\x09\x09var list = \x27\x27, alt = true, classes = \x27\x27,\x0a\x09\x09\x09\x09firstPage = params.page == 1;\x0a\x0a\x09\x09\x09if ( ! results ) {\x0a\x09\x09\x09\x09if ( firstPage ) {\x0a\x09\x09\x09\x09\x09list += \x27\x3cli class=\x22unselectable no-matches-found\x22\x3e\x3cspan class=\x22item-title\x22\x3e\x3cem\x3e\x27 +\x0a\x09\x09\x09\x09\x09\x09wpLinkL10n.noMatchesFound + \x27\x3c/em\x3e\x3c/span\x3e\x3c/li\x3e\x27;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09$.each( results, function() {\x0a\x09\x09\x09\x09\x09classes = alt ? \x27alternate\x27 : \x27\x27;\x0a\x09\x09\x09\x09\x09classes += this.title ? \x27\x27 : \x27 no-title\x27;\x0a\x09\x09\x09\x09\x09list += classes ? \x27\x3cli class=\x22\x27 + classes + \x27\x22\x3e\x27 : \x27\x3cli\x3e\x27;\x0a\x09\x09\x09\x09\x09list += \x27\x3cinput type=\x22hidden\x22 class=\x22item-permalink\x22 value=\x22\x27 + this.permalink + \x27\x22 /\x3e\x27;\x0a\x09\x09\x09\x09\x09list += \x27\x3cspan class=\x22item-title\x22\x3e\x27;\x0a\x09\x09\x09\x09\x09list += this.title ? this.title : wpLinkL10n.noTitle;\x0a\x09\x09\x09\x09\x09list += \x27\x3c/span\x3e\x3cspan class=\x22item-info\x22\x3e\x27 + this.info + \x27\x3c/span\x3e\x3c/li\x3e\x27;\x0a\x09\x09\x09\x09\x09alt = ! alt;\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09this.ul[ firstPage ? \x27html\x27 : \x27append\x27 ]( list );\x0a\x09\x09},\x0a\x09\x09maybeLoad: function() {\x0a\x09\x09\x09var self = this,\x0a\x09\x09\x09\x09el = this.element,\x0a\x09\x09\x09\x09bottom = el.scrollTop() + el.height();\x0a\x0a\x09\x09\x09if ( ! this.query.ready() || bottom \x3c this.contentHeight.height() - wpLink.riverBottomThreshold )\x0a\x09\x09\x09\x09return;\x0a\x0a\x09\x09\x09setTimeout(function() {\x0a\x09\x09\x09\x09var newTop = el.scrollTop(),\x0a\x09\x09\x09\x09\x09newBottom = newTop + el.height();\x0a\x0a\x09\x09\x09\x09if ( ! self.query.ready() || newBottom \x3c self.contentHeight.height() - wpLink.riverBottomThreshold )\x0a\x09\x09\x09\x09\x09return;\x0a\x0a\x09\x09\x09\x09self.waiting.addClass( \x27is-active\x27 );\x0a\x09\x09\x09\x09el.scrollTop( newTop + self.waiting.outerHeight() );\x0a\x0a\x09\x09\x09\x09self.ajax( function() {\x0a\x09\x09\x09\x09\x09self.waiting.removeClass( \x27is-active\x27 );\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09}, wpLink.timeToTriggerRiver );\x0a\x09\x09}\x0a\x09});\x0a\x0a\x09Query = function( search ) {\x0a\x09\x09this.page = 1;\x0a\x09\x09this.allLoaded = false;\x0a\x09\x09this.querying = false;\x0a\x09\x09this.search = search;\x0a\x09};\x0a\x0a\x09$.extend( Query.prototype, {\x0a\x09\x09ready: function() {\x0a\x09\x09\x09return ! ( this.querying || this.allLoaded );\x0a\x09\x09},\x0a\x09\x09ajax: function( callback ) {\x0a\x09\x09\x09var self = this,\x0a\x09\x09\x09\x09query = {\x0a\x09\x09\x09\x09\x09action : \x27wp-link-ajax\x27,\x0a\x09\x09\x09\x09\x09page : this.page,\x0a\x09\x09\x09\x09\x09\x27_ajax_linking_nonce\x27 : inputs.nonce.val()\x0a\x09\x09\x09\x09};\x0a\x0a\x09\x09\x09if ( this.search )\x0a\x09\x09\x09\x09query.search = this.search;\x0a\x0a\x09\x09\x09this.querying = true;\x0a\x0a\x09\x09\x09$.post( window.ajaxurl, query, function( r ) {\x0a\x09\x09\x09\x09self.page++;\x0a\x09\x09\x09\x09self.querying = false;\x0a\x09\x09\x09\x09self.allLoaded = ! r;\x0a\x09\x09\x09\x09callback( r, query );\x0a\x09\x09\x09}, \x27json\x27 );\x0a\x09\x09}\x0a\x09});\x0a\x0a\x09$( document ).ready( wpLink.init );\x0a})( jQuery, window.wpLinkL10n, window.wp );\x0a'}