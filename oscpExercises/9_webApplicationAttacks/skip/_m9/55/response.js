var res = {'data':'HTTP/1.1 200 OK\x0aDate: Sun, 20 Sep 2020 15:00:03 GMT\x0aServer: Apache/2.4.29 (Ubuntu)\x0aLast-Modified: Fri, 22 Sep 2017 20:10:48 GMT\x0aETag: \x223e084-559ccce022200-gzip\x22\x0aAccept-Ranges: bytes\x0aVary: Accept-Encoding\x0aContent-Encoding: gzip\x0aKeep-Alive: timeout=5, max=77\x0aConnection: Keep-Alive\x0aTransfer-Encoding: chunked\x0aContent-Type: application/javascript\x0a\x0a;var MXI_DEBUG = false;\x0a/**\x0a * mOxie - multi-runtime File API & XMLHttpRequest L2 Polyfill\x0a * v1.3.5\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a *\x0a * Date: 2016-05-15\x0a */\x0a/**\x0a * Compiled inline version. (Library mode)\x0a */\x0a\x0a/**\x0a * Modified for WordPress, Silverlight and Flash runtimes support was removed.\x0a * See https://core.trac.wordpress.org/ticket/41755.\x0a */\x0a\x0a/*jshint smarttabs:true, undef:true, latedef:true, curly:true, bitwise:true, camelcase:true */\x0a/*globals $code */\x0a\x0a(function(exports, undefined) {\x0a\x09\x22use strict\x22;\x0a\x0a\x09var modules = {};\x0a\x0a\x09function require(ids, callback) {\x0a\x09\x09var module, defs = [];\x0a\x0a\x09\x09for (var i = 0; i \x3c ids.length; ++i) {\x0a\x09\x09\x09module = modules[ids[i]] || resolve(ids[i]);\x0a\x09\x09\x09if (!module) {\x0a\x09\x09\x09\x09throw \x27module definition dependecy not found: \x27 + ids[i];\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09defs.push(module);\x0a\x09\x09}\x0a\x0a\x09\x09callback.apply(null, defs);\x0a\x09}\x0a\x0a\x09function define(id, dependencies, definition) {\x0a\x09\x09if (typeof id !== \x27string\x27) {\x0a\x09\x09\x09throw \x27invalid module definition, module id must be defined and be a string\x27;\x0a\x09\x09}\x0a\x0a\x09\x09if (dependencies === undefined) {\x0a\x09\x09\x09throw \x27invalid module definition, dependencies must be specified\x27;\x0a\x09\x09}\x0a\x0a\x09\x09if (definition === undefined) {\x0a\x09\x09\x09throw \x27invalid module definition, definition function must be specified\x27;\x0a\x09\x09}\x0a\x0a\x09\x09require(dependencies, function() {\x0a\x09\x09\x09modules[id] = definition.apply(null, arguments);\x0a\x09\x09});\x0a\x09}\x0a\x0a\x09function defined(id) {\x0a\x09\x09return !!modules[id];\x0a\x09}\x0a\x0a\x09function resolve(id) {\x0a\x09\x09var target = exports;\x0a\x09\x09var fragments = id.split(/[.\x5c/]/);\x0a\x0a\x09\x09for (var fi = 0; fi \x3c fragments.length; ++fi) {\x0a\x09\x09\x09if (!target[fragments[fi]]) {\x0a\x09\x09\x09\x09return;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09target = target[fragments[fi]];\x0a\x09\x09}\x0a\x0a\x09\x09return target;\x0a\x09}\x0a\x0a\x09function expose(ids) {\x0a\x09\x09for (var i = 0; i \x3c ids.length; i++) {\x0a\x09\x09\x09var target = exports;\x0a\x09\x09\x09var id = ids[i];\x0a\x09\x09\x09var fragments = id.split(/[.\x5c/]/);\x0a\x0a\x09\x09\x09for (var fi = 0; fi \x3c fragments.length - 1; ++fi) {\x0a\x09\x09\x09\x09if (target[fragments[fi]] === undefined) {\x0a\x09\x09\x09\x09\x09target[fragments[fi]] = {};\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09target = target[fragments[fi]];\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09target[fragments[fragments.length - 1]] = modules[id];\x0a\x09\x09}\x0a\x09}\x0a\x0a// Included from: src/javascript/core/utils/Basic.js\x0a\x0a/**\x0a * Basic.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x27moxie/core/utils/Basic\x27, [], function() {\x0a\x09/**\x0a\x09Gets the true type of the built-in object (better version of typeof).\x0a\x09@author Angus Croll (http://javascriptweblog.wordpress.com/)\x0a\x0a\x09@method typeOf\x0a\x09@for Utils\x0a\x09@static\x0a\x09@param {Object} o Object to check.\x0a\x09@return {String} Object [[Class]]\x0a\x09*/\x0a\x09var typeOf = function(o) {\x0a\x09\x09var undef;\x0a\x0a\x09\x09if (o === undef) {\x0a\x09\x09\x09return \x27undefined\x27;\x0a\x09\x09} else if (o === null) {\x0a\x09\x09\x09return \x27null\x27;\x0a\x09\x09} else if (o.nodeType) {\x0a\x09\x09\x09return \x27node\x27;\x0a\x09\x09}\x0a\x0a\x09\x09// the snippet below is awesome, however it fails to detect null, undefined and arguments types in IE lte 8\x0a\x09\x09return ({}).toString.call(o).match(/\x5cs([a-z|A-Z]+)/)[1].toLowerCase();\x0a\x09};\x0a\x09\x09\x0a\x09/**\x0a\x09Extends the specified object with another object.\x0a\x0a\x09@method extend\x0a\x09@static\x0a\x09@param {Object} target Object to extend.\x0a\x09@param {Object} [obj]* Multiple objects to extend with.\x0a\x09@return {Object} Same as target, the extended object.\x0a\x09*/\x0a\x09var extend = function(target) {\x0a\x09\x09var undef;\x0a\x0a\x09\x09each(arguments, function(arg, i) {\x0a\x09\x09\x09if (i \x3e 0) {\x0a\x09\x09\x09\x09each(arg, function(value, key) {\x0a\x09\x09\x09\x09\x09if (value !== undef) {\x0a\x09\x09\x09\x09\x09\x09if (typeOf(target[key]) === typeOf(value) && !!~inArray(typeOf(value), [\x27array\x27, \x27object\x27])) {\x0a\x09\x09\x09\x09\x09\x09\x09extend(target[key], value);\x0a\x09\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09\x09target[key] = value;\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x09\x09return target;\x0a\x09};\x0a\x09\x09\x0a\x09/**\x0a\x09Executes the callback function for each item in array/object. If you return false in the\x0a\x09callback it will break the loop.\x0a\x0a\x09@method each\x0a\x09@static\x0a\x09@param {Object} obj Object to iterate.\x0a\x09@param {function} callback Callback function to execute for each item.\x0a\x09*/\x0a\x09var each = function(obj, callback) {\x0a\x09\x09var length, key, i, undef;\x0a\x0a\x09\x09if (obj) {\x0a\x09\x09\x09if (typeOf(obj.length) === \x27number\x27) { // it might be Array, FileList or even arguments object\x0a\x09\x09\x09\x09// Loop array items\x0a\x09\x09\x09\x09for (i = 0, length = obj.length; i \x3c length; i++) {\x0a\x09\x09\x09\x09\x09if (callback(obj[i], i) === false) {\x0a\x09\x09\x09\x09\x09\x09return;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09} else if (typeOf(obj) === \x27object\x27) {\x0a\x09\x09\x09\x09// Loop object items\x0a\x09\x09\x09\x09for (key in obj) {\x0a\x09\x09\x09\x09\x09if (obj.hasOwnProperty(key)) {\x0a\x09\x09\x09\x09\x09\x09if (callback(obj[key], key) === false) {\x0a\x09\x09\x09\x09\x09\x09\x09return;\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x09};\x0a\x0a\x09/**\x0a\x09Checks if object is empty.\x0a\x09\x0a\x09@method isEmptyObj\x0a\x09@static\x0a\x09@param {Object} o Object to check.\x0a\x09@return {Boolean}\x0a\x09*/\x0a\x09var isEmptyObj = function(obj) {\x0a\x09\x09var prop;\x0a\x0a\x09\x09if (!obj || typeOf(obj) !== \x27object\x27) {\x0a\x09\x09\x09return true;\x0a\x09\x09}\x0a\x0a\x09\x09for (prop in obj) {\x0a\x09\x09\x09return false;\x0a\x09\x09}\x0a\x0a\x09\x09return true;\x0a\x09};\x0a\x0a\x09/**\x0a\x09Recieve an array of functions (usually async) to call in sequence, each  function\x0a\x09receives a callback as first argument that it should call, when it completes. Finally,\x0a\x09after everything is complete, main callback is called. Passing truthy value to the\x0a\x09callback as a first argument will interrupt the sequence and invoke main callback\x0a\x09immediately.\x0a\x0a\x09@method inSeries\x0a\x09@static\x0a\x09@param {Array} queue Array of functions to call in sequence\x0a\x09@param {Function} cb Main callback that is called in the end, or in case of error\x0a\x09*/\x0a\x09var inSeries = function(queue, cb) {\x0a\x09\x09var i = 0, length = queue.length;\x0a\x0a\x09\x09if (typeOf(cb) !== \x27function\x27) {\x0a\x09\x09\x09cb = function() {};\x0a\x09\x09}\x0a\x0a\x09\x09if (!queue || !queue.length) {\x0a\x09\x09\x09cb();\x0a\x09\x09}\x0a\x0a\x09\x09function callNext(i) {\x0a\x09\x09\x09if (typeOf(queue[i]) === \x27function\x27) {\x0a\x09\x09\x09\x09queue[i](function(error) {\x0a\x09\x09\x09\x09\x09/*jshint expr:true */\x0a\x09\x09\x09\x09\x09++i \x3c length && !error ? callNext(i) : cb(error);\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x09\x09callNext(i);\x0a\x09};\x0a\x0a\x0a\x09/**\x0a\x09Recieve an array of functions (usually async) to call in parallel, each  function\x0a\x09receives a callback as first argument that it should call, when it completes. After \x0a\x09everything is complete, main callback is called. Passing truthy value to the\x0a\x09callback as a first argument will interrupt the process and invoke main callback\x0a\x09immediately.\x0a\x0a\x09@method inParallel\x0a\x09@static\x0a\x09@param {Array} queue Array of functions to call in sequence\x0a\x09@param {Function} cb Main callback that is called in the end, or in case of error\x0a\x09*/\x0a\x09var inParallel = function(queue, cb) {\x0a\x09\x09var count = 0, num = queue.length, cbArgs = new Array(num);\x0a\x0a\x09\x09each(queue, function(fn, i) {\x0a\x09\x09\x09fn(function(error) {\x0a\x09\x09\x09\x09if (error) {\x0a\x09\x09\x09\x09\x09return cb(error);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09var args = [].slice.call(arguments);\x0a\x09\x09\x09\x09args.shift(); // strip error - undefined or not\x0a\x0a\x09\x09\x09\x09cbArgs[i] = args;\x0a\x09\x09\x09\x09count++;\x0a\x0a\x09\x09\x09\x09if (count === num) {\x0a\x09\x09\x09\x09\x09cbArgs.unshift(null);\x0a\x09\x09\x09\x09\x09cb.apply(this, cbArgs);\x0a\x09\x09\x09\x09} \x0a\x09\x09\x09});\x0a\x09\x09});\x0a\x09};\x0a\x09\x0a\x09\x0a\x09/**\x0a\x09Find an element in array and return it\x27s index if present, otherwise return -1.\x0a\x09\x0a\x09@method inArray\x0a\x09@static\x0a\x09@param {Mixed} needle Element to find\x0a\x09@param {Array} array\x0a\x09@return {Int} Index of the element, or -1 if not found\x0a\x09*/\x0a\x09var inArray = function(needle, array) {\x0a\x09\x09if (array) {\x0a\x09\x09\x09if (Array.prototype.indexOf) {\x0a\x09\x09\x09\x09return Array.prototype.indexOf.call(array, needle);\x0a\x09\x09\x09}\x0a\x09\x09\x0a\x09\x09\x09for (var i = 0, length = array.length; i \x3c length; i++) {\x0a\x09\x09\x09\x09if (array[i] === needle) {\x0a\x09\x09\x09\x09\x09return i;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x09\x09return -1;\x0a\x09};\x0a\x0a\x0a\x09/**\x0a\x09Returns elements of first array if they are not present in second. And false - otherwise.\x0a\x0a\x09@private\x0a\x09@method arrayDiff\x0a\x09@param {Array} needles\x0a\x09@param {Array} array\x0a\x09@return {Array|Boolean}\x0a\x09*/\x0a\x09var arrayDiff = function(needles, array) {\x0a\x09\x09var diff = [];\x0a\x0a\x09\x09if (typeOf(needles) !== \x27array\x27) {\x0a\x09\x09\x09needles = [needles];\x0a\x09\x09}\x0a\x0a\x09\x09if (typeOf(array) !== \x27array\x27) {\x0a\x09\x09\x09array = [array];\x0a\x09\x09}\x0a\x0a\x09\x09for (var i in needles) {\x0a\x09\x09\x09if (inArray(needles[i], array) === -1) {\x0a\x09\x09\x09\x09diff.push(needles[i]);\x0a\x09\x09\x09}\x09\x0a\x09\x09}\x0a\x09\x09return diff.length ? diff : false;\x0a\x09};\x0a\x0a\x0a\x09/**\x0a\x09Find intersection of two arrays.\x0a\x0a\x09@private\x0a\x09@method arrayIntersect\x0a\x09@param {Array} array1\x0a\x09@param {Array} array2\x0a\x09@return {Array} Intersection of two arrays or null if there is none\x0a\x09*/\x0a\x09var arrayIntersect = function(array1, array2) {\x0a\x09\x09var result = [];\x0a\x09\x09each(array1, function(item) {\x0a\x09\x09\x09if (inArray(item, array2) !== -1) {\x0a\x09\x09\x09\x09result.push(item);\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x09\x09return result.length ? result : null;\x0a\x09};\x0a\x09\x0a\x09\x0a\x09/**\x0a\x09Forces anything into an array.\x0a\x09\x0a\x09@method toArray\x0a\x09@static\x0a\x09@param {Object} obj Object with length field.\x0a\x09@return {Array} Array object containing all items.\x0a\x09*/\x0a\x09var toArray = function(obj) {\x0a\x09\x09var i, arr = [];\x0a\x0a\x09\x09for (i = 0; i \x3c obj.length; i++) {\x0a\x09\x09\x09arr[i] = obj[i];\x0a\x09\x09}\x0a\x0a\x09\x09return arr;\x0a\x09};\x0a\x09\x0a\x09\x09\x09\x0a\x09/**\x0a\x09Generates an unique ID. The only way a user would be able to get the same ID is if the two persons\x0a\x09at the same exact millisecond manage to get the same 5 random numbers between 0-65535; it also uses \x0a\x09a counter so each ID is guaranteed to be unique for the given page. It is more probable for the earth \x0a\x09to be hit with an asteroid.\x0a\x09\x0a\x09@method guid\x0a\x09@static\x0a\x09@param {String} prefix to prepend (by default \x27o\x27 will be prepended).\x0a\x09@method guid\x0a\x09@return {String} Virtually unique id.\x0a\x09*/\x0a\x09var guid = (function() {\x0a\x09\x09var counter = 0;\x0a\x09\x09\x0a\x09\x09return function(prefix) {\x0a\x09\x09\x09var guid = new Date().getTime().toString(32), i;\x0a\x0a\x09\x09\x09for (i = 0; i \x3c 5; i++) {\x0a\x09\x09\x09\x09guid += Math.floor(Math.random() * 65535).toString(32);\x0a\x09\x09\x09}\x0a\x09\x09\x09\x0a\x09\x09\x09return (prefix || \x27o_\x27) + guid + (counter++).toString(32);\x0a\x09\x09};\x0a\x09}());\x0a\x09\x0a\x0a\x09/**\x0a\x09Trims white spaces around the string\x0a\x09\x0a\x09@method trim\x0a\x09@static\x0a\x09@param {String} str\x0a\x09@return {String}\x0a\x09*/\x0a\x09var trim = function(str) {\x0a\x09\x09if (!str) {\x0a\x09\x09\x09return str;\x0a\x09\x09}\x0a\x09\x09return String.prototype.trim ? String.prototype.trim.call(str) : str.toString().replace(/^\x5cs*/, \x27\x27).replace(/\x5cs*$/, \x27\x27);\x0a\x09};\x0a\x0a\x0a\x09/**\x0a\x09Parses the specified size string into a byte value. For example 10kb becomes 10240.\x0a\x09\x0a\x09@method parseSizeStr\x0a\x09@static\x0a\x09@param {String/Number} size String to parse or number to just pass through.\x0a\x09@return {Number} Size in bytes.\x0a\x09*/\x0a\x09var parseSizeStr = function(size) {\x0a\x09\x09if (typeof(size) !== \x27string\x27) {\x0a\x09\x09\x09return size;\x0a\x09\x09}\x0a\x09\x09\x0a\x09\x09var muls = {\x0a\x09\x09\x09\x09t: 1099511627776,\x0a\x09\x09\x09\x09g: 1073741824,\x0a\x09\x09\x09\x09m: 1048576,\x0a\x09\x09\x09\x09k: 1024\x0a\x09\x09\x09},\x0a\x09\x09\x09mul;\x0a\x0a\x0a\x09\x09size = /^([0-9\x5c.]+)([tmgk]?)$/.exec(size.toLowerCase().replace(/[^0-9\x5c.tmkg]/g, \x27\x27));\x0a\x09\x09mul = size[2];\x0a\x09\x09size = +size[1];\x0a\x09\x09\x0a\x09\x09if (muls.hasOwnProperty(mul)) {\x0a\x09\x09\x09size *= muls[mul];\x0a\x09\x09}\x0a\x09\x09return Math.floor(size);\x0a\x09};\x0a\x0a\x0a\x09/**\x0a\x09 * Pseudo sprintf implementation - simple way to replace tokens with specified values.\x0a\x09 *\x0a\x09 * @param {String} str String with tokens\x0a\x09 * @return {String} String with replaced tokens\x0a\x09 */\x0a\x09var sprintf = function(str) {\x0a\x09\x09var args = [].slice.call(arguments, 1);\x0a\x0a\x09\x09return str.replace(/%[a-z]/g, function() {\x0a\x09\x09\x09var value = args.shift();\x0a\x09\x09\x09return typeOf(value) !== \x27undefined\x27 ? value : \x27\x27;\x0a\x09\x09});\x0a\x09};\x0a\x09\x0a\x0a\x09return {\x0a\x09\x09guid: guid,\x0a\x09\x09typeOf: typeOf,\x0a\x09\x09extend: extend,\x0a\x09\x09each: each,\x0a\x09\x09isEmptyObj: isEmptyObj,\x0a\x09\x09inSeries: inSeries,\x0a\x09\x09inParallel: inParallel,\x0a\x09\x09inArray: inArray,\x0a\x09\x09arrayDiff: arrayDiff,\x0a\x09\x09arrayIntersect: arrayIntersect,\x0a\x09\x09toArray: toArray,\x0a\x09\x09trim: trim,\x0a\x09\x09sprintf: sprintf,\x0a\x09\x09parseSizeStr: parseSizeStr\x0a\x09};\x0a});\x0a\x0a// Included from: src/javascript/core/utils/Env.js\x0a\x0a/**\x0a * Env.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x22moxie/core/utils/Env\x22, [\x0a\x09\x22moxie/core/utils/Basic\x22\x0a], function(Basic) {\x0a\x09\x0a\x09/**\x0a\x09 * UAParser.js v0.7.7\x0a\x09 * Lightweight JavaScript-based User-Agent string parser\x0a\x09 * https://github.com/faisalman/ua-parser-js\x0a\x09 *\x0a\x09 * Copyright \xc2\xa9 2012-2015 Faisal Salman \x3cfyzlman@gmail.com\x3e\x0a\x09 * Dual licensed under GPLv2 & MIT\x0a\x09 */\x0a\x09var UAParser = (function (undefined) {\x0a\x0a\x09    //////////////\x0a\x09    // Constants\x0a\x09    /////////////\x0a\x0a\x0a\x09    var EMPTY       = \x27\x27,\x0a\x09        UNKNOWN     = \x27?\x27,\x0a\x09        FUNC_TYPE   = \x27function\x27,\x0a\x09        UNDEF_TYPE  = \x27undefined\x27,\x0a\x09        OBJ_TYPE    = \x27object\x27,\x0a\x09        MAJOR       = \x27major\x27,\x0a\x09        MODEL       = \x27model\x27,\x0a\x09        NAME        = \x27name\x27,\x0a\x09        TYPE        = \x27type\x27,\x0a\x09        VENDOR      = \x27vendor\x27,\x0a\x09        VERSION     = \x27version\x27,\x0a\x09        ARCHITECTURE= \x27architecture\x27,\x0a\x09        CONSOLE     = \x27console\x27,\x0a\x09        MOBILE      = \x27mobile\x27,\x0a\x09        TABLET      = \x27tablet\x27;\x0a\x0a\x0a\x09    ///////////\x0a\x09    // Helper\x0a\x09    //////////\x0a\x0a\x0a\x09    var util = {\x0a\x09        has : function (str1, str2) {\x0a\x09            return str2.toLowerCase().indexOf(str1.toLowerCase()) !== -1;\x0a\x09        },\x0a\x09        lowerize : function (str) {\x0a\x09            return str.toLowerCase();\x0a\x09        }\x0a\x09    };\x0a\x0a\x0a\x09    ///////////////\x0a\x09    // Map helper\x0a\x09    //////////////\x0a\x0a\x0a\x09    var mapper = {\x0a\x0a\x09        rgx : function () {\x0a\x0a\x09            // loop through all regexes maps\x0a\x09            for (var result, i = 0, j, k, p, q, matches, match, args = arguments; i \x3c args.length; i += 2) {\x0a\x0a\x09                var regex = args[i],       // even sequence (0,2,4,..)\x0a\x09                    props = args[i + 1];   // odd sequence (1,3,5,..)\x0a\x0a\x09                // construct object barebones\x0a\x09                if (typeof(result) === UNDEF_TYPE) {\x0a\x09                    result = {};\x0a\x09                    for (p in props) {\x0a\x09                        q = props[p];\x0a\x09                        if (typeof(q) === OBJ_TYPE) {\x0a\x09                            result[q[0]] = undefined;\x0a\x09                        } else {\x0a\x09                            result[q] = undefined;\x0a\x09                        }\x0a\x09                    }\x0a\x09                }\x0a\x0a\x09                // try matching uastring with regexes\x0a\x09                for (j = k = 0; j \x3c regex.length; j++) {\x0a\x09                    matches = regex[j].exec(this.getUA());\x0a\x09                    if (!!matches) {\x0a\x09                        for (p = 0; p \x3c props.length; p++) {\x0a\x09                            match = matches[++k];\x0a\x09                            q = props[p];\x0a\x09                            // check if given property is actually array\x0a\x09                            if (typeof(q) === OBJ_TYPE && q.length \x3e 0) {\x0a\x09                                if (q.length == 2) {\x0a\x09                                    if (typeof(q[1]) == FUNC_TYPE) {\x0a\x09                                        // assign modified match\x0a\x09                                        result[q[0]] = q[1].call(this, match);\x0a\x09                                    } else {\x0a\x09                                        // assign given value, ignore regex match\x0a\x09                                        result[q[0]] = q[1];\x0a\x09                                    }\x0a\x09                                } else if (q.length == 3) {\x0a\x09                                    // check whether function or regex\x0a\x09                                    if (typeof(q[1]) === FUNC_TYPE && !(q[1].exec && q[1].test)) {\x0a\x09                                        // call function (usually string mapper)\x0a\x09                                        result[q[0]] = match ? q[1].call(this, match, q[2]) : undefined;\x0a\x09                                    } else {\x0a\x09                                        // sanitize match using given regex\x0a\x09                                        result[q[0]] = match ? match.replace(q[1], q[2]) : undefined;\x0a\x09                                    }\x0a\x09                                } else if (q.length == 4) {\x0a\x09                                        result[q[0]] = match ? q[3].call(this, match.replace(q[1], q[2])) : undefined;\x0a\x09                                }\x0a\x09                            } else {\x0a\x09                                result[q] = match ? match : undefined;\x0a\x09                            }\x0a\x09                        }\x0a\x09                        break;\x0a\x09                    }\x0a\x09                }\x0a\x0a\x09                if(!!matches) break; // break the loop immediately if match found\x0a\x09            }\x0a\x09            return result;\x0a\x09        },\x0a\x0a\x09        str : function (str, map) {\x0a\x0a\x09            for (var i in map) {\x0a\x09                // check if array\x0a\x09                if (typeof(map[i]) === OBJ_TYPE && map[i].length \x3e 0) {\x0a\x09                    for (var j = 0; j \x3c map[i].length; j++) {\x0a\x09                        if (util.has(map[i][j], str)) {\x0a\x09                            return (i === UNKNOWN) ? undefined : i;\x0a\x09                        }\x0a\x09                    }\x0a\x09                } else if (util.has(map[i], str)) {\x0a\x09                    return (i === UNKNOWN) ? undefined : i;\x0a\x09                }\x0a\x09            }\x0a\x09            return str;\x0a\x09        }\x0a\x09    };\x0a\x0a\x0a\x09    ///////////////\x0a\x09    // String map\x0a\x09    //////////////\x0a\x0a\x0a\x09    var maps = {\x0a\x0a\x09        browser : {\x0a\x09            oldsafari : {\x0a\x09                major : {\x0a\x09                    \x271\x27 : [\x27/8\x27, \x27/1\x27, \x27/3\x27],\x0a\x09                    \x272\x27 : \x27/4\x27,\x0a\x09                    \x27?\x27 : \x27/\x27\x0a\x09                },\x0a\x09                version : {\x0a\x09                    \x271.0\x27   : \x27/8\x27,\x0a\x09                    \x271.2\x27   : \x27/1\x27,\x0a\x09                    \x271.3\x27   : \x27/3\x27,\x0a\x09                    \x272.0\x27   : \x27/412\x27,\x0a\x09                    \x272.0.2\x27 : \x27/416\x27,\x0a\x09                    \x272.0.3\x27 : \x27/417\x27,\x0a\x09                    \x272.0.4\x27 : \x27/419\x27,\x0a\x09                    \x27?\x27     : \x27/\x27\x0a\x09                }\x0a\x09            }\x0a\x09        },\x0a\x0a\x09        device : {\x0a\x09            sprint : {\x0a\x09                model : {\x0a\x09                    \x27Evo Shift 4G\x27 : \x277373KT\x27\x0a\x09                },\x0a\x09                vendor : {\x0a\x09                    \x27HTC\x27       : \x27APA\x27,\x0a\x09                    \x27Sprint\x27    : \x27Sprint\x27\x0a\x09                }\x0a\x09            }\x0a\x09        },\x0a\x0a\x09        os : {\x0a\x09            windows : {\x0a\x09                version : {\x0a\x09                    \x27ME\x27        : \x274.90\x27,\x0a\x09                    \x27NT 3.11\x27   : \x27NT3.51\x27,\x0a\x09                    \x27NT 4.0\x27    : \x27NT4.0\x27,\x0a\x09                    \x272000\x27      : \x27NT 5.0\x27,\x0a\x09                    \x27XP\x27        : [\x27NT 5.1\x27, \x27NT 5.2\x27],\x0a\x09                    \x27Vista\x27     : \x27NT 6.0\x27,\x0a\x09                    \x277\x27         : \x27NT 6.1\x27,\x0a\x09                    \x278\x27         : \x27NT 6.2\x27,\x0a\x09                    \x278.1\x27       : \x27NT 6.3\x27,\x0a\x09                    \x27RT\x27        : \x27ARM\x27\x0a\x09                }\x0a\x09            }\x0a\x09        }\x0a\x09    };\x0a\x0a\x0a\x09    //////////////\x0a\x09    // Regex map\x0a\x09    /////////////\x0a\x0a\x0a\x09    var regexes = {\x0a\x0a\x09        browser : [[\x0a\x09        \x0a\x09            // Presto based\x0a\x09            /(opera\x5csmini)\x5c/([\x5cw\x5c.-]+)/i,                                       // Opera Mini\x0a\x09            /(opera\x5cs[mobiletab]+).+version\x5c/([\x5cw\x5c.-]+)/i,                      // Opera Mobi/Tablet\x0a\x09            /(opera).+version\x5c/([\x5cw\x5c.]+)/i,                                     // Opera \x3e 9.80\x0a\x09            /(opera)[\x5c/\x5cs]+([\x5cw\x5c.]+)/i                                          // Opera \x3c 9.80\x0a\x0a\x09            ], [NAME, VERSION], [\x0a\x0a\x09            /\x5cs(opr)\x5c/([\x5cw\x5c.]+)/i                                               // Opera Webkit\x0a\x09            ], [[NAME, \x27Opera\x27], VERSION], [\x0a\x0a\x09            // Mixed\x0a\x09            /(kindle)\x5c/([\x5cw\x5c.]+)/i,                                             // Kindle\x0a\x09            /(lunascape|maxthon|netfront|jasmine|blazer)[\x5c/\x5cs]?([\x5cw\x5c.]+)*/i,\x0a\x09                                                                                // Lunascape/Maxthon/Netfront/Jasmine/Blazer\x0a\x0a\x09            // Trident based\x0a\x09            /(avant\x5cs|iemobile|slim|baidu)(?:browser)?[\x5c/\x5cs]?([\x5cw\x5c.]*)/i,\x0a\x09                                                                                // Avant/IEMobile/SlimBrowser/Baidu\x0a\x09            /(?:ms|\x5c()(ie)\x5cs([\x5cw\x5c.]+)/i,                                        // Internet Explorer\x0a\x0a\x09            // Webkit/KHTML based\x0a\x09            /(rekonq)\x5c/([\x5cw\x5c.]+)*/i,                                            // Rekonq\x0a\x09            /(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi)\x5c/([\x5cw\x5c.-]+)/i\x0a\x09                                                                                // Chromium/Flock/RockMelt/Midori/Epiphany/Silk/Skyfire/Bolt/Iron\x0a\x09            ], [NAME, VERSION], [\x0a\x0a\x09            /(trident).+rv[:\x5cs]([\x5cw\x5c.]+).+like\x5csgecko/i                         // IE11\x0a\x09            ], [[NAME, \x27IE\x27], VERSION], [\x0a\x0a\x09            /(edge)\x5c/((\x5cd+)?[\x5cw\x5c.]+)/i                                          // Microsoft Edge\x0a\x09            ], [NAME, VERSION], [\x0a\x0a\x09            /(yabrowser)\x5c/([\x5cw\x5c.]+)/i                                           // Yandex\x0a\x09            ], [[NAME, \x27Yandex\x27], VERSION], [\x0a\x0a\x09            /(comodo_dragon)\x5c/([\x5cw\x5c.]+)/i                                       // Comodo Dragon\x0a\x09            ], [[NAME, /_/g, \x27 \x27], VERSION], [\x0a\x0a\x09            /(chrome|omniweb|arora|[tizenoka]{5}\x5cs?browser)\x5c/v?([\x5cw\x5c.]+)/i,\x0a\x09                                                                                // Chrome/OmniWeb/Arora/Tizen/Nokia\x0a\x09            /(uc\x5cs?browser|qqbrowser)[\x5c/\x5cs]?([\x5cw\x5c.]+)/i\x0a\x09                                                                                // UCBrowser/QQBrowser\x0a\x09            ], [NAME, VERSION], [\x0a\x0a\x09            /(dolfin)\x5c/([\x5cw\x5c.]+)/i                                              // Dolphin\x0a\x09            ], [[NAME, \x27Dolphin\x27], VERSION], [\x0a\x0a\x09            /((?:android.+)crmo|crios)\x5c/([\x5cw\x5c.]+)/i                             // Chrome for Android/iOS\x0a\x09            ], [[NAME, \x27Chrome\x27], VERSION], [\x0a\x0a\x09            /XiaoMi\x5c/MiuiBrowser\x5c/([\x5cw\x5c.]+)/i                                   // MIUI Browser\x0a\x09            ], [VERSION, [NAME, \x27MIUI Browser\x27]], [\x0a\x0a\x09            /android.+version\x5c/([\x5cw\x5c.]+)\x5cs+(?:mobile\x5cs?safari|safari)/i         // Android Browser\x0a\x09            ], [VERSION, [NAME, \x27Android Browser\x27]], [\x0a\x0a\x09            /FBAV\x5c/([\x5cw\x5c.]+);/i                                                 // Facebook App for iOS\x0a\x09            ], [VERSION, [NAME, \x27Facebook\x27]], [\x0a\x0a\x09            /version\x5c/([\x5cw\x5c.]+).+?mobile\x5c/\x5cw+\x5cs(safari)/i                       // Mobile Safari\x0a\x09            ], [VERSION, [NAME, \x27Mobile Safari\x27]], [\x0a\x0a\x09            /version\x5c/([\x5cw\x5c.]+).+?(mobile\x5cs?safari|safari)/i                    // Safari & Safari Mobile\x0a\x09            ], [VERSION, NAME], [\x0a\x0a\x09            /webkit.+?(mobile\x5cs?safari|safari)(\x5c/[\x5cw\x5c.]+)/i                     // Safari \x3c 3.0\x0a\x09            ], [NAME, [VERSION, mapper.str, maps.browser.oldsafari.version]], [\x0a\x0a\x09            /(konqueror)\x5c/([\x5cw\x5c.]+)/i,                                          // Konqueror\x0a\x09            /(webkit|khtml)\x5c/([\x5cw\x5c.]+)/i\x0a\x09            ], [NAME, VERSION], [\x0a\x0a\x09            // Gecko based\x0a\x09            /(navigator|netscape)\x5c/([\x5cw\x5c.-]+)/i                                 // Netscape\x0a\x09            ], [[NAME, \x27Netscape\x27], VERSION], [\x0a\x09            /(swiftfox)/i,                                                      // Swiftfox\x0a\x09            /(icedragon|iceweasel|camino|chimera|fennec|maemo\x5csbrowser|minimo|conkeror)[\x5c/\x5cs]?([\x5cw\x5c.\x5c+]+)/i,\x0a\x09                                                                                // IceDragon/Iceweasel/Camino/Chimera/Fennec/Maemo/Minimo/Conkeror\x0a\x09            /(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\x5c/([\x5cw\x5c.-]+)/i,\x0a\x09                                                                                // Firefox/SeaMonkey/K-Meleon/IceCat/IceApe/Firebird/Phoenix\x0a\x09            /(mozilla)\x5c/([\x5cw\x5c.]+).+rv\x5c:.+gecko\x5c/\x5cd+/i,                          // Mozilla\x0a\x0a\x09            // Other\x0a\x09            /(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\x5c/\x5cs]?([\x5cw\x5c.]+)/i,\x0a\x09                                                                                // Polaris/Lynx/Dillo/iCab/Doris/Amaya/w3m/NetSurf\x0a\x09            /(links)\x5cs\x5c(([\x5cw\x5c.]+)/i,                                            // Links\x0a\x09            /(gobrowser)\x5c/?([\x5cw\x5c.]+)*/i,                                        // GoBrowser\x0a\x09            /(ice\x5cs?browser)\x5c/v?([\x5cw\x5c._]+)/i,                                   // ICE Browser\x0a\x09            /(mosaic)[\x5c/\x5cs]([\x5cw\x5c.]+)/i                                          // Mosaic\x0a\x09            ], [NAME, VERSION]\x0a\x09        ],\x0a\x0a\x09        engine : [[\x0a\x0a\x09            /windows.+\x5csedge\x5c/([\x5cw\x5c.]+)/i                                       // EdgeHTML\x0a\x09            ], [VERSION, [NAME, \x27EdgeHTML\x27]], [\x0a\x0a\x09            /(presto)\x5c/([\x5cw\x5c.]+)/i,                                             // Presto\x0a\x09            /(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\x5c/([\x5cw\x5c.]+)/i,     // WebKit/Trident/NetFront/NetSurf/Amaya/Lynx/w3m\x0a\x09            /(khtml|tasman|links)[\x5c/\x5cs]\x5c(?([\x5cw\x5c.]+)/i,                          // KHTML/Tasman/Links\x0a\x09            /(icab)[\x5c/\x5cs]([23]\x5c.[\x5cd\x5c.]+)/i                                      // iCab\x0a\x09            ], [NAME, VERSION], [\x0a\x0a\x09            /rv\x5c:([\x5cw\x5c.]+).*(gecko)/i                                           // Gecko\x0a\x09            ], [VERSION, NAME]\x0a\x09        ],\x0a\x0a\x09        os : [[\x0a\x0a\x09            // Windows based\x0a\x09            /microsoft\x5cs(windows)\x5cs(vista|xp)/i                                 // Windows (iTunes)\x0a\x09            ], [NAME, VERSION], [\x0a\x09            /(windows)\x5csnt\x5cs6\x5c.2;\x5cs(arm)/i,                                     // Windows RT\x0a\x09            /(windows\x5csphone(?:\x5csos)*|windows\x5csmobile|windows)[\x5cs\x5c/]?([ntce\x5cd\x5c.\x5cs]+\x5cw)/i\x0a\x09            ], [NAME, [VERSION, mapper.str, maps.os.windows.version]], [\x0a\x09            /(win(?=3|9|n)|win\x5cs9x\x5cs)([nt\x5cd\x5c.]+)/i\x0a\x09            ], [[NAME, \x27Windows\x27], [VERSION, mapper.str, maps.os.windows.version]], [\x0a\x0a\x09            // Mobile/Embedded OS\x0a\x09            /\x5c((bb)(10);/i                                                      // BlackBerry 10\x0a\x09            ], [[NAME, \x27BlackBerry\x27], VERSION], [\x0a\x09            /(blackberry)\x5cw*\x5c/?([\x5cw\x5c.]+)*/i,                                    // Blackberry\x0a\x09            /(tizen)[\x5c/\x5cs]([\x5cw\x5c.]+)/i,                                          // Tizen\x0a\x09            /(android|webos|palm\x5cos|qnx|bada|rim\x5cstablet\x5csos|meego|contiki)[\x5c/\x5cs-]?([\x5cw\x5c.]+)*/i,\x0a\x09                                                                                // Android/WebOS/Palm/QNX/Bada/RIM/MeeGo/Contiki\x0a\x09            /linux;.+(sailfish);/i                                              // Sailfish OS\x0a\x09            ], [NAME, VERSION], [\x0a\x09            /(symbian\x5cs?os|symbos|s60(?=;))[\x5c/\x5cs-]?([\x5cw\x5c.]+)*/i                 // Symbian\x0a\x09            ], [[NAME, \x27Symbian\x27], VERSION], [\x0a\x09            /\x5c((series40);/i                                                    // Series 40\x0a\x09            ], [NAME], [\x0a\x09            /mozilla.+\x5c(mobile;.+gecko.+firefox/i                               // Firefox OS\x0a\x09            ], [[NAME, \x27Firefox OS\x27], VERSION], [\x0a\x0a\x09            // Console\x0a\x09            /(nintendo|playstation)\x5cs([wids3portablevu]+)/i,                    // Nintendo/Playstation\x0a\x0a\x09            // GNU/Linux based\x0a\x09            /(mint)[\x5c/\x5cs\x5c(]?(\x5cw+)*/i,                                           // Mint\x0a\x09            /(mageia|vectorlinux)[;\x5cs]/i,                                       // Mageia/VectorLinux\x0a\x09            /(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\x5c/\x5cs-]?([\x5cw\x5c.-]+)*/i,\x0a\x09                                                                                // Joli/Ubuntu/Debian/SUSE/Gentoo/Arch/Slackware\x0a\x09                                                                                // Fedora/Mandriva/CentOS/PCLinuxOS/RedHat/Zenwalk/Linpus\x0a\x09            /(hurd|linux)\x5cs?([\x5cw\x5c.]+)*/i,                                       // Hurd/Linux\x0a\x09            /(gnu)\x5cs?([\x5cw\x5c.]+)*/i                                               // GNU\x0a\x09            ], [NAME, VERSION], [\x0a\x0a\x09            /(cros)\x5cs[\x5cw]+\x5cs([\x5cw\x5c.]+\x5cw)/i                                       // Chromium OS\x0a\x09            ], [[NAME, \x27Chromium OS\x27], VERSION],[\x0a\x0a\x09            // Solaris\x0a\x09            /(sunos)\x5cs?([\x5cw\x5c.]+\x5cd)*/i                                           // Solaris\x0a\x09            ], [[NAME, \x27Solaris\x27], VERSION], [\x0a\x0a\x09            // BSD based\x0a\x09            /\x5cs([frentopc-]{0,4}bsd|dragonfly)\x5cs?([\x5cw\x5c.]+)*/i                   // FreeBSD/NetBSD/OpenBSD/PC-BSD/DragonFly\x0a\x09            ], [NAME, VERSION],[\x0a\x0a\x09            /(ip[honead]+)(?:.*os\x5cs*([\x5cw]+)*\x5cslike\x5csmac|;\x5csopera)/i             // iOS\x0a\x09            ], [[NAME, \x27iOS\x27], [VERSION, /_/g, \x27.\x27]], [\x0a\x0a\x09            /(mac\x5csos\x5csx)\x5cs?([\x5cw\x5cs\x5c.]+\x5cw)*/i,\x0a\x09            /(macintosh|mac(?=_powerpc)\x5cs)/i                                    // Mac OS\x0a\x09            ], [[NAME, \x27Mac OS\x27], [VERSION, /_/g, \x27.\x27]], [\x0a\x0a\x09            // Other\x0a\x09            /((?:open)?solaris)[\x5c/\x5cs-]?([\x5cw\x5c.]+)*/i,                            // Solaris\x0a\x09            /(haiku)\x5cs(\x5cw+)/i,                                                  // Haiku\x0a\x09            /(aix)\x5cs((\x5cd)(?=\x5c.|\x5c)|\x5cs)[\x5cw\x5c.]*)*/i,                               // AIX\x0a\x09            /(plan\x5cs9|minix|beos|os\x5c/2|amigaos|morphos|risc\x5csos|openvms)/i,\x0a\x09                                                                                // Plan9/Minix/BeOS/OS2/AmigaOS/MorphOS/RISCOS/OpenVMS\x0a\x09            /(unix)\x5cs?([\x5cw\x5c.]+)*/i                                              // UNIX\x0a\x09            ], [NAME, VERSION]\x0a\x09        ]\x0a\x09    };\x0a\x0a\x0a\x09    /////////////////\x0a\x09    // Constructor\x0a\x09    ////////////////\x0a\x0a\x0a\x09    var UAParser = function (uastring) {\x0a\x0a\x09        var ua = uastring || ((window && window.navigator && window.navigator.userAgent) ? window.navigator.userAgent : EMPTY);\x0a\x0a\x09        this.getBrowser = function () {\x0a\x09            return mapper.rgx.apply(this, regexes.browser);\x0a\x09        };\x0a\x09        this.getEngine = function () {\x0a\x09            return mapper.rgx.apply(this, regexes.engine);\x0a\x09        };\x0a\x09        this.getOS = function () {\x0a\x09            return mapper.rgx.apply(this, regexes.os);\x0a\x09        };\x0a\x09        this.getResult = function() {\x0a\x09            return {\x0a\x09                ua      : this.getUA(),\x0a\x09                browser : this.getBrowser(),\x0a\x09                engine  : this.getEngine(),\x0a\x09                os      : this.getOS()\x0a\x09            };\x0a\x09        };\x0a\x09        this.getUA = function () {\x0a\x09            return ua;\x0a\x09        };\x0a\x09        this.setUA = function (uastring) {\x0a\x09            ua = uastring;\x0a\x09            return this;\x0a\x09        };\x0a\x09        this.setUA(ua);\x0a\x09    };\x0a\x0a\x09    return UAParser;\x0a\x09})();\x0a\x0a\x0a\x09function version_compare(v1, v2, operator) {\x0a\x09  // From: http://phpjs.org/functions\x0a\x09  // +      original by: Philippe Jausions (http://pear.php.net/user/jausions)\x0a\x09  // +      original by: Aidan Lister (http://aidanlister.com/)\x0a\x09  // + reimplemented by: Kankrelune (http://www.webfaktory.info/)\x0a\x09  // +      improved by: Brett Zamir (http://brett-zamir.me)\x0a\x09  // +      improved by: Scott Baker\x0a\x09  // +      improved by: Theriault\x0a\x09  // *        example 1: version_compare(\x278.2.5rc\x27, \x278.2.5a\x27);\x0a\x09  // *        returns 1: 1\x0a\x09  // *        example 2: version_compare(\x278.2.50\x27, \x278.2.52\x27, \x27\x3c\x27);\x0a\x09  // *        returns 2: true\x0a\x09  // *        example 3: version_compare(\x275.3.0-dev\x27, \x275.3.0\x27);\x0a\x09  // *        returns 3: -1\x0a\x09  // *        example 4: version_compare(\x274.1.0.52\x27,\x274.01.0.51\x27);\x0a\x09  // *        returns 4: 1\x0a\x0a\x09  // Important: compare must be initialized at 0.\x0a\x09  var i = 0,\x0a\x09    x = 0,\x0a\x09    compare = 0,\x0a\x09    // vm maps textual PHP versions to negatives so they\x27re less than 0.\x0a\x09    // PHP currently defines these as CASE-SENSITIVE. It is important to\x0a\x09    // leave these as negatives so that they can come before numerical versions\x0a\x09    // and as if no letters were there to begin with.\x0a\x09    // (1alpha is \x3c 1 and \x3c 1.1 but \x3e 1dev1)\x0a\x09    // If a non-numerical value can\x27t be mapped to this table, it receives\x0a\x09    // -7 as its value.\x0a\x09    vm = {\x0a\x09      \x27dev\x27: -6,\x0a\x09      \x27alpha\x27: -5,\x0a\x09      \x27a\x27: -5,\x0a\x09      \x27beta\x27: -4,\x0a\x09      \x27b\x27: -4,\x0a\x09      \x27RC\x27: -3,\x0a\x09      \x27rc\x27: -3,\x0a\x09      \x27#\x27: -2,\x0a\x09      \x27p\x27: 1,\x0a\x09      \x27pl\x27: 1\x0a\x09    },\x0a\x09    // This function will be called to prepare each version argument.\x0a\x09    // It replaces every _, -, and + with a dot.\x0a\x09    // It surrounds any nonsequence of numbers/dots with dots.\x0a\x09    // It replaces sequences of dots with a single dot.\x0a\x09    //    version_compare(\x274..0\x27, \x274.0\x27) == 0\x0a\x09    // Important: A string of 0 length needs to be converted into a value\x0a\x09    // even less than an unexisting value in vm (-7), hence [-8].\x0a\x09    // It\x27s also important to not strip spaces because of this.\x0a\x09    //   version_compare(\x27\x27, \x27 \x27) == 1\x0a\x09    prepVersion = function (v) {\x0a\x09      v = (\x27\x27 + v).replace(/[_\x5c-+]/g, \x27.\x27);\x0a\x09      v = v.replace(/([^.\x5cd]+)/g, \x27.$1.\x27).replace(/\x5c.{2,}/g, \x27.\x27);\x0a\x09      return (!v.length ? [-8] : v.split(\x27.\x27));\x0a\x09    },\x0a\x09    // This converts a version component to a number.\x0a\x09    // Empty component becomes 0.\x0a\x09    // Non-numerical component becomes a negative number.\x0a\x09    // Numerical component becomes itself as an integer.\x0a\x09    numVersion = function (v) {\x0a\x09      return !v ? 0 : (isNaN(v) ? vm[v] || -7 : parseInt(v, 10));\x0a\x09    };\x0a\x0a\x09  v1 = prepVersion(v1);\x0a\x09  v2 = prepVersion(v2);\x0a\x09  x = Math.max(v1.length, v2.length);\x0a\x09  for (i = 0; i \x3c x; i++) {\x0a\x09    if (v1[i] == v2[i]) {\x0a\x09      continue;\x0a\x09    }\x0a\x09    v1[i] = numVersion(v1[i]);\x0a\x09    v2[i] = numVersion(v2[i]);\x0a\x09    if (v1[i] \x3c v2[i]) {\x0a\x09      compare = -1;\x0a\x09      break;\x0a\x09    } else if (v1[i] \x3e v2[i]) {\x0a\x09      compare = 1;\x0a\x09      break;\x0a\x09    }\x0a\x09  }\x0a\x09  if (!operator) {\x0a\x09    return compare;\x0a\x09  }\x0a\x0a\x09  // Important: operator is CASE-SENSITIVE.\x0a\x09  // \x22No operator\x22 seems to be treated as \x22\x3c.\x22\x0a\x09  // Any other values seem to make the function return null.\x0a\x09  switch (operator) {\x0a\x09  case \x27\x3e\x27:\x0a\x09  case \x27gt\x27:\x0a\x09    return (compare \x3e 0);\x0a\x09  case \x27\x3e=\x27:\x0a\x09  case \x27ge\x27:\x0a\x09    return (compare \x3e= 0);\x0a\x09  case \x27\x3c=\x27:\x0a\x09  case \x27le\x27:\x0a\x09    return (compare \x3c= 0);\x0a\x09  case \x27==\x27:\x0a\x09  case \x27=\x27:\x0a\x09  case \x27eq\x27:\x0a\x09    return (compare === 0);\x0a\x09  case \x27\x3c\x3e\x27:\x0a\x09  case \x27!=\x27:\x0a\x09  case \x27ne\x27:\x0a\x09    return (compare !== 0);\x0a\x09  case \x27\x27:\x0a\x09  case \x27\x3c\x27:\x0a\x09  case \x27lt\x27:\x0a\x09    return (compare \x3c 0);\x0a\x09  default:\x0a\x09    return null;\x0a\x09  }\x0a\x09}\x0a\x0a\x0a\x09var can = (function() {\x0a\x09\x09var caps = {\x0a\x09\x09\x09\x09define_property: (function() {\x0a\x09\x09\x09\x09\x09/* // currently too much extra code required, not exactly worth it\x0a\x09\x09\x09\x09\x09try { // as of IE8, getters/setters are supported only on DOM elements\x0a\x09\x09\x09\x09\x09\x09var obj = {};\x0a\x09\x09\x09\x09\x09\x09if (Object.defineProperty) {\x0a\x09\x09\x09\x09\x09\x09\x09Object.defineProperty(obj, \x27prop\x27, {\x0a\x09\x09\x09\x09\x09\x09\x09\x09enumerable: true,\x0a\x09\x09\x09\x09\x09\x09\x09\x09configurable: true\x0a\x09\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09\x09\x09return true;\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09} catch(ex) {}\x0a\x0a\x09\x09\x09\x09\x09if (Object.prototype.__defineGetter__ && Object.prototype.__defineSetter__) {\x0a\x09\x09\x09\x09\x09\x09return true;\x0a\x09\x09\x09\x09\x09}*/\x0a\x09\x09\x09\x09\x09return false;\x0a\x09\x09\x09\x09}()),\x0a\x0a\x09\x09\x09\x09create_canvas: (function() {\x0a\x09\x09\x09\x09\x09// On the S60 and BB Storm, getContext exists, but always returns undefined\x0a\x09\x09\x09\x09\x09// so we actually have to call getContext() to verify\x0a\x09\x09\x09\x09\x09// github.com/Modernizr/Modernizr/issues/issue/97/\x0a\x09\x09\x09\x09\x09var el = document.createElement(\x27canvas\x27);\x0a\x09\x09\x09\x09\x09return !!(el.getContext && el.getContext(\x272d\x27));\x0a\x09\x09\x09\x09}()),\x0a\x0a\x09\x09\x09\x09return_response_type: function(responseType) {\x0a\x09\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09\x09if (Basic.inArray(responseType, [\x27\x27, \x27text\x27, \x27document\x27]) !== -1) {\x0a\x09\x09\x09\x09\x09\x09\x09return true;\x0a\x09\x09\x09\x09\x09\x09} else if (window.XMLHttpRequest) {\x0a\x09\x09\x09\x09\x09\x09\x09var xhr = new XMLHttpRequest();\x0a\x09\x09\x09\x09\x09\x09\x09xhr.open(\x27get\x27, \x27/\x27); // otherwise Gecko throws an exception\x0a\x09\x09\x09\x09\x09\x09\x09if (\x27responseType\x27 in xhr) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09xhr.responseType = responseType;\x0a\x09\x09\x09\x09\x09\x09\x09\x09// as of 23.0.1271.64, Chrome switched from throwing exception to merely logging it to the console (why? o why?)\x0a\x09\x09\x09\x09\x09\x09\x09\x09if (xhr.responseType !== responseType) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09return false;\x0a\x09\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09\x09\x09return true;\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09} catch (ex) {}\x0a\x09\x09\x09\x09\x09return false;\x0a\x09\x09\x09\x09},\x0a\x0a\x09\x09\x09\x09// ideas for this heavily come from Modernizr (http://modernizr.com/)\x0a\x09\x09\x09\x09use_data_uri: (function() {\x0a\x09\x09\x09\x09\x09var du = new Image();\x0a\x0a\x09\x09\x09\x09\x09du.onload = function() {\x0a\x09\x09\x09\x09\x09\x09caps.use_data_uri = (du.width === 1 && du.height === 1);\x0a\x09\x09\x09\x09\x09};\x0a\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09setTimeout(function() {\x0a\x09\x09\x09\x09\x09\x09du.src = \x22data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==\x22;\x0a\x09\x09\x09\x09\x09}, 1);\x0a\x09\x09\x09\x09\x09return false;\x0a\x09\x09\x09\x09}()),\x0a\x0a\x09\x09\x09\x09use_data_uri_over32kb: function() { // IE8\x0a\x09\x09\x09\x09\x09return caps.use_data_uri && (Env.browser !== \x27IE\x27 || Env.version \x3e= 9);\x0a\x09\x09\x09\x09},\x0a\x0a\x09\x09\x09\x09use_data_uri_of: function(bytes) {\x0a\x09\x09\x09\x09\x09return (caps.use_data_uri && bytes \x3c 33000 || caps.use_data_uri_over32kb());\x0a\x09\x09\x09\x09},\x0a\x0a\x09\x09\x09\x09use_fileinput: function() {\x0a\x09\x09\x09\x09\x09if (navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\x5c/(1.0|2.0|2.5|3.0))/)) {\x0a\x09\x09\x09\x09\x09\x09return false;\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09var el = document.createElement(\x27input\x27);\x0a\x09\x09\x09\x09\x09el.setAttribute(\x27type\x27, \x27file\x27);\x0a\x09\x09\x09\x09\x09return !el.disabled;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09};\x0a\x0a\x09\x09return function(cap) {\x0a\x09\x09\x09var args = [].slice.call(arguments);\x0a\x09\x09\x09args.shift(); // shift of cap\x0a\x09\x09\x09return Basic.typeOf(caps[cap]) === \x27function\x27 ? caps[cap].apply(this, args) : !!caps[cap];\x0a\x09\x09};\x0a\x09}());\x0a\x0a\x0a\x09var uaResult = new UAParser().getResult();\x0a\x0a\x0a\x09var Env = {\x0a\x09\x09can: can,\x0a\x0a\x09\x09uaParser: UAParser,\x0a\x09\x09\x0a\x09\x09browser: uaResult.browser.name,\x0a\x09\x09version: uaResult.browser.version,\x0a\x09\x09os: uaResult.os.name, // everybody intuitively types it in a lowercase for some reason\x0a\x09\x09osVersion: uaResult.os.version,\x0a\x0a\x09\x09verComp: version_compare,\x0a\x0a\x09\x09global_event_dispatcher: \x22moxie.core.EventTarget.instance.dispatchEvent\x22\x0a\x09};\x0a\x0a\x09// for backward compatibility\x0a\x09// @deprecated Use `Env.os` instead\x0a\x09Env.OS = Env.os;\x0a\x0a\x09if (MXI_DEBUG) {\x0a\x09\x09Env.debug = {\x0a\x09\x09\x09runtime: true,\x0a\x09\x09\x09events: false\x0a\x09\x09};\x0a\x0a\x09\x09Env.log = function() {\x0a\x09\x09\x09\x0a\x09\x09\x09function logObj(data) {\x0a\x09\x09\x09\x09// TODO: this should recursively print out the object in a pretty way\x0a\x09\x09\x09\x09console.appendChild(document.createTextNode(data + \x22\x5cn\x22));\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09var data = arguments[0];\x0a\x0a\x09\x09\x09if (Basic.typeOf(data) === \x27string\x27) {\x0a\x09\x09\x09\x09data = Basic.sprintf.apply(this, arguments);\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09if (window && window.console && window.console.log) {\x0a\x09\x09\x09\x09window.console.log(data);\x0a\x09\x09\x09} else if (document) {\x0a\x09\x09\x09\x09var console = document.getElementById(\x27moxie-console\x27);\x0a\x09\x09\x09\x09if (!console) {\x0a\x09\x09\x09\x09\x09console = document.createElement(\x27pre\x27);\x0a\x09\x09\x09\x09\x09console.id = \x27moxie-console\x27;\x0a\x09\x09\x09\x09\x09//console.style.display = \x27none\x27;\x0a\x09\x09\x09\x09\x09document.body.appendChild(console);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if (Basic.inArray(Basic.typeOf(data), [\x27object\x27, \x27array\x27]) !== -1) {\x0a\x09\x09\x09\x09\x09logObj(data);\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09console.appendChild(document.createTextNode(data + \x22\x5cn\x22));\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x09\x09};\x0a\x09}\x0a\x0a\x09return Env;\x0a});\x0a\x0a// Included from: src/javascript/core/I18n.js\x0a\x0a/**\x0a * I18n.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x22moxie/core/I18n\x22, [\x0a\x09\x22moxie/core/utils/Basic\x22\x0a], function(Basic) {\x0a\x09var i18n = {};\x0a\x0a\x09return {\x0a\x09\x09/**\x0a\x09\x09 * Extends the language pack object with new items.\x0a\x09\x09 *\x0a\x09\x09 * @param {Object} pack Language pack items to add.\x0a\x09\x09 * @return {Object} Extended language pack object.\x0a\x09\x09 */\x0a\x09\x09addI18n: function(pack) {\x0a\x09\x09\x09return Basic.extend(i18n, pack);\x0a\x09\x09},\x0a\x0a\x09\x09/**\x0a\x09\x09 * Translates the specified string by checking for the english string in the language pack lookup.\x0a\x09\x09 *\x0a\x09\x09 * @param {String} str String to look for.\x0a\x09\x09 * @return {String} Translated string or the input string if it wasn\x27t found.\x0a\x09\x09 */\x0a\x09\x09translate: function(str) {\x0a\x09\x09\x09return i18n[str] || str;\x0a\x09\x09},\x0a\x0a\x09\x09/**\x0a\x09\x09 * Shortcut for translate function\x0a\x09\x09 *\x0a\x09\x09 * @param {String} str String to look for.\x0a\x09\x09 * @return {String} Translated string or the input string if it wasn\x27t found.\x0a\x09\x09 */\x0a\x09\x09_: function(str) {\x0a\x09\x09\x09return this.translate(str);\x0a\x09\x09},\x0a\x0a\x09\x09/**\x0a\x09\x09 * Pseudo sprintf implementation - simple way to replace tokens with specified values.\x0a\x09\x09 *\x0a\x09\x09 * @param {String} str String with tokens\x0a\x09\x09 * @return {String} String with replaced tokens\x0a\x09\x09 */\x0a\x09\x09sprintf: function(str) {\x0a\x09\x09\x09var args = [].slice.call(arguments, 1);\x0a\x0a\x09\x09\x09return str.replace(/%[a-z]/g, function() {\x0a\x09\x09\x09\x09var value = args.shift();\x0a\x09\x09\x09\x09return Basic.typeOf(value) !== \x27undefined\x27 ? value : \x27\x27;\x0a\x09\x09\x09});\x0a\x09\x09}\x0a\x09};\x0a});\x0a\x0a// Included from: src/javascript/core/utils/Mime.js\x0a\x0a/**\x0a * Mime.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x22moxie/core/utils/Mime\x22, [\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/core/I18n\x22\x0a], function(Basic, I18n) {\x0a\x09\x0a\x09var mimeData = \x22\x22 +\x0a\x09\x09\x22application/msword,doc dot,\x22 +\x0a\x09\x09\x22application/pdf,pdf,\x22 +\x0a\x09\x09\x22application/pgp-signature,pgp,\x22 +\x0a\x09\x09\x22application/postscript,ps ai eps,\x22 +\x0a\x09\x09\x22application/rtf,rtf,\x22 +\x0a\x09\x09\x22application/vnd.ms-excel,xls xlb,\x22 +\x0a\x09\x09\x22application/vnd.ms-powerpoint,ppt pps pot,\x22 +\x0a\x09\x09\x22application/zip,zip,\x22 +\x0a\x09\x09\x22application/x-shockwave-flash,swf swfl,\x22 +\x0a\x09\x09\x22application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,\x22 +\x0a\x09\x09\x22application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,\x22 +\x0a\x09\x09\x22application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,\x22 +\x0a\x09\x09\x22application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,\x22 +\x0a\x09\x09\x22application/vnd.openxmlformats-officedocument.presentationml.template,potx,\x22 +\x0a\x09\x09\x22application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,\x22 +\x0a\x09\x09\x22application/x-javascript,js,\x22 +\x0a\x09\x09\x22application/json,json,\x22 +\x0a\x09\x09\x22audio/mpeg,mp3 mpga mpega mp2,\x22 +\x0a\x09\x09\x22audio/x-wav,wav,\x22 +\x0a\x09\x09\x22audio/x-m4a,m4a,\x22 +\x0a\x09\x09\x22audio/ogg,oga ogg,\x22 +\x0a\x09\x09\x22audio/aiff,aiff aif,\x22 +\x0a\x09\x09\x22audio/flac,flac,\x22 +\x0a\x09\x09\x22audio/aac,aac,\x22 +\x0a\x09\x09\x22audio/ac3,ac3,\x22 +\x0a\x09\x09\x22audio/x-ms-wma,wma,\x22 +\x0a\x09\x09\x22image/bmp,bmp,\x22 +\x0a\x09\x09\x22image/gif,gif,\x22 +\x0a\x09\x09\x22image/jpeg,jpg jpeg jpe,\x22 +\x0a\x09\x09\x22image/photoshop,psd,\x22 +\x0a\x09\x09\x22image/png,png,\x22 +\x0a\x09\x09\x22image/svg+xml,svg svgz,\x22 +\x0a\x09\x09\x22image/tiff,tiff tif,\x22 +\x0a\x09\x09\x22text/plain,asc txt text diff log,\x22 +\x0a\x09\x09\x22text/html,htm html xhtml,\x22 +\x0a\x09\x09\x22text/css,css,\x22 +\x0a\x09\x09\x22text/csv,csv,\x22 +\x0a\x09\x09\x22text/rtf,rtf,\x22 +\x0a\x09\x09\x22video/mpeg,mpeg mpg mpe m2v,\x22 +\x0a\x09\x09\x22video/quicktime,qt mov,\x22 +\x0a\x09\x09\x22video/mp4,mp4,\x22 +\x0a\x09\x09\x22video/x-m4v,m4v,\x22 +\x0a\x09\x09\x22video/x-flv,flv,\x22 +\x0a\x09\x09\x22video/x-ms-wmv,wmv,\x22 +\x0a\x09\x09\x22video/avi,avi,\x22 +\x0a\x09\x09\x22video/webm,webm,\x22 +\x0a\x09\x09\x22video/3gpp,3gpp 3gp,\x22 +\x0a\x09\x09\x22video/3gpp2,3g2,\x22 +\x0a\x09\x09\x22video/vnd.rn-realvideo,rv,\x22 +\x0a\x09\x09\x22video/ogg,ogv,\x22 + \x0a\x09\x09\x22video/x-matroska,mkv,\x22 +\x0a\x09\x09\x22application/vnd.oasis.opendocument.formula-template,otf,\x22 +\x0a\x09\x09\x22application/octet-stream,exe\x22;\x0a\x09\x0a\x09\x0a\x09var Mime = {\x0a\x0a\x09\x09mimes: {},\x0a\x0a\x09\x09extensions: {},\x0a\x0a\x09\x09// Parses the default mime types string into a mimes and extensions lookup maps\x0a\x09\x09addMimeType: function (mimeData) {\x0a\x09\x09\x09var items = mimeData.split(/,/), i, ii, ext;\x0a\x09\x09\x09\x0a\x09\x09\x09for (i = 0; i \x3c items.length; i += 2) {\x0a\x09\x09\x09\x09ext = items[i + 1].split(/ /);\x0a\x0a\x09\x09\x09\x09// extension to mime lookup\x0a\x09\x09\x09\x09for (ii = 0; ii \x3c ext.length; ii++) {\x0a\x09\x09\x09\x09\x09this.mimes[ext[ii]] = items[i];\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09// mime to extension lookup\x0a\x09\x09\x09\x09this.extensions[items[i]] = ext;\x0a\x09\x09\x09}\x0a\x09\x09},\x0a\x0a\x0a\x09\x09extList2mimes: function (filters, addMissingExtensions) {\x0a\x09\x09\x09var self = this, ext, i, ii, type, mimes = [];\x0a\x09\x09\x09\x0a\x09\x09\x09// convert extensions to mime types list\x0a\x09\x09\x09for (i = 0; i \x3c filters.length; i++) {\x0a\x09\x09\x09\x09ext = filters[i].extensions.split(/\x5cs*,\x5cs*/);\x0a\x0a\x09\x09\x09\x09for (ii = 0; ii \x3c ext.length; ii++) {\x0a\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09// if there\x27s an asterisk in the list, then accept attribute is not required\x0a\x09\x09\x09\x09\x09if (ext[ii] === \x27*\x27) {\x0a\x09\x09\x09\x09\x09\x09return [];\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09type = self.mimes[ext[ii]];\x0a\x09\x09\x09\x09\x09if (type && Basic.inArray(type, mimes) === -1) {\x0a\x09\x09\x09\x09\x09\x09mimes.push(type);\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09// future browsers should filter by extension, finally\x0a\x09\x09\x09\x09\x09if (addMissingExtensions && /^\x5cw+$/.test(ext[ii])) {\x0a\x09\x09\x09\x09\x09\x09mimes.push(\x27.\x27 + ext[ii]);\x0a\x09\x09\x09\x09\x09} else if (!type) {\x0a\x09\x09\x09\x09\x09\x09// if we have no type in our map, then accept all\x0a\x09\x09\x09\x09\x09\x09return [];\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x09\x09\x09return mimes;\x0a\x09\x09},\x0a\x0a\x0a\x09\x09mimes2exts: function(mimes) {\x0a\x09\x09\x09var self = this, exts = [];\x0a\x09\x09\x09\x0a\x09\x09\x09Basic.each(mimes, function(mime) {\x0a\x09\x09\x09\x09if (mime === \x27*\x27) {\x0a\x09\x09\x09\x09\x09exts = [];\x0a\x09\x09\x09\x09\x09return false;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// check if this thing looks like mime type\x0a\x09\x09\x09\x09var m = mime.match(/^(\x5cw+)\x5c/(\x5c*|\x5cw+)$/);\x0a\x09\x09\x09\x09if (m) {\x0a\x09\x09\x09\x09\x09if (m[2] === \x27*\x27) { \x0a\x09\x09\x09\x09\x09\x09// wildcard mime type detected\x0a\x09\x09\x09\x09\x09\x09Basic.each(self.extensions, function(arr, mime) {\x0a\x09\x09\x09\x09\x09\x09\x09if ((new RegExp(\x27^\x27 + m[1] + \x27/\x27)).test(mime)) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09[].push.apply(exts, self.extensions[mime]);\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09} else if (self.extensions[mime]) {\x0a\x09\x09\x09\x09\x09\x09[].push.apply(exts, self.extensions[mime]);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09});\x0a\x09\x09\x09return exts;\x0a\x09\x09},\x0a\x0a\x0a\x09\x09mimes2extList: function(mimes) {\x0a\x09\x09\x09var accept = [], exts = [];\x0a\x0a\x09\x09\x09if (Basic.typeOf(mimes) === \x27string\x27) {\x0a\x09\x09\x09\x09mimes = Basic.trim(mimes).split(/\x5cs*,\x5cs*/);\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09exts = this.mimes2exts(mimes);\x0a\x09\x09\x09\x0a\x09\x09\x09accept.push({\x0a\x09\x09\x09\x09title: I18n.translate(\x27Files\x27),\x0a\x09\x09\x09\x09extensions: exts.length ? exts.join(\x27,\x27) : \x27*\x27\x0a\x09\x09\x09});\x0a\x09\x09\x09\x0a\x09\x09\x09// save original mimes string\x0a\x09\x09\x09accept.mimes = mimes;\x0a\x0a\x09\x09\x09return accept;\x0a\x09\x09},\x0a\x0a\x0a\x09\x09getFileExtension: function(fileName) {\x0a\x09\x09\x09var matches = fileName && fileName.match(/\x5c.([^.]+)$/);\x0a\x09\x09\x09if (matches) {\x0a\x09\x09\x09\x09return matches[1].toLowerCase();\x0a\x09\x09\x09}\x0a\x09\x09\x09return \x27\x27;\x0a\x09\x09},\x0a\x0a\x09\x09getFileMime: function(fileName) {\x0a\x09\x09\x09return this.mimes[this.getFileExtension(fileName)] || \x27\x27;\x0a\x09\x09}\x0a\x09};\x0a\x0a\x09Mime.addMimeType(mimeData);\x0a\x0a\x09return Mime;\x0a});\x0a\x0a// Included from: src/javascript/core/utils/Dom.js\x0a\x0a/**\x0a * Dom.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x27moxie/core/utils/Dom\x27, [\x27moxie/core/utils/Env\x27], function(Env) {\x0a\x0a\x09/**\x0a\x09Get DOM Element by it\x27s id.\x0a\x0a\x09@method get\x0a\x09@for Utils\x0a\x09@param {String} id Identifier of the DOM Element\x0a\x09@return {DOMElement}\x0a\x09*/\x0a\x09var get = function(id) {\x0a\x09\x09if (typeof id !== \x27string\x27) {\x0a\x09\x09\x09return id;\x0a\x09\x09}\x0a\x09\x09return document.getElementById(id);\x0a\x09};\x0a\x0a\x09/**\x0a\x09Checks if specified DOM element has specified class.\x0a\x0a\x09@method hasClass\x0a\x09@static\x0a\x09@param {Object} obj DOM element like object to add handler to.\x0a\x09@param {String} name Class name\x0a\x09*/\x0a\x09var hasClass = function(obj, name) {\x0a\x09\x09if (!obj.className) {\x0a\x09\x09\x09return false;\x0a\x09\x09}\x0a\x0a\x09\x09var regExp = new RegExp(\x22(^|\x5c\x5cs+)\x22+name+\x22(\x5c\x5cs+|$)\x22);\x0a\x09\x09return regExp.test(obj.className);\x0a\x09};\x0a\x0a\x09/**\x0a\x09Adds specified className to specified DOM element.\x0a\x0a\x09@method addClass\x0a\x09@static\x0a\x09@param {Object} obj DOM element like object to add handler to.\x0a\x09@param {String} name Class name\x0a\x09*/\x0a\x09var addClass = function(obj, name) {\x0a\x09\x09if (!hasClass(obj, name)) {\x0a\x09\x09\x09obj.className = !obj.className ? name : obj.className.replace(/\x5cs+$/, \x27\x27) + \x27 \x27 + name;\x0a\x09\x09}\x0a\x09};\x0a\x0a\x09/**\x0a\x09Removes specified className from specified DOM element.\x0a\x0a\x09@method removeClass\x0a\x09@static\x0a\x09@param {Object} obj DOM element like object to add handler to.\x0a\x09@param {String} name Class name\x0a\x09*/\x0a\x09var removeClass = function(obj, name) {\x0a\x09\x09if (obj.className) {\x0a\x09\x09\x09var regExp = new RegExp(\x22(^|\x5c\x5cs+)\x22+name+\x22(\x5c\x5cs+|$)\x22);\x0a\x09\x09\x09obj.className = obj.className.replace(regExp, function($0, $1, $2) {\x0a\x09\x09\x09\x09return $1 === \x27 \x27 && $2 === \x27 \x27 ? \x27 \x27 : \x27\x27;\x0a\x09\x09\x09});\x0a\x09\x09}\x0a\x09};\x0a\x0a\x09/**\x0a\x09Returns a given computed style of a DOM element.\x0a\x0a\x09@method getStyle\x0a\x09@static\x0a\x09@param {Object} obj DOM element like object.\x0a\x09@param {String} name Style you want to get from the DOM element\x0a\x09*/\x0a\x09var getStyle = function(obj, name) {\x0a\x09\x09if (obj.currentStyle) {\x0a\x09\x09\x09return obj.currentStyle[name];\x0a\x09\x09} else if (window.getComputedStyle) {\x0a\x09\x09\x09return window.getComputedStyle(obj, null)[name];\x0a\x09\x09}\x0a\x09};\x0a\x0a\x0a\x09/**\x0a\x09Returns the absolute x, y position of an Element. The position will be returned in a object with x, y fields.\x0a\x0a\x09@method getPos\x0a\x09@static\x0a\x09@param {Element} node HTML element or element id to get x, y position from.\x0a\x09@param {Element} root Optional root element to stop calculations at.\x0a\x09@return {object} Absolute position of the specified element object with x, y fields.\x0a\x09*/\x0a\x09var getPos = function(node, root) {\x0a\x09\x09var x = 0, y = 0, parent, doc = document, nodeRect, rootRect;\x0a\x0a\x09\x09node = node;\x0a\x09\x09root = root || doc.body;\x0a\x0a\x09\x09// Returns the x, y cordinate for an element on IE 6 and IE 7\x0a\x09\x09function getIEPos(node) {\x0a\x09\x09\x09var bodyElm, rect, x = 0, y = 0;\x0a\x0a\x09\x09\x09if (node) {\x0a\x09\x09\x09\x09rect = node.getBoundingClientRect();\x0a\x09\x09\x09\x09bodyElm = doc.compatMode === \x22CSS1Compat\x22 ? doc.documentElement : doc.body;\x0a\x09\x09\x09\x09x = rect.left + bodyElm.scrollLeft;\x0a\x09\x09\x09\x09y = rect.top + bodyElm.scrollTop;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09return {\x0a\x09\x09\x09\x09x : x,\x0a\x09\x09\x09\x09y : y\x0a\x09\x09\x09};\x0a\x09\x09}\x0a\x0a\x09\x09// Use getBoundingClientRect on IE 6 and IE 7 but not on IE 8 in standards mode\x0a\x09\x09if (node && node.getBoundingClientRect && Env.browser === \x27IE\x27 && (!doc.documentMode || doc.documentMode \x3c 8)) {\x0a\x09\x09\x09nodeRect = getIEPos(node);\x0a\x09\x09\x09rootRect = getIEPos(root);\x0a\x0a\x09\x09\x09return {\x0a\x09\x09\x09\x09x : nodeRect.x - rootRect.x,\x0a\x09\x09\x09\x09y : nodeRect.y - rootRect.y\x0a\x09\x09\x09};\x0a\x09\x09}\x0a\x0a\x09\x09parent = node;\x0a\x09\x09while (parent && parent != root && parent.nodeType) {\x0a\x09\x09\x09x += parent.offsetLeft || 0;\x0a\x09\x09\x09y += parent.offsetTop || 0;\x0a\x09\x09\x09parent = parent.offsetParent;\x0a\x09\x09}\x0a\x0a\x09\x09parent = node.parentNode;\x0a\x09\x09while (parent && parent != root && parent.nodeType) {\x0a\x09\x09\x09x -= parent.scrollLeft || 0;\x0a\x09\x09\x09y -= parent.scrollTop || 0;\x0a\x09\x09\x09parent = parent.parentNode;\x0a\x09\x09}\x0a\x0a\x09\x09return {\x0a\x09\x09\x09x : x,\x0a\x09\x09\x09y : y\x0a\x09\x09};\x0a\x09};\x0a\x0a\x09/**\x0a\x09Returns the size of the specified node in pixels.\x0a\x0a\x09@method getSize\x0a\x09@static\x0a\x09@param {Node} node Node to get the size of.\x0a\x09@return {Object} Object with a w and h property.\x0a\x09*/\x0a\x09var getSize = function(node) {\x0a\x09\x09return {\x0a\x09\x09\x09w : node.offsetWidth || node.clientWidth,\x0a\x09\x09\x09h : node.offsetHeight || node.clientHeight\x0a\x09\x09};\x0a\x09};\x0a\x0a\x09return {\x0a\x09\x09get: get,\x0a\x09\x09hasClass: hasClass,\x0a\x09\x09addClass: addClass,\x0a\x09\x09removeClass: removeClass,\x0a\x09\x09getStyle: getStyle,\x0a\x09\x09getPos: getPos,\x0a\x09\x09getSize: getSize\x0a\x09};\x0a});\x0a\x0a// Included from: src/javascript/core/Exceptions.js\x0a\x0a/**\x0a * Exceptions.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x27moxie/core/Exceptions\x27, [\x0a\x09\x27moxie/core/utils/Basic\x27\x0a], function(Basic) {\x0a\x09function _findKey(obj, value) {\x0a\x09\x09var key;\x0a\x09\x09for (key in obj) {\x0a\x09\x09\x09if (obj[key] === value) {\x0a\x09\x09\x09\x09return key;\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x09\x09return null;\x0a\x09}\x0a\x0a\x09return {\x0a\x09\x09RuntimeError: (function() {\x0a\x09\x09\x09var namecodes = {\x0a\x09\x09\x09\x09NOT_INIT_ERR: 1,\x0a\x09\x09\x09\x09NOT_SUPPORTED_ERR: 9,\x0a\x09\x09\x09\x09JS_ERR: 4\x0a\x09\x09\x09};\x0a\x0a\x09\x09\x09function RuntimeError(code) {\x0a\x09\x09\x09\x09this.code = code;\x0a\x09\x09\x09\x09this.name = _findKey(namecodes, code);\x0a\x09\x09\x09\x09this.message = this.name + \x22: RuntimeError \x22 + this.code;\x0a\x09\x09\x09}\x0a\x09\x09\x09\x0a\x09\x09\x09Basic.extend(RuntimeError, namecodes);\x0a\x09\x09\x09RuntimeError.prototype = Error.prototype;\x0a\x09\x09\x09return RuntimeError;\x0a\x09\x09}()),\x0a\x09\x09\x0a\x09\x09OperationNotAllowedException: (function() {\x0a\x09\x09\x09\x0a\x09\x09\x09function OperationNotAllowedException(code) {\x0a\x09\x09\x09\x09this.code = code;\x0a\x09\x09\x09\x09this.name = \x27OperationNotAllowedException\x27;\x0a\x09\x09\x09}\x0a\x09\x09\x09\x0a\x09\x09\x09Basic.extend(OperationNotAllowedException, {\x0a\x09\x09\x09\x09NOT_ALLOWED_ERR: 1\x0a\x09\x09\x09});\x0a\x09\x09\x09\x0a\x09\x09\x09OperationNotAllowedException.prototype = Error.prototype;\x0a\x09\x09\x09\x0a\x09\x09\x09return OperationNotAllowedException;\x0a\x09\x09}()),\x0a\x0a\x09\x09ImageError: (function() {\x0a\x09\x09\x09var namecodes = {\x0a\x09\x09\x09\x09WRONG_FORMAT: 1,\x0a\x09\x09\x09\x09MAX_RESOLUTION_ERR: 2,\x0a\x09\x09\x09\x09INVALID_META_ERR: 3\x0a\x09\x09\x09};\x0a\x0a\x09\x09\x09function ImageError(code) {\x0a\x09\x09\x09\x09this.code = code;\x0a\x09\x09\x09\x09this.name = _findKey(namecodes, code);\x0a\x09\x09\x09\x09this.message = this.name + \x22: ImageError \x22 + this.code;\x0a\x09\x09\x09}\x0a\x09\x09\x09\x0a\x09\x09\x09Basic.extend(ImageError, namecodes);\x0a\x09\x09\x09ImageError.prototype = Error.prototype;\x0a\x0a\x09\x09\x09return ImageError;\x0a\x09\x09}()),\x0a\x0a\x09\x09FileException: (function() {\x0a\x09\x09\x09var namecodes = {\x0a\x09\x09\x09\x09NOT_FOUND_ERR: 1,\x0a\x09\x09\x09\x09SECURITY_ERR: 2,\x0a\x09\x09\x09\x09ABORT_ERR: 3,\x0a\x09\x09\x09\x09NOT_READABLE_ERR: 4,\x0a\x09\x09\x09\x09ENCODING_ERR: 5,\x0a\x09\x09\x09\x09NO_MODIFICATION_ALLOWED_ERR: 6,\x0a\x09\x09\x09\x09INVALID_STATE_ERR: 7,\x0a\x09\x09\x09\x09SYNTAX_ERR: 8\x0a\x09\x09\x09};\x0a\x0a\x09\x09\x09function FileException(code) {\x0a\x09\x09\x09\x09this.code = code;\x0a\x09\x09\x09\x09this.name = _findKey(namecodes, code);\x0a\x09\x09\x09\x09this.message = this.name + \x22: FileException \x22 + this.code;\x0a\x09\x09\x09}\x0a\x09\x09\x09\x0a\x09\x09\x09Basic.extend(FileException, namecodes);\x0a\x09\x09\x09FileException.prototype = Error.prototype;\x0a\x09\x09\x09return FileException;\x0a\x09\x09}()),\x0a\x09\x09\x0a\x09\x09DOMException: (function() {\x0a\x09\x09\x09var namecodes = {\x0a\x09\x09\x09\x09INDEX_SIZE_ERR: 1,\x0a\x09\x09\x09\x09DOMSTRING_SIZE_ERR: 2,\x0a\x09\x09\x09\x09HIERARCHY_REQUEST_ERR: 3,\x0a\x09\x09\x09\x09WRONG_DOCUMENT_ERR: 4,\x0a\x09\x09\x09\x09INVALID_CHARACTER_ERR: 5,\x0a\x09\x09\x09\x09NO_DATA_ALLOWED_ERR: 6,\x0a\x09\x09\x09\x09NO_MODIFICATION_ALLOWED_ERR: 7,\x0a\x09\x09\x09\x09NOT_FOUND_ERR: 8,\x0a\x09\x09\x09\x09NOT_SUPPORTED_ERR: 9,\x0a\x09\x09\x09\x09INUSE_ATTRIBUTE_ERR: 10,\x0a\x09\x09\x09\x09INVALID_STATE_ERR: 11,\x0a\x09\x09\x09\x09SYNTAX_ERR: 12,\x0a\x09\x09\x09\x09INVALID_MODIFICATION_ERR: 13,\x0a\x09\x09\x09\x09NAMESPACE_ERR: 14,\x0a\x09\x09\x09\x09INVALID_ACCESS_ERR: 15,\x0a\x09\x09\x09\x09VALIDATION_ERR: 16,\x0a\x09\x09\x09\x09TYPE_MISMATCH_ERR: 17,\x0a\x09\x09\x09\x09SECURITY_ERR: 18,\x0a\x09\x09\x09\x09NETWORK_ERR: 19,\x0a\x09\x09\x09\x09ABORT_ERR: 20,\x0a\x09\x09\x09\x09URL_MISMATCH_ERR: 21,\x0a\x09\x09\x09\x09QUOTA_EXCEEDED_ERR: 22,\x0a\x09\x09\x09\x09TIMEOUT_ERR: 23,\x0a\x09\x09\x09\x09INVALID_NODE_TYPE_ERR: 24,\x0a\x09\x09\x09\x09DATA_CLONE_ERR: 25\x0a\x09\x09\x09};\x0a\x0a\x09\x09\x09function DOMException(code) {\x0a\x09\x09\x09\x09this.code = code;\x0a\x09\x09\x09\x09this.name = _findKey(namecodes, code);\x0a\x09\x09\x09\x09this.message = this.name + \x22: DOMException \x22 + this.code;\x0a\x09\x09\x09}\x0a\x09\x09\x09\x0a\x09\x09\x09Basic.extend(DOMException, namecodes);\x0a\x09\x09\x09DOMException.prototype = Error.prototype;\x0a\x09\x09\x09return DOMException;\x0a\x09\x09}()),\x0a\x09\x09\x0a\x09\x09EventException: (function() {\x0a\x09\x09\x09function EventException(code) {\x0a\x09\x09\x09\x09this.code = code;\x0a\x09\x09\x09\x09this.name = \x27EventException\x27;\x0a\x09\x09\x09}\x0a\x09\x09\x09\x0a\x09\x09\x09Basic.extend(EventException, {\x0a\x09\x09\x09\x09UNSPECIFIED_EVENT_TYPE_ERR: 0\x0a\x09\x09\x09});\x0a\x09\x09\x09\x0a\x09\x09\x09EventException.prototype = Error.prototype;\x0a\x09\x09\x09\x0a\x09\x09\x09return EventException;\x0a\x09\x09}())\x0a\x09};\x0a});\x0a\x0a// Included from: src/javascript/core/EventTarget.js\x0a\x0a/**\x0a * EventTarget.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x27moxie/core/EventTarget\x27, [\x0a\x09\x27moxie/core/utils/Env\x27,\x0a\x09\x27moxie/core/Exceptions\x27,\x0a\x09\x27moxie/core/utils/Basic\x27\x0a], function(Env, x, Basic) {\x0a\x09/**\x0a\x09Parent object for all event dispatching components and objects\x0a\x0a\x09@class EventTarget\x0a\x09@constructor EventTarget\x0a\x09*/\x0a\x09function EventTarget() {\x0a\x09\x09// hash of event listeners by object uid\x0a\x09\x09var eventpool = {};\x0a\x09\x09\x09\x09\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Unique id of the event dispatcher, usually overriden by children\x0a\x0a\x09\x09\x09@property uid\x0a\x09\x09\x09@type String\x0a\x09\x09\x09*/\x0a\x09\x09\x09uid: null,\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Can be called from within a child  in order to acquire uniqie id in automated manner\x0a\x0a\x09\x09\x09@method init\x0a\x09\x09\x09*/\x0a\x09\x09\x09init: function() {\x0a\x09\x09\x09\x09if (!this.uid) {\x0a\x09\x09\x09\x09\x09this.uid = Basic.guid(\x27uid_\x27);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Register a handler to a specific event dispatched by the object\x0a\x0a\x09\x09\x09@method addEventListener\x0a\x09\x09\x09@param {String} type Type or basically a name of the event to subscribe to\x0a\x09\x09\x09@param {Function} fn Callback function that will be called when event happens\x0a\x09\x09\x09@param {Number} [priority=0] Priority of the event handler - handlers with higher priorities will be called first\x0a\x09\x09\x09@param {Object} [scope=this] A scope to invoke event handler in\x0a\x09\x09\x09*/\x0a\x09\x09\x09addEventListener: function(type, fn, priority, scope) {\x0a\x09\x09\x09\x09var self = this, list;\x0a\x0a\x09\x09\x09\x09// without uid no event handlers can be added, so make sure we got one\x0a\x09\x09\x09\x09if (!this.hasOwnProperty(\x27uid\x27)) {\x0a\x09\x09\x09\x09\x09this.uid = Basic.guid(\x27uid_\x27);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09type = Basic.trim(type);\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09if (/\x5cs/.test(type)) {\x0a\x09\x09\x09\x09\x09// multiple event types were passed for one handler\x0a\x09\x09\x09\x09\x09Basic.each(type.split(/\x5cs+/), function(type) {\x0a\x09\x09\x09\x09\x09\x09self.addEventListener(type, fn, priority, scope);\x0a\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09return;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09type = type.toLowerCase();\x0a\x09\x09\x09\x09priority = parseInt(priority, 10) || 0;\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09list = eventpool[this.uid] && eventpool[this.uid][type] || [];\x0a\x09\x09\x09\x09list.push({fn : fn, priority : priority, scope : scope || this});\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09if (!eventpool[this.uid]) {\x0a\x09\x09\x09\x09\x09eventpool[this.uid] = {};\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09eventpool[this.uid][type] = list;\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Check if any handlers were registered to the specified event\x0a\x0a\x09\x09\x09@method hasEventListener\x0a\x09\x09\x09@param {String} type Type or basically a name of the event to check\x0a\x09\x09\x09@return {Mixed} Returns a handler if it was found and false, if - not\x0a\x09\x09\x09*/\x0a\x09\x09\x09hasEventListener: function(type) {\x0a\x09\x09\x09\x09var list = type ? eventpool[this.uid] && eventpool[this.uid][type] : eventpool[this.uid];\x0a\x09\x09\x09\x09return list ? list : false;\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Unregister the handler from the event, or if former was not specified - unregister all handlers\x0a\x0a\x09\x09\x09@method removeEventListener\x0a\x09\x09\x09@param {String} type Type or basically a name of the event\x0a\x09\x09\x09@param {Function} [fn] Handler to unregister\x0a\x09\x09\x09*/\x0a\x09\x09\x09removeEventListener: function(type, fn) {\x0a\x09\x09\x09\x09type = type.toLowerCase();\x0a\x09\x0a\x09\x09\x09\x09var list = eventpool[this.uid] && eventpool[this.uid][type], i;\x0a\x09\x0a\x09\x09\x09\x09if (list) {\x0a\x09\x09\x09\x09\x09if (fn) {\x0a\x09\x09\x09\x09\x09\x09for (i = list.length - 1; i \x3e= 0; i--) {\x0a\x09\x09\x09\x09\x09\x09\x09if (list[i].fn === fn) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09list.splice(i, 1);\x0a\x09\x09\x09\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09list = [];\x0a\x09\x09\x09\x09\x09}\x0a\x09\x0a\x09\x09\x09\x09\x09// delete event list if it has become empty\x0a\x09\x09\x09\x09\x09if (!list.length) {\x0a\x09\x09\x09\x09\x09\x09delete eventpool[this.uid][type];\x0a\x09\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09\x09// and object specific entry in a hash if it has no more listeners attached\x0a\x09\x09\x09\x09\x09\x09if (Basic.isEmptyObj(eventpool[this.uid])) {\x0a\x09\x09\x09\x09\x09\x09\x09delete eventpool[this.uid];\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Remove all event handlers from the object\x0a\x0a\x09\x09\x09@method removeAllEventListeners\x0a\x09\x09\x09*/\x0a\x09\x09\x09removeAllEventListeners: function() {\x0a\x09\x09\x09\x09if (eventpool[this.uid]) {\x0a\x09\x09\x09\x09\x09delete eventpool[this.uid];\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Dispatch the event\x0a\x0a\x09\x09\x09@method dispatchEvent\x0a\x09\x09\x09@param {String/Object} Type of event or event object to dispatch\x0a\x09\x09\x09@param {Mixed} [...] Variable number of arguments to be passed to a handlers\x0a\x09\x09\x09@return {Boolean} true by default and false if any handler returned false\x0a\x09\x09\x09*/\x0a\x09\x09\x09dispatchEvent: function(type) {\x0a\x09\x09\x09\x09var uid, list, args, tmpEvt, evt = {}, result = true, undef;\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09if (Basic.typeOf(type) !== \x27string\x27) {\x0a\x09\x09\x09\x09\x09// we can\x27t use original object directly (because of Silverlight)\x0a\x09\x09\x09\x09\x09tmpEvt = type;\x0a\x0a\x09\x09\x09\x09\x09if (Basic.typeOf(tmpEvt.type) === \x27string\x27) {\x0a\x09\x09\x09\x09\x09\x09type = tmpEvt.type;\x0a\x0a\x09\x09\x09\x09\x09\x09if (tmpEvt.total !== undef && tmpEvt.loaded !== undef) { // progress event\x0a\x09\x09\x09\x09\x09\x09\x09evt.total = tmpEvt.total;\x0a\x09\x09\x09\x09\x09\x09\x09evt.loaded = tmpEvt.loaded;\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09evt.async = tmpEvt.async || false;\x0a\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09throw new x.EventException(x.EventException.UNSPECIFIED_EVENT_TYPE_ERR);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09// check if event is meant to be dispatched on an object having specific uid\x0a\x09\x09\x09\x09if (type.indexOf(\x27::\x27) !== -1) {\x0a\x09\x09\x09\x09\x09(function(arr) {\x0a\x09\x09\x09\x09\x09\x09uid = arr[0];\x0a\x09\x09\x09\x09\x09\x09type = arr[1];\x0a\x09\x09\x09\x09\x09}(type.split(\x27::\x27)));\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09uid = this.uid;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09type = type.toLowerCase();\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09list = eventpool[uid] && eventpool[uid][type];\x0a\x0a\x09\x09\x09\x09if (list) {\x0a\x09\x09\x09\x09\x09// sort event list by prority\x0a\x09\x09\x09\x09\x09list.sort(function(a, b) { return b.priority - a.priority; });\x0a\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09args = [].slice.call(arguments);\x0a\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09// first argument will be pseudo-event object\x0a\x09\x09\x09\x09\x09args.shift();\x0a\x09\x09\x09\x09\x09evt.type = type;\x0a\x09\x09\x09\x09\x09args.unshift(evt);\x0a\x0a\x09\x09\x09\x09\x09if (MXI_DEBUG && Env.debug.events) {\x0a\x09\x09\x09\x09\x09\x09Env.log(\x22Event \x27%s\x27 fired on %u\x22, evt.type, uid);\x09\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09// Dispatch event to all listeners\x0a\x09\x09\x09\x09\x09var queue = [];\x0a\x09\x09\x09\x09\x09Basic.each(list, function(handler) {\x0a\x09\x09\x09\x09\x09\x09// explicitly set the target, otherwise events fired from shims do not get it\x0a\x09\x09\x09\x09\x09\x09args[0].target = handler.scope;\x0a\x09\x09\x09\x09\x09\x09// if event is marked as async, detach the handler\x0a\x09\x09\x09\x09\x09\x09if (evt.async) {\x0a\x09\x09\x09\x09\x09\x09\x09queue.push(function(cb) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09setTimeout(function() {\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09cb(handler.fn.apply(handler.scope, args) === false);\x0a\x09\x09\x09\x09\x09\x09\x09\x09}, 1);\x0a\x09\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09\x09queue.push(function(cb) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09cb(handler.fn.apply(handler.scope, args) === false); // if handler returns false stop propagation\x0a\x09\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09if (queue.length) {\x0a\x09\x09\x09\x09\x09\x09Basic.inSeries(queue, function(err) {\x0a\x09\x09\x09\x09\x09\x09\x09result = !err;\x0a\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09return result;\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Alias for addEventListener\x0a\x0a\x09\x09\x09@method bind\x0a\x09\x09\x09@protected\x0a\x09\x09\x09*/\x0a\x09\x09\x09bind: function() {\x0a\x09\x09\x09\x09this.addEventListener.apply(this, arguments);\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Alias for removeEventListener\x0a\x0a\x09\x09\x09@method unbind\x0a\x09\x09\x09@protected\x0a\x09\x09\x09*/\x0a\x09\x09\x09unbind: function() {\x0a\x09\x09\x09\x09this.removeEventListener.apply(this, arguments);\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Alias for removeAllEventListeners\x0a\x0a\x09\x09\x09@method unbindAll\x0a\x09\x09\x09@protected\x0a\x09\x09\x09*/\x0a\x09\x09\x09unbindAll: function() {\x0a\x09\x09\x09\x09this.removeAllEventListeners.apply(this, arguments);\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Alias for dispatchEvent\x0a\x0a\x09\x09\x09@method trigger\x0a\x09\x09\x09@protected\x0a\x09\x09\x09*/\x0a\x09\x09\x09trigger: function() {\x0a\x09\x09\x09\x09return this.dispatchEvent.apply(this, arguments);\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Handle properties of on[event] type.\x0a\x0a\x09\x09\x09@method handleEventProps\x0a\x09\x09\x09@private\x0a\x09\x09\x09*/\x0a\x09\x09\x09handleEventProps: function(dispatches) {\x0a\x09\x09\x09\x09var self = this;\x0a\x0a\x09\x09\x09\x09this.bind(dispatches.join(\x27 \x27), function(e) {\x0a\x09\x09\x09\x09\x09var prop = \x27on\x27 + e.type.toLowerCase();\x0a\x09\x09\x09\x09\x09if (Basic.typeOf(this[prop]) === \x27function\x27) {\x0a\x09\x09\x09\x09\x09\x09this[prop].apply(this, arguments);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09// object must have defined event properties, even if it doesn\x27t make use of them\x0a\x09\x09\x09\x09Basic.each(dispatches, function(prop) {\x0a\x09\x09\x09\x09\x09prop = \x27on\x27 + prop.toLowerCase(prop);\x0a\x09\x09\x09\x09\x09if (Basic.typeOf(self[prop]) === \x27undefined\x27) {\x0a\x09\x09\x09\x09\x09\x09self[prop] = null; \x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09}\x0a\x09\x09\x09\x0a\x09\x09});\x0a\x09}\x0a\x0a\x09EventTarget.instance = new EventTarget(); \x0a\x0a\x09return EventTarget;\x0a});\x0a\x0a// Included from: src/javascript/runtime/Runtime.js\x0a\x0a/**\x0a * Runtime.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x27moxie/runtime/Runtime\x27, [\x0a\x09\x22moxie/core/utils/Env\x22,\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/core/utils/Dom\x22,\x0a\x09\x22moxie/core/EventTarget\x22\x0a], function(Env, Basic, Dom, EventTarget) {\x0a\x09var runtimeConstructors = {}, runtimes = {};\x0a\x0a\x09/**\x0a\x09Common set of methods and properties for every runtime instance\x0a\x0a\x09@class Runtime\x0a\x0a\x09@param {Object} options\x0a\x09@param {String} type Sanitized name of the runtime\x0a\x09@param {Object} [caps] Set of capabilities that differentiate specified runtime\x0a\x09@param {Object} [modeCaps] Set of capabilities that do require specific operational mode\x0a\x09@param {String} [preferredMode=\x27browser\x27] Preferred operational mode to choose if no required capabilities were requested\x0a\x09*/\x0a\x09function Runtime(options, type, caps, modeCaps, preferredMode) {\x0a\x09\x09/**\x0a\x09\x09Dispatched when runtime is initialized and ready.\x0a\x09\x09Results in RuntimeInit on a connected component.\x0a\x0a\x09\x09@event Init\x0a\x09\x09*/\x0a\x0a\x09\x09/**\x0a\x09\x09Dispatched when runtime fails to initialize.\x0a\x09\x09Results in RuntimeError on a connected component.\x0a\x0a\x09\x09@event Error\x0a\x09\x09*/\x0a\x0a\x09\x09var self = this\x0a\x09\x09, _shim\x0a\x09\x09, _uid = Basic.guid(type + \x27_\x27)\x0a\x09\x09, defaultMode = preferredMode || \x27browser\x27\x0a\x09\x09;\x0a\x0a\x09\x09options = options || {};\x0a\x0a\x09\x09// register runtime in private hash\x0a\x09\x09runtimes[_uid] = this;\x0a\x0a\x09\x09/**\x0a\x09\x09Default set of capabilities, which can be redifined later by specific runtime\x0a\x0a\x09\x09@private\x0a\x09\x09@property caps\x0a\x09\x09@type Object\x0a\x09\x09*/\x0a\x09\x09caps = Basic.extend({\x0a\x09\x09\x09// Runtime can: \x0a\x09\x09\x09// provide access to raw binary data of the file\x0a\x09\x09\x09access_binary: false,\x0a\x09\x09\x09// provide access to raw binary data of the image (image extension is optional) \x0a\x09\x09\x09access_image_binary: false,\x0a\x09\x09\x09// display binary data as thumbs for example\x0a\x09\x09\x09display_media: false,\x0a\x09\x09\x09// make cross-domain requests\x0a\x09\x09\x09do_cors: false,\x0a\x09\x09\x09// accept files dragged and dropped from the desktop\x0a\x09\x09\x09drag_and_drop: false,\x0a\x09\x09\x09// filter files in selection dialog by their extensions\x0a\x09\x09\x09filter_by_extension: true,\x0a\x09\x09\x09// resize image (and manipulate it raw data of any file in general)\x0a\x09\x09\x09resize_image: false,\x0a\x09\x09\x09// periodically report how many bytes of total in the file were uploaded (loaded)\x0a\x09\x09\x09report_upload_progress: false,\x0a\x09\x09\x09// provide access to the headers of http response \x0a\x09\x09\x09return_response_headers: false,\x0a\x09\x09\x09// support response of specific type, which should be passed as an argument\x0a\x09\x09\x09// e.g. runtime.can(\x27return_response_type\x27, \x27blob\x27)\x0a\x09\x09\x09return_response_type: false,\x0a\x09\x09\x09// return http status code of the response\x0a\x09\x09\x09return_status_code: true,\x0a\x09\x09\x09// send custom http header with the request\x0a\x09\x09\x09send_custom_headers: false,\x0a\x09\x09\x09// pick up the files from a dialog\x0a\x09\x09\x09select_file: false,\x0a\x09\x09\x09// select whole folder in file browse dialog\x0a\x09\x09\x09select_folder: false,\x0a\x09\x09\x09// select multiple files at once in file browse dialog\x0a\x09\x09\x09select_multiple: true,\x0a\x09\x09\x09// send raw binary data, that is generated after image resizing or manipulation of other kind\x0a\x09\x09\x09send_binary_string: false,\x0a\x09\x09\x09// send cookies with http request and therefore retain session\x0a\x09\x09\x09send_browser_cookies: true,\x0a\x09\x09\x09// send data formatted as multipart/form-data\x0a\x09\x09\x09send_multipart: true,\x0a\x09\x09\x09// slice the file or blob to smaller parts\x0a\x09\x09\x09slice_blob: false,\x0a\x09\x09\x09// upload file without preloading it to memory, stream it out directly from disk\x0a\x09\x09\x09stream_upload: false,\x0a\x09\x09\x09// programmatically trigger file browse dialog\x0a\x09\x09\x09summon_file_dialog: false,\x0a\x09\x09\x09// upload file of specific size, size should be passed as argument\x0a\x09\x09\x09// e.g. runtime.can(\x27upload_filesize\x27, \x27500mb\x27)\x0a\x09\x09\x09upload_filesize: true,\x0a\x09\x09\x09// initiate http request with specific http method, method should be passed as argument\x0a\x09\x09\x09// e.g. runtime.can(\x27use_http_method\x27, \x27put\x27)\x0a\x09\x09\x09use_http_method: true\x0a\x09\x09}, caps);\x0a\x09\x09\x09\x0a\x09\x0a\x09\x09// default to the mode that is compatible with preferred caps\x0a\x09\x09if (options.preferred_caps) {\x0a\x09\x09\x09defaultMode = Runtime.getMode(modeCaps, options.preferred_caps, defaultMode);\x0a\x09\x09}\x0a\x0a\x09\x09if (MXI_DEBUG && Env.debug.runtime) {\x0a\x09\x09\x09Env.log(\x22\x5ctdefault mode: %s\x22, defaultMode);\x09\x0a\x09\x09}\x0a\x09\x09\x0a\x09\x09// small extension factory here (is meant to be extended with actual extensions constructors)\x0a\x09\x09_shim = (function() {\x0a\x09\x09\x09var objpool = {};\x0a\x09\x09\x09return {\x0a\x09\x09\x09\x09exec: function(uid, comp, fn, args) {\x0a\x09\x09\x09\x09\x09if (_shim[comp]) {\x0a\x09\x09\x09\x09\x09\x09if (!objpool[uid]) {\x0a\x09\x09\x09\x09\x09\x09\x09objpool[uid] = {\x0a\x09\x09\x09\x09\x09\x09\x09\x09context: this,\x0a\x09\x09\x09\x09\x09\x09\x09\x09instance: new _shim[comp]()\x0a\x09\x09\x09\x09\x09\x09\x09};\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09if (objpool[uid].instance[fn]) {\x0a\x09\x09\x09\x09\x09\x09\x09return objpool[uid].instance[fn].apply(this, args);\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09},\x0a\x0a\x09\x09\x09\x09removeInstance: function(uid) {\x0a\x09\x09\x09\x09\x09delete objpool[uid];\x0a\x09\x09\x09\x09},\x0a\x0a\x09\x09\x09\x09removeAllInstances: function() {\x0a\x09\x09\x09\x09\x09var self = this;\x0a\x09\x09\x09\x09\x09Basic.each(objpool, function(obj, uid) {\x0a\x09\x09\x09\x09\x09\x09if (Basic.typeOf(obj.instance.destroy) === \x27function\x27) {\x0a\x09\x09\x09\x09\x09\x09\x09obj.instance.destroy.call(obj.context);\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09self.removeInstance(uid);\x0a\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09};\x0a\x09\x09}());\x0a\x0a\x0a\x09\x09// public methods\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09/**\x0a\x09\x09\x09Specifies whether runtime instance was initialized or not\x0a\x0a\x09\x09\x09@property initialized\x0a\x09\x09\x09@type {Boolean}\x0a\x09\x09\x09@default false\x0a\x09\x09\x09*/\x0a\x09\x09\x09initialized: false, // shims require this flag to stop initialization retries\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Unique ID of the runtime\x0a\x0a\x09\x09\x09@property uid\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09*/\x0a\x09\x09\x09uid: _uid,\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Runtime type (e.g. flash, html5, etc)\x0a\x0a\x09\x09\x09@property type\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09*/\x0a\x09\x09\x09type: type,\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Runtime (not native one) may operate in browser or client mode.\x0a\x0a\x09\x09\x09@property mode\x0a\x09\x09\x09@private\x0a\x09\x09\x09@type {String|Boolean} current mode or false, if none possible\x0a\x09\x09\x09*/\x0a\x09\x09\x09mode: Runtime.getMode(modeCaps, (options.required_caps), defaultMode),\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09id of the DOM container for the runtime (if available)\x0a\x0a\x09\x09\x09@property shimid\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09*/\x0a\x09\x09\x09shimid: _uid + \x27_container\x27,\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Number of connected clients. If equal to zero, runtime can be destroyed\x0a\x0a\x09\x09\x09@property clients\x0a\x09\x09\x09@type {Number}\x0a\x09\x09\x09*/\x0a\x09\x09\x09clients: 0,\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Runtime initialization options\x0a\x0a\x09\x09\x09@property options\x0a\x09\x09\x09@type {Object}\x0a\x09\x09\x09*/\x0a\x09\x09\x09options: options,\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Checks if the runtime has specific capability\x0a\x0a\x09\x09\x09@method can\x0a\x09\x09\x09@param {String} cap Name of capability to check\x0a\x09\x09\x09@param {Mixed} [value] If passed, capability should somehow correlate to the value\x0a\x09\x09\x09@param {Object} [refCaps] Set of capabilities to check the specified cap against (defaults to internal set)\x0a\x09\x09\x09@return {Boolean} true if runtime has such capability and false, if - not\x0a\x09\x09\x09*/\x0a\x09\x09\x09can: function(cap, value) {\x0a\x09\x09\x09\x09var refCaps = arguments[2] || caps;\x0a\x0a\x09\x09\x09\x09// if cap var is a comma-separated list of caps, convert it to object (key/value)\x0a\x09\x09\x09\x09if (Basic.typeOf(cap) === \x27string\x27 && Basic.typeOf(value) === \x27undefined\x27) {\x0a\x09\x09\x09\x09\x09cap = Runtime.parseCaps(cap);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if (Basic.typeOf(cap) === \x27object\x27) {\x0a\x09\x09\x09\x09\x09for (var key in cap) {\x0a\x09\x09\x09\x09\x09\x09if (!this.can(key, cap[key], refCaps)) {\x0a\x09\x09\x09\x09\x09\x09\x09return false;\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09return true;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// check the individual cap\x0a\x09\x09\x09\x09if (Basic.typeOf(refCaps[cap]) === \x27function\x27) {\x0a\x09\x09\x09\x09\x09return refCaps[cap].call(this, value);\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09return (value === refCaps[cap]);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Returns container for the runtime as DOM element\x0a\x0a\x09\x09\x09@method getShimContainer\x0a\x09\x09\x09@return {DOMElement}\x0a\x09\x09\x09*/\x0a\x09\x09\x09getShimContainer: function() {\x0a\x09\x09\x09\x09var container, shimContainer = Dom.get(this.shimid);\x0a\x0a\x09\x09\x09\x09// if no container for shim, create one\x0a\x09\x09\x09\x09if (!shimContainer) {\x0a\x09\x09\x09\x09\x09container = this.options.container ? Dom.get(this.options.container) : document.body;\x0a\x0a\x09\x09\x09\x09\x09// create shim container and insert it at an absolute position into the outer container\x0a\x09\x09\x09\x09\x09shimContainer = document.createElement(\x27div\x27);\x0a\x09\x09\x09\x09\x09shimContainer.id = this.shimid;\x0a\x09\x09\x09\x09\x09shimContainer.className = \x27moxie-shim moxie-shim-\x27 + this.type;\x0a\x0a\x09\x09\x09\x09\x09Basic.extend(shimContainer.style, {\x0a\x09\x09\x09\x09\x09\x09position: \x27absolute\x27,\x0a\x09\x09\x09\x09\x09\x09top: \x270px\x27,\x0a\x09\x09\x09\x09\x09\x09left: \x270px\x27,\x0a\x09\x09\x09\x09\x09\x09width: \x271px\x27,\x0a\x09\x09\x09\x09\x09\x09height: \x271px\x27,\x0a\x09\x09\x09\x09\x09\x09overflow: \x27hidden\x27\x0a\x09\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09\x09container.appendChild(shimContainer);\x0a\x09\x09\x09\x09\x09container = null;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09return shimContainer;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Returns runtime as DOM element (if appropriate)\x0a\x0a\x09\x09\x09@method getShim\x0a\x09\x09\x09@return {DOMElement}\x0a\x09\x09\x09*/\x0a\x09\x09\x09getShim: function() {\x0a\x09\x09\x09\x09return _shim;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Invokes a method within the runtime itself (might differ across the runtimes)\x0a\x0a\x09\x09\x09@method shimExec\x0a\x09\x09\x09@param {Mixed} []\x0a\x09\x09\x09@protected\x0a\x09\x09\x09@return {Mixed} Depends on the action and component\x0a\x09\x09\x09*/\x0a\x09\x09\x09shimExec: function(component, action) {\x0a\x09\x09\x09\x09var args = [].slice.call(arguments, 2);\x0a\x09\x09\x09\x09return self.getShim().exec.call(this, this.uid, component, action, args);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Operaional interface that is used by components to invoke specific actions on the runtime\x0a\x09\x09\x09(is invoked in the scope of component)\x0a\x0a\x09\x09\x09@method exec\x0a\x09\x09\x09@param {Mixed} []*\x0a\x09\x09\x09@protected\x0a\x09\x09\x09@return {Mixed} Depends on the action and component\x0a\x09\x09\x09*/\x0a\x09\x09\x09exec: function(component, action) { // this is called in the context of component, not runtime\x0a\x09\x09\x09\x09var args = [].slice.call(arguments, 2);\x0a\x0a\x09\x09\x09\x09if (self[component] && self[component][action]) {\x0a\x09\x09\x09\x09\x09return self[component][action].apply(this, args);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09return self.shimExec.apply(this, arguments);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Destroys the runtime (removes all events and deletes DOM structures)\x0a\x0a\x09\x09\x09@method destroy\x0a\x09\x09\x09*/\x0a\x09\x09\x09destroy: function() {\x0a\x09\x09\x09\x09if (!self) {\x0a\x09\x09\x09\x09\x09return; // obviously already destroyed\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09var shimContainer = Dom.get(this.shimid);\x0a\x09\x09\x09\x09if (shimContainer) {\x0a\x09\x09\x09\x09\x09shimContainer.parentNode.removeChild(shimContainer);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if (_shim) {\x0a\x09\x09\x09\x09\x09_shim.removeAllInstances();\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09this.unbindAll();\x0a\x09\x09\x09\x09delete runtimes[this.uid];\x0a\x09\x09\x09\x09this.uid = null; // mark this runtime as destroyed\x0a\x09\x09\x09\x09_uid = self = _shim = shimContainer = null;\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09// once we got the mode, test against all caps\x0a\x09\x09if (this.mode && options.required_caps && !this.can(options.required_caps)) {\x0a\x09\x09\x09this.mode = false;\x0a\x09\x09}\x09\x0a\x09}\x0a\x0a\x0a\x09/**\x0a\x09Default order to try different runtime types\x0a\x0a\x09@property order\x0a\x09@type String\x0a\x09@static\x0a\x09*/\x0a\x09Runtime.order = \x27html5,html4\x27;\x0a\x0a\x0a\x09/**\x0a\x09Retrieves runtime from private hash by it\x27s uid\x0a\x0a\x09@method getRuntime\x0a\x09@private\x0a\x09@static\x0a\x09@param {String} uid Unique identifier of the runtime\x0a\x09@return {Runtime|Boolean} Returns runtime, if it exists and false, if - not\x0a\x09*/\x0a\x09Runtime.getRuntime = function(uid) {\x0a\x09\x09return runtimes[uid] ? runtimes[uid] : false;\x0a\x09};\x0a\x0a\x0a\x09/**\x0a\x09Register constructor for the Runtime of new (or perhaps modified) type\x0a\x0a\x09@method addConstructor\x0a\x09@static\x0a\x09@param {String} type Runtime type (e.g. flash, html5, etc)\x0a\x09@param {Function} construct Constructor for the Runtime type\x0a\x09*/\x0a\x09Runtime.addConstructor = function(type, constructor) {\x0a\x09\x09constructor.prototype = EventTarget.instance;\x0a\x09\x09runtimeConstructors[type] = constructor;\x0a\x09};\x0a\x0a\x0a\x09/**\x0a\x09Get the constructor for the specified type.\x0a\x0a\x09method getConstructor\x0a\x09@static\x0a\x09@param {String} type Runtime type (e.g. flash, html5, etc)\x0a\x09@return {Function} Constructor for the Runtime type\x0a\x09*/\x0a\x09Runtime.getConstructor = function(type) {\x0a\x09\x09return runtimeConstructors[type] || null;\x0a\x09};\x0a\x0a\x0a\x09/**\x0a\x09Get info about the runtime (uid, type, capabilities)\x0a\x0a\x09@method getInfo\x0a\x09@static\x0a\x09@param {String} uid Unique identifier of the runtime\x0a\x09@return {Mixed} Info object or null if runtime doesn\x27t exist\x0a\x09*/\x0a\x09Runtime.getInfo = function(uid) {\x0a\x09\x09var runtime = Runtime.getRuntime(uid);\x0a\x0a\x09\x09if (runtime) {\x0a\x09\x09\x09return {\x0a\x09\x09\x09\x09uid: runtime.uid,\x0a\x09\x09\x09\x09type: runtime.type,\x0a\x09\x09\x09\x09mode: runtime.mode,\x0a\x09\x09\x09\x09can: function() {\x0a\x09\x09\x09\x09\x09return runtime.can.apply(runtime, arguments);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09};\x0a\x09\x09}\x0a\x09\x09return null;\x0a\x09};\x0a\x0a\x0a\x09/**\x0a\x09Convert caps represented by a comma-separated string to the object representation.\x0a\x0a\x09@method parseCaps\x0a\x09@static\x0a\x09@param {String} capStr Comma-separated list of capabilities\x0a\x09@return {Object}\x0a\x09*/\x0a\x09Runtime.parseCaps = function(capStr) {\x0a\x09\x09var capObj = {};\x0a\x0a\x09\x09if (Basic.typeOf(capStr) !== \x27string\x27) {\x0a\x09\x09\x09return capStr || {};\x0a\x09\x09}\x0a\x0a\x09\x09Basic.each(capStr.split(\x27,\x27), function(key) {\x0a\x09\x09\x09capObj[key] = true; // we assume it to be - true\x0a\x09\x09});\x0a\x0a\x09\x09return capObj;\x0a\x09};\x0a\x0a\x09/**\x0a\x09Test the specified runtime for specific capabilities.\x0a\x0a\x09@method can\x0a\x09@static\x0a\x09@param {String} type Runtime type (e.g. flash, html5, etc)\x0a\x09@param {String|Object} caps Set of capabilities to check\x0a\x09@return {Boolean} Result of the test\x0a\x09*/\x0a\x09Runtime.can = function(type, caps) {\x0a\x09\x09var runtime\x0a\x09\x09, constructor = Runtime.getConstructor(type)\x0a\x09\x09, mode\x0a\x09\x09;\x0a\x09\x09if (constructor) {\x0a\x09\x09\x09runtime = new constructor({\x0a\x09\x09\x09\x09required_caps: caps\x0a\x09\x09\x09});\x0a\x09\x09\x09mode = runtime.mode;\x0a\x09\x09\x09runtime.destroy();\x0a\x09\x09\x09return !!mode;\x0a\x09\x09}\x0a\x09\x09return false;\x0a\x09};\x0a\x0a\x0a\x09/**\x0a\x09Figure out a runtime that supports specified capabilities.\x0a\x0a\x09@method thatCan\x0a\x09@static\x0a\x09@param {String|Object} caps Set of capabilities to check\x0a\x09@param {String} [runtimeOrder] Comma-separated list of runtimes to check against\x0a\x09@return {String} Usable runtime identifier or null\x0a\x09*/\x0a\x09Runtime.thatCan = function(caps, runtimeOrder) {\x0a\x09\x09var types = (runtimeOrder || Runtime.order).split(/\x5cs*,\x5cs*/);\x0a\x09\x09for (var i in types) {\x0a\x09\x09\x09if (Runtime.can(types[i], caps)) {\x0a\x09\x09\x09\x09return types[i];\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x09\x09return null;\x0a\x09};\x0a\x0a\x0a\x09/**\x0a\x09Figure out an operational mode for the specified set of capabilities.\x0a\x0a\x09@method getMode\x0a\x09@static\x0a\x09@param {Object} modeCaps Set of capabilities that depend on particular runtime mode\x0a\x09@param {Object} [requiredCaps] Supplied set of capabilities to find operational mode for\x0a\x09@param {String|Boolean} [defaultMode=\x27browser\x27] Default mode to use \x0a\x09@return {String|Boolean} Compatible operational mode\x0a\x09*/\x0a\x09Runtime.getMode = function(modeCaps, requiredCaps, defaultMode) {\x0a\x09\x09var mode = null;\x0a\x0a\x09\x09if (Basic.typeOf(defaultMode) === \x27undefined\x27) { // only if not specified\x0a\x09\x09\x09defaultMode = \x27browser\x27;\x0a\x09\x09}\x0a\x0a\x09\x09if (requiredCaps && !Basic.isEmptyObj(modeCaps)) {\x0a\x09\x09\x09// loop over required caps and check if they do require the same mode\x0a\x09\x09\x09Basic.each(requiredCaps, function(value, cap) {\x0a\x09\x09\x09\x09if (modeCaps.hasOwnProperty(cap)) {\x0a\x09\x09\x09\x09\x09var capMode = modeCaps[cap](value);\x0a\x0a\x09\x09\x09\x09\x09// make sure we always have an array\x0a\x09\x09\x09\x09\x09if (typeof(capMode) === \x27string\x27) {\x0a\x09\x09\x09\x09\x09\x09capMode = [capMode];\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09if (!mode) {\x0a\x09\x09\x09\x09\x09\x09mode = capMode;\x09\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09} else if (!(mode = Basic.arrayIntersect(mode, capMode))) {\x0a\x09\x09\x09\x09\x09\x09// if cap requires conflicting mode - runtime cannot fulfill required caps\x0a\x0a\x09\x09\x09\x09\x09\x09if (MXI_DEBUG && Env.debug.runtime) {\x0a\x09\x09\x09\x09\x09\x09\x09Env.log(\x22\x5ct\x5ct%c: %v (conflicting mode requested: %s)\x22, cap, value, capMode);\x09\x0a\x09\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09\x09return (mode = false);\x0a\x09\x09\x09\x09\x09}\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if (MXI_DEBUG && Env.debug.runtime) {\x0a\x09\x09\x09\x09\x09Env.log(\x22\x5ct\x5ct%c: %v (compatible modes: %s)\x22, cap, value, mode);\x09\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09});\x0a\x0a\x09\x09\x09if (mode) {\x0a\x09\x09\x09\x09return Basic.inArray(defaultMode, mode) !== -1 ? defaultMode : mode[0];\x0a\x09\x09\x09} else if (mode === false) {\x0a\x09\x09\x09\x09return false;\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x09\x09return defaultMode; \x0a\x09};\x0a\x0a\x0a\x09/**\x0a\x09Capability check that always returns true\x0a\x0a\x09@private\x0a\x09@static\x0a\x09@return {True}\x0a\x09*/\x0a\x09Runtime.capTrue = function() {\x0a\x09\x09return true;\x0a\x09};\x0a\x0a\x09/**\x0a\x09Capability check that always returns false\x0a\x0a\x09@private\x0a\x09@static\x0a\x09@return {False}\x0a\x09*/\x0a\x09Runtime.capFalse = function() {\x0a\x09\x09return false;\x0a\x09};\x0a\x0a\x09/**\x0a\x09Evaluate the expression to boolean value and create a function that always returns it.\x0a\x0a\x09@private\x0a\x09@static\x0a\x09@param {Mixed} expr Expression to evaluate\x0a\x09@return {Function} Function returning the result of evaluation\x0a\x09*/\x0a\x09Runtime.capTest = function(expr) {\x0a\x09\x09return function() {\x0a\x09\x09\x09return !!expr;\x0a\x09\x09};\x0a\x09};\x0a\x0a\x09return Runtime;\x0a});\x0a\x0a// Included from: src/javascript/runtime/RuntimeClient.js\x0a\x0a/**\x0a * RuntimeClient.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x27moxie/runtime/RuntimeClient\x27, [\x0a\x09\x27moxie/core/utils/Env\x27,\x0a\x09\x27moxie/core/Exceptions\x27,\x0a\x09\x27moxie/core/utils/Basic\x27,\x0a\x09\x27moxie/runtime/Runtime\x27\x0a], function(Env, x, Basic, Runtime) {\x0a\x09/**\x0a\x09Set of methods and properties, required by a component to acquire ability to connect to a runtime\x0a\x0a\x09@class RuntimeClient\x0a\x09*/\x0a\x09return function RuntimeClient() {\x0a\x09\x09var runtime;\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09/**\x0a\x09\x09\x09Connects to the runtime specified by the options. Will either connect to existing runtime or create a new one.\x0a\x09\x09\x09Increments number of clients connected to the specified runtime.\x0a\x0a\x09\x09\x09@private\x0a\x09\x09\x09@method connectRuntime\x0a\x09\x09\x09@param {Mixed} options Can be a runtme uid or a set of key-value pairs defining requirements and pre-requisites\x0a\x09\x09\x09*/\x0a\x09\x09\x09connectRuntime: function(options) {\x0a\x09\x09\x09\x09var comp = this, ruid;\x0a\x0a\x09\x09\x09\x09function initialize(items) {\x0a\x09\x09\x09\x09\x09var type, constructor;\x0a\x0a\x09\x09\x09\x09\x09// if we ran out of runtimes\x0a\x09\x09\x09\x09\x09if (!items.length) {\x0a\x09\x09\x09\x09\x09\x09comp.trigger(\x27RuntimeError\x27, new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR));\x0a\x09\x09\x09\x09\x09\x09runtime = null;\x0a\x09\x09\x09\x09\x09\x09return;\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09type = items.shift().toLowerCase();\x0a\x09\x09\x09\x09\x09constructor = Runtime.getConstructor(type);\x0a\x09\x09\x09\x09\x09if (!constructor) {\x0a\x09\x09\x09\x09\x09\x09initialize(items);\x0a\x09\x09\x09\x09\x09\x09return;\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09if (MXI_DEBUG && Env.debug.runtime) {\x0a\x09\x09\x09\x09\x09\x09Env.log(\x22Trying runtime: %s\x22, type);\x0a\x09\x09\x09\x09\x09\x09Env.log(options);\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09// try initializing the runtime\x0a\x09\x09\x09\x09\x09runtime = new constructor(options);\x0a\x0a\x09\x09\x09\x09\x09runtime.bind(\x27Init\x27, function() {\x0a\x09\x09\x09\x09\x09\x09// mark runtime as initialized\x0a\x09\x09\x09\x09\x09\x09runtime.initialized = true;\x0a\x0a\x09\x09\x09\x09\x09\x09if (MXI_DEBUG && Env.debug.runtime) {\x0a\x09\x09\x09\x09\x09\x09\x09Env.log(\x22Runtime \x27%s\x27 initialized\x22, runtime.type);\x0a\x09\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09\x09// jailbreak ...\x0a\x09\x09\x09\x09\x09\x09setTimeout(function() {\x0a\x09\x09\x09\x09\x09\x09\x09runtime.clients++;\x0a\x09\x09\x09\x09\x09\x09\x09// this will be triggered on component\x0a\x09\x09\x09\x09\x09\x09\x09comp.trigger(\x27RuntimeInit\x27, runtime);\x0a\x09\x09\x09\x09\x09\x09}, 1);\x0a\x09\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09\x09runtime.bind(\x27Error\x27, function() {\x0a\x09\x09\x09\x09\x09\x09if (MXI_DEBUG && Env.debug.runtime) {\x0a\x09\x09\x09\x09\x09\x09\x09Env.log(\x22Runtime \x27%s\x27 failed to initialize\x22, runtime.type);\x0a\x09\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09\x09runtime.destroy(); // runtime cannot destroy itself from inside at a right moment, thus we do it here\x0a\x09\x09\x09\x09\x09\x09initialize(items);\x0a\x09\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09\x09/*runtime.bind(\x27Exception\x27, function() { });*/\x0a\x0a\x09\x09\x09\x09\x09if (MXI_DEBUG && Env.debug.runtime) {\x0a\x09\x09\x09\x09\x09\x09Env.log(\x22\x5ctselected mode: %s\x22, runtime.mode);\x09\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09// check if runtime managed to pick-up operational mode\x0a\x09\x09\x09\x09\x09if (!runtime.mode) {\x0a\x09\x09\x09\x09\x09\x09runtime.trigger(\x27Error\x27);\x0a\x09\x09\x09\x09\x09\x09return;\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09runtime.init();\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// check if a particular runtime was requested\x0a\x09\x09\x09\x09if (Basic.typeOf(options) === \x27string\x27) {\x0a\x09\x09\x09\x09\x09ruid = options;\x0a\x09\x09\x09\x09} else if (Basic.typeOf(options.ruid) === \x27string\x27) {\x0a\x09\x09\x09\x09\x09ruid = options.ruid;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if (ruid) {\x0a\x09\x09\x09\x09\x09runtime = Runtime.getRuntime(ruid);\x0a\x09\x09\x09\x09\x09if (runtime) {\x0a\x09\x09\x09\x09\x09\x09runtime.clients++;\x0a\x09\x09\x09\x09\x09\x09return runtime;\x0a\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09// there should be a runtime and there\x27s none - weird case\x0a\x09\x09\x09\x09\x09\x09throw new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// initialize a fresh one, that fits runtime list and required features best\x0a\x09\x09\x09\x09initialize((options.runtime_order || Runtime.order).split(/\x5cs*,\x5cs*/));\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Disconnects from the runtime. Decrements number of clients connected to the specified runtime.\x0a\x0a\x09\x09\x09@private\x0a\x09\x09\x09@method disconnectRuntime\x0a\x09\x09\x09*/\x0a\x09\x09\x09disconnectRuntime: function() {\x0a\x09\x09\x09\x09if (runtime && --runtime.clients \x3c= 0) {\x0a\x09\x09\x09\x09\x09runtime.destroy();\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// once the component is disconnected, it shouldn\x27t have access to the runtime\x0a\x09\x09\x09\x09runtime = null;\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Returns the runtime to which the client is currently connected.\x0a\x0a\x09\x09\x09@method getRuntime\x0a\x09\x09\x09@return {Runtime} Runtime or null if client is not connected\x0a\x09\x09\x09*/\x0a\x09\x09\x09getRuntime: function() {\x0a\x09\x09\x09\x09if (runtime && runtime.uid) {\x0a\x09\x09\x09\x09\x09return runtime;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09return runtime = null; // make sure we do not leave zombies rambling around\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Handy shortcut to safely invoke runtime extension methods.\x0a\x09\x09\x09\x0a\x09\x09\x09@private\x0a\x09\x09\x09@method exec\x0a\x09\x09\x09@return {Mixed} Whatever runtime extension method returns\x0a\x09\x09\x09*/\x0a\x09\x09\x09exec: function() {\x0a\x09\x09\x09\x09if (runtime) {\x0a\x09\x09\x09\x09\x09return runtime.exec.apply(this, arguments);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09return null;\x0a\x09\x09\x09}\x0a\x0a\x09\x09});\x0a\x09};\x0a\x0a\x0a});\x0a\x0a// Included from: src/javascript/file/FileInput.js\x0a\x0a/**\x0a * FileInput.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x27moxie/file/FileInput\x27, [\x0a\x09\x27moxie/core/utils/Basic\x27,\x0a\x09\x27moxie/core/utils/Env\x27,\x0a\x09\x27moxie/core/utils/Mime\x27,\x0a\x09\x27moxie/core/utils/Dom\x27,\x0a\x09\x27moxie/core/Exceptions\x27,\x0a\x09\x27moxie/core/EventTarget\x27,\x0a\x09\x27moxie/core/I18n\x27,\x0a\x09\x27moxie/runtime/Runtime\x27,\x0a\x09\x27moxie/runtime/RuntimeClient\x27\x0a], function(Basic, Env, Mime, Dom, x, EventTarget, I18n, Runtime, RuntimeClient) {\x0a\x09/**\x0a\x09Provides a convenient way to create cross-browser file-picker. Generates file selection dialog on click,\x0a\x09converts selected files to _File_ objects, to be used in conjunction with _Image_, preloaded in memory\x0a\x09with _FileReader_ or uploaded to a server through _XMLHttpRequest_.\x0a\x0a\x09@class FileInput\x0a\x09@constructor\x0a\x09@extends EventTarget\x0a\x09@uses RuntimeClient\x0a\x09@param {Object|String|DOMElement} options If options is string or node, argument is considered as _browse\x5c_button_.\x0a\x09\x09@param {String|DOMElement} options.browse_button DOM Element to turn into file picker.\x0a\x09\x09@param {Array} [options.accept] Array of mime types to accept. By default accepts all.\x0a\x09\x09@param {String} [options.file=\x27file\x27] Name of the file field (not the filename).\x0a\x09\x09@param {Boolean} [options.multiple=false] Enable selection of multiple files.\x0a\x09\x09@param {Boolean} [options.directory=false] Turn file input into the folder input (cannot be both at the same time).\x0a\x09\x09@param {String|DOMElement} [options.container] DOM Element to use as a container for file-picker. Defaults to parentNode \x0a\x09\x09for _browse\x5c_button_.\x0a\x09\x09@param {Object|String} [options.required_caps] Set of required capabilities, that chosen runtime must support.\x0a\x0a\x09@example\x0a\x09\x09\x3cdiv id=\x22container\x22\x3e\x0a\x09\x09\x09\x3ca id=\x22file-picker\x22 href=\x22javascript:;\x22\x3eBrowse...\x3c/a\x3e\x0a\x09\x09\x3c/div\x3e\x0a\x0a\x09\x09\x3cscript\x3e\x0a\x09\x09\x09var fileInput = new mOxie.FileInput({\x0a\x09\x09\x09\x09browse_button: \x27file-picker\x27, // or document.getElementById(\x27file-picker\x27)\x0a\x09\x09\x09\x09container: \x27container\x27,\x0a\x09\x09\x09\x09accept: [\x0a\x09\x09\x09\x09\x09{title: \x22Image files\x22, extensions: \x22jpg,gif,png\x22} // accept only images\x0a\x09\x09\x09\x09],\x0a\x09\x09\x09\x09multiple: true // allow multiple file selection\x0a\x09\x09\x09});\x0a\x0a\x09\x09\x09fileInput.onchange = function(e) {\x0a\x09\x09\x09\x09// do something to files array\x0a\x09\x09\x09\x09console.info(e.target.files); // or this.files or fileInput.files\x0a\x09\x09\x09};\x0a\x0a\x09\x09\x09fileInput.init(); // initialize\x0a\x09\x09\x3c/script\x3e\x0a\x09*/\x0a\x09var dispatches = [\x0a\x09\x09/**\x0a\x09\x09Dispatched when runtime is connected and file-picker is ready to be used.\x0a\x0a\x09\x09@event ready\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27ready\x27,\x0a\x0a\x09\x09/**\x0a\x09\x09Dispatched right after [ready](#event_ready) event, and whenever [refresh()](#method_refresh) is invoked. \x0a\x09\x09Check [corresponding documentation entry](#method_refresh) for more info.\x0a\x0a\x09\x09@event refresh\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x0a\x09\x09/**\x0a\x09\x09Dispatched when selection of files in the dialog is complete.\x0a\x0a\x09\x09@event change\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27change\x27,\x0a\x0a\x09\x09\x27cancel\x27, // TODO: might be useful\x0a\x0a\x09\x09/**\x0a\x09\x09Dispatched when mouse cursor enters file-picker area. Can be used to style element\x0a\x09\x09accordingly.\x0a\x0a\x09\x09@event mouseenter\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27mouseenter\x27,\x0a\x0a\x09\x09/**\x0a\x09\x09Dispatched when mouse cursor leaves file-picker area. Can be used to style element\x0a\x09\x09accordingly.\x0a\x0a\x09\x09@event mouseleave\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27mouseleave\x27,\x0a\x0a\x09\x09/**\x0a\x09\x09Dispatched when functional mouse button is pressed on top of file-picker area.\x0a\x0a\x09\x09@event mousedown\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27mousedown\x27,\x0a\x0a\x09\x09/**\x0a\x09\x09Dispatched when functional mouse button is released on top of file-picker area.\x0a\x0a\x09\x09@event mouseup\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27mouseup\x27\x0a\x09];\x0a\x0a\x09function FileInput(options) {\x0a\x09\x09if (MXI_DEBUG) {\x0a\x09\x09\x09Env.log(\x22Instantiating FileInput...\x22);\x09\x0a\x09\x09}\x0a\x0a\x09\x09var self = this,\x0a\x09\x09\x09container, browseButton, defaults;\x0a\x0a\x09\x09// if flat argument passed it should be browse_button id\x0a\x09\x09if (Basic.inArray(Basic.typeOf(options), [\x27string\x27, \x27node\x27]) !== -1) {\x0a\x09\x09\x09options = { browse_button : options };\x0a\x09\x09}\x0a\x0a\x09\x09// this will help us to find proper default container\x0a\x09\x09browseButton = Dom.get(options.browse_button);\x0a\x09\x09if (!browseButton) {\x0a\x09\x09\x09// browse button is required\x0a\x09\x09\x09throw new x.DOMException(x.DOMException.NOT_FOUND_ERR);\x0a\x09\x09}\x0a\x0a\x09\x09// figure out the options\x0a\x09\x09defaults = {\x0a\x09\x09\x09accept: [{\x0a\x09\x09\x09\x09title: I18n.translate(\x27All Files\x27),\x0a\x09\x09\x09\x09extensions: \x27*\x27\x0a\x09\x09\x09}],\x0a\x09\x09\x09name: \x27file\x27,\x0a\x09\x09\x09multiple: false,\x0a\x09\x09\x09required_caps: false,\x0a\x09\x09\x09container: browseButton.parentNode || document.body\x0a\x09\x09};\x0a\x09\x09\x0a\x09\x09options = Basic.extend({}, defaults, options);\x0a\x0a\x09\x09// convert to object representation\x0a\x09\x09if (typeof(options.required_caps) === \x27string\x27) {\x0a\x09\x09\x09options.required_caps = Runtime.parseCaps(options.required_caps);\x0a\x09\x09}\x0a\x09\x09\x09\x09\x09\x0a\x09\x09// normalize accept option (could be list of mime types or array of title/extensions pairs)\x0a\x09\x09if (typeof(options.accept) === \x27string\x27) {\x0a\x09\x09\x09options.accept = Mime.mimes2extList(options.accept);\x0a\x09\x09}\x0a\x0a\x09\x09container = Dom.get(options.container);\x0a\x09\x09// make sure we have container\x0a\x09\x09if (!container) {\x0a\x09\x09\x09container = document.body;\x0a\x09\x09}\x0a\x0a\x09\x09// make container relative, if it\x27s not\x0a\x09\x09if (Dom.getStyle(container, \x27position\x27) === \x27static\x27) {\x0a\x09\x09\x09container.style.position = \x27relative\x27;\x0a\x09\x09}\x0a\x0a\x09\x09container = browseButton = null; // IE\x0a\x09\x09\x09\x09\x09\x09\x0a\x09\x09RuntimeClient.call(self);\x0a\x09\x09\x0a\x09\x09Basic.extend(self, {\x0a\x09\x09\x09/**\x0a\x09\x09\x09Unique id of the component\x0a\x0a\x09\x09\x09@property uid\x0a\x09\x09\x09@protected\x0a\x09\x09\x09@readOnly\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09@default UID\x0a\x09\x09\x09*/\x0a\x09\x09\x09uid: Basic.guid(\x27uid_\x27),\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Unique id of the connected runtime, if any.\x0a\x0a\x09\x09\x09@property ruid\x0a\x09\x09\x09@protected\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09*/\x0a\x09\x09\x09ruid: null,\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Unique id of the runtime container. Useful to get hold of it for various manipulations.\x0a\x0a\x09\x09\x09@property shimid\x0a\x09\x09\x09@protected\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09*/\x0a\x09\x09\x09shimid: null,\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Array of selected mOxie.File objects\x0a\x0a\x09\x09\x09@property files\x0a\x09\x09\x09@type {Array}\x0a\x09\x09\x09@default null\x0a\x09\x09\x09*/\x0a\x09\x09\x09files: null,\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Initializes the file-picker, connects it to runtime and dispatches event ready when done.\x0a\x0a\x09\x09\x09@method init\x0a\x09\x09\x09*/\x0a\x09\x09\x09init: function() {\x0a\x09\x09\x09\x09self.bind(\x27RuntimeInit\x27, function(e, runtime) {\x0a\x09\x09\x09\x09\x09self.ruid = runtime.uid;\x0a\x09\x09\x09\x09\x09self.shimid = runtime.shimid;\x0a\x0a\x09\x09\x09\x09\x09self.bind(\x22Ready\x22, function() {\x0a\x09\x09\x09\x09\x09\x09self.trigger(\x22Refresh\x22);\x0a\x09\x09\x09\x09\x09}, 999);\x0a\x0a\x09\x09\x09\x09\x09// re-position and resize shim container\x0a\x09\x09\x09\x09\x09self.bind(\x27Refresh\x27, function() {\x0a\x09\x09\x09\x09\x09\x09var pos, size, browseButton, shimContainer;\x0a\x09\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09\x09browseButton = Dom.get(options.browse_button);\x0a\x09\x09\x09\x09\x09\x09shimContainer = Dom.get(runtime.shimid); // do not use runtime.getShimContainer(), since it will create container if it doesn\x27t exist\x0a\x0a\x09\x09\x09\x09\x09\x09if (browseButton) {\x0a\x09\x09\x09\x09\x09\x09\x09pos = Dom.getPos(browseButton, Dom.get(options.container));\x0a\x09\x09\x09\x09\x09\x09\x09size = Dom.getSize(browseButton);\x0a\x0a\x09\x09\x09\x09\x09\x09\x09if (shimContainer) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09Basic.extend(shimContainer.style, {\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09top     : pos.y + \x27px\x27,\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09left    : pos.x + \x27px\x27,\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09width   : size.w + \x27px\x27,\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09height  : size.h + \x27px\x27\x0a\x09\x09\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09shimContainer = browseButton = null;\x0a\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09runtime.exec.call(self, \x27FileInput\x27, \x27init\x27, options);\x0a\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09// runtime needs: options.required_features, options.runtime_order and options.container\x0a\x09\x09\x09\x09self.connectRuntime(Basic.extend({}, options, {\x0a\x09\x09\x09\x09\x09required_caps: {\x0a\x09\x09\x09\x09\x09\x09select_file: true\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}));\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Disables file-picker element, so that it doesn\x27t react to mouse clicks.\x0a\x0a\x09\x09\x09@method disable\x0a\x09\x09\x09@param {Boolean} [state=true] Disable component if - true, enable if - false\x0a\x09\x09\x09*/\x0a\x09\x09\x09disable: function(state) {\x0a\x09\x09\x09\x09var runtime = this.getRuntime();\x0a\x09\x09\x09\x09if (runtime) {\x0a\x09\x09\x09\x09\x09runtime.exec.call(this, \x27FileInput\x27, \x27disable\x27, Basic.typeOf(state) === \x27undefined\x27 ? true : state);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Reposition and resize dialog trigger to match the position and size of browse_button element.\x0a\x0a\x09\x09\x09@method refresh\x0a\x09\x09\x09*/\x0a\x09\x09\x09refresh: function() {\x0a\x09\x09\x09\x09self.trigger(\x22Refresh\x22);\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Destroy component.\x0a\x0a\x09\x09\x09@method destroy\x0a\x09\x09\x09*/\x0a\x09\x09\x09destroy: function() {\x0a\x09\x09\x09\x09var runtime = this.getRuntime();\x0a\x09\x09\x09\x09if (runtime) {\x0a\x09\x09\x09\x09\x09runtime.exec.call(this, \x27FileInput\x27, \x27destroy\x27);\x0a\x09\x09\x09\x09\x09this.disconnectRuntime();\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if (Basic.typeOf(this.files) === \x27array\x27) {\x0a\x09\x09\x09\x09\x09// no sense in leaving associated files behind\x0a\x09\x09\x09\x09\x09Basic.each(this.files, function(file) {\x0a\x09\x09\x09\x09\x09\x09file.destroy();\x0a\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09} \x0a\x09\x09\x09\x09this.files = null;\x0a\x0a\x09\x09\x09\x09this.unbindAll();\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09this.handleEventProps(dispatches);\x0a\x09}\x0a\x0a\x09FileInput.prototype = EventTarget.instance;\x0a\x0a\x09return FileInput;\x0a});\x0a\x0a// Included from: src/javascript/core/utils/Encode.js\x0a\x0a/**\x0a * Encode.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x27moxie/core/utils/Encode\x27, [], function() {\x0a\x0a\x09/**\x0a\x09Encode string with UTF-8\x0a\x0a\x09@method utf8_encode\x0a\x09@for Utils\x0a\x09@static\x0a\x09@param {String} str String to encode\x0a\x09@return {String} UTF-8 encoded string\x0a\x09*/\x0a\x09var utf8_encode = function(str) {\x0a\x09\x09return unescape(encodeURIComponent(str));\x0a\x09};\x0a\x09\x0a\x09/**\x0a\x09Decode UTF-8 encoded string\x0a\x0a\x09@method utf8_decode\x0a\x09@static\x0a\x09@param {String} str String to decode\x0a\x09@return {String} Decoded string\x0a\x09*/\x0a\x09var utf8_decode = function(str_data) {\x0a\x09\x09return decodeURIComponent(escape(str_data));\x0a\x09};\x0a\x09\x0a\x09/**\x0a\x09Decode Base64 encoded string (uses browser\x27s default method if available),\x0a\x09from: https://raw.github.com/kvz/phpjs/master/functions/url/base64_decode.js\x0a\x0a\x09@method atob\x0a\x09@static\x0a\x09@param {String} data String to decode\x0a\x09@return {String} Decoded string\x0a\x09*/\x0a\x09var atob = function(data, utf8) {\x0a\x09\x09if (typeof(window.atob) === \x27function\x27) {\x0a\x09\x09\x09return utf8 ? utf8_decode(window.atob(data)) : window.atob(data);\x0a\x09\x09}\x0a\x0a\x09\x09// http://kevin.vanzonneveld.net\x0a\x09\x09// +   original by: Tyler Akins (http://rumkin.com)\x0a\x09\x09// +   improved by: Thunder.m\x0a\x09\x09// +      input by: Aman Gupta\x0a\x09\x09// +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\x0a\x09\x09// +   bugfixed by: Onno Marsman\x0a\x09\x09// +   bugfixed by: Pellentesque Malesuada\x0a\x09\x09// +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\x0a\x09\x09// +      input by: Brett Zamir (http://brett-zamir.me)\x0a\x09\x09// +   bugfixed by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\x0a\x09\x09// *     example 1: base64_decode(\x27S2V2aW4gdmFuIFpvbm5ldmVsZA==\x27);\x0a\x09\x09// *     returns 1: \x27Kevin van Zonneveld\x27\x0a\x09\x09// mozilla has this native\x0a\x09\x09// - but breaks in 2.0.0.12!\x0a\x09\x09//if (typeof this.window.atob == \x27function\x27) {\x0a\x09\x09//    return atob(data);\x0a\x09\x09//}\x0a\x09\x09var b64 = \x22ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\x22;\x0a\x09\x09var o1, o2, o3, h1, h2, h3, h4, bits, i = 0,\x0a\x09\x09\x09ac = 0,\x0a\x09\x09\x09dec = \x22\x22,\x0a\x09\x09\x09tmp_arr = [];\x0a\x0a\x09\x09if (!data) {\x0a\x09\x09\x09return data;\x0a\x09\x09}\x0a\x0a\x09\x09data += \x27\x27;\x0a\x0a\x09\x09do { // unpack four hexets into three octets using index points in b64\x0a\x09\x09\x09h1 = b64.indexOf(data.charAt(i++));\x0a\x09\x09\x09h2 = b64.indexOf(data.charAt(i++));\x0a\x09\x09\x09h3 = b64.indexOf(data.charAt(i++));\x0a\x09\x09\x09h4 = b64.indexOf(data.charAt(i++));\x0a\x0a\x09\x09\x09bits = h1 \x3c\x3c 18 | h2 \x3c\x3c 12 | h3 \x3c\x3c 6 | h4;\x0a\x0a\x09\x09\x09o1 = bits \x3e\x3e 16 & 0xff;\x0a\x09\x09\x09o2 = bits \x3e\x3e 8 & 0xff;\x0a\x09\x09\x09o3 = bits & 0xff;\x0a\x0a\x09\x09\x09if (h3 == 64) {\x0a\x09\x09\x09\x09tmp_arr[ac++] = String.fromCharCode(o1);\x0a\x09\x09\x09} else if (h4 == 64) {\x0a\x09\x09\x09\x09tmp_arr[ac++] = String.fromCharCode(o1, o2);\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09tmp_arr[ac++] = String.fromCharCode(o1, o2, o3);\x0a\x09\x09\x09}\x0a\x09\x09} while (i \x3c data.length);\x0a\x0a\x09\x09dec = tmp_arr.join(\x27\x27);\x0a\x0a\x09\x09return utf8 ? utf8_decode(dec) : dec;\x0a\x09};\x0a\x09\x0a\x09/**\x0a\x09Base64 encode string (uses browser\x27s default method if available),\x0a\x09from: https://raw.github.com/kvz/phpjs/master/functions/url/base64_encode.js\x0a\x0a\x09@method btoa\x0a\x09@static\x0a\x09@param {String} data String to encode\x0a\x09@return {String} Base64 encoded string\x0a\x09*/\x0a\x09var btoa = function(data, utf8) {\x0a\x09\x09if (utf8) {\x0a\x09\x09\x09data = utf8_encode(data);\x0a\x09\x09}\x0a\x0a\x09\x09if (typeof(window.btoa) === \x27function\x27) {\x0a\x09\x09\x09return window.btoa(data);\x0a\x09\x09}\x0a\x0a\x09\x09// http://kevin.vanzonneveld.net\x0a\x09\x09// +   original by: Tyler Akins (http://rumkin.com)\x0a\x09\x09// +   improved by: Bayron Guevara\x0a\x09\x09// +   improved by: Thunder.m\x0a\x09\x09// +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\x0a\x09\x09// +   bugfixed by: Pellentesque Malesuada\x0a\x09\x09// +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\x0a\x09\x09// +   improved by: Rafa\xc5\x82 Kukawski (http://kukawski.pl)\x0a\x09\x09// *     example 1: base64_encode(\x27Kevin van Zonneveld\x27);\x0a\x09\x09// *     returns 1: \x27S2V2aW4gdmFuIFpvbm5ldmVsZA==\x27\x0a\x09\x09// mozilla has this native\x0a\x09\x09// - but breaks in 2.0.0.12!\x0a\x09\x09var b64 = \x22ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\x22;\x0a\x09\x09var o1, o2, o3, h1, h2, h3, h4, bits, i = 0,\x0a\x09\x09\x09ac = 0,\x0a\x09\x09\x09enc = \x22\x22,\x0a\x09\x09\x09tmp_arr = [];\x0a\x0a\x09\x09if (!data) {\x0a\x09\x09\x09return data;\x0a\x09\x09}\x0a\x0a\x09\x09do { // pack three octets into four hexets\x0a\x09\x09\x09o1 = data.charCodeAt(i++);\x0a\x09\x09\x09o2 = data.charCodeAt(i++);\x0a\x09\x09\x09o3 = data.charCodeAt(i++);\x0a\x0a\x09\x09\x09bits = o1 \x3c\x3c 16 | o2 \x3c\x3c 8 | o3;\x0a\x0a\x09\x09\x09h1 = bits \x3e\x3e 18 & 0x3f;\x0a\x09\x09\x09h2 = bits \x3e\x3e 12 & 0x3f;\x0a\x09\x09\x09h3 = bits \x3e\x3e 6 & 0x3f;\x0a\x09\x09\x09h4 = bits & 0x3f;\x0a\x0a\x09\x09\x09// use hexets to index into b64, and append result to encoded string\x0a\x09\x09\x09tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\x0a\x09\x09} while (i \x3c data.length);\x0a\x0a\x09\x09enc = tmp_arr.join(\x27\x27);\x0a\x0a\x09\x09var r = data.length % 3;\x0a\x0a\x09\x09return (r ? enc.slice(0, r - 3) : enc) + \x27===\x27.slice(r || 3);\x0a\x09};\x0a\x0a\x0a\x09return {\x0a\x09\x09utf8_encode: utf8_encode,\x0a\x09\x09utf8_decode: utf8_decode,\x0a\x09\x09atob: atob,\x0a\x09\x09btoa: btoa\x0a\x09};\x0a});\x0a\x0a// Included from: src/javascript/file/Blob.js\x0a\x0a/**\x0a * Blob.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x27moxie/file/Blob\x27, [\x0a\x09\x27moxie/core/utils/Basic\x27,\x0a\x09\x27moxie/core/utils/Encode\x27,\x0a\x09\x27moxie/runtime/RuntimeClient\x27\x0a], function(Basic, Encode, RuntimeClient) {\x0a\x09\x0a\x09var blobpool = {};\x0a\x0a\x09/**\x0a\x09@class Blob\x0a\x09@constructor\x0a\x09@param {String} ruid Unique id of the runtime, to which this blob belongs to\x0a\x09@param {Object} blob Object \x22Native\x22 blob object, as it is represented in the runtime\x0a\x09*/\x0a\x09function Blob(ruid, blob) {\x0a\x0a\x09\x09function _sliceDetached(start, end, type) {\x0a\x09\x09\x09var blob, data = blobpool[this.uid];\x0a\x0a\x09\x09\x09if (Basic.typeOf(data) !== \x27string\x27 || !data.length) {\x0a\x09\x09\x09\x09return null; // or throw exception\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09blob = new Blob(null, {\x0a\x09\x09\x09\x09type: type,\x0a\x09\x09\x09\x09size: end - start\x0a\x09\x09\x09});\x0a\x09\x09\x09blob.detach(data.substr(start, blob.size));\x0a\x0a\x09\x09\x09return blob;\x0a\x09\x09}\x0a\x0a\x09\x09RuntimeClient.call(this);\x0a\x0a\x09\x09if (ruid) {\x09\x0a\x09\x09\x09this.connectRuntime(ruid);\x0a\x09\x09}\x0a\x0a\x09\x09if (!blob) {\x0a\x09\x09\x09blob = {};\x0a\x09\x09} else if (Basic.typeOf(blob) === \x27string\x27) { // dataUrl or binary string\x0a\x09\x09\x09blob = { data: blob };\x0a\x09\x09}\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Unique id of the component\x0a\x0a\x09\x09\x09@property uid\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09*/\x0a\x09\x09\x09uid: blob.uid || Basic.guid(\x27uid_\x27),\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Unique id of the connected runtime, if falsy, then runtime will have to be initialized \x0a\x09\x09\x09before this Blob can be used, modified or sent\x0a\x0a\x09\x09\x09@property ruid\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09*/\x0a\x09\x09\x09ruid: ruid,\x0a\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Size of blob\x0a\x0a\x09\x09\x09@property size\x0a\x09\x09\x09@type {Number}\x0a\x09\x09\x09@default 0\x0a\x09\x09\x09*/\x0a\x09\x09\x09size: blob.size || 0,\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Mime type of blob\x0a\x0a\x09\x09\x09@property type\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09@default \x27\x27\x0a\x09\x09\x09*/\x0a\x09\x09\x09type: blob.type || \x27\x27,\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09@method slice\x0a\x09\x09\x09@param {Number} [start=0]\x0a\x09\x09\x09*/\x0a\x09\x09\x09slice: function(start, end, type) {\x09\x09\x0a\x09\x09\x09\x09if (this.isDetached()) {\x0a\x09\x09\x09\x09\x09return _sliceDetached.apply(this, arguments);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09return this.getRuntime().exec.call(this, \x27Blob\x27, \x27slice\x27, this.getSource(), start, end, type);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Returns \x22native\x22 blob object (as it is represented in connected runtime) or null if not found\x0a\x0a\x09\x09\x09@method getSource\x0a\x09\x09\x09@return {Blob} Returns \x22native\x22 blob object or null if not found\x0a\x09\x09\x09*/\x0a\x09\x09\x09getSource: function() {\x0a\x09\x09\x09\x09if (!blobpool[this.uid]) {\x0a\x09\x09\x09\x09\x09return null;\x09\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09return blobpool[this.uid];\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/** \x0a\x09\x09\x09Detaches blob from any runtime that it depends on and initialize with standalone value\x0a\x0a\x09\x09\x09@method detach\x0a\x09\x09\x09@protected\x0a\x09\x09\x09@param {DOMString} [data=\x27\x27] Standalone value\x0a\x09\x09\x09*/\x0a\x09\x09\x09detach: function(data) {\x0a\x09\x09\x09\x09if (this.ruid) {\x0a\x09\x09\x09\x09\x09this.getRuntime().exec.call(this, \x27Blob\x27, \x27destroy\x27);\x0a\x09\x09\x09\x09\x09this.disconnectRuntime();\x0a\x09\x09\x09\x09\x09this.ruid = null;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09data = data || \x27\x27;\x0a\x0a\x09\x09\x09\x09// if dataUrl, convert to binary string\x0a\x09\x09\x09\x09if (data.substr(0, 5) == \x27data:\x27) {\x0a\x09\x09\x09\x09\x09var base64Offset = data.indexOf(\x27;base64,\x27);\x0a\x09\x09\x09\x09\x09this.type = data.substring(5, base64Offset);\x0a\x09\x09\x09\x09\x09data = Encode.atob(data.substring(base64Offset + 8));\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09this.size = data.length;\x0a\x0a\x09\x09\x09\x09blobpool[this.uid] = data;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Checks if blob is standalone (detached of any runtime)\x0a\x09\x09\x09\x0a\x09\x09\x09@method isDetached\x0a\x09\x09\x09@protected\x0a\x09\x09\x09@return {Boolean}\x0a\x09\x09\x09*/\x0a\x09\x09\x09isDetached: function() {\x0a\x09\x09\x09\x09return !this.ruid && Basic.typeOf(blobpool[this.uid]) === \x27string\x27;\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09/** \x0a\x09\x09\x09Destroy Blob and free any resources it was using\x0a\x0a\x09\x09\x09@method destroy\x0a\x09\x09\x09*/\x0a\x09\x09\x09destroy: function() {\x0a\x09\x09\x09\x09this.detach();\x0a\x09\x09\x09\x09delete blobpool[this.uid];\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09\x0a\x09\x09if (blob.data) {\x0a\x09\x09\x09this.detach(blob.data); // auto-detach if payload has been passed\x0a\x09\x09} else {\x0a\x09\x09\x09blobpool[this.uid] = blob;\x09\x0a\x09\x09}\x0a\x09}\x0a\x09\x0a\x09return Blob;\x0a});\x0a\x0a// Included from: src/javascript/file/File.js\x0a\x0a/**\x0a * File.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x27moxie/file/File\x27, [\x0a\x09\x27moxie/core/utils/Basic\x27,\x0a\x09\x27moxie/core/utils/Mime\x27,\x0a\x09\x27moxie/file/Blob\x27\x0a], function(Basic, Mime, Blob) {\x0a\x09/**\x0a\x09@class File\x0a\x09@extends Blob\x0a\x09@constructor\x0a\x09@param {String} ruid Unique id of the runtime, to which this blob belongs to\x0a\x09@param {Object} file Object \x22Native\x22 file object, as it is represented in the runtime\x0a\x09*/\x0a\x09function File(ruid, file) {\x0a\x09\x09if (!file) { // avoid extra errors in case we overlooked something\x0a\x09\x09\x09file = {};\x0a\x09\x09}\x0a\x0a\x09\x09Blob.apply(this, arguments);\x0a\x0a\x09\x09if (!this.type) {\x0a\x09\x09\x09this.type = Mime.getFileMime(file.name);\x0a\x09\x09}\x0a\x0a\x09\x09// sanitize file name or generate new one\x0a\x09\x09var name;\x0a\x09\x09if (file.name) {\x0a\x09\x09\x09name = file.name.replace(/\x5c\x5c/g, \x27/\x27);\x0a\x09\x09\x09name = name.substr(name.lastIndexOf(\x27/\x27) + 1);\x0a\x09\x09} else if (this.type) {\x0a\x09\x09\x09var prefix = this.type.split(\x27/\x27)[0];\x0a\x09\x09\x09name = Basic.guid((prefix !== \x27\x27 ? prefix : \x27file\x27) + \x27_\x27);\x0a\x09\x09\x09\x0a\x09\x09\x09if (Mime.extensions[this.type]) {\x0a\x09\x09\x09\x09name += \x27.\x27 + Mime.extensions[this.type][0]; // append proper extension if possible\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x09\x09\x0a\x09\x09\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09/**\x0a\x09\x09\x09File name\x0a\x0a\x09\x09\x09@property name\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09@default UID\x0a\x09\x09\x09*/\x0a\x09\x09\x09name: name || Basic.guid(\x27file_\x27),\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Relative path to the file inside a directory\x0a\x0a\x09\x09\x09@property relativePath\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09@default \x27\x27\x0a\x09\x09\x09*/\x0a\x09\x09\x09relativePath: \x27\x27,\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Date of last modification\x0a\x0a\x09\x09\x09@property lastModifiedDate\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09@default now\x0a\x09\x09\x09*/\x0a\x09\x09\x09lastModifiedDate: file.lastModifiedDate || (new Date()).toLocaleString() // Thu Aug 23 2012 19:40:00 GMT+0400 (GET)\x0a\x09\x09});\x0a\x09}\x0a\x0a\x09File.prototype = Blob.prototype;\x0a\x0a\x09return File;\x0a});\x0a\x0a// Included from: src/javascript/file/FileDrop.js\x0a\x0a/**\x0a * FileDrop.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x27moxie/file/FileDrop\x27, [\x0a\x09\x27moxie/core/I18n\x27,\x0a\x09\x27moxie/core/utils/Dom\x27,\x0a\x09\x27moxie/core/Exceptions\x27,\x0a\x09\x27moxie/core/utils/Basic\x27,\x0a\x09\x27moxie/core/utils/Env\x27,\x0a\x09\x27moxie/file/File\x27,\x0a\x09\x27moxie/runtime/RuntimeClient\x27,\x0a\x09\x27moxie/core/EventTarget\x27,\x0a\x09\x27moxie/core/utils/Mime\x27\x0a], function(I18n, Dom, x, Basic, Env, File, RuntimeClient, EventTarget, Mime) {\x0a\x09/**\x0a\x09Turn arbitrary DOM element to a drop zone accepting files. Converts selected files to _File_ objects, to be used \x0a\x09in conjunction with _Image_, preloaded in memory with _FileReader_ or uploaded to a server through \x0a\x09_XMLHttpRequest_.\x0a\x0a\x09@example\x0a\x09\x09\x3cdiv id=\x22drop_zone\x22\x3e\x0a\x09\x09\x09Drop files here\x0a\x09\x09\x3c/div\x3e\x0a\x09\x09\x3cbr /\x3e\x0a\x09\x09\x3cdiv id=\x22filelist\x22\x3e\x3c/div\x3e\x0a\x0a\x09\x09\x3cscript type=\x22text/javascript\x22\x3e\x0a\x09\x09\x09var fileDrop = new mOxie.FileDrop(\x27drop_zone\x27), fileList = mOxie.get(\x27filelist\x27);\x0a\x0a\x09\x09\x09fileDrop.ondrop = function() {\x0a\x09\x09\x09\x09mOxie.each(this.files, function(file) {\x0a\x09\x09\x09\x09\x09fileList.innerHTML += \x27\x3cdiv\x3e\x27 + file.name + \x27\x3c/div\x3e\x27;\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09};\x0a\x0a\x09\x09\x09fileDrop.init();\x0a\x09\x09\x3c/script\x3e\x0a\x0a\x09@class FileDrop\x0a\x09@constructor\x0a\x09@extends EventTarget\x0a\x09@uses RuntimeClient\x0a\x09@param {Object|String} options If options has typeof string, argument is considered as options.drop_zone\x0a\x09\x09@param {String|DOMElement} options.drop_zone DOM Element to turn into a drop zone\x0a\x09\x09@param {Array} [options.accept] Array of mime types to accept. By default accepts all\x0a\x09\x09@param {Object|String} [options.required_caps] Set of required capabilities, that chosen runtime must support\x0a\x09*/\x0a\x09var dispatches = [\x0a\x09\x09/**\x0a\x09\x09Dispatched when runtime is connected and drop zone is ready to accept files.\x0a\x0a\x09\x09@event ready\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27ready\x27, \x0a\x0a\x09\x09/**\x0a\x09\x09Dispatched when dragging cursor enters the drop zone.\x0a\x0a\x09\x09@event dragenter\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27dragenter\x27,\x0a\x0a\x09\x09/**\x0a\x09\x09Dispatched when dragging cursor leaves the drop zone.\x0a\x0a\x09\x09@event dragleave\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27dragleave\x27, \x0a\x0a\x09\x09/**\x0a\x09\x09Dispatched when file is dropped onto the drop zone.\x0a\x0a\x09\x09@event drop\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27drop\x27, \x0a\x0a\x09\x09/**\x0a\x09\x09Dispatched if error occurs.\x0a\x0a\x09\x09@event error\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27error\x27\x0a\x09];\x0a\x0a\x09function FileDrop(options) {\x0a\x09\x09if (MXI_DEBUG) {\x0a\x09\x09\x09Env.log(\x22Instantiating FileDrop...\x22);\x09\x0a\x09\x09}\x0a\x0a\x09\x09var self = this, defaults;\x0a\x0a\x09\x09// if flat argument passed it should be drop_zone id\x0a\x09\x09if (typeof(options) === \x27string\x27) {\x0a\x09\x09\x09options = { drop_zone : options };\x0a\x09\x09}\x0a\x0a\x09\x09// figure out the options\x0a\x09\x09defaults = {\x0a\x09\x09\x09accept: [{\x0a\x09\x09\x09\x09title: I18n.translate(\x27All Files\x27),\x0a\x09\x09\x09\x09extensions: \x27*\x27\x0a\x09\x09\x09}],\x0a\x09\x09\x09required_caps: {\x0a\x09\x09\x09\x09drag_and_drop: true\x0a\x09\x09\x09}\x0a\x09\x09};\x0a\x09\x09\x0a\x09\x09options = typeof(options) === \x27object\x27 ? Basic.extend({}, defaults, options) : defaults;\x0a\x0a\x09\x09// this will help us to find proper default container\x0a\x09\x09options.container = Dom.get(options.drop_zone) || document.body;\x0a\x0a\x09\x09// make container relative, if it is not\x0a\x09\x09if (Dom.getStyle(options.container, \x27position\x27) === \x27static\x27) {\x0a\x09\x09\x09options.container.style.position = \x27relative\x27;\x0a\x09\x09}\x0a\x09\x09\x09\x09\x09\x0a\x09\x09// normalize accept option (could be list of mime types or array of title/extensions pairs)\x0a\x09\x09if (typeof(options.accept) === \x27string\x27) {\x0a\x09\x09\x09options.accept = Mime.mimes2extList(options.accept);\x0a\x09\x09}\x0a\x0a\x09\x09RuntimeClient.call(self);\x0a\x0a\x09\x09Basic.extend(self, {\x0a\x09\x09\x09uid: Basic.guid(\x27uid_\x27),\x0a\x0a\x09\x09\x09ruid: null,\x0a\x0a\x09\x09\x09files: null,\x0a\x0a\x09\x09\x09init: function() {\x09\x09\x0a\x09\x09\x09\x09self.bind(\x27RuntimeInit\x27, function(e, runtime) {\x0a\x09\x09\x09\x09\x09self.ruid = runtime.uid;\x0a\x09\x09\x09\x09\x09runtime.exec.call(self, \x27FileDrop\x27, \x27init\x27, options);\x0a\x09\x09\x09\x09\x09self.dispatchEvent(\x27ready\x27);\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09// runtime needs: options.required_features, options.runtime_order and options.container\x0a\x09\x09\x09\x09self.connectRuntime(options); // throws RuntimeError\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09destroy: function() {\x0a\x09\x09\x09\x09var runtime = this.getRuntime();\x0a\x09\x09\x09\x09if (runtime) {\x0a\x09\x09\x09\x09\x09runtime.exec.call(this, \x27FileDrop\x27, \x27destroy\x27);\x0a\x09\x09\x09\x09\x09this.disconnectRuntime();\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09this.files = null;\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09this.unbindAll();\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09this.handleEventProps(dispatches);\x0a\x09}\x0a\x0a\x09FileDrop.prototype = EventTarget.instance;\x0a\x0a\x09return FileDrop;\x0a});\x0a\x0a// Included from: src/javascript/file/FileReader.js\x0a\x0a/**\x0a * FileReader.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x27moxie/file/FileReader\x27, [\x0a\x09\x27moxie/core/utils/Basic\x27,\x0a\x09\x27moxie/core/utils/Encode\x27,\x0a\x09\x27moxie/core/Exceptions\x27,\x0a\x09\x27moxie/core/EventTarget\x27,\x0a\x09\x27moxie/file/Blob\x27,\x0a\x09\x27moxie/runtime/RuntimeClient\x27\x0a], function(Basic, Encode, x, EventTarget, Blob, RuntimeClient) {\x0a\x09/**\x0a\x09Utility for preloading o.Blob/o.File objects in memory. By design closely follows [W3C FileReader](http://www.w3.org/TR/FileAPI/#dfn-filereader)\x0a\x09interface. Where possible uses native FileReader, where - not falls back to shims.\x0a\x0a\x09@class FileReader\x0a\x09@constructor FileReader\x0a\x09@extends EventTarget\x0a\x09@uses RuntimeClient\x0a\x09*/\x0a\x09var dispatches = [\x0a\x0a\x09\x09/** \x0a\x09\x09Dispatched when the read starts.\x0a\x0a\x09\x09@event loadstart\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27loadstart\x27, \x0a\x0a\x09\x09/** \x0a\x09\x09Dispatched while reading (and decoding) blob, and reporting partial Blob data (progess.loaded/progress.total).\x0a\x0a\x09\x09@event progress\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27progress\x27, \x0a\x0a\x09\x09/** \x0a\x09\x09Dispatched when the read has successfully completed.\x0a\x0a\x09\x09@event load\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27load\x27, \x0a\x0a\x09\x09/** \x0a\x09\x09Dispatched when the read has been aborted. For instance, by invoking the abort() method.\x0a\x0a\x09\x09@event abort\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27abort\x27, \x0a\x0a\x09\x09/** \x0a\x09\x09Dispatched when the read has failed.\x0a\x0a\x09\x09@event error\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27error\x27, \x0a\x0a\x09\x09/** \x0a\x09\x09Dispatched when the request has completed (either in success or failure).\x0a\x0a\x09\x09@event loadend\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27loadend\x27\x0a\x09];\x0a\x09\x0a\x09function FileReader() {\x0a\x0a\x09\x09RuntimeClient.call(this);\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09/**\x0a\x09\x09\x09UID of the component instance.\x0a\x0a\x09\x09\x09@property uid\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09*/\x0a\x09\x09\x09uid: Basic.guid(\x27uid_\x27),\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Contains current state of FileReader object. Can take values of FileReader.EMPTY, FileReader.LOADING\x0a\x09\x09\x09and FileReader.DONE.\x0a\x0a\x09\x09\x09@property readyState\x0a\x09\x09\x09@type {Number}\x0a\x09\x09\x09@default FileReader.EMPTY\x0a\x09\x09\x09*/\x0a\x09\x09\x09readyState: FileReader.EMPTY,\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Result of the successful read operation.\x0a\x0a\x09\x09\x09@property result\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09*/\x0a\x09\x09\x09result: null,\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Stores the error of failed asynchronous read operation.\x0a\x0a\x09\x09\x09@property error\x0a\x09\x09\x09@type {DOMError}\x0a\x09\x09\x09*/\x0a\x09\x09\x09error: null,\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Initiates reading of File/Blob object contents to binary string.\x0a\x0a\x09\x09\x09@method readAsBinaryString\x0a\x09\x09\x09@param {Blob|File} blob Object to preload\x0a\x09\x09\x09*/\x0a\x09\x09\x09readAsBinaryString: function(blob) {\x0a\x09\x09\x09\x09_read.call(this, \x27readAsBinaryString\x27, blob);\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Initiates reading of File/Blob object contents to dataURL string.\x0a\x0a\x09\x09\x09@method readAsDataURL\x0a\x09\x09\x09@param {Blob|File} blob Object to preload\x0a\x09\x09\x09*/\x0a\x09\x09\x09readAsDataURL: function(blob) {\x0a\x09\x09\x09\x09_read.call(this, \x27readAsDataURL\x27, blob);\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Initiates reading of File/Blob object contents to string.\x0a\x0a\x09\x09\x09@method readAsText\x0a\x09\x09\x09@param {Blob|File} blob Object to preload\x0a\x09\x09\x09*/\x0a\x09\x09\x09readAsText: function(blob) {\x0a\x09\x09\x09\x09_read.call(this, \x27readAsText\x27, blob);\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Aborts preloading process.\x0a\x0a\x09\x09\x09@method abort\x0a\x09\x09\x09*/\x0a\x09\x09\x09abort: function() {\x0a\x09\x09\x09\x09this.result = null;\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09if (Basic.inArray(this.readyState, [FileReader.EMPTY, FileReader.DONE]) !== -1) {\x0a\x09\x09\x09\x09\x09return;\x0a\x09\x09\x09\x09} else if (this.readyState === FileReader.LOADING) {\x0a\x09\x09\x09\x09\x09this.readyState = FileReader.DONE;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09this.exec(\x27FileReader\x27, \x27abort\x27);\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09this.trigger(\x27abort\x27);\x0a\x09\x09\x09\x09this.trigger(\x27loadend\x27);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Destroy component and release resources.\x0a\x0a\x09\x09\x09@method destroy\x0a\x09\x09\x09*/\x0a\x09\x09\x09destroy: function() {\x0a\x09\x09\x09\x09this.abort();\x0a\x09\x09\x09\x09this.exec(\x27FileReader\x27, \x27destroy\x27);\x0a\x09\x09\x09\x09this.disconnectRuntime();\x0a\x09\x09\x09\x09this.unbindAll();\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09// uid must already be assigned\x0a\x09\x09this.handleEventProps(dispatches);\x0a\x0a\x09\x09this.bind(\x27Error\x27, function(e, err) {\x0a\x09\x09\x09this.readyState = FileReader.DONE;\x0a\x09\x09\x09this.error = err;\x0a\x09\x09}, 999);\x0a\x09\x09\x0a\x09\x09this.bind(\x27Load\x27, function(e) {\x0a\x09\x09\x09this.readyState = FileReader.DONE;\x0a\x09\x09}, 999);\x0a\x0a\x09\x09\x0a\x09\x09function _read(op, blob) {\x0a\x09\x09\x09var self = this;\x09\x09\x09\x0a\x0a\x09\x09\x09this.trigger(\x27loadstart\x27);\x0a\x0a\x09\x09\x09if (this.readyState === FileReader.LOADING) {\x0a\x09\x09\x09\x09this.trigger(\x27error\x27, new x.DOMException(x.DOMException.INVALID_STATE_ERR));\x0a\x09\x09\x09\x09this.trigger(\x27loadend\x27);\x0a\x09\x09\x09\x09return;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09// if source is not o.Blob/o.File\x0a\x09\x09\x09if (!(blob instanceof Blob)) {\x0a\x09\x09\x09\x09this.trigger(\x27error\x27, new x.DOMException(x.DOMException.NOT_FOUND_ERR));\x0a\x09\x09\x09\x09this.trigger(\x27loadend\x27);\x0a\x09\x09\x09\x09return;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09this.result = null;\x0a\x09\x09\x09this.readyState = FileReader.LOADING;\x0a\x09\x09\x09\x0a\x09\x09\x09if (blob.isDetached()) {\x0a\x09\x09\x09\x09var src = blob.getSource();\x0a\x09\x09\x09\x09switch (op) {\x0a\x09\x09\x09\x09\x09case \x27readAsText\x27:\x0a\x09\x09\x09\x09\x09case \x27readAsBinaryString\x27:\x0a\x09\x09\x09\x09\x09\x09this.result = src;\x0a\x09\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09\x09case \x27readAsDataURL\x27:\x0a\x09\x09\x09\x09\x09\x09this.result = \x27data:\x27 + blob.type + \x27;base64,\x27 + Encode.btoa(src);\x0a\x09\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09this.readyState = FileReader.DONE;\x0a\x09\x09\x09\x09this.trigger(\x27load\x27);\x0a\x09\x09\x09\x09this.trigger(\x27loadend\x27);\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09this.connectRuntime(blob.ruid);\x0a\x09\x09\x09\x09this.exec(\x27FileReader\x27, \x27read\x27, op, blob);\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x09}\x0a\x09\x0a\x09/**\x0a\x09Initial FileReader state\x0a\x0a\x09@property EMPTY\x0a\x09@type {Number}\x0a\x09@final\x0a\x09@static\x0a\x09@default 0\x0a\x09*/\x0a\x09FileReader.EMPTY = 0;\x0a\x0a\x09/**\x0a\x09FileReader switches to this state when it is preloading the source\x0a\x0a\x09@property LOADING\x0a\x09@type {Number}\x0a\x09@final\x0a\x09@static\x0a\x09@default 1\x0a\x09*/\x0a\x09FileReader.LOADING = 1;\x0a\x0a\x09/**\x0a\x09Preloading is complete, this is a final state\x0a\x0a\x09@property DONE\x0a\x09@type {Number}\x0a\x09@final\x0a\x09@static\x0a\x09@default 2\x0a\x09*/\x0a\x09FileReader.DONE = 2;\x0a\x0a\x09FileReader.prototype = EventTarget.instance;\x0a\x0a\x09return FileReader;\x0a});\x0a\x0a// Included from: src/javascript/core/utils/Url.js\x0a\x0a/**\x0a * Url.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x27moxie/core/utils/Url\x27, [], function() {\x0a\x09/**\x0a\x09Parse url into separate components and fill in absent parts with parts from current url,\x0a\x09based on https://raw.github.com/kvz/phpjs/master/functions/url/parse_url.js\x0a\x0a\x09@method parseUrl\x0a\x09@for Utils\x0a\x09@static\x0a\x09@param {String} url Url to parse (defaults to empty string if undefined)\x0a\x09@return {Object} Hash containing extracted uri components\x0a\x09*/\x0a\x09var parseUrl = function(url, currentUrl) {\x0a\x09\x09var key = [\x27source\x27, \x27scheme\x27, \x27authority\x27, \x27userInfo\x27, \x27user\x27, \x27pass\x27, \x27host\x27, \x27port\x27, \x27relative\x27, \x27path\x27, \x27directory\x27, \x27file\x27, \x27query\x27, \x27fragment\x27]\x0a\x09\x09, i = key.length\x0a\x09\x09, ports = {\x0a\x09\x09\x09http: 80,\x0a\x09\x09\x09https: 443\x0a\x09\x09}\x0a\x09\x09, uri = {}\x0a\x09\x09, regex = /^(?:([^:\x5c/?#]+):)?(?:\x5c/\x5c/()(?:(?:()(?:([^:@\x5c/]*):?([^:@\x5c/]*))?@)?([^:\x5c/?#]*)(?::(\x5cd*))?))?()(?:(()(?:(?:[^?#\x5c/]*\x5c/)*)()(?:[^?#]*))(?:\x5c\x5c?([^#]*))?(?:#(.*))?)/\x0a\x09\x09, m = regex.exec(url || \x27\x27)\x0a\x09\x09;\x0a\x09\x09\x09\x09\x09\x0a\x09\x09while (i--) {\x0a\x09\x09\x09if (m[i]) {\x0a\x09\x09\x09\x09uri[key[i]] = m[i];\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x0a\x09\x09// when url is relative, we set the origin and the path ourselves\x0a\x09\x09if (!uri.scheme) {\x0a\x09\x09\x09// come up with defaults\x0a\x09\x09\x09if (!currentUrl || typeof(currentUrl) === \x27string\x27) {\x0a\x09\x09\x09\x09currentUrl = parseUrl(currentUrl || document.location.href);\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09uri.scheme = currentUrl.scheme;\x0a\x09\x09\x09uri.host = currentUrl.host;\x0a\x09\x09\x09uri.port = currentUrl.port;\x0a\x0a\x09\x09\x09var path = \x27\x27;\x0a\x09\x09\x09// for urls without trailing slash we need to figure out the path\x0a\x09\x09\x09if (/^[^\x5c/]/.test(uri.path)) {\x0a\x09\x09\x09\x09path = currentUrl.path;\x0a\x09\x09\x09\x09// if path ends with a filename, strip it\x0a\x09\x09\x09\x09if (/\x5c/[^\x5c/]*\x5c.[^\x5c/]*$/.test(path)) {\x0a\x09\x09\x09\x09\x09path = path.replace(/\x5c/[^\x5c/]+$/, \x27/\x27);\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09// avoid double slash at the end (see #127)\x0a\x09\x09\x09\x09\x09path = path.replace(/\x5c/?$/, \x27/\x27);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x09\x09\x09uri.path = path + (uri.path || \x27\x27); // site may reside at domain.com or domain.com/subdir\x0a\x09\x09}\x0a\x0a\x09\x09if (!uri.port) {\x0a\x09\x09\x09uri.port = ports[uri.scheme] || 80;\x0a\x09\x09} \x0a\x09\x09\x0a\x09\x09uri.port = parseInt(uri.port, 10);\x0a\x0a\x09\x09if (!uri.path) {\x0a\x09\x09\x09uri.path = \x22/\x22;\x0a\x09\x09}\x0a\x0a\x09\x09delete uri.source;\x0a\x0a\x09\x09return uri;\x0a\x09};\x0a\x0a\x09/**\x0a\x09Resolve url - among other things will turn relative url to absolute\x0a\x0a\x09@method resolveUrl\x0a\x09@static\x0a\x09@param {String|Object} url Either absolute or relative, or a result of parseUrl call\x0a\x09@return {String} Resolved, absolute url\x0a\x09*/\x0a\x09var resolveUrl = function(url) {\x0a\x09\x09var ports = { // we ignore default ports\x0a\x09\x09\x09http: 80,\x0a\x09\x09\x09https: 443\x0a\x09\x09}\x0a\x09\x09, urlp = typeof(url) === \x27object\x27 ? url : parseUrl(url);\x0a\x09\x09;\x0a\x0a\x09\x09return urlp.scheme + \x27://\x27 + urlp.host + (urlp.port !== ports[urlp.scheme] ? \x27:\x27 + urlp.port : \x27\x27) + urlp.path + (urlp.query ? urlp.query : \x27\x27);\x0a\x09};\x0a\x0a\x09/**\x0a\x09Check if specified url has the same origin as the current document\x0a\x0a\x09@method hasSameOrigin\x0a\x09@param {String|Object} url\x0a\x09@return {Boolean}\x0a\x09*/\x0a\x09var hasSameOrigin = function(url) {\x0a\x09\x09function origin(url) {\x0a\x09\x09\x09return [url.scheme, url.host, url.port].join(\x27/\x27);\x0a\x09\x09}\x0a\x09\x09\x09\x0a\x09\x09if (typeof url === \x27string\x27) {\x0a\x09\x09\x09url = parseUrl(url);\x0a\x09\x09}\x09\x0a\x09\x09\x0a\x09\x09return origin(parseUrl()) === origin(url);\x0a\x09};\x0a\x0a\x09return {\x0a\x09\x09parseUrl: parseUrl,\x0a\x09\x09resolveUrl: resolveUrl,\x0a\x09\x09hasSameOrigin: hasSameOrigin\x0a\x09};\x0a});\x0a\x0a// Included from: src/javascript/runtime/RuntimeTarget.js\x0a\x0a/**\x0a * RuntimeTarget.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x27moxie/runtime/RuntimeTarget\x27, [\x0a\x09\x27moxie/core/utils/Basic\x27,\x0a\x09\x27moxie/runtime/RuntimeClient\x27,\x0a\x09\x22moxie/core/EventTarget\x22\x0a], function(Basic, RuntimeClient, EventTarget) {\x0a\x09/**\x0a\x09Instance of this class can be used as a target for the events dispatched by shims,\x0a\x09when allowing them onto components is for either reason inappropriate\x0a\x0a\x09@class RuntimeTarget\x0a\x09@constructor\x0a\x09@protected\x0a\x09@extends EventTarget\x0a\x09*/\x0a\x09function RuntimeTarget() {\x0a\x09\x09this.uid = Basic.guid(\x27uid_\x27);\x0a\x09\x09\x0a\x09\x09RuntimeClient.call(this);\x0a\x0a\x09\x09this.destroy = function() {\x0a\x09\x09\x09this.disconnectRuntime();\x0a\x09\x09\x09this.unbindAll();\x0a\x09\x09};\x0a\x09}\x0a\x0a\x09RuntimeTarget.prototype = EventTarget.instance;\x0a\x0a\x09return RuntimeTarget;\x0a});\x0a\x0a// Included from: src/javascript/file/FileReaderSync.js\x0a\x0a/**\x0a * FileReaderSync.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x27moxie/file/FileReaderSync\x27, [\x0a\x09\x27moxie/core/utils/Basic\x27,\x0a\x09\x27moxie/runtime/RuntimeClient\x27,\x0a\x09\x27moxie/core/utils/Encode\x27\x0a], function(Basic, RuntimeClient, Encode) {\x0a\x09/**\x0a\x09Synchronous FileReader implementation. Something like this is available in WebWorkers environment, here\x0a\x09it can be used to read only preloaded blobs/files and only below certain size (not yet sure what that\x27d be,\x0a\x09but probably \x3c 1mb). Not meant to be used directly by user.\x0a\x0a\x09@class FileReaderSync\x0a\x09@private\x0a\x09@constructor\x0a\x09*/\x0a\x09return function() {\x0a\x09\x09RuntimeClient.call(this);\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09uid: Basic.guid(\x27uid_\x27),\x0a\x0a\x09\x09\x09readAsBinaryString: function(blob) {\x0a\x09\x09\x09\x09return _read.call(this, \x27readAsBinaryString\x27, blob);\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09readAsDataURL: function(blob) {\x0a\x09\x09\x09\x09return _read.call(this, \x27readAsDataURL\x27, blob);\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09/*readAsArrayBuffer: function(blob) {\x0a\x09\x09\x09\x09return _read.call(this, \x27readAsArrayBuffer\x27, blob);\x0a\x09\x09\x09},*/\x0a\x09\x09\x09\x0a\x09\x09\x09readAsText: function(blob) {\x0a\x09\x09\x09\x09return _read.call(this, \x27readAsText\x27, blob);\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09function _read(op, blob) {\x0a\x09\x09\x09if (blob.isDetached()) {\x0a\x09\x09\x09\x09var src = blob.getSource();\x0a\x09\x09\x09\x09switch (op) {\x0a\x09\x09\x09\x09\x09case \x27readAsBinaryString\x27:\x0a\x09\x09\x09\x09\x09\x09return src;\x0a\x09\x09\x09\x09\x09case \x27readAsDataURL\x27:\x0a\x09\x09\x09\x09\x09\x09return \x27data:\x27 + blob.type + \x27;base64,\x27 + Encode.btoa(src);\x0a\x09\x09\x09\x09\x09case \x27readAsText\x27:\x0a\x09\x09\x09\x09\x09\x09var txt = \x27\x27;\x0a\x09\x09\x09\x09\x09\x09for (var i = 0, length = src.length; i \x3c length; i++) {\x0a\x09\x09\x09\x09\x09\x09\x09txt += String.fromCharCode(src[i]);\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09return txt;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09var result = this.connectRuntime(blob.ruid).exec.call(this, \x27FileReaderSync\x27, \x27read\x27, op, blob);\x0a\x09\x09\x09\x09this.disconnectRuntime();\x0a\x09\x09\x09\x09return result;\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x09};\x0a});\x0a\x0a// Included from: src/javascript/xhr/FormData.js\x0a\x0a/**\x0a * FormData.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x22moxie/xhr/FormData\x22, [\x0a\x09\x22moxie/core/Exceptions\x22,\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/file/Blob\x22\x0a], function(x, Basic, Blob) {\x0a\x09/**\x0a\x09FormData\x0a\x0a\x09@class FormData\x0a\x09@constructor\x0a\x09*/\x0a\x09function FormData() {\x0a\x09\x09var _blob, _fields = [];\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09/**\x0a\x09\x09\x09Append another key-value pair to the FormData object\x0a\x0a\x09\x09\x09@method append\x0a\x09\x09\x09@param {String} name Name for the new field\x0a\x09\x09\x09@param {String|Blob|Array|Object} value Value for the field\x0a\x09\x09\x09*/\x0a\x09\x09\x09append: function(name, value) {\x0a\x09\x09\x09\x09var self = this, valueType = Basic.typeOf(value);\x0a\x0a\x09\x09\x09\x09// according to specs value might be either Blob or String\x0a\x09\x09\x09\x09if (value instanceof Blob) {\x0a\x09\x09\x09\x09\x09_blob = {\x0a\x09\x09\x09\x09\x09\x09name: name,\x0a\x09\x09\x09\x09\x09\x09value: value // unfortunately we can only send single Blob in one FormData\x0a\x09\x09\x09\x09\x09};\x0a\x09\x09\x09\x09} else if (\x27array\x27 === valueType) {\x0a\x09\x09\x09\x09\x09name += \x27[]\x27;\x0a\x0a\x09\x09\x09\x09\x09Basic.each(value, function(value) {\x0a\x09\x09\x09\x09\x09\x09self.append(name, value);\x0a\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09} else if (\x27object\x27 === valueType) {\x0a\x09\x09\x09\x09\x09Basic.each(value, function(value, key) {\x0a\x09\x09\x09\x09\x09\x09self.append(name + \x27[\x27 + key + \x27]\x27, value);\x0a\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09} else if (\x27null\x27 === valueType || \x27undefined\x27 === valueType || \x27number\x27 === valueType && isNaN(value)) {\x0a\x09\x09\x09\x09\x09self.append(name, \x22false\x22);\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09_fields.push({\x0a\x09\x09\x09\x09\x09\x09name: name,\x0a\x09\x09\x09\x09\x09\x09value: value.toString()\x0a\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Checks if FormData contains Blob.\x0a\x0a\x09\x09\x09@method hasBlob\x0a\x09\x09\x09@return {Boolean}\x0a\x09\x09\x09*/\x0a\x09\x09\x09hasBlob: function() {\x0a\x09\x09\x09\x09return !!this.getBlob();\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Retrieves blob.\x0a\x0a\x09\x09\x09@method getBlob\x0a\x09\x09\x09@return {Object} Either Blob if found or null\x0a\x09\x09\x09*/\x0a\x09\x09\x09getBlob: function() {\x0a\x09\x09\x09\x09return _blob && _blob.value || null;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Retrieves blob field name.\x0a\x0a\x09\x09\x09@method getBlobName\x0a\x09\x09\x09@return {String} Either Blob field name or null\x0a\x09\x09\x09*/\x0a\x09\x09\x09getBlobName: function() {\x0a\x09\x09\x09\x09return _blob && _blob.name || null;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Loop over the fields in FormData and invoke the callback for each of them.\x0a\x0a\x09\x09\x09@method each\x0a\x09\x09\x09@param {Function} cb Callback to call for each field\x0a\x09\x09\x09*/\x0a\x09\x09\x09each: function(cb) {\x0a\x09\x09\x09\x09Basic.each(_fields, function(field) {\x0a\x09\x09\x09\x09\x09cb(field.value, field.name);\x0a\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09if (_blob) {\x0a\x09\x09\x09\x09\x09cb(_blob.value, _blob.name);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09destroy: function() {\x0a\x09\x09\x09\x09_blob = null;\x0a\x09\x09\x09\x09_fields = [];\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x09}\x0a\x0a\x09return FormData;\x0a});\x0a\x0a// Included from: src/javascript/xhr/XMLHttpRequest.js\x0a\x0a/**\x0a * XMLHttpRequest.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x22moxie/xhr/XMLHttpRequest\x22, [\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/core/Exceptions\x22,\x0a\x09\x22moxie/core/EventTarget\x22,\x0a\x09\x22moxie/core/utils/Encode\x22,\x0a\x09\x22moxie/core/utils/Url\x22,\x0a\x09\x22moxie/runtime/Runtime\x22,\x0a\x09\x22moxie/runtime/RuntimeTarget\x22,\x0a\x09\x22moxie/file/Blob\x22,\x0a\x09\x22moxie/file/FileReaderSync\x22,\x0a\x09\x22moxie/xhr/FormData\x22,\x0a\x09\x22moxie/core/utils/Env\x22,\x0a\x09\x22moxie/core/utils/Mime\x22\x0a], function(Basic, x, EventTarget, Encode, Url, Runtime, RuntimeTarget, Blob, FileReaderSync, FormData, Env, Mime) {\x0a\x0a\x09var httpCode = {\x0a\x09\x09100: \x27Continue\x27,\x0a\x09\x09101: \x27Switching Protocols\x27,\x0a\x09\x09102: \x27Processing\x27,\x0a\x0a\x09\x09200: \x27OK\x27,\x0a\x09\x09201: \x27Created\x27,\x0a\x09\x09202: \x27Accepted\x27,\x0a\x09\x09203: \x27Non-Authoritative Information\x27,\x0a\x09\x09204: \x27No Content\x27,\x0a\x09\x09205: \x27Reset Content\x27,\x0a\x09\x09206: \x27Partial Content\x27,\x0a\x09\x09207: \x27Multi-Status\x27,\x0a\x09\x09226: \x27IM Used\x27,\x0a\x0a\x09\x09300: \x27Multiple Choices\x27,\x0a\x09\x09301: \x27Moved Permanently\x27,\x0a\x09\x09302: \x27Found\x27,\x0a\x09\x09303: \x27See Other\x27,\x0a\x09\x09304: \x27Not Modified\x27,\x0a\x09\x09305: \x27Use Proxy\x27,\x0a\x09\x09306: \x27Reserved\x27,\x0a\x09\x09307: \x27Temporary Redirect\x27,\x0a\x0a\x09\x09400: \x27Bad Request\x27,\x0a\x09\x09401: \x27Unauthorized\x27,\x0a\x09\x09402: \x27Payment Required\x27,\x0a\x09\x09403: \x27Forbidden\x27,\x0a\x09\x09404: \x27Not Found\x27,\x0a\x09\x09405: \x27Method Not Allowed\x27,\x0a\x09\x09406: \x27Not Acceptable\x27,\x0a\x09\x09407: \x27Proxy Authentication Required\x27,\x0a\x09\x09408: \x27Request Timeout\x27,\x0a\x09\x09409: \x27Conflict\x27,\x0a\x09\x09410: \x27Gone\x27,\x0a\x09\x09411: \x27Length Required\x27,\x0a\x09\x09412: \x27Precondition Failed\x27,\x0a\x09\x09413: \x27Request Entity Too Large\x27,\x0a\x09\x09414: \x27Request-URI Too Long\x27,\x0a\x09\x09415: \x27Unsupported Media Type\x27,\x0a\x09\x09416: \x27Requested Range Not Satisfiable\x27,\x0a\x09\x09417: \x27Expectation Failed\x27,\x0a\x09\x09422: \x27Unprocessable Entity\x27,\x0a\x09\x09423: \x27Locked\x27,\x0a\x09\x09424: \x27Failed Dependency\x27,\x0a\x09\x09426: \x27Upgrade Required\x27,\x0a\x0a\x09\x09500: \x27Internal Server Error\x27,\x0a\x09\x09501: \x27Not Implemented\x27,\x0a\x09\x09502: \x27Bad Gateway\x27,\x0a\x09\x09503: \x27Service Unavailable\x27,\x0a\x09\x09504: \x27Gateway Timeout\x27,\x0a\x09\x09505: \x27HTTP Version Not Supported\x27,\x0a\x09\x09506: \x27Variant Also Negotiates\x27,\x0a\x09\x09507: \x27Insufficient Storage\x27,\x0a\x09\x09510: \x27Not Extended\x27\x0a\x09};\x0a\x0a\x09function XMLHttpRequestUpload() {\x0a\x09\x09this.uid = Basic.guid(\x27uid_\x27);\x0a\x09}\x0a\x09\x0a\x09XMLHttpRequestUpload.prototype = EventTarget.instance;\x0a\x0a\x09/**\x0a\x09Implementation of XMLHttpRequest\x0a\x0a\x09@class XMLHttpRequest\x0a\x09@constructor\x0a\x09@uses RuntimeClient\x0a\x09@extends EventTarget\x0a\x09*/\x0a\x09var dispatches = [\x0a\x09\x09\x27loadstart\x27,\x0a\x0a\x09\x09\x27progress\x27,\x0a\x0a\x09\x09\x27abort\x27,\x0a\x0a\x09\x09\x27error\x27,\x0a\x0a\x09\x09\x27load\x27,\x0a\x0a\x09\x09\x27timeout\x27,\x0a\x0a\x09\x09\x27loadend\x27\x0a\x0a\x09\x09// readystatechange (for historical reasons)\x0a\x09]; \x0a\x09\x0a\x09var NATIVE = 1, RUNTIME = 2;\x0a\x09\x09\x09\x09\x09\x0a\x09function XMLHttpRequest() {\x0a\x09\x09var self = this,\x0a\x09\x09\x09// this (together with _p() @see below) is here to gracefully upgrade to setter/getter syntax where possible\x0a\x09\x09\x09props = {\x0a\x09\x09\x09\x09/**\x0a\x09\x09\x09\x09The amount of milliseconds a request can take before being terminated. Initially zero. Zero means there is no timeout.\x0a\x0a\x09\x09\x09\x09@property timeout\x0a\x09\x09\x09\x09@type Number\x0a\x09\x09\x09\x09@default 0\x0a\x09\x09\x09\x09*/\x0a\x09\x09\x09\x09timeout: 0,\x0a\x0a\x09\x09\x09\x09/**\x0a\x09\x09\x09\x09Current state, can take following values:\x0a\x09\x09\x09\x09UNSENT (numeric value 0)\x0a\x09\x09\x09\x09The object has been constructed.\x0a\x0a\x09\x09\x09\x09OPENED (numeric value 1)\x0a\x09\x09\x09\x09The open() method has been successfully invoked. During this state request headers can be set using setRequestHeader() and the request can be made using the send() method.\x0a\x0a\x09\x09\x09\x09HEADERS_RECEIVED (numeric value 2)\x0a\x09\x09\x09\x09All redirects (if any) have been followed and all HTTP headers of the final response have been received. Several response members of the object are now available.\x0a\x0a\x09\x09\x09\x09LOADING (numeric value 3)\x0a\x09\x09\x09\x09The response entity body is being received.\x0a\x0a\x09\x09\x09\x09DONE (numeric value 4)\x0a\x0a\x09\x09\x09\x09@property readyState\x0a\x09\x09\x09\x09@type Number\x0a\x09\x09\x09\x09@default 0 (UNSENT)\x0a\x09\x09\x09\x09*/\x0a\x09\x09\x09\x09readyState: XMLHttpRequest.UNSENT,\x0a\x0a\x09\x09\x09\x09/**\x0a\x09\x09\x09\x09True when user credentials are to be included in a cross-origin request. False when they are to be excluded\x0a\x09\x09\x09\x09in a cross-origin request and when cookies are to be ignored in its response. Initially false.\x0a\x0a\x09\x09\x09\x09@property withCredentials\x0a\x09\x09\x09\x09@type Boolean\x0a\x09\x09\x09\x09@default false\x0a\x09\x09\x09\x09*/\x0a\x09\x09\x09\x09withCredentials: false,\x0a\x0a\x09\x09\x09\x09/**\x0a\x09\x09\x09\x09Returns the HTTP status code.\x0a\x0a\x09\x09\x09\x09@property status\x0a\x09\x09\x09\x09@type Number\x0a\x09\x09\x09\x09@default 0\x0a\x09\x09\x09\x09*/\x0a\x09\x09\x09\x09status: 0,\x0a\x0a\x09\x09\x09\x09/**\x0a\x09\x09\x09\x09Returns the HTTP status text.\x0a\x0a\x09\x09\x09\x09@property statusText\x0a\x09\x09\x09\x09@type String\x0a\x09\x09\x09\x09*/\x0a\x09\x09\x09\x09statusText: \x22\x22,\x0a\x0a\x09\x09\x09\x09/**\x0a\x09\x09\x09\x09Returns the response type. Can be set to change the response type. Values are:\x0a\x09\x09\x09\x09the empty string (default), \x22arraybuffer\x22, \x22blob\x22, \x22document\x22, \x22json\x22, and \x22text\x22.\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09@property responseType\x0a\x09\x09\x09\x09@type String\x0a\x09\x09\x09\x09*/\x0a\x09\x09\x09\x09responseType: \x22\x22,\x0a\x0a\x09\x09\x09\x09/**\x0a\x09\x09\x09\x09Returns the document response entity body.\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09Throws an \x22InvalidStateError\x22 exception if responseType is not the empty string or \x22document\x22.\x0a\x0a\x09\x09\x09\x09@property responseXML\x0a\x09\x09\x09\x09@type Document\x0a\x09\x09\x09\x09*/\x0a\x09\x09\x09\x09responseXML: null,\x0a\x0a\x09\x09\x09\x09/**\x0a\x09\x09\x09\x09Returns the text response entity body.\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09Throws an \x22InvalidStateError\x22 exception if responseType is not the empty string or \x22text\x22.\x0a\x0a\x09\x09\x09\x09@property responseText\x0a\x09\x09\x09\x09@type String\x0a\x09\x09\x09\x09*/\x0a\x09\x09\x09\x09responseText: null,\x0a\x0a\x09\x09\x09\x09/**\x0a\x09\x09\x09\x09Returns the response entity body (http://www.w3.org/TR/XMLHttpRequest/#response-entity-body).\x0a\x09\x09\x09\x09Can become: ArrayBuffer, Blob, Document, JSON, Text\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09@property response\x0a\x09\x09\x09\x09@type Mixed\x0a\x09\x09\x09\x09*/\x0a\x09\x09\x09\x09response: null\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09_async = true,\x0a\x09\x09\x09_url,\x0a\x09\x09\x09_method,\x0a\x09\x09\x09_headers = {},\x0a\x09\x09\x09_user,\x0a\x09\x09\x09_password,\x0a\x09\x09\x09_encoding = null,\x0a\x09\x09\x09_mimeType = null,\x0a\x0a\x09\x09\x09// flags\x0a\x09\x09\x09_sync_flag = false,\x0a\x09\x09\x09_send_flag = false,\x0a\x09\x09\x09_upload_events_flag = false,\x0a\x09\x09\x09_upload_complete_flag = false,\x0a\x09\x09\x09_error_flag = false,\x0a\x09\x09\x09_same_origin_flag = false,\x0a\x0a\x09\x09\x09// times\x0a\x09\x09\x09_start_time,\x0a\x09\x09\x09_timeoutset_time,\x0a\x0a\x09\x09\x09_finalMime = null,\x0a\x09\x09\x09_finalCharset = null,\x0a\x0a\x09\x09\x09_options = {},\x0a\x09\x09\x09_xhr,\x0a\x09\x09\x09_responseHeaders = \x27\x27,\x0a\x09\x09\x09_responseHeadersBag\x0a\x09\x09\x09;\x0a\x0a\x09\x09\x0a\x09\x09Basic.extend(this, props, {\x0a\x09\x09\x09/**\x0a\x09\x09\x09Unique id of the component\x0a\x0a\x09\x09\x09@property uid\x0a\x09\x09\x09@type String\x0a\x09\x09\x09*/\x0a\x09\x09\x09uid: Basic.guid(\x27uid_\x27),\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Target for Upload events\x0a\x0a\x09\x09\x09@property upload\x0a\x09\x09\x09@type XMLHttpRequestUpload\x0a\x09\x09\x09*/\x0a\x09\x09\x09upload: new XMLHttpRequestUpload(),\x0a\x09\x09\x09\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Sets the request method, request URL, synchronous flag, request username, and request password.\x0a\x0a\x09\x09\x09Throws a \x22SyntaxError\x22 exception if one of the following is true:\x0a\x0a\x09\x09\x09method is not a valid HTTP method.\x0a\x09\x09\x09url cannot be resolved.\x0a\x09\x09\x09url contains the \x22user:password\x22 format in the userinfo production.\x0a\x09\x09\x09Throws a \x22SecurityError\x22 exception if method is a case-insensitive match for CONNECT, TRACE or TRACK.\x0a\x0a\x09\x09\x09Throws an \x22InvalidAccessError\x22 exception if one of the following is true:\x0a\x0a\x09\x09\x09Either user or password is passed as argument and the origin of url does not match the XMLHttpRequest origin.\x0a\x09\x09\x09There is an associated XMLHttpRequest document and either the timeout attribute is not zero,\x0a\x09\x09\x09the withCredentials attribute is true, or the responseType attribute is not the empty string.\x0a\x0a\x0a\x09\x09\x09@method open\x0a\x09\x09\x09@param {String} method HTTP method to use on request\x0a\x09\x09\x09@param {String} url URL to request\x0a\x09\x09\x09@param {Boolean} [async=true] If false request will be done in synchronous manner. Asynchronous by default.\x0a\x09\x09\x09@param {String} [user] Username to use in HTTP authentication process on server-side\x0a\x09\x09\x09@param {String} [password] Password to use in HTTP authentication process on server-side\x0a\x09\x09\x09*/\x0a\x09\x09\x09open: function(method, url, async, user, password) {\x0a\x09\x09\x09\x09var urlp;\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09// first two arguments are required\x0a\x09\x09\x09\x09if (!method || !url) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.SYNTAX_ERR);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09// 2 - check if any code point in method is higher than U+00FF or after deflating method it does not match the method\x0a\x09\x09\x09\x09if (/[\x5cu0100-\x5cuffff]/.test(method) || Encode.utf8_encode(method) !== method) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.SYNTAX_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// 3\x0a\x09\x09\x09\x09if (!!~Basic.inArray(method.toUpperCase(), [\x27CONNECT\x27, \x27DELETE\x27, \x27GET\x27, \x27HEAD\x27, \x27OPTIONS\x27, \x27POST\x27, \x27PUT\x27, \x27TRACE\x27, \x27TRACK\x27])) {\x0a\x09\x09\x09\x09\x09_method = method.toUpperCase();\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09// 4 - allowing these methods poses a security risk\x0a\x09\x09\x09\x09if (!!~Basic.inArray(_method, [\x27CONNECT\x27, \x27TRACE\x27, \x27TRACK\x27])) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.SECURITY_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// 5\x0a\x09\x09\x09\x09url = Encode.utf8_encode(url);\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09// 6 - Resolve url relative to the XMLHttpRequest base URL. If the algorithm returns an error, throw a \x22SyntaxError\x22.\x0a\x09\x09\x09\x09urlp = Url.parseUrl(url);\x0a\x0a\x09\x09\x09\x09_same_origin_flag = Url.hasSameOrigin(urlp);\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09// 7 - manually build up absolute url\x0a\x09\x09\x09\x09_url = Url.resolveUrl(url);\x0a\x09\x09\x0a\x09\x09\x09\x09// 9-10, 12-13\x0a\x09\x09\x09\x09if ((user || password) && !_same_origin_flag) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_ACCESS_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09_user = user || urlp.user;\x0a\x09\x09\x09\x09_password = password || urlp.pass;\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09// 11\x0a\x09\x09\x09\x09_async = async || true;\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09if (_async === false && (_p(\x27timeout\x27) || _p(\x27withCredentials\x27) || _p(\x27responseType\x27) !== \x22\x22)) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_ACCESS_ERR);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09// 14 - terminate abort()\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09// 15 - terminate send()\x0a\x0a\x09\x09\x09\x09// 18\x0a\x09\x09\x09\x09_sync_flag = !_async;\x0a\x09\x09\x09\x09_send_flag = false;\x0a\x09\x09\x09\x09_headers = {};\x0a\x09\x09\x09\x09_reset.call(this);\x0a\x0a\x09\x09\x09\x09// 19\x0a\x09\x09\x09\x09_p(\x27readyState\x27, XMLHttpRequest.OPENED);\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09// 20\x0a\x09\x09\x09\x09this.dispatchEvent(\x27readystatechange\x27);\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Appends an header to the list of author request headers, or if header is already\x0a\x09\x09\x09in the list of author request headers, combines its value with value.\x0a\x0a\x09\x09\x09Throws an \x22InvalidStateError\x22 exception if the state is not OPENED or if the send() flag is set.\x0a\x09\x09\x09Throws a \x22SyntaxError\x22 exception if header is not a valid HTTP header field name or if value\x0a\x09\x09\x09is not a valid HTTP header field value.\x0a\x09\x09\x09\x0a\x09\x09\x09@method setRequestHeader\x0a\x09\x09\x09@param {String} header\x0a\x09\x09\x09@param {String|Number} value\x0a\x09\x09\x09*/\x0a\x09\x09\x09setRequestHeader: function(header, value) {\x0a\x09\x09\x09\x09var uaHeaders = [ // these headers are controlled by the user agent\x0a\x09\x09\x09\x09\x09\x09\x22accept-charset\x22,\x0a\x09\x09\x09\x09\x09\x09\x22accept-encoding\x22,\x0a\x09\x09\x09\x09\x09\x09\x22access-control-request-headers\x22,\x0a\x09\x09\x09\x09\x09\x09\x22access-control-request-method\x22,\x0a\x09\x09\x09\x09\x09\x09\x22connection\x22,\x0a\x09\x09\x09\x09\x09\x09\x22content-length\x22,\x0a\x09\x09\x09\x09\x09\x09\x22cookie\x22,\x0a\x09\x09\x09\x09\x09\x09\x22cookie2\x22,\x0a\x09\x09\x09\x09\x09\x09\x22content-transfer-encoding\x22,\x0a\x09\x09\x09\x09\x09\x09\x22date\x22,\x0a\x09\x09\x09\x09\x09\x09\x22expect\x22,\x0a\x09\x09\x09\x09\x09\x09\x22host\x22,\x0a\x09\x09\x09\x09\x09\x09\x22keep-alive\x22,\x0a\x09\x09\x09\x09\x09\x09\x22origin\x22,\x0a\x09\x09\x09\x09\x09\x09\x22referer\x22,\x0a\x09\x09\x09\x09\x09\x09\x22te\x22,\x0a\x09\x09\x09\x09\x09\x09\x22trailer\x22,\x0a\x09\x09\x09\x09\x09\x09\x22transfer-encoding\x22,\x0a\x09\x09\x09\x09\x09\x09\x22upgrade\x22,\x0a\x09\x09\x09\x09\x09\x09\x22user-agent\x22,\x0a\x09\x09\x09\x09\x09\x09\x22via\x22\x0a\x09\x09\x09\x09\x09];\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09// 1-2\x0a\x09\x09\x09\x09if (_p(\x27readyState\x27) !== XMLHttpRequest.OPENED || _send_flag) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// 3\x0a\x09\x09\x09\x09if (/[\x5cu0100-\x5cuffff]/.test(header) || Encode.utf8_encode(header) !== header) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.SYNTAX_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// 4\x0a\x09\x09\x09\x09/* this step is seemingly bypassed in browsers, probably to allow various unicode characters in header values\x0a\x09\x09\x09\x09if (/[\x5cu0100-\x5cuffff]/.test(value) || Encode.utf8_encode(value) !== value) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.SYNTAX_ERR);\x0a\x09\x09\x09\x09}*/\x0a\x0a\x09\x09\x09\x09header = Basic.trim(header).toLowerCase();\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09// setting of proxy-* and sec-* headers is prohibited by spec\x0a\x09\x09\x09\x09if (!!~Basic.inArray(header, uaHeaders) || /^(proxy\x5c-|sec\x5c-)/.test(header)) {\x0a\x09\x09\x09\x09\x09return false;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// camelize\x0a\x09\x09\x09\x09// browsers lowercase header names (at least for custom ones)\x0a\x09\x09\x09\x09// header = header.replace(/\x5cb\x5cw/g, function($1) { return $1.toUpperCase(); });\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09if (!_headers[header]) {\x0a\x09\x09\x09\x09\x09_headers[header] = value;\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09// http://tools.ietf.org/html/rfc2616#section-4.2 (last paragraph)\x0a\x09\x09\x09\x09\x09_headers[header] += \x27, \x27 + value;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09return true;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Returns all headers from the response, with the exception of those whose field name is Set-Cookie or Set-Cookie2.\x0a\x0a\x09\x09\x09@method getAllResponseHeaders\x0a\x09\x09\x09@return {String} reponse headers or empty string\x0a\x09\x09\x09*/\x0a\x09\x09\x09getAllResponseHeaders: function() {\x0a\x09\x09\x09\x09return _responseHeaders || \x27\x27;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Returns the header field value from the response of which the field name matches header, \x0a\x09\x09\x09unless the field name is Set-Cookie or Set-Cookie2.\x0a\x0a\x09\x09\x09@method getResponseHeader\x0a\x09\x09\x09@param {String} header\x0a\x09\x09\x09@return {String} value(s) for the specified header or null\x0a\x09\x09\x09*/\x0a\x09\x09\x09getResponseHeader: function(header) {\x0a\x09\x09\x09\x09header = header.toLowerCase();\x0a\x0a\x09\x09\x09\x09if (_error_flag || !!~Basic.inArray(header, [\x27set-cookie\x27, \x27set-cookie2\x27])) {\x0a\x09\x09\x09\x09\x09return null;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if (_responseHeaders && _responseHeaders !== \x27\x27) {\x0a\x09\x09\x09\x09\x09// if we didn\x27t parse response headers until now, do it and keep for later\x0a\x09\x09\x09\x09\x09if (!_responseHeadersBag) {\x0a\x09\x09\x09\x09\x09\x09_responseHeadersBag = {};\x0a\x09\x09\x09\x09\x09\x09Basic.each(_responseHeaders.split(/\x5cr\x5cn/), function(line) {\x0a\x09\x09\x09\x09\x09\x09\x09var pair = line.split(/:\x5cs+/);\x0a\x09\x09\x09\x09\x09\x09\x09if (pair.length === 2) { // last line might be empty, omit\x0a\x09\x09\x09\x09\x09\x09\x09\x09pair[0] = Basic.trim(pair[0]); // just in case\x0a\x09\x09\x09\x09\x09\x09\x09\x09_responseHeadersBag[pair[0].toLowerCase()] = { // simply to retain header name in original form\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09header: pair[0],\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09value: Basic.trim(pair[1])\x0a\x09\x09\x09\x09\x09\x09\x09\x09};\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09if (_responseHeadersBag.hasOwnProperty(header)) {\x0a\x09\x09\x09\x09\x09\x09return _responseHeadersBag[header].header + \x27: \x27 + _responseHeadersBag[header].value;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09return null;\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Sets the Content-Type header for the response to mime.\x0a\x09\x09\x09Throws an \x22InvalidStateError\x22 exception if the state is LOADING or DONE.\x0a\x09\x09\x09Throws a \x22SyntaxError\x22 exception if mime is not a valid media type.\x0a\x0a\x09\x09\x09@method overrideMimeType\x0a\x09\x09\x09@param String mime Mime type to set\x0a\x09\x09\x09*/\x0a\x09\x09\x09overrideMimeType: function(mime) {\x0a\x09\x09\x09\x09var matches, charset;\x0a\x09\x09\x09\x0a\x09\x09\x09\x09// 1\x0a\x09\x09\x09\x09if (!!~Basic.inArray(_p(\x27readyState\x27), [XMLHttpRequest.LOADING, XMLHttpRequest.DONE])) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// 2\x0a\x09\x09\x09\x09mime = Basic.trim(mime.toLowerCase());\x0a\x0a\x09\x09\x09\x09if (/;/.test(mime) && (matches = mime.match(/^([^;]+)(?:;\x5cscharset\x5c=)?(.*)$/))) {\x0a\x09\x09\x09\x09\x09mime = matches[1];\x0a\x09\x09\x09\x09\x09if (matches[2]) {\x0a\x09\x09\x09\x09\x09\x09charset = matches[2];\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if (!Mime.mimes[mime]) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.SYNTAX_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// 3-4\x0a\x09\x09\x09\x09_finalMime = mime;\x0a\x09\x09\x09\x09_finalCharset = charset;\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Initiates the request. The optional argument provides the request entity body.\x0a\x09\x09\x09The argument is ignored if request method is GET or HEAD.\x0a\x0a\x09\x09\x09Throws an \x22InvalidStateError\x22 exception if the state is not OPENED or if the send() flag is set.\x0a\x0a\x09\x09\x09@method send\x0a\x09\x09\x09@param {Blob|Document|String|FormData} [data] Request entity body\x0a\x09\x09\x09@param {Object} [options] Set of requirements and pre-requisities for runtime initialization\x0a\x09\x09\x09*/\x0a\x09\x09\x09send: function(data, options) {\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09if (Basic.typeOf(options) === \x27string\x27) {\x0a\x09\x09\x09\x09\x09_options = { ruid: options };\x0a\x09\x09\x09\x09} else if (!options) {\x0a\x09\x09\x09\x09\x09_options = {};\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09_options = options;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09// 1-2\x0a\x09\x09\x09\x09if (this.readyState !== XMLHttpRequest.OPENED || _send_flag) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09// 3\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09// sending Blob\x0a\x09\x09\x09\x09if (data instanceof Blob) {\x0a\x09\x09\x09\x09\x09_options.ruid = data.ruid;\x0a\x09\x09\x09\x09\x09_mimeType = data.type || \x27application/octet-stream\x27;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09// FormData\x0a\x09\x09\x09\x09else if (data instanceof FormData) {\x0a\x09\x09\x09\x09\x09if (data.hasBlob()) {\x0a\x09\x09\x09\x09\x09\x09var blob = data.getBlob();\x0a\x09\x09\x09\x09\x09\x09_options.ruid = blob.ruid;\x0a\x09\x09\x09\x09\x09\x09_mimeType = blob.type || \x27application/octet-stream\x27;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09// DOMString\x0a\x09\x09\x09\x09else if (typeof data === \x27string\x27) {\x0a\x09\x09\x09\x09\x09_encoding = \x27UTF-8\x27;\x0a\x09\x09\x09\x09\x09_mimeType = \x27text/plain;charset=UTF-8\x27;\x0a\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09// data should be converted to Unicode and encoded as UTF-8\x0a\x09\x09\x09\x09\x09data = Encode.utf8_encode(data);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// if withCredentials not set, but requested, set it automatically\x0a\x09\x09\x09\x09if (!this.withCredentials) {\x0a\x09\x09\x09\x09\x09this.withCredentials = (_options.required_caps && _options.required_caps.send_browser_cookies) && !_same_origin_flag;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// 4 - storage mutex\x0a\x09\x09\x09\x09// 5\x0a\x09\x09\x09\x09_upload_events_flag = (!_sync_flag && this.upload.hasEventListener()); // DSAP\x0a\x09\x09\x09\x09// 6\x0a\x09\x09\x09\x09_error_flag = false;\x0a\x09\x09\x09\x09// 7\x0a\x09\x09\x09\x09_upload_complete_flag = !data;\x0a\x09\x09\x09\x09// 8 - Asynchronous steps\x0a\x09\x09\x09\x09if (!_sync_flag) {\x0a\x09\x09\x09\x09\x09// 8.1\x0a\x09\x09\x09\x09\x09_send_flag = true;\x0a\x09\x09\x09\x09\x09// 8.2\x0a\x09\x09\x09\x09\x09// this.dispatchEvent(\x27loadstart\x27); // will be dispatched either by native or runtime xhr\x0a\x09\x09\x09\x09\x09// 8.3\x0a\x09\x09\x09\x09\x09//if (!_upload_complete_flag) {\x0a\x09\x09\x09\x09\x09\x09// this.upload.dispatchEvent(\x27loadstart\x27);\x09// will be dispatched either by native or runtime xhr\x0a\x09\x09\x09\x09\x09//}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09// 8.5 - Return the send() method call, but continue running the steps in this algorithm.\x0a\x09\x09\x09\x09_doXHR.call(this, data);\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x09\x09\x09/**\x0a\x09\x09\x09Cancels any network activity.\x0a\x09\x09\x09\x0a\x09\x09\x09@method abort\x0a\x09\x09\x09*/\x0a\x09\x09\x09abort: function() {\x0a\x09\x09\x09\x09_error_flag = true;\x0a\x09\x09\x09\x09_sync_flag = false;\x0a\x0a\x09\x09\x09\x09if (!~Basic.inArray(_p(\x27readyState\x27), [XMLHttpRequest.UNSENT, XMLHttpRequest.OPENED, XMLHttpRequest.DONE])) {\x0a\x09\x09\x09\x09\x09_p(\x27readyState\x27, XMLHttpRequest.DONE);\x0a\x09\x09\x09\x09\x09_send_flag = false;\x0a\x0a\x09\x09\x09\x09\x09if (_xhr) {\x0a\x09\x09\x09\x09\x09\x09_xhr.getRuntime().exec.call(_xhr, \x27XMLHttpRequest\x27, \x27abort\x27, _upload_complete_flag);\x0a\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09_upload_complete_flag = true;\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09_p(\x27readyState\x27, XMLHttpRequest.UNSENT);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09destroy: function() {\x0a\x09\x09\x09\x09if (_xhr) {\x0a\x09\x09\x09\x09\x09if (Basic.typeOf(_xhr.destroy) === \x27function\x27) {\x0a\x09\x09\x09\x09\x09\x09_xhr.destroy();\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09_xhr = null;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09this.unbindAll();\x0a\x0a\x09\x09\x09\x09if (this.upload) {\x0a\x09\x09\x09\x09\x09this.upload.unbindAll();\x0a\x09\x09\x09\x09\x09this.upload = null;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09this.handleEventProps(dispatches.concat([\x27readystatechange\x27])); // for historical reasons\x0a\x09\x09this.upload.handleEventProps(dispatches);\x0a\x0a\x09\x09/* this is nice, but maybe too lengthy\x0a\x0a\x09\x09// if supported by JS version, set getters/setters for specific properties\x0a\x09\x09o.defineProperty(this, \x27readyState\x27, {\x0a\x09\x09\x09configurable: false,\x0a\x0a\x09\x09\x09get: function() {\x0a\x09\x09\x09\x09return _p(\x27readyState\x27);\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09o.defineProperty(this, \x27timeout\x27, {\x0a\x09\x09\x09configurable: false,\x0a\x0a\x09\x09\x09get: function() {\x0a\x09\x09\x09\x09return _p(\x27timeout\x27);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09set: function(value) {\x0a\x0a\x09\x09\x09\x09if (_sync_flag) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_ACCESS_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// timeout still should be measured relative to the start time of request\x0a\x09\x09\x09\x09_timeoutset_time = (new Date).getTime();\x0a\x0a\x09\x09\x09\x09_p(\x27timeout\x27, value);\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09// the withCredentials attribute has no effect when fetching same-origin resources\x0a\x09\x09o.defineProperty(this, \x27withCredentials\x27, {\x0a\x09\x09\x09configurable: false,\x0a\x0a\x09\x09\x09get: function() {\x0a\x09\x09\x09\x09return _p(\x27withCredentials\x27);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09set: function(value) {\x0a\x09\x09\x09\x09// 1-2\x0a\x09\x09\x09\x09if (!~o.inArray(_p(\x27readyState\x27), [XMLHttpRequest.UNSENT, XMLHttpRequest.OPENED]) || _send_flag) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// 3-4\x0a\x09\x09\x09\x09if (_anonymous_flag || _sync_flag) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_ACCESS_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// 5\x0a\x09\x09\x09\x09_p(\x27withCredentials\x27, value);\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09o.defineProperty(this, \x27status\x27, {\x0a\x09\x09\x09configurable: false,\x0a\x0a\x09\x09\x09get: function() {\x0a\x09\x09\x09\x09return _p(\x27status\x27);\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09o.defineProperty(this, \x27statusText\x27, {\x0a\x09\x09\x09configurable: false,\x0a\x0a\x09\x09\x09get: function() {\x0a\x09\x09\x09\x09return _p(\x27statusText\x27);\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09o.defineProperty(this, \x27responseType\x27, {\x0a\x09\x09\x09configurable: false,\x0a\x0a\x09\x09\x09get: function() {\x0a\x09\x09\x09\x09return _p(\x27responseType\x27);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09set: function(value) {\x0a\x09\x09\x09\x09// 1\x0a\x09\x09\x09\x09if (!!~o.inArray(_p(\x27readyState\x27), [XMLHttpRequest.LOADING, XMLHttpRequest.DONE])) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// 2\x0a\x09\x09\x09\x09if (_sync_flag) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_ACCESS_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// 3\x0a\x09\x09\x09\x09_p(\x27responseType\x27, value.toLowerCase());\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09o.defineProperty(this, \x27responseText\x27, {\x0a\x09\x09\x09configurable: false,\x0a\x0a\x09\x09\x09get: function() {\x0a\x09\x09\x09\x09// 1\x0a\x09\x09\x09\x09if (!~o.inArray(_p(\x27responseType\x27), [\x27\x27, \x27text\x27])) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// 2-3\x0a\x09\x09\x09\x09if (_p(\x27readyState\x27) !== XMLHttpRequest.DONE && _p(\x27readyState\x27) !== XMLHttpRequest.LOADING || _error_flag) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09return _p(\x27responseText\x27);\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09o.defineProperty(this, \x27responseXML\x27, {\x0a\x09\x09\x09configurable: false,\x0a\x0a\x09\x09\x09get: function() {\x0a\x09\x09\x09\x09// 1\x0a\x09\x09\x09\x09if (!~o.inArray(_p(\x27responseType\x27), [\x27\x27, \x27document\x27])) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// 2-3\x0a\x09\x09\x09\x09if (_p(\x27readyState\x27) !== XMLHttpRequest.DONE || _error_flag) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09return _p(\x27responseXML\x27);\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09o.defineProperty(this, \x27response\x27, {\x0a\x09\x09\x09configurable: false,\x0a\x0a\x09\x09\x09get: function() {\x0a\x09\x09\x09\x09if (!!~o.inArray(_p(\x27responseType\x27), [\x27\x27, \x27text\x27])) {\x0a\x09\x09\x09\x09\x09if (_p(\x27readyState\x27) !== XMLHttpRequest.DONE && _p(\x27readyState\x27) !== XMLHttpRequest.LOADING || _error_flag) {\x0a\x09\x09\x09\x09\x09\x09return \x27\x27;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if (_p(\x27readyState\x27) !== XMLHttpRequest.DONE || _error_flag) {\x0a\x09\x09\x09\x09\x09return null;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09return _p(\x27response\x27);\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09*/\x0a\x0a\x09\x09function _p(prop, value) {\x0a\x09\x09\x09if (!props.hasOwnProperty(prop)) {\x0a\x09\x09\x09\x09return;\x0a\x09\x09\x09}\x0a\x09\x09\x09if (arguments.length === 1) { // get\x0a\x09\x09\x09\x09return Env.can(\x27define_property\x27) ? props[prop] : self[prop];\x0a\x09\x09\x09} else { // set\x0a\x09\x09\x09\x09if (Env.can(\x27define_property\x27)) {\x0a\x09\x09\x09\x09\x09props[prop] = value;\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09self[prop] = value;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x09\x09\x0a\x09\x09/*\x0a\x09\x09function _toASCII(str, AllowUnassigned, UseSTD3ASCIIRules) {\x0a\x09\x09\x09// TODO: http://tools.ietf.org/html/rfc3490#section-4.1\x0a\x09\x09\x09return str.toLowerCase();\x0a\x09\x09}\x0a\x09\x09*/\x0a\x09\x09\x0a\x09\x09\x0a\x09\x09function _doXHR(data) {\x0a\x09\x09\x09var self = this;\x0a\x09\x09\x09\x0a\x09\x09\x09_start_time = new Date().getTime();\x0a\x0a\x09\x09\x09_xhr = new RuntimeTarget();\x0a\x0a\x09\x09\x09function loadEnd() {\x0a\x09\x09\x09\x09if (_xhr) { // it could have been destroyed by now\x0a\x09\x09\x09\x09\x09_xhr.destroy();\x0a\x09\x09\x09\x09\x09_xhr = null;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09self.dispatchEvent(\x27loadend\x27);\x0a\x09\x09\x09\x09self = null;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09function exec(runtime) {\x0a\x09\x09\x09\x09_xhr.bind(\x27LoadStart\x27, function(e) {\x0a\x09\x09\x09\x09\x09_p(\x27readyState\x27, XMLHttpRequest.LOADING);\x0a\x09\x09\x09\x09\x09self.dispatchEvent(\x27readystatechange\x27);\x0a\x0a\x09\x09\x09\x09\x09self.dispatchEvent(e);\x0a\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09if (_upload_events_flag) {\x0a\x09\x09\x09\x09\x09\x09self.upload.dispatchEvent(e);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09_xhr.bind(\x27Progress\x27, function(e) {\x0a\x09\x09\x09\x09\x09if (_p(\x27readyState\x27) !== XMLHttpRequest.LOADING) {\x0a\x09\x09\x09\x09\x09\x09_p(\x27readyState\x27, XMLHttpRequest.LOADING); // LoadStart unreliable (in Flash for example)\x0a\x09\x09\x09\x09\x09\x09self.dispatchEvent(\x27readystatechange\x27);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09self.dispatchEvent(e);\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09_xhr.bind(\x27UploadProgress\x27, function(e) {\x0a\x09\x09\x09\x09\x09if (_upload_events_flag) {\x0a\x09\x09\x09\x09\x09\x09self.upload.dispatchEvent({\x0a\x09\x09\x09\x09\x09\x09\x09type: \x27progress\x27,\x0a\x09\x09\x09\x09\x09\x09\x09lengthComputable: false,\x0a\x09\x09\x09\x09\x09\x09\x09total: e.total,\x0a\x09\x09\x09\x09\x09\x09\x09loaded: e.loaded\x0a\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09_xhr.bind(\x27Load\x27, function(e) {\x0a\x09\x09\x09\x09\x09_p(\x27readyState\x27, XMLHttpRequest.DONE);\x0a\x09\x09\x09\x09\x09_p(\x27status\x27, Number(runtime.exec.call(_xhr, \x27XMLHttpRequest\x27, \x27getStatus\x27) || 0));\x0a\x09\x09\x09\x09\x09_p(\x27statusText\x27, httpCode[_p(\x27status\x27)] || \x22\x22);\x0a\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09_p(\x27response\x27, runtime.exec.call(_xhr, \x27XMLHttpRequest\x27, \x27getResponse\x27, _p(\x27responseType\x27)));\x0a\x0a\x09\x09\x09\x09\x09if (!!~Basic.inArray(_p(\x27responseType\x27), [\x27text\x27, \x27\x27])) {\x0a\x09\x09\x09\x09\x09\x09_p(\x27responseText\x27, _p(\x27response\x27));\x0a\x09\x09\x09\x09\x09} else if (_p(\x27responseType\x27) === \x27document\x27) {\x0a\x09\x09\x09\x09\x09\x09_p(\x27responseXML\x27, _p(\x27response\x27));\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09_responseHeaders = runtime.exec.call(_xhr, \x27XMLHttpRequest\x27, \x27getAllResponseHeaders\x27);\x0a\x0a\x09\x09\x09\x09\x09self.dispatchEvent(\x27readystatechange\x27);\x0a\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09if (_p(\x27status\x27) \x3e 0) { // status 0 usually means that server is unreachable\x0a\x09\x09\x09\x09\x09\x09if (_upload_events_flag) {\x0a\x09\x09\x09\x09\x09\x09\x09self.upload.dispatchEvent(e);\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09self.dispatchEvent(e);\x0a\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09_error_flag = true;\x0a\x09\x09\x09\x09\x09\x09self.dispatchEvent(\x27error\x27);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09loadEnd();\x0a\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09_xhr.bind(\x27Abort\x27, function(e) {\x0a\x09\x09\x09\x09\x09self.dispatchEvent(e);\x0a\x09\x09\x09\x09\x09loadEnd();\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09_xhr.bind(\x27Error\x27, function(e) {\x0a\x09\x09\x09\x09\x09_error_flag = true;\x0a\x09\x09\x09\x09\x09_p(\x27readyState\x27, XMLHttpRequest.DONE);\x0a\x09\x09\x09\x09\x09self.dispatchEvent(\x27readystatechange\x27);\x0a\x09\x09\x09\x09\x09_upload_complete_flag = true;\x0a\x09\x09\x09\x09\x09self.dispatchEvent(e);\x0a\x09\x09\x09\x09\x09loadEnd();\x0a\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09runtime.exec.call(_xhr, \x27XMLHttpRequest\x27, \x27send\x27, {\x0a\x09\x09\x09\x09\x09url: _url,\x0a\x09\x09\x09\x09\x09method: _method,\x0a\x09\x09\x09\x09\x09async: _async,\x0a\x09\x09\x09\x09\x09user: _user,\x0a\x09\x09\x09\x09\x09password: _password,\x0a\x09\x09\x09\x09\x09headers: _headers,\x0a\x09\x09\x09\x09\x09mimeType: _mimeType,\x0a\x09\x09\x09\x09\x09encoding: _encoding,\x0a\x09\x09\x09\x09\x09responseType: self.responseType,\x0a\x09\x09\x09\x09\x09withCredentials: self.withCredentials,\x0a\x09\x09\x09\x09\x09options: _options\x0a\x09\x09\x09\x09}, data);\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09// clarify our requirements\x0a\x09\x09\x09if (typeof(_options.required_caps) === \x27string\x27) {\x0a\x09\x09\x09\x09_options.required_caps = Runtime.parseCaps(_options.required_caps);\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09_options.required_caps = Basic.extend({}, _options.required_caps, {\x0a\x09\x09\x09\x09return_response_type: self.responseType\x0a\x09\x09\x09});\x0a\x0a\x09\x09\x09if (data instanceof FormData) {\x0a\x09\x09\x09\x09_options.required_caps.send_multipart = true;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09if (!Basic.isEmptyObj(_headers)) {\x0a\x09\x09\x09\x09_options.required_caps.send_custom_headers = true;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09if (!_same_origin_flag) {\x0a\x09\x09\x09\x09_options.required_caps.do_cors = true;\x0a\x09\x09\x09}\x0a\x09\x09\x09\x0a\x0a\x09\x09\x09if (_options.ruid) { // we do not need to wait if we can connect directly\x0a\x09\x09\x09\x09exec(_xhr.connectRuntime(_options));\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09_xhr.bind(\x27RuntimeInit\x27, function(e, runtime) {\x0a\x09\x09\x09\x09\x09exec(runtime);\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09\x09_xhr.bind(\x27RuntimeError\x27, function(e, err) {\x0a\x09\x09\x09\x09\x09self.dispatchEvent(\x27RuntimeError\x27, err);\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09\x09_xhr.connectRuntime(_options);\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x09\x0a\x09\x09\x0a\x09\x09function _reset() {\x0a\x09\x09\x09_p(\x27responseText\x27, \x22\x22);\x0a\x09\x09\x09_p(\x27responseXML\x27, null);\x0a\x09\x09\x09_p(\x27response\x27, null);\x0a\x09\x09\x09_p(\x27status\x27, 0);\x0a\x09\x09\x09_p(\x27statusText\x27, \x22\x22);\x0a\x09\x09\x09_start_time = _timeoutset_time = null;\x0a\x09\x09}\x0a\x09}\x0a\x0a\x09XMLHttpRequest.UNSENT = 0;\x0a\x09XMLHttpRequest.OPENED = 1;\x0a\x09XMLHttpRequest.HEADERS_RECEIVED = 2;\x0a\x09XMLHttpRequest.LOADING = 3;\x0a\x09XMLHttpRequest.DONE = 4;\x0a\x09\x0a\x09XMLHttpRequest.prototype = EventTarget.instance;\x0a\x0a\x09return XMLHttpRequest;\x0a});\x0a\x0a// Included from: src/javascript/runtime/Transporter.js\x0a\x0a/**\x0a * Transporter.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x22moxie/runtime/Transporter\x22, [\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/core/utils/Encode\x22,\x0a\x09\x22moxie/runtime/RuntimeClient\x22,\x0a\x09\x22moxie/core/EventTarget\x22\x0a], function(Basic, Encode, RuntimeClient, EventTarget) {\x0a\x09function Transporter() {\x0a\x09\x09var mod, _runtime, _data, _size, _pos, _chunk_size;\x0a\x0a\x09\x09RuntimeClient.call(this);\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09uid: Basic.guid(\x27uid_\x27),\x0a\x0a\x09\x09\x09state: Transporter.IDLE,\x0a\x0a\x09\x09\x09result: null,\x0a\x0a\x09\x09\x09transport: function(data, type, options) {\x0a\x09\x09\x09\x09var self = this;\x0a\x0a\x09\x09\x09\x09options = Basic.extend({\x0a\x09\x09\x09\x09\x09chunk_size: 204798\x0a\x09\x09\x09\x09}, options);\x0a\x0a\x09\x09\x09\x09// should divide by three, base64 requires this\x0a\x09\x09\x09\x09if ((mod = options.chunk_size % 3)) {\x0a\x09\x09\x09\x09\x09options.chunk_size += 3 - mod;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09_chunk_size = options.chunk_size;\x0a\x0a\x09\x09\x09\x09_reset.call(this);\x0a\x09\x09\x09\x09_data = data;\x0a\x09\x09\x09\x09_size = data.length;\x0a\x0a\x09\x09\x09\x09if (Basic.typeOf(options) === \x27string\x27 || options.ruid) {\x0a\x09\x09\x09\x09\x09_run.call(self, type, this.connectRuntime(options));\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09// we require this to run only once\x0a\x09\x09\x09\x09\x09var cb = function(e, runtime) {\x0a\x09\x09\x09\x09\x09\x09self.unbind(\x22RuntimeInit\x22, cb);\x0a\x09\x09\x09\x09\x09\x09_run.call(self, type, runtime);\x0a\x09\x09\x09\x09\x09};\x0a\x09\x09\x09\x09\x09this.bind(\x22RuntimeInit\x22, cb);\x0a\x09\x09\x09\x09\x09this.connectRuntime(options);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09abort: function() {\x0a\x09\x09\x09\x09var self = this;\x0a\x0a\x09\x09\x09\x09self.state = Transporter.IDLE;\x0a\x09\x09\x09\x09if (_runtime) {\x0a\x09\x09\x09\x09\x09_runtime.exec.call(self, \x27Transporter\x27, \x27clear\x27);\x0a\x09\x09\x09\x09\x09self.trigger(\x22TransportingAborted\x22);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09_reset.call(self);\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09destroy: function() {\x0a\x09\x09\x09\x09this.unbindAll();\x0a\x09\x09\x09\x09_runtime = null;\x0a\x09\x09\x09\x09this.disconnectRuntime();\x0a\x09\x09\x09\x09_reset.call(this);\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09function _reset() {\x0a\x09\x09\x09_size = _pos = 0;\x0a\x09\x09\x09_data = this.result = null;\x0a\x09\x09}\x0a\x0a\x09\x09function _run(type, runtime) {\x0a\x09\x09\x09var self = this;\x0a\x0a\x09\x09\x09_runtime = runtime;\x0a\x0a\x09\x09\x09//self.unbind(\x22RuntimeInit\x22);\x0a\x0a\x09\x09\x09self.bind(\x22TransportingProgress\x22, function(e) {\x0a\x09\x09\x09\x09_pos = e.loaded;\x0a\x0a\x09\x09\x09\x09if (_pos \x3c _size && Basic.inArray(self.state, [Transporter.IDLE, Transporter.DONE]) === -1) {\x0a\x09\x09\x09\x09\x09_transport.call(self);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}, 999);\x0a\x0a\x09\x09\x09self.bind(\x22TransportingComplete\x22, function() {\x0a\x09\x09\x09\x09_pos = _size;\x0a\x09\x09\x09\x09self.state = Transporter.DONE;\x0a\x09\x09\x09\x09_data = null; // clean a bit\x0a\x09\x09\x09\x09self.result = _runtime.exec.call(self, \x27Transporter\x27, \x27getAsBlob\x27, type || \x27\x27);\x0a\x09\x09\x09}, 999);\x0a\x0a\x09\x09\x09self.state = Transporter.BUSY;\x0a\x09\x09\x09self.trigger(\x22TransportingStarted\x22);\x0a\x09\x09\x09_transport.call(self);\x0a\x09\x09}\x0a\x0a\x09\x09function _transport() {\x0a\x09\x09\x09var self = this,\x0a\x09\x09\x09\x09chunk,\x0a\x09\x09\x09\x09bytesLeft = _size - _pos;\x0a\x0a\x09\x09\x09if (_chunk_size \x3e bytesLeft) {\x0a\x09\x09\x09\x09_chunk_size = bytesLeft;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09chunk = Encode.btoa(_data.substr(_pos, _chunk_size));\x0a\x09\x09\x09_runtime.exec.call(self, \x27Transporter\x27, \x27receive\x27, chunk, _size);\x0a\x09\x09}\x0a\x09}\x0a\x0a\x09Transporter.IDLE = 0;\x0a\x09Transporter.BUSY = 1;\x0a\x09Transporter.DONE = 2;\x0a\x0a\x09Transporter.prototype = EventTarget.instance;\x0a\x0a\x09return Transporter;\x0a});\x0a\x0a// Included from: src/javascript/image/Image.js\x0a\x0a/**\x0a * Image.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x22moxie/image/Image\x22, [\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/core/utils/Dom\x22,\x0a\x09\x22moxie/core/Exceptions\x22,\x0a\x09\x22moxie/file/FileReaderSync\x22,\x0a\x09\x22moxie/xhr/XMLHttpRequest\x22,\x0a\x09\x22moxie/runtime/Runtime\x22,\x0a\x09\x22moxie/runtime/RuntimeClient\x22,\x0a\x09\x22moxie/runtime/Transporter\x22,\x0a\x09\x22moxie/core/utils/Env\x22,\x0a\x09\x22moxie/core/EventTarget\x22,\x0a\x09\x22moxie/file/Blob\x22,\x0a\x09\x22moxie/file/File\x22,\x0a\x09\x22moxie/core/utils/Encode\x22\x0a], function(Basic, Dom, x, FileReaderSync, XMLHttpRequest, Runtime, RuntimeClient, Transporter, Env, EventTarget, Blob, File, Encode) {\x0a\x09/**\x0a\x09Image preloading and manipulation utility. Additionally it provides access to image meta info (Exif, GPS) and raw binary data.\x0a\x0a\x09@class Image\x0a\x09@constructor\x0a\x09@extends EventTarget\x0a\x09*/\x0a\x09var dispatches = [\x0a\x09\x09\x27progress\x27,\x0a\x0a\x09\x09/**\x0a\x09\x09Dispatched when loading is complete.\x0a\x0a\x09\x09@event load\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27load\x27,\x0a\x0a\x09\x09\x27error\x27,\x0a\x0a\x09\x09/**\x0a\x09\x09Dispatched when resize operation is complete.\x0a\x09\x09\x0a\x09\x09@event resize\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27resize\x27,\x0a\x0a\x09\x09/**\x0a\x09\x09Dispatched when visual representation of the image is successfully embedded\x0a\x09\x09into the corresponsing container.\x0a\x0a\x09\x09@event embedded\x0a\x09\x09@param {Object} event\x0a\x09\x09*/\x0a\x09\x09\x27embedded\x27\x0a\x09];\x0a\x0a\x09function Image() {\x0a\x0a\x09\x09RuntimeClient.call(this);\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09/**\x0a\x09\x09\x09Unique id of the component\x0a\x0a\x09\x09\x09@property uid\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09*/\x0a\x09\x09\x09uid: Basic.guid(\x27uid_\x27),\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Unique id of the connected runtime, if any.\x0a\x0a\x09\x09\x09@property ruid\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09*/\x0a\x09\x09\x09ruid: null,\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Name of the file, that was used to create an image, if available. If not equals to empty string.\x0a\x0a\x09\x09\x09@property name\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09@default \x22\x22\x0a\x09\x09\x09*/\x0a\x09\x09\x09name: \x22\x22,\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Size of the image in bytes. Actual value is set only after image is preloaded.\x0a\x0a\x09\x09\x09@property size\x0a\x09\x09\x09@type {Number}\x0a\x09\x09\x09@default 0\x0a\x09\x09\x09*/\x0a\x09\x09\x09size: 0,\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Width of the image. Actual value is set only after image is preloaded.\x0a\x0a\x09\x09\x09@property width\x0a\x09\x09\x09@type {Number}\x0a\x09\x09\x09@default 0\x0a\x09\x09\x09*/\x0a\x09\x09\x09width: 0,\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Height of the image. Actual value is set only after image is preloaded.\x0a\x0a\x09\x09\x09@property height\x0a\x09\x09\x09@type {Number}\x0a\x09\x09\x09@default 0\x0a\x09\x09\x09*/\x0a\x09\x09\x09height: 0,\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Mime type of the image. Currently only image/jpeg and image/png are supported. Actual value is set only after image is preloaded.\x0a\x0a\x09\x09\x09@property type\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09@default \x22\x22\x0a\x09\x09\x09*/\x0a\x09\x09\x09type: \x22\x22,\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Holds meta info (Exif, GPS). Is populated only for image/jpeg. Actual value is set only after image is preloaded.\x0a\x0a\x09\x09\x09@property meta\x0a\x09\x09\x09@type {Object}\x0a\x09\x09\x09@default {}\x0a\x09\x09\x09*/\x0a\x09\x09\x09meta: {},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Alias for load method, that takes another mOxie.Image object as a source (see load).\x0a\x0a\x09\x09\x09@method clone\x0a\x09\x09\x09@param {Image} src Source for the image\x0a\x09\x09\x09@param {Boolean} [exact=false] Whether to activate in-depth clone mode\x0a\x09\x09\x09*/\x0a\x09\x09\x09clone: function() {\x0a\x09\x09\x09\x09this.load.apply(this, arguments);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Loads image from various sources. Currently the source for new image can be: mOxie.Image, mOxie.Blob/mOxie.File, \x0a\x09\x09\x09native Blob/File, dataUrl or URL. Depending on the type of the source, arguments - differ. When source is URL, \x0a\x09\x09\x09Image will be downloaded from remote destination and loaded in memory.\x0a\x0a\x09\x09\x09@example\x0a\x09\x09\x09\x09var img = new mOxie.Image();\x0a\x09\x09\x09\x09img.onload = function() {\x0a\x09\x09\x09\x09\x09var blob = img.getAsBlob();\x0a\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09var formData = new mOxie.FormData();\x0a\x09\x09\x09\x09\x09formData.append(\x27file\x27, blob);\x0a\x0a\x09\x09\x09\x09\x09var xhr = new mOxie.XMLHttpRequest();\x0a\x09\x09\x09\x09\x09xhr.onload = function() {\x0a\x09\x09\x09\x09\x09\x09// upload complete\x0a\x09\x09\x09\x09\x09};\x0a\x09\x09\x09\x09\x09xhr.open(\x27post\x27, \x27upload.php\x27);\x0a\x09\x09\x09\x09\x09xhr.send(formData);\x0a\x09\x09\x09\x09};\x0a\x09\x09\x09\x09img.load(\x22http://www.moxiecode.com/images/mox-logo.jpg\x22); // notice file extension (.jpg)\x0a\x09\x09\x09\x0a\x0a\x09\x09\x09@method load\x0a\x09\x09\x09@param {Image|Blob|File|String} src Source for the image\x0a\x09\x09\x09@param {Boolean|Object} [mixed]\x0a\x09\x09\x09*/\x0a\x09\x09\x09load: function() {\x0a\x09\x09\x09\x09_load.apply(this, arguments);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Downsizes the image to fit the specified width/height. If crop is supplied, image will be cropped to exact dimensions.\x0a\x0a\x09\x09\x09@method downsize\x0a\x09\x09\x09@param {Object} opts\x0a\x09\x09\x09\x09@param {Number} opts.width Resulting width\x0a\x09\x09\x09\x09@param {Number} [opts.height=width] Resulting height (optional, if not supplied will default to width)\x0a\x09\x09\x09\x09@param {Boolean} [opts.crop=false] Whether to crop the image to exact dimensions\x0a\x09\x09\x09\x09@param {Boolean} [opts.preserveHeaders=true] Whether to preserve meta headers (on JPEGs after resize)\x0a\x09\x09\x09\x09@param {String} [opts.resample=false] Resampling algorithm to use for resizing\x0a\x09\x09\x09*/\x0a\x09\x09\x09downsize: function(opts) {\x0a\x09\x09\x09\x09var defaults = {\x0a\x09\x09\x09\x09\x09width: this.width,\x0a\x09\x09\x09\x09\x09height: this.height,\x0a\x09\x09\x09\x09\x09type: this.type || \x27image/jpeg\x27,\x0a\x09\x09\x09\x09\x09quality: 90,\x0a\x09\x09\x09\x09\x09crop: false,\x0a\x09\x09\x09\x09\x09preserveHeaders: true,\x0a\x09\x09\x09\x09\x09resample: false\x0a\x09\x09\x09\x09};\x0a\x0a\x09\x09\x09\x09if (typeof(opts) === \x27object\x27) {\x0a\x09\x09\x09\x09\x09opts = Basic.extend(defaults, opts);\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09// for backward compatibility\x0a\x09\x09\x09\x09\x09opts = Basic.extend(defaults, {\x0a\x09\x09\x09\x09\x09\x09width: arguments[0],\x0a\x09\x09\x09\x09\x09\x09height: arguments[1],\x0a\x09\x09\x09\x09\x09\x09crop: arguments[2],\x0a\x09\x09\x09\x09\x09\x09preserveHeaders: arguments[3]\x0a\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09if (!this.size) { // only preloaded image objects can be used as source\x0a\x09\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09// no way to reliably intercept the crash due to high resolution, so we simply avoid it\x0a\x09\x09\x09\x09\x09if (this.width \x3e Image.MAX_RESIZE_WIDTH || this.height \x3e Image.MAX_RESIZE_HEIGHT) {\x0a\x09\x09\x09\x09\x09\x09throw new x.ImageError(x.ImageError.MAX_RESOLUTION_ERR);\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09this.exec(\x27Image\x27, \x27downsize\x27, opts.width, opts.height, opts.crop, opts.preserveHeaders);\x0a\x09\x09\x09\x09} catch(ex) {\x0a\x09\x09\x09\x09\x09// for now simply trigger error event\x0a\x09\x09\x09\x09\x09this.trigger(\x27error\x27, ex.code);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Alias for downsize(width, height, true). (see downsize)\x0a\x09\x09\x09\x0a\x09\x09\x09@method crop\x0a\x09\x09\x09@param {Number} width Resulting width\x0a\x09\x09\x09@param {Number} [height=width] Resulting height (optional, if not supplied will default to width)\x0a\x09\x09\x09@param {Boolean} [preserveHeaders=true] Whether to preserve meta headers (on JPEGs after resize)\x0a\x09\x09\x09*/\x0a\x09\x09\x09crop: function(width, height, preserveHeaders) {\x0a\x09\x09\x09\x09this.downsize(width, height, true, preserveHeaders);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09getAsCanvas: function() {\x0a\x09\x09\x09\x09if (!Env.can(\x27create_canvas\x27)) {\x0a\x09\x09\x09\x09\x09throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09var runtime = this.connectRuntime(this.ruid);\x0a\x09\x09\x09\x09return runtime.exec.call(this, \x27Image\x27, \x27getAsCanvas\x27);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Retrieves image in it\x27s current state as mOxie.Blob object. Cannot be run on empty or image in progress (throws\x0a\x09\x09\x09DOMException.INVALID_STATE_ERR).\x0a\x0a\x09\x09\x09@method getAsBlob\x0a\x09\x09\x09@param {String} [type=\x22image/jpeg\x22] Mime type of resulting blob. Can either be image/jpeg or image/png\x0a\x09\x09\x09@param {Number} [quality=90] Applicable only together with mime type image/jpeg\x0a\x09\x09\x09@return {Blob} Image as Blob\x0a\x09\x09\x09*/\x0a\x09\x09\x09getAsBlob: function(type, quality) {\x0a\x09\x09\x09\x09if (!this.size) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09return this.exec(\x27Image\x27, \x27getAsBlob\x27, type || \x27image/jpeg\x27, quality || 90);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Retrieves image in it\x27s current state as dataURL string. Cannot be run on empty or image in progress (throws\x0a\x09\x09\x09DOMException.INVALID_STATE_ERR).\x0a\x0a\x09\x09\x09@method getAsDataURL\x0a\x09\x09\x09@param {String} [type=\x22image/jpeg\x22] Mime type of resulting blob. Can either be image/jpeg or image/png\x0a\x09\x09\x09@param {Number} [quality=90] Applicable only together with mime type image/jpeg\x0a\x09\x09\x09@return {String} Image as dataURL string\x0a\x09\x09\x09*/\x0a\x09\x09\x09getAsDataURL: function(type, quality) {\x0a\x09\x09\x09\x09if (!this.size) {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09return this.exec(\x27Image\x27, \x27getAsDataURL\x27, type || \x27image/jpeg\x27, quality || 90);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Retrieves image in it\x27s current state as binary string. Cannot be run on empty or image in progress (throws\x0a\x09\x09\x09DOMException.INVALID_STATE_ERR).\x0a\x0a\x09\x09\x09@method getAsBinaryString\x0a\x09\x09\x09@param {String} [type=\x22image/jpeg\x22] Mime type of resulting blob. Can either be image/jpeg or image/png\x0a\x09\x09\x09@param {Number} [quality=90] Applicable only together with mime type image/jpeg\x0a\x09\x09\x09@return {String} Image as binary string\x0a\x09\x09\x09*/\x0a\x09\x09\x09getAsBinaryString: function(type, quality) {\x0a\x09\x09\x09\x09var dataUrl = this.getAsDataURL(type, quality);\x0a\x09\x09\x09\x09return Encode.atob(dataUrl.substring(dataUrl.indexOf(\x27base64,\x27) + 7));\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Embeds a visual representation of the image into the specified node. Depending on the runtime, \x0a\x09\x09\x09it might be a canvas, an img node or a thrid party shim object (Flash or SilverLight - very rare, \x0a\x09\x09\x09can be used in legacy browsers that do not have canvas or proper dataURI support).\x0a\x0a\x09\x09\x09@method embed\x0a\x09\x09\x09@param {DOMElement} el DOM element to insert the image object into\x0a\x09\x09\x09@param {Object} [opts]\x0a\x09\x09\x09\x09@param {Number} [opts.width] The width of an embed (defaults to the image width)\x0a\x09\x09\x09\x09@param {Number} [opts.height] The height of an embed (defaults to the image height)\x0a\x09\x09\x09\x09@param {String} [type=\x22image/jpeg\x22] Mime type\x0a\x09\x09\x09\x09@param {Number} [quality=90] Quality of an embed, if mime type is image/jpeg\x0a\x09\x09\x09\x09@param {Boolean} [crop=false] Whether to crop an embed to the specified dimensions\x0a\x09\x09\x09*/\x0a\x09\x09\x09embed: function(el, opts) {\x0a\x09\x09\x09\x09var self = this\x0a\x09\x09\x09\x09, runtime // this has to be outside of all the closures to contain proper runtime\x0a\x09\x09\x09\x09;\x0a\x0a\x09\x09\x09\x09opts = Basic.extend({\x0a\x09\x09\x09\x09\x09width: this.width,\x0a\x09\x09\x09\x09\x09height: this.height,\x0a\x09\x09\x09\x09\x09type: this.type || \x27image/jpeg\x27,\x0a\x09\x09\x09\x09\x09quality: 90\x0a\x09\x09\x09\x09}, opts || {});\x0a\x09\x09\x09\x09\x0a\x0a\x09\x09\x09\x09function render(type, quality) {\x0a\x09\x09\x09\x09\x09var img = this;\x0a\x0a\x09\x09\x09\x09\x09// if possible, embed a canvas element directly\x0a\x09\x09\x09\x09\x09if (Env.can(\x27create_canvas\x27)) {\x0a\x09\x09\x09\x09\x09\x09var canvas = img.getAsCanvas();\x0a\x09\x09\x09\x09\x09\x09if (canvas) {\x0a\x09\x09\x09\x09\x09\x09\x09el.appendChild(canvas);\x0a\x09\x09\x09\x09\x09\x09\x09canvas = null;\x0a\x09\x09\x09\x09\x09\x09\x09img.destroy();\x0a\x09\x09\x09\x09\x09\x09\x09self.trigger(\x27embedded\x27);\x0a\x09\x09\x09\x09\x09\x09\x09return;\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09var dataUrl = img.getAsDataURL(type, quality);\x0a\x09\x09\x09\x09\x09if (!dataUrl) {\x0a\x09\x09\x09\x09\x09\x09throw new x.ImageError(x.ImageError.WRONG_FORMAT);\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09if (Env.can(\x27use_data_uri_of\x27, dataUrl.length)) {\x0a\x09\x09\x09\x09\x09\x09el.innerHTML = \x27\x3cimg src=\x22\x27 + dataUrl + \x27\x22 width=\x22\x27 + img.width + \x27\x22 height=\x22\x27 + img.height + \x27\x22 /\x3e\x27;\x0a\x09\x09\x09\x09\x09\x09img.destroy();\x0a\x09\x09\x09\x09\x09\x09self.trigger(\x27embedded\x27);\x0a\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09var tr = new Transporter();\x0a\x0a\x09\x09\x09\x09\x09\x09tr.bind(\x22TransportingComplete\x22, function() {\x0a\x09\x09\x09\x09\x09\x09\x09runtime = self.connectRuntime(this.result.ruid);\x0a\x0a\x09\x09\x09\x09\x09\x09\x09self.bind(\x22Embedded\x22, function() {\x0a\x09\x09\x09\x09\x09\x09\x09\x09// position and size properly\x0a\x09\x09\x09\x09\x09\x09\x09\x09Basic.extend(runtime.getShimContainer().style, {\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09//position: \x27relative\x27,\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09top: \x270px\x27,\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09left: \x270px\x27,\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09width: img.width + \x27px\x27,\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09height: img.height + \x27px\x27\x0a\x09\x09\x09\x09\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09\x09\x09\x09\x09// some shims (Flash/SilverLight) reinitialize, if parent element is hidden, reordered or it\x27s\x0a\x09\x09\x09\x09\x09\x09\x09\x09// position type changes (in Gecko), but since we basically need this only in IEs 6/7 and\x0a\x09\x09\x09\x09\x09\x09\x09\x09// sometimes 8 and they do not have this problem, we can comment this for now\x0a\x09\x09\x09\x09\x09\x09\x09\x09/*tr.bind(\x22RuntimeInit\x22, function(e, runtime) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09tr.destroy();\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09runtime.destroy();\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09onResize.call(self); // re-feed our image data\x0a\x09\x09\x09\x09\x09\x09\x09\x09});*/\x0a\x0a\x09\x09\x09\x09\x09\x09\x09\x09runtime = null; // release\x0a\x09\x09\x09\x09\x09\x09\x09}, 999);\x0a\x0a\x09\x09\x09\x09\x09\x09\x09runtime.exec.call(self, \x22ImageView\x22, \x22display\x22, this.result.uid, width, height);\x0a\x09\x09\x09\x09\x09\x09\x09img.destroy();\x0a\x09\x09\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09\x09\x09tr.transport(Encode.atob(dataUrl.substring(dataUrl.indexOf(\x27base64,\x27) + 7)), type, {\x0a\x09\x09\x09\x09\x09\x09\x09required_caps: {\x0a\x09\x09\x09\x09\x09\x09\x09\x09display_media: true\x0a\x09\x09\x09\x09\x09\x09\x09},\x0a\x09\x09\x09\x09\x09\x09\x09runtime_order: \x27flash,silverlight\x27,\x0a\x09\x09\x09\x09\x09\x09\x09container: el\x0a\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09if (!(el = Dom.get(el))) {\x0a\x09\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_NODE_TYPE_ERR);\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09if (!this.size) { // only preloaded image objects can be used as source\x0a\x09\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09// high-resolution images cannot be consistently handled across the runtimes\x0a\x09\x09\x09\x09\x09if (this.width \x3e Image.MAX_RESIZE_WIDTH || this.height \x3e Image.MAX_RESIZE_HEIGHT) {\x0a\x09\x09\x09\x09\x09\x09//throw new x.ImageError(x.ImageError.MAX_RESOLUTION_ERR);\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09var imgCopy = new Image();\x0a\x0a\x09\x09\x09\x09\x09imgCopy.bind(\x22Resize\x22, function() {\x0a\x09\x09\x09\x09\x09\x09render.call(this, opts.type, opts.quality);\x0a\x09\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09\x09imgCopy.bind(\x22Load\x22, function() {\x0a\x09\x09\x09\x09\x09\x09imgCopy.downsize(opts);\x0a\x09\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09\x09// if embedded thumb data is available and dimensions are big enough, use it\x0a\x09\x09\x09\x09\x09if (this.meta.thumb && this.meta.thumb.width \x3e= opts.width && this.meta.thumb.height \x3e= opts.height) {\x0a\x09\x09\x09\x09\x09\x09imgCopy.load(this.meta.thumb.data);\x0a\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09imgCopy.clone(this, false);\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09return imgCopy;\x0a\x09\x09\x09\x09} catch(ex) {\x0a\x09\x09\x09\x09\x09// for now simply trigger error event\x0a\x09\x09\x09\x09\x09this.trigger(\x27error\x27, ex.code);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Properly destroys the image and frees resources in use. If any. Recommended way to dispose mOxie.Image object.\x0a\x0a\x09\x09\x09@method destroy\x0a\x09\x09\x09*/\x0a\x09\x09\x09destroy: function() {\x0a\x09\x09\x09\x09if (this.ruid) {\x0a\x09\x09\x09\x09\x09this.getRuntime().exec.call(this, \x27Image\x27, \x27destroy\x27);\x0a\x09\x09\x09\x09\x09this.disconnectRuntime();\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09this.unbindAll();\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x0a\x09\x09// this is here, because in order to bind properly, we need uid, which is created above\x0a\x09\x09this.handleEventProps(dispatches);\x0a\x0a\x09\x09this.bind(\x27Load Resize\x27, function() {\x0a\x09\x09\x09_updateInfo.call(this);\x0a\x09\x09}, 999);\x0a\x0a\x0a\x09\x09function _updateInfo(info) {\x0a\x09\x09\x09if (!info) {\x0a\x09\x09\x09\x09info = this.exec(\x27Image\x27, \x27getInfo\x27);\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09this.size = info.size;\x0a\x09\x09\x09this.width = info.width;\x0a\x09\x09\x09this.height = info.height;\x0a\x09\x09\x09this.type = info.type;\x0a\x09\x09\x09this.meta = info.meta;\x0a\x0a\x09\x09\x09// update file name, only if empty\x0a\x09\x09\x09if (this.name === \x27\x27) {\x0a\x09\x09\x09\x09this.name = info.name;\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x09\x09\x0a\x0a\x09\x09function _load(src) {\x0a\x09\x09\x09var srcType = Basic.typeOf(src);\x0a\x0a\x09\x09\x09try {\x0a\x09\x09\x09\x09// if source is Image\x0a\x09\x09\x09\x09if (src instanceof Image) {\x0a\x09\x09\x09\x09\x09if (!src.size) { // only preloaded image objects can be used as source\x0a\x09\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09_loadFromImage.apply(this, arguments);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09// if source is o.Blob/o.File\x0a\x09\x09\x09\x09else if (src instanceof Blob) {\x0a\x09\x09\x09\x09\x09if (!~Basic.inArray(src.type, [\x27image/jpeg\x27, \x27image/png\x27])) {\x0a\x09\x09\x09\x09\x09\x09throw new x.ImageError(x.ImageError.WRONG_FORMAT);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09_loadFromBlob.apply(this, arguments);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09// if native blob/file\x0a\x09\x09\x09\x09else if (Basic.inArray(srcType, [\x27blob\x27, \x27file\x27]) !== -1) {\x0a\x09\x09\x09\x09\x09_load.call(this, new File(null, src), arguments[1]);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09// if String\x0a\x09\x09\x09\x09else if (srcType === \x27string\x27) {\x0a\x09\x09\x09\x09\x09// if dataUrl String\x0a\x09\x09\x09\x09\x09if (src.substr(0, 5) === \x27data:\x27) {\x0a\x09\x09\x09\x09\x09\x09_load.call(this, new Blob(null, { data: src }), arguments[1]);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09// else assume Url, either relative or absolute\x0a\x09\x09\x09\x09\x09else {\x0a\x09\x09\x09\x09\x09\x09_loadFromUrl.apply(this, arguments);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09// if source seems to be an img node\x0a\x09\x09\x09\x09else if (srcType === \x27node\x27 && src.nodeName.toLowerCase() === \x27img\x27) {\x0a\x09\x09\x09\x09\x09_load.call(this, src.src, arguments[1]);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09else {\x0a\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.TYPE_MISMATCH_ERR);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09} catch(ex) {\x0a\x09\x09\x09\x09// for now simply trigger error event\x0a\x09\x09\x09\x09this.trigger(\x27error\x27, ex.code);\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _loadFromImage(img, exact) {\x0a\x09\x09\x09var runtime = this.connectRuntime(img.ruid);\x0a\x09\x09\x09this.ruid = runtime.uid;\x0a\x09\x09\x09runtime.exec.call(this, \x27Image\x27, \x27loadFromImage\x27, img, (Basic.typeOf(exact) === \x27undefined\x27 ? true : exact));\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _loadFromBlob(blob, options) {\x0a\x09\x09\x09var self = this;\x0a\x0a\x09\x09\x09self.name = blob.name || \x27\x27;\x0a\x0a\x09\x09\x09function exec(runtime) {\x0a\x09\x09\x09\x09self.ruid = runtime.uid;\x0a\x09\x09\x09\x09runtime.exec.call(self, \x27Image\x27, \x27loadFromBlob\x27, blob);\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09if (blob.isDetached()) {\x0a\x09\x09\x09\x09this.bind(\x27RuntimeInit\x27, function(e, runtime) {\x0a\x09\x09\x09\x09\x09exec(runtime);\x0a\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09// convert to object representation\x0a\x09\x09\x09\x09if (options && typeof(options.required_caps) === \x27string\x27) {\x0a\x09\x09\x09\x09\x09options.required_caps = Runtime.parseCaps(options.required_caps);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09this.connectRuntime(Basic.extend({\x0a\x09\x09\x09\x09\x09required_caps: {\x0a\x09\x09\x09\x09\x09\x09access_image_binary: true,\x0a\x09\x09\x09\x09\x09\x09resize_image: true\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}, options));\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09exec(this.connectRuntime(blob.ruid));\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _loadFromUrl(url, options) {\x0a\x09\x09\x09var self = this, xhr;\x0a\x0a\x09\x09\x09xhr = new XMLHttpRequest();\x0a\x0a\x09\x09\x09xhr.open(\x27get\x27, url);\x0a\x09\x09\x09xhr.responseType = \x27blob\x27;\x0a\x0a\x09\x09\x09xhr.onprogress = function(e) {\x0a\x09\x09\x09\x09self.trigger(e);\x0a\x09\x09\x09};\x0a\x0a\x09\x09\x09xhr.onload = function() {\x0a\x09\x09\x09\x09_loadFromBlob.call(self, xhr.response, true);\x0a\x09\x09\x09};\x0a\x0a\x09\x09\x09xhr.onerror = function(e) {\x0a\x09\x09\x09\x09self.trigger(e);\x0a\x09\x09\x09};\x0a\x0a\x09\x09\x09xhr.onloadend = function() {\x0a\x09\x09\x09\x09xhr.destroy();\x0a\x09\x09\x09};\x0a\x0a\x09\x09\x09xhr.bind(\x27RuntimeError\x27, function(e, err) {\x0a\x09\x09\x09\x09self.trigger(\x27RuntimeError\x27, err);\x0a\x09\x09\x09});\x0a\x0a\x09\x09\x09xhr.send(null, options);\x0a\x09\x09}\x0a\x09}\x0a\x0a\x09// virtual world will crash on you if image has a resolution higher than this:\x0a\x09Image.MAX_RESIZE_WIDTH = 8192;\x0a\x09Image.MAX_RESIZE_HEIGHT = 8192; \x0a\x0a\x09Image.prototype = EventTarget.instance;\x0a\x0a\x09return Image;\x0a});\x0a\x0a// Included from: src/javascript/runtime/html5/Runtime.js\x0a\x0a/**\x0a * Runtime.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/*global File:true */\x0a\x0a/**\x0aDefines constructor for HTML5 runtime.\x0a\x0a@class moxie/runtime/html5/Runtime\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html5/Runtime\x22, [\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/core/Exceptions\x22,\x0a\x09\x22moxie/runtime/Runtime\x22,\x0a\x09\x22moxie/core/utils/Env\x22\x0a], function(Basic, x, Runtime, Env) {\x0a\x09\x0a\x09var type = \x22html5\x22, extensions = {};\x0a\x09\x0a\x09function Html5Runtime(options) {\x0a\x09\x09var I = this\x0a\x09\x09, Test = Runtime.capTest\x0a\x09\x09, True = Runtime.capTrue\x0a\x09\x09;\x0a\x0a\x09\x09var caps = Basic.extend({\x0a\x09\x09\x09\x09access_binary: Test(window.FileReader || window.File && window.File.getAsDataURL),\x0a\x09\x09\x09\x09access_image_binary: function() {\x0a\x09\x09\x09\x09\x09return I.can(\x27access_binary\x27) && !!extensions.Image;\x0a\x09\x09\x09\x09},\x0a\x09\x09\x09\x09display_media: Test(Env.can(\x27create_canvas\x27) || Env.can(\x27use_data_uri_over32kb\x27)),\x0a\x09\x09\x09\x09do_cors: Test(window.XMLHttpRequest && \x27withCredentials\x27 in new XMLHttpRequest()),\x0a\x09\x09\x09\x09drag_and_drop: Test(function() {\x0a\x09\x09\x09\x09\x09// this comes directly from Modernizr: http://www.modernizr.com/\x0a\x09\x09\x09\x09\x09var div = document.createElement(\x27div\x27);\x0a\x09\x09\x09\x09\x09// IE has support for drag and drop since version 5, but doesn\x27t support dropping files from desktop\x0a\x09\x09\x09\x09\x09return ((\x27draggable\x27 in div) || (\x27ondragstart\x27 in div && \x27ondrop\x27 in div)) && \x0a\x09\x09\x09\x09\x09\x09(Env.browser !== \x27IE\x27 || Env.verComp(Env.version, 9, \x27\x3e\x27));\x0a\x09\x09\x09\x09}()),\x0a\x09\x09\x09\x09filter_by_extension: Test(function() { // if you know how to feature-detect this, please suggest\x0a\x09\x09\x09\x09\x09return (Env.browser === \x27Chrome\x27 && Env.verComp(Env.version, 28, \x27\x3e=\x27)) || \x0a\x09\x09\x09\x09\x09\x09(Env.browser === \x27IE\x27 && Env.verComp(Env.version, 10, \x27\x3e=\x27)) || \x0a\x09\x09\x09\x09\x09\x09(Env.browser === \x27Safari\x27 && Env.verComp(Env.version, 7, \x27\x3e=\x27));\x0a\x09\x09\x09\x09}()),\x0a\x09\x09\x09\x09return_response_headers: True,\x0a\x09\x09\x09\x09return_response_type: function(responseType) {\x0a\x09\x09\x09\x09\x09if (responseType === \x27json\x27 && !!window.JSON) { // we can fake this one even if it\x27s not supported\x0a\x09\x09\x09\x09\x09\x09return true;\x0a\x09\x09\x09\x09\x09} \x0a\x09\x09\x09\x09\x09return Env.can(\x27return_response_type\x27, responseType);\x0a\x09\x09\x09\x09},\x0a\x09\x09\x09\x09return_status_code: True,\x0a\x09\x09\x09\x09report_upload_progress: Test(window.XMLHttpRequest && new XMLHttpRequest().upload),\x0a\x09\x09\x09\x09resize_image: function() {\x0a\x09\x09\x09\x09\x09return I.can(\x27access_binary\x27) && Env.can(\x27create_canvas\x27);\x0a\x09\x09\x09\x09},\x0a\x09\x09\x09\x09select_file: function() {\x0a\x09\x09\x09\x09\x09return Env.can(\x27use_fileinput\x27) && window.File;\x0a\x09\x09\x09\x09},\x0a\x09\x09\x09\x09select_folder: function() {\x0a\x09\x09\x09\x09\x09return I.can(\x27select_file\x27) && Env.browser === \x27Chrome\x27 && Env.verComp(Env.version, 21, \x27\x3e=\x27);\x0a\x09\x09\x09\x09},\x0a\x09\x09\x09\x09select_multiple: function() {\x0a\x09\x09\x09\x09\x09// it is buggy on Safari Windows and iOS\x0a\x09\x09\x09\x09\x09return I.can(\x27select_file\x27) &&\x0a\x09\x09\x09\x09\x09\x09!(Env.browser === \x27Safari\x27 && Env.os === \x27Windows\x27) &&\x0a\x09\x09\x09\x09\x09\x09!(Env.os === \x27iOS\x27 && Env.verComp(Env.osVersion, \x227.0.0\x22, \x27\x3e\x27) && Env.verComp(Env.osVersion, \x228.0.0\x22, \x27\x3c\x27));\x0a\x09\x09\x09\x09},\x0a\x09\x09\x09\x09send_binary_string: Test(window.XMLHttpRequest && (new XMLHttpRequest().sendAsBinary || (window.Uint8Array && window.ArrayBuffer))),\x0a\x09\x09\x09\x09send_custom_headers: Test(window.XMLHttpRequest),\x0a\x09\x09\x09\x09send_multipart: function() {\x0a\x09\x09\x09\x09\x09return !!(window.XMLHttpRequest && new XMLHttpRequest().upload && window.FormData) || I.can(\x27send_binary_string\x27);\x0a\x09\x09\x09\x09},\x0a\x09\x09\x09\x09slice_blob: Test(window.File && (File.prototype.mozSlice || File.prototype.webkitSlice || File.prototype.slice)),\x0a\x09\x09\x09\x09stream_upload: function(){\x0a\x09\x09\x09\x09\x09return I.can(\x27slice_blob\x27) && I.can(\x27send_multipart\x27);\x0a\x09\x09\x09\x09},\x0a\x09\x09\x09\x09summon_file_dialog: function() { // yeah... some dirty sniffing here...\x0a\x09\x09\x09\x09\x09return I.can(\x27select_file\x27) && (\x0a\x09\x09\x09\x09\x09\x09(Env.browser === \x27Firefox\x27 && Env.verComp(Env.version, 4, \x27\x3e=\x27)) ||\x0a\x09\x09\x09\x09\x09\x09(Env.browser === \x27Opera\x27 && Env.verComp(Env.version, 12, \x27\x3e=\x27)) ||\x0a\x09\x09\x09\x09\x09\x09(Env.browser === \x27IE\x27 && Env.verComp(Env.version, 10, \x27\x3e=\x27)) ||\x0a\x09\x09\x09\x09\x09\x09!!~Basic.inArray(Env.browser, [\x27Chrome\x27, \x27Safari\x27])\x0a\x09\x09\x09\x09\x09);\x0a\x09\x09\x09\x09},\x0a\x09\x09\x09\x09upload_filesize: True\x0a\x09\x09\x09}, \x0a\x09\x09\x09arguments[2]\x0a\x09\x09);\x0a\x0a\x09\x09Runtime.call(this, options, (arguments[1] || type), caps);\x0a\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x0a\x09\x09\x09init : function() {\x0a\x09\x09\x09\x09this.trigger(\x22Init\x22);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09destroy: (function(destroy) { // extend default destroy method\x0a\x09\x09\x09\x09return function() {\x0a\x09\x09\x09\x09\x09destroy.call(I);\x0a\x09\x09\x09\x09\x09destroy = I = null;\x0a\x09\x09\x09\x09};\x0a\x09\x09\x09}(this.destroy))\x0a\x09\x09});\x0a\x0a\x09\x09Basic.extend(this.getShim(), extensions);\x0a\x09}\x0a\x0a\x09Runtime.addConstructor(type, Html5Runtime);\x0a\x0a\x09return extensions;\x0a});\x0a\x0a// Included from: src/javascript/core/utils/Events.js\x0a\x0a/**\x0a * Events.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0adefine(\x27moxie/core/utils/Events\x27, [\x0a\x09\x27moxie/core/utils/Basic\x27\x0a], function(Basic) {\x0a\x09var eventhash = {}, uid = \x27moxie_\x27 + Basic.guid();\x0a\x09\x0a\x09// IE W3C like event funcs\x0a\x09function preventDefault() {\x0a\x09\x09this.returnValue = false;\x0a\x09}\x0a\x0a\x09function stopPropagation() {\x0a\x09\x09this.cancelBubble = true;\x0a\x09}\x0a\x0a\x09/**\x0a\x09Adds an event handler to the specified object and store reference to the handler\x0a\x09in objects internal Plupload registry (@see removeEvent).\x0a\x09\x0a\x09@method addEvent\x0a\x09@for Utils\x0a\x09@static\x0a\x09@param {Object} obj DOM element like object to add handler to.\x0a\x09@param {String} name Name to add event listener to.\x0a\x09@param {Function} callback Function to call when event occurs.\x0a\x09@param {String} [key] that might be used to add specifity to the event record.\x0a\x09*/\x0a\x09var addEvent = function(obj, name, callback, key) {\x0a\x09\x09var func, events;\x0a\x09\x09\x09\x09\x09\x0a\x09\x09name = name.toLowerCase();\x0a\x0a\x09\x09// Add event listener\x0a\x09\x09if (obj.addEventListener) {\x0a\x09\x09\x09func = callback;\x0a\x09\x09\x09\x0a\x09\x09\x09obj.addEventListener(name, func, false);\x0a\x09\x09} else if (obj.attachEvent) {\x0a\x09\x09\x09func = function() {\x0a\x09\x09\x09\x09var evt = window.event;\x0a\x0a\x09\x09\x09\x09if (!evt.target) {\x0a\x09\x09\x09\x09\x09evt.target = evt.srcElement;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09evt.preventDefault = preventDefault;\x0a\x09\x09\x09\x09evt.stopPropagation = stopPropagation;\x0a\x0a\x09\x09\x09\x09callback(evt);\x0a\x09\x09\x09};\x0a\x0a\x09\x09\x09obj.attachEvent(\x27on\x27 + name, func);\x0a\x09\x09}\x0a\x09\x09\x0a\x09\x09// Log event handler to objects internal mOxie registry\x0a\x09\x09if (!obj[uid]) {\x0a\x09\x09\x09obj[uid] = Basic.guid();\x0a\x09\x09}\x0a\x09\x09\x0a\x09\x09if (!eventhash.hasOwnProperty(obj[uid])) {\x0a\x09\x09\x09eventhash[obj[uid]] = {};\x0a\x09\x09}\x0a\x09\x09\x0a\x09\x09events = eventhash[obj[uid]];\x0a\x09\x09\x0a\x09\x09if (!events.hasOwnProperty(name)) {\x0a\x09\x09\x09events[name] = [];\x0a\x09\x09}\x0a\x09\x09\x09\x09\x0a\x09\x09events[name].push({\x0a\x09\x09\x09func: func,\x0a\x09\x09\x09orig: callback, // store original callback for IE\x0a\x09\x09\x09key: key\x0a\x09\x09});\x0a\x09};\x0a\x09\x0a\x09\x0a\x09/**\x0a\x09Remove event handler from the specified object. If third argument (callback)\x0a\x09is not specified remove all events with the specified name.\x0a\x09\x0a\x09@method removeEvent\x0a\x09@static\x0a\x09@param {Object} obj DOM element to remove event listener(s) from.\x0a\x09@param {String} name Name of event listener to remove.\x0a\x09@param {Function|String} [callback] might be a callback or unique key to match.\x0a\x09*/\x0a\x09var removeEvent = function(obj, name, callback) {\x0a\x09\x09var type, undef;\x0a\x09\x09\x0a\x09\x09name = name.toLowerCase();\x0a\x09\x09\x0a\x09\x09if (obj[uid] && eventhash[obj[uid]] && eventhash[obj[uid]][name]) {\x0a\x09\x09\x09type = eventhash[obj[uid]][name];\x0a\x09\x09} else {\x0a\x09\x09\x09return;\x0a\x09\x09}\x0a\x09\x09\x09\x0a\x09\x09for (var i = type.length - 1; i \x3e= 0; i--) {\x0a\x09\x09\x09// undefined or not, key should match\x0a\x09\x09\x09if (type[i].orig === callback || type[i].key === callback) {\x0a\x09\x09\x09\x09if (obj.removeEventListener) {\x0a\x09\x09\x09\x09\x09obj.removeEventListener(name, type[i].func, false);\x0a\x09\x09\x09\x09} else if (obj.detachEvent) {\x0a\x09\x09\x09\x09\x09obj.detachEvent(\x27on\x27+name, type[i].func);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09type[i].orig = null;\x0a\x09\x09\x09\x09type[i].func = null;\x0a\x09\x09\x09\x09type.splice(i, 1);\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09// If callback was passed we are done here, otherwise proceed\x0a\x09\x09\x09\x09if (callback !== undef) {\x0a\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x09\x09\x0a\x09\x09// If event array got empty, remove it\x0a\x09\x09if (!type.length) {\x0a\x09\x09\x09delete eventhash[obj[uid]][name];\x0a\x09\x09}\x0a\x09\x09\x0a\x09\x09// If mOxie registry has become empty, remove it\x0a\x09\x09if (Basic.isEmptyObj(eventhash[obj[uid]])) {\x0a\x09\x09\x09delete eventhash[obj[uid]];\x0a\x09\x09\x09\x0a\x09\x09\x09// IE doesn\x27t let you remove DOM object property with - delete\x0a\x09\x09\x09try {\x0a\x09\x09\x09\x09delete obj[uid];\x0a\x09\x09\x09} catch(e) {\x0a\x09\x09\x09\x09obj[uid] = undef;\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x09};\x0a\x09\x0a\x09\x0a\x09/**\x0a\x09Remove all kind of events from the specified object\x0a\x09\x0a\x09@method removeAllEvents\x0a\x09@static\x0a\x09@param {Object} obj DOM element to remove event listeners from.\x0a\x09@param {String} [key] unique key to match, when removing events.\x0a\x09*/\x0a\x09var removeAllEvents = function(obj, key) {\x09\x09\x0a\x09\x09if (!obj || !obj[uid]) {\x0a\x09\x09\x09return;\x0a\x09\x09}\x0a\x09\x09\x0a\x09\x09Basic.each(eventhash[obj[uid]], function(events, name) {\x0a\x09\x09\x09removeEvent(obj, name, key);\x0a\x09\x09});\x0a\x09};\x0a\x0a\x09return {\x0a\x09\x09addEvent: addEvent,\x0a\x09\x09removeEvent: removeEvent,\x0a\x09\x09removeAllEvents: removeAllEvents\x0a\x09};\x0a});\x0a\x0a// Included from: src/javascript/runtime/html5/file/FileInput.js\x0a\x0a/**\x0a * FileInput.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/**\x0a@class moxie/runtime/html5/file/FileInput\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html5/file/FileInput\x22, [\x0a\x09\x22moxie/runtime/html5/Runtime\x22,\x0a\x09\x22moxie/file/File\x22,\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/core/utils/Dom\x22,\x0a\x09\x22moxie/core/utils/Events\x22,\x0a\x09\x22moxie/core/utils/Mime\x22,\x0a\x09\x22moxie/core/utils/Env\x22\x0a], function(extensions, File, Basic, Dom, Events, Mime, Env) {\x0a\x09\x0a\x09function FileInput() {\x0a\x09\x09var _options;\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09init: function(options) {\x0a\x09\x09\x09\x09var comp = this, I = comp.getRuntime(), input, shimContainer, mimes, browseButton, zIndex, top;\x0a\x0a\x09\x09\x09\x09_options = options;\x0a\x0a\x09\x09\x09\x09// figure out accept string\x0a\x09\x09\x09\x09mimes = _options.accept.mimes || Mime.extList2mimes(_options.accept, I.can(\x27filter_by_extension\x27));\x0a\x0a\x09\x09\x09\x09shimContainer = I.getShimContainer();\x0a\x0a\x09\x09\x09\x09shimContainer.innerHTML = \x27\x3cinput id=\x22\x27 + I.uid +\x27\x22 type=\x22file\x22 style=\x22font-size:999px;opacity:0;\x22\x27 +\x0a\x09\x09\x09\x09\x09(_options.multiple && I.can(\x27select_multiple\x27) ? \x27multiple\x27 : \x27\x27) + \x0a\x09\x09\x09\x09\x09(_options.directory && I.can(\x27select_folder\x27) ? \x27webkitdirectory directory\x27 : \x27\x27) + // Chrome 11+\x0a\x09\x09\x09\x09\x09(mimes ? \x27 accept=\x22\x27 + mimes.join(\x27,\x27) + \x27\x22\x27 : \x27\x27) + \x27 /\x3e\x27;\x0a\x0a\x09\x09\x09\x09input = Dom.get(I.uid);\x0a\x0a\x09\x09\x09\x09// prepare file input to be placed underneath the browse_button element\x0a\x09\x09\x09\x09Basic.extend(input.style, {\x0a\x09\x09\x09\x09\x09position: \x27absolute\x27,\x0a\x09\x09\x09\x09\x09top: 0,\x0a\x09\x09\x09\x09\x09left: 0,\x0a\x09\x09\x09\x09\x09width: \x27100%\x27,\x0a\x09\x09\x09\x09\x09height: \x27100%\x27\x0a\x09\x09\x09\x09});\x0a\x0a\x0a\x09\x09\x09\x09browseButton = Dom.get(_options.browse_button);\x0a\x0a\x09\x09\x09\x09// Route click event to the input[type=file] element for browsers that support such behavior\x0a\x09\x09\x09\x09if (I.can(\x27summon_file_dialog\x27)) {\x0a\x09\x09\x09\x09\x09if (Dom.getStyle(browseButton, \x27position\x27) === \x27static\x27) {\x0a\x09\x09\x09\x09\x09\x09browseButton.style.position = \x27relative\x27;\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09zIndex = parseInt(Dom.getStyle(browseButton, \x27z-index\x27), 10) || 1;\x0a\x0a\x09\x09\x09\x09\x09browseButton.style.zIndex = zIndex;\x0a\x09\x09\x09\x09\x09shimContainer.style.zIndex = zIndex - 1;\x0a\x0a\x09\x09\x09\x09\x09Events.addEvent(browseButton, \x27click\x27, function(e) {\x0a\x09\x09\x09\x09\x09\x09var input = Dom.get(I.uid);\x0a\x09\x09\x09\x09\x09\x09if (input && !input.disabled) { // for some reason FF (up to 8.0.1 so far) lets to click disabled input[type=file]\x0a\x09\x09\x09\x09\x09\x09\x09input.click();\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09e.preventDefault();\x0a\x09\x09\x09\x09\x09}, comp.uid);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09/* Since we have to place input[type=file] on top of the browse_button for some browsers,\x0a\x09\x09\x09\x09browse_button loses interactivity, so we restore it here */\x0a\x09\x09\x09\x09top = I.can(\x27summon_file_dialog\x27) ? browseButton : shimContainer;\x0a\x0a\x09\x09\x09\x09Events.addEvent(top, \x27mouseover\x27, function() {\x0a\x09\x09\x09\x09\x09comp.trigger(\x27mouseenter\x27);\x0a\x09\x09\x09\x09}, comp.uid);\x0a\x0a\x09\x09\x09\x09Events.addEvent(top, \x27mouseout\x27, function() {\x0a\x09\x09\x09\x09\x09comp.trigger(\x27mouseleave\x27);\x0a\x09\x09\x09\x09}, comp.uid);\x0a\x0a\x09\x09\x09\x09Events.addEvent(top, \x27mousedown\x27, function() {\x0a\x09\x09\x09\x09\x09comp.trigger(\x27mousedown\x27);\x0a\x09\x09\x09\x09}, comp.uid);\x0a\x0a\x09\x09\x09\x09Events.addEvent(Dom.get(_options.container), \x27mouseup\x27, function() {\x0a\x09\x09\x09\x09\x09comp.trigger(\x27mouseup\x27);\x0a\x09\x09\x09\x09}, comp.uid);\x0a\x0a\x0a\x09\x09\x09\x09input.onchange = function onChange(e) { // there should be only one handler for this\x0a\x09\x09\x09\x09\x09comp.files = [];\x0a\x0a\x09\x09\x09\x09\x09Basic.each(this.files, function(file) {\x0a\x09\x09\x09\x09\x09\x09var relativePath = \x27\x27;\x0a\x0a\x09\x09\x09\x09\x09\x09if (_options.directory) {\x0a\x09\x09\x09\x09\x09\x09\x09// folders are represented by dots, filter them out (Chrome 11+)\x0a\x09\x09\x09\x09\x09\x09\x09if (file.name == \x22.\x22) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09// if it looks like a folder...\x0a\x09\x09\x09\x09\x09\x09\x09\x09return true;\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09\x09if (file.webkitRelativePath) {\x0a\x09\x09\x09\x09\x09\x09\x09relativePath = \x27/\x27 + file.webkitRelativePath.replace(/^\x5c//, \x27\x27);\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09\x09file = new File(I.uid, file);\x0a\x09\x09\x09\x09\x09\x09file.relativePath = relativePath;\x0a\x0a\x09\x09\x09\x09\x09\x09comp.files.push(file);\x0a\x09\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09\x09// clearing the value enables the user to select the same file again if they want to\x0a\x09\x09\x09\x09\x09if (Env.browser !== \x27IE\x27 && Env.browser !== \x27IEMobile\x27) {\x0a\x09\x09\x09\x09\x09\x09this.value = \x27\x27;\x0a\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09// in IE input[type=\x22file\x22] is read-only so the only way to reset it is to re-insert it\x0a\x09\x09\x09\x09\x09\x09var clone = this.cloneNode(true);\x0a\x09\x09\x09\x09\x09\x09this.parentNode.replaceChild(clone, this);\x0a\x09\x09\x09\x09\x09\x09clone.onchange = onChange;\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09if (comp.files.length) {\x0a\x09\x09\x09\x09\x09\x09comp.trigger(\x27change\x27);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09};\x0a\x0a\x09\x09\x09\x09// ready event is perfectly asynchronous\x0a\x09\x09\x09\x09comp.trigger({\x0a\x09\x09\x09\x09\x09type: \x27ready\x27,\x0a\x09\x09\x09\x09\x09async: true\x0a\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09shimContainer = null;\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09disable: function(state) {\x0a\x09\x09\x09\x09var I = this.getRuntime(), input;\x0a\x0a\x09\x09\x09\x09if ((input = Dom.get(I.uid))) {\x0a\x09\x09\x09\x09\x09input.disabled = !!state;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09destroy: function() {\x0a\x09\x09\x09\x09var I = this.getRuntime()\x0a\x09\x09\x09\x09, shim = I.getShim()\x0a\x09\x09\x09\x09, shimContainer = I.getShimContainer()\x0a\x09\x09\x09\x09;\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09Events.removeAllEvents(shimContainer, this.uid);\x0a\x09\x09\x09\x09Events.removeAllEvents(_options && Dom.get(_options.container), this.uid);\x0a\x09\x09\x09\x09Events.removeAllEvents(_options && Dom.get(_options.browse_button), this.uid);\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09if (shimContainer) {\x0a\x09\x09\x09\x09\x09shimContainer.innerHTML = \x27\x27;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09shim.removeInstance(this.uid);\x0a\x0a\x09\x09\x09\x09_options = shimContainer = shim = null;\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x09}\x0a\x0a\x09return (extensions.FileInput = FileInput);\x0a});\x0a\x0a// Included from: src/javascript/runtime/html5/file/Blob.js\x0a\x0a/**\x0a * Blob.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/**\x0a@class moxie/runtime/html5/file/Blob\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html5/file/Blob\x22, [\x0a\x09\x22moxie/runtime/html5/Runtime\x22,\x0a\x09\x22moxie/file/Blob\x22\x0a], function(extensions, Blob) {\x0a\x0a\x09function HTML5Blob() {\x0a\x09\x09function w3cBlobSlice(blob, start, end) {\x0a\x09\x09\x09var blobSlice;\x0a\x0a\x09\x09\x09if (window.File.prototype.slice) {\x0a\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09blob.slice();\x09// depricated version will throw WRONG_ARGUMENTS_ERR exception\x0a\x09\x09\x09\x09\x09return blob.slice(start, end);\x0a\x09\x09\x09\x09} catch (e) {\x0a\x09\x09\x09\x09\x09// depricated slice method\x0a\x09\x09\x09\x09\x09return blob.slice(start, end - start);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09// slice method got prefixed: https://bugzilla.mozilla.org/show_bug.cgi?id=649672\x0a\x09\x09\x09} else if ((blobSlice = window.File.prototype.webkitSlice || window.File.prototype.mozSlice)) {\x0a\x09\x09\x09\x09return blobSlice.call(blob, start, end);\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09return null; // or throw some exception\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x0a\x09\x09this.slice = function() {\x0a\x09\x09\x09return new Blob(this.getRuntime().uid, w3cBlobSlice.apply(this, arguments));\x0a\x09\x09};\x0a\x09}\x0a\x0a\x09return (extensions.Blob = HTML5Blob);\x0a});\x0a\x0a// Included from: src/javascript/runtime/html5/file/FileDrop.js\x0a\x0a/**\x0a * FileDrop.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/**\x0a@class moxie/runtime/html5/file/FileDrop\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html5/file/FileDrop\x22, [\x0a\x09\x22moxie/runtime/html5/Runtime\x22,\x0a\x09\x27moxie/file/File\x27,\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/core/utils/Dom\x22,\x0a\x09\x22moxie/core/utils/Events\x22,\x0a\x09\x22moxie/core/utils/Mime\x22\x0a], function(extensions, File, Basic, Dom, Events, Mime) {\x0a\x09\x0a\x09function FileDrop() {\x0a\x09\x09var _files = [], _allowedExts = [], _options, _ruid;\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09init: function(options) {\x0a\x09\x09\x09\x09var comp = this, dropZone;\x0a\x0a\x09\x09\x09\x09_options = options;\x0a\x09\x09\x09\x09_ruid = comp.ruid; // every dropped-in file should have a reference to the runtime\x0a\x09\x09\x09\x09_allowedExts = _extractExts(_options.accept);\x0a\x09\x09\x09\x09dropZone = _options.container;\x0a\x0a\x09\x09\x09\x09Events.addEvent(dropZone, \x27dragover\x27, function(e) {\x0a\x09\x09\x09\x09\x09if (!_hasFiles(e)) {\x0a\x09\x09\x09\x09\x09\x09return;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09e.preventDefault();\x0a\x09\x09\x09\x09\x09e.dataTransfer.dropEffect = \x27copy\x27;\x0a\x09\x09\x09\x09}, comp.uid);\x0a\x0a\x09\x09\x09\x09Events.addEvent(dropZone, \x27drop\x27, function(e) {\x0a\x09\x09\x09\x09\x09if (!_hasFiles(e)) {\x0a\x09\x09\x09\x09\x09\x09return;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09e.preventDefault();\x0a\x0a\x09\x09\x09\x09\x09_files = [];\x0a\x0a\x09\x09\x09\x09\x09// Chrome 21+ accepts folders via Drag\x27n\x27Drop\x0a\x09\x09\x09\x09\x09if (e.dataTransfer.items && e.dataTransfer.items[0].webkitGetAsEntry) {\x0a\x09\x09\x09\x09\x09\x09_readItems(e.dataTransfer.items, function() {\x0a\x09\x09\x09\x09\x09\x09\x09comp.files = _files;\x0a\x09\x09\x09\x09\x09\x09\x09comp.trigger(\x22drop\x22);\x0a\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09Basic.each(e.dataTransfer.files, function(file) {\x0a\x09\x09\x09\x09\x09\x09\x09_addFile(file);\x0a\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09\x09comp.files = _files;\x0a\x09\x09\x09\x09\x09\x09comp.trigger(\x22drop\x22);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}, comp.uid);\x0a\x0a\x09\x09\x09\x09Events.addEvent(dropZone, \x27dragenter\x27, function(e) {\x0a\x09\x09\x09\x09\x09comp.trigger(\x22dragenter\x22);\x0a\x09\x09\x09\x09}, comp.uid);\x0a\x0a\x09\x09\x09\x09Events.addEvent(dropZone, \x27dragleave\x27, function(e) {\x0a\x09\x09\x09\x09\x09comp.trigger(\x22dragleave\x22);\x0a\x09\x09\x09\x09}, comp.uid);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09destroy: function() {\x0a\x09\x09\x09\x09Events.removeAllEvents(_options && Dom.get(_options.container), this.uid);\x0a\x09\x09\x09\x09_ruid = _files = _allowedExts = _options = null;\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x0a\x09\x09function _hasFiles(e) {\x0a\x09\x09\x09if (!e.dataTransfer || !e.dataTransfer.types) { // e.dataTransfer.files is not available in Gecko during dragover\x0a\x09\x09\x09\x09return false;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09var types = Basic.toArray(e.dataTransfer.types || []);\x0a\x0a\x09\x09\x09return Basic.inArray(\x22Files\x22, types) !== -1 ||\x0a\x09\x09\x09\x09Basic.inArray(\x22public.file-url\x22, types) !== -1 || // Safari \x3c 5\x0a\x09\x09\x09\x09Basic.inArray(\x22application/x-moz-file\x22, types) !== -1 // Gecko \x3c 1.9.2 (\x3c Firefox 3.6)\x0a\x09\x09\x09\x09;\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _addFile(file, relativePath) {\x0a\x09\x09\x09if (_isAcceptable(file)) {\x0a\x09\x09\x09\x09var fileObj = new File(_ruid, file);\x0a\x09\x09\x09\x09fileObj.relativePath = relativePath || \x27\x27;\x0a\x09\x09\x09\x09_files.push(fileObj);\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x0a\x09\x09\x0a\x09\x09function _extractExts(accept) {\x0a\x09\x09\x09var exts = [];\x0a\x09\x09\x09for (var i = 0; i \x3c accept.length; i++) {\x0a\x09\x09\x09\x09[].push.apply(exts, accept[i].extensions.split(/\x5cs*,\x5cs*/));\x0a\x09\x09\x09}\x0a\x09\x09\x09return Basic.inArray(\x27*\x27, exts) === -1 ? exts : [];\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _isAcceptable(file) {\x0a\x09\x09\x09if (!_allowedExts.length) {\x0a\x09\x09\x09\x09return true;\x0a\x09\x09\x09}\x0a\x09\x09\x09var ext = Mime.getFileExtension(file.name);\x0a\x09\x09\x09return !ext || Basic.inArray(ext, _allowedExts) !== -1;\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _readItems(items, cb) {\x0a\x09\x09\x09var entries = [];\x0a\x09\x09\x09Basic.each(items, function(item) {\x0a\x09\x09\x09\x09var entry = item.webkitGetAsEntry();\x0a\x09\x09\x09\x09// Address #998 (https://code.google.com/p/chromium/issues/detail?id=332579)\x0a\x09\x09\x09\x09if (entry) {\x0a\x09\x09\x09\x09\x09// file() fails on OSX when the filename contains a special character (e.g. umlaut): see #61\x0a\x09\x09\x09\x09\x09if (entry.isFile) {\x0a\x09\x09\x09\x09\x09\x09_addFile(item.getAsFile(), entry.fullPath);\x0a\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09entries.push(entry);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09});\x0a\x0a\x09\x09\x09if (entries.length) {\x0a\x09\x09\x09\x09_readEntries(entries, cb);\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09cb();\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _readEntries(entries, cb) {\x0a\x09\x09\x09var queue = [];\x0a\x09\x09\x09Basic.each(entries, function(entry) {\x0a\x09\x09\x09\x09queue.push(function(cbcb) {\x0a\x09\x09\x09\x09\x09_readEntry(entry, cbcb);\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09});\x0a\x09\x09\x09Basic.inSeries(queue, function() {\x0a\x09\x09\x09\x09cb();\x0a\x09\x09\x09});\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _readEntry(entry, cb) {\x0a\x09\x09\x09if (entry.isFile) {\x0a\x09\x09\x09\x09entry.file(function(file) {\x0a\x09\x09\x09\x09\x09_addFile(file, entry.fullPath);\x0a\x09\x09\x09\x09\x09cb();\x0a\x09\x09\x09\x09}, function() {\x0a\x09\x09\x09\x09\x09// fire an error event maybe\x0a\x09\x09\x09\x09\x09cb();\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09} else if (entry.isDirectory) {\x0a\x09\x09\x09\x09_readDirEntry(entry, cb);\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09cb(); // not file, not directory? what then?..\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _readDirEntry(dirEntry, cb) {\x0a\x09\x09\x09var entries = [], dirReader = dirEntry.createReader();\x0a\x0a\x09\x09\x09// keep quering recursively till no more entries\x0a\x09\x09\x09function getEntries(cbcb) {\x0a\x09\x09\x09\x09dirReader.readEntries(function(moreEntries) {\x0a\x09\x09\x09\x09\x09if (moreEntries.length) {\x0a\x09\x09\x09\x09\x09\x09[].push.apply(entries, moreEntries);\x0a\x09\x09\x09\x09\x09\x09getEntries(cbcb);\x0a\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09cbcb();\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}, cbcb);\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09// ...and you thought FileReader was crazy...\x0a\x09\x09\x09getEntries(function() {\x0a\x09\x09\x09\x09_readEntries(entries, cb);\x0a\x09\x09\x09}); \x0a\x09\x09}\x0a\x09}\x0a\x0a\x09return (extensions.FileDrop = FileDrop);\x0a});\x0a\x0a// Included from: src/javascript/runtime/html5/file/FileReader.js\x0a\x0a/**\x0a * FileReader.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/**\x0a@class moxie/runtime/html5/file/FileReader\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html5/file/FileReader\x22, [\x0a\x09\x22moxie/runtime/html5/Runtime\x22,\x0a\x09\x22moxie/core/utils/Encode\x22,\x0a\x09\x22moxie/core/utils/Basic\x22\x0a], function(extensions, Encode, Basic) {\x0a\x09\x0a\x09function FileReader() {\x0a\x09\x09var _fr, _convertToBinary = false;\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x0a\x09\x09\x09read: function(op, blob) {\x0a\x09\x09\x09\x09var comp = this;\x0a\x0a\x09\x09\x09\x09comp.result = \x27\x27;\x0a\x0a\x09\x09\x09\x09_fr = new window.FileReader();\x0a\x0a\x09\x09\x09\x09_fr.addEventListener(\x27progress\x27, function(e) {\x0a\x09\x09\x09\x09\x09comp.trigger(e);\x0a\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09_fr.addEventListener(\x27load\x27, function(e) {\x0a\x09\x09\x09\x09\x09comp.result = _convertToBinary ? _toBinary(_fr.result) : _fr.result;\x0a\x09\x09\x09\x09\x09comp.trigger(e);\x0a\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09_fr.addEventListener(\x27error\x27, function(e) {\x0a\x09\x09\x09\x09\x09comp.trigger(e, _fr.error);\x0a\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09_fr.addEventListener(\x27loadend\x27, function(e) {\x0a\x09\x09\x09\x09\x09_fr = null;\x0a\x09\x09\x09\x09\x09comp.trigger(e);\x0a\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09if (Basic.typeOf(_fr[op]) === \x27function\x27) {\x0a\x09\x09\x09\x09\x09_convertToBinary = false;\x0a\x09\x09\x09\x09\x09_fr[op](blob.getSource());\x0a\x09\x09\x09\x09} else if (op === \x27readAsBinaryString\x27) { // readAsBinaryString is depricated in general and never existed in IE10+\x0a\x09\x09\x09\x09\x09_convertToBinary = true;\x0a\x09\x09\x09\x09\x09_fr.readAsDataURL(blob.getSource());\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09abort: function() {\x0a\x09\x09\x09\x09if (_fr) {\x0a\x09\x09\x09\x09\x09_fr.abort();\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09destroy: function() {\x0a\x09\x09\x09\x09_fr = null;\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09function _toBinary(str) {\x0a\x09\x09\x09return Encode.atob(str.substring(str.indexOf(\x27base64,\x27) + 7));\x0a\x09\x09}\x0a\x09}\x0a\x0a\x09return (extensions.FileReader = FileReader);\x0a});\x0a\x0a// Included from: src/javascript/runtime/html5/xhr/XMLHttpRequest.js\x0a\x0a/**\x0a * XMLHttpRequest.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/*global ActiveXObject:true */\x0a\x0a/**\x0a@class moxie/runtime/html5/xhr/XMLHttpRequest\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html5/xhr/XMLHttpRequest\x22, [\x0a\x09\x22moxie/runtime/html5/Runtime\x22,\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/core/utils/Mime\x22,\x0a\x09\x22moxie/core/utils/Url\x22,\x0a\x09\x22moxie/file/File\x22,\x0a\x09\x22moxie/file/Blob\x22,\x0a\x09\x22moxie/xhr/FormData\x22,\x0a\x09\x22moxie/core/Exceptions\x22,\x0a\x09\x22moxie/core/utils/Env\x22\x0a], function(extensions, Basic, Mime, Url, File, Blob, FormData, x, Env) {\x0a\x09\x0a\x09function XMLHttpRequest() {\x0a\x09\x09var self = this\x0a\x09\x09, _xhr\x0a\x09\x09, _filename\x0a\x09\x09;\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09send: function(meta, data) {\x0a\x09\x09\x09\x09var target = this\x0a\x09\x09\x09\x09, isGecko2_5_6 = (Env.browser === \x27Mozilla\x27 && Env.verComp(Env.version, 4, \x27\x3e=\x27) && Env.verComp(Env.version, 7, \x27\x3c\x27))\x0a\x09\x09\x09\x09, isAndroidBrowser = Env.browser === \x27Android Browser\x27\x0a\x09\x09\x09\x09, mustSendAsBinary = false\x0a\x09\x09\x09\x09;\x0a\x0a\x09\x09\x09\x09// extract file name\x0a\x09\x09\x09\x09_filename = meta.url.replace(/^.+?\x5c/([\x5cw\x5c-\x5c.]+)$/, \x27$1\x27).toLowerCase();\x0a\x0a\x09\x09\x09\x09_xhr = _getNativeXHR();\x0a\x09\x09\x09\x09_xhr.open(meta.method, meta.url, meta.async, meta.user, meta.password);\x0a\x0a\x0a\x09\x09\x09\x09// prepare data to be sent\x0a\x09\x09\x09\x09if (data instanceof Blob) {\x0a\x09\x09\x09\x09\x09if (data.isDetached()) {\x0a\x09\x09\x09\x09\x09\x09mustSendAsBinary = true;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09data = data.getSource();\x0a\x09\x09\x09\x09} else if (data instanceof FormData) {\x0a\x0a\x09\x09\x09\x09\x09if (data.hasBlob()) {\x0a\x09\x09\x09\x09\x09\x09if (data.getBlob().isDetached()) {\x0a\x09\x09\x09\x09\x09\x09\x09data = _prepareMultipart.call(target, data); // _xhr must be instantiated and be in OPENED state\x0a\x09\x09\x09\x09\x09\x09\x09mustSendAsBinary = true;\x0a\x09\x09\x09\x09\x09\x09} else if ((isGecko2_5_6 || isAndroidBrowser) && Basic.typeOf(data.getBlob().getSource()) === \x27blob\x27 && window.FileReader) {\x0a\x09\x09\x09\x09\x09\x09\x09// Gecko 2/5/6 can\x27t send blob in FormData: https://bugzilla.mozilla.org/show_bug.cgi?id=649150\x0a\x09\x09\x09\x09\x09\x09\x09// Android browsers (default one and Dolphin) seem to have the same issue, see: #613\x0a\x09\x09\x09\x09\x09\x09\x09_preloadAndSend.call(target, meta, data);\x0a\x09\x09\x09\x09\x09\x09\x09return; // _preloadAndSend will reinvoke send() with transmutated FormData =%D\x0a\x09\x09\x09\x09\x09\x09}\x09\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09// transfer fields to real FormData\x0a\x09\x09\x09\x09\x09if (data instanceof FormData) { // if still a FormData, e.g. not mangled by _prepareMultipart()\x0a\x09\x09\x09\x09\x09\x09var fd = new window.FormData();\x0a\x09\x09\x09\x09\x09\x09data.each(function(value, name) {\x0a\x09\x09\x09\x09\x09\x09\x09if (value instanceof Blob) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09fd.append(name, value.getSource());\x0a\x09\x09\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09\x09\x09fd.append(name, value);\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09\x09data = fd;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x0a\x0a\x09\x09\x09\x09// if XHR L2\x0a\x09\x09\x09\x09if (_xhr.upload) {\x0a\x09\x09\x09\x09\x09if (meta.withCredentials) {\x0a\x09\x09\x09\x09\x09\x09_xhr.withCredentials = true;\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09_xhr.addEventListener(\x27load\x27, function(e) {\x0a\x09\x09\x09\x09\x09\x09target.trigger(e);\x0a\x09\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09\x09_xhr.addEventListener(\x27error\x27, function(e) {\x0a\x09\x09\x09\x09\x09\x09target.trigger(e);\x0a\x09\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09\x09// additionally listen to progress events\x0a\x09\x09\x09\x09\x09_xhr.addEventListener(\x27progress\x27, function(e) {\x0a\x09\x09\x09\x09\x09\x09target.trigger(e);\x0a\x09\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09\x09_xhr.upload.addEventListener(\x27progress\x27, function(e) {\x0a\x09\x09\x09\x09\x09\x09target.trigger({\x0a\x09\x09\x09\x09\x09\x09\x09type: \x27UploadProgress\x27,\x0a\x09\x09\x09\x09\x09\x09\x09loaded: e.loaded,\x0a\x09\x09\x09\x09\x09\x09\x09total: e.total\x0a\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09// ... otherwise simulate XHR L2\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09_xhr.onreadystatechange = function onReadyStateChange() {\x0a\x09\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09\x09// fake Level 2 events\x0a\x09\x09\x09\x09\x09\x09switch (_xhr.readyState) {\x0a\x09\x09\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09\x09\x09case 1: // XMLHttpRequest.OPENED\x0a\x09\x09\x09\x09\x09\x09\x09\x09// readystatechanged is fired twice for OPENED state (in IE and Mozilla) - neu\x0a\x09\x09\x09\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09\x09\x09// looks like HEADERS_RECEIVED (state 2) is not reported in Opera (or it\x27s old versions) - neu\x0a\x09\x09\x09\x09\x09\x09\x09case 2: // XMLHttpRequest.HEADERS_RECEIVED\x0a\x09\x09\x09\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09\x09\x09case 3: // XMLHttpRequest.LOADING \x0a\x09\x09\x09\x09\x09\x09\x09\x09// try to fire progress event for not XHR L2\x0a\x09\x09\x09\x09\x09\x09\x09\x09var total, loaded;\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09if (Url.hasSameOrigin(meta.url)) { // Content-Length not accessible for cross-domain on some browsers\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09total = _xhr.getResponseHeader(\x27Content-Length\x27) || 0; // old Safari throws an exception here\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09if (_xhr.responseText) { // responseText was introduced in IE7\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09loaded = _xhr.responseText.length;\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09\x09\x09} catch(ex) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09total = loaded = 0;\x0a\x09\x09\x09\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09\x09\x09\x09target.trigger({\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09type: \x27progress\x27,\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09lengthComputable: !!total,\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09total: parseInt(total, 10),\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09loaded: loaded\x0a\x09\x09\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09\x09\x09case 4: // XMLHttpRequest.DONE\x0a\x09\x09\x09\x09\x09\x09\x09\x09// release readystatechange handler (mostly for IE)\x0a\x09\x09\x09\x09\x09\x09\x09\x09_xhr.onreadystatechange = function() {};\x0a\x0a\x09\x09\x09\x09\x09\x09\x09\x09// usually status 0 is returned when server is unreachable, but FF also fails to status 0 for 408 timeout\x0a\x09\x09\x09\x09\x09\x09\x09\x09if (_xhr.status === 0) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09target.trigger(\x27error\x27);\x0a\x09\x09\x09\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09target.trigger(\x27load\x27);\x0a\x09\x09\x09\x09\x09\x09\x09\x09}\x09\x09\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09};\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x0a\x0a\x09\x09\x09\x09// set request headers\x0a\x09\x09\x09\x09if (!Basic.isEmptyObj(meta.headers)) {\x0a\x09\x09\x09\x09\x09Basic.each(meta.headers, function(value, header) {\x0a\x09\x09\x09\x09\x09\x09_xhr.setRequestHeader(header, value);\x0a\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// request response type\x0a\x09\x09\x09\x09if (\x22\x22 !== meta.responseType && \x27responseType\x27 in _xhr) {\x0a\x09\x09\x09\x09\x09if (\x27json\x27 === meta.responseType && !Env.can(\x27return_response_type\x27, \x27json\x27)) { // we can fake this one\x0a\x09\x09\x09\x09\x09\x09_xhr.responseType = \x27text\x27;\x0a\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09_xhr.responseType = meta.responseType;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// send ...\x0a\x09\x09\x09\x09if (!mustSendAsBinary) {\x0a\x09\x09\x09\x09\x09_xhr.send(data);\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09if (_xhr.sendAsBinary) { // Gecko\x0a\x09\x09\x09\x09\x09\x09_xhr.sendAsBinary(data);\x0a\x09\x09\x09\x09\x09} else { // other browsers having support for typed arrays\x0a\x09\x09\x09\x09\x09\x09(function() {\x0a\x09\x09\x09\x09\x09\x09\x09// mimic Gecko\x27s sendAsBinary\x0a\x09\x09\x09\x09\x09\x09\x09var ui8a = new Uint8Array(data.length);\x0a\x09\x09\x09\x09\x09\x09\x09for (var i = 0; i \x3c data.length; i++) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09ui8a[i] = (data.charCodeAt(i) & 0xff);\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09\x09_xhr.send(ui8a.buffer);\x0a\x09\x09\x09\x09\x09\x09}());\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09target.trigger(\x27loadstart\x27);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09getStatus: function() {\x0a\x09\x09\x09\x09// according to W3C spec it should return 0 for readyState \x3c 3, but instead it throws an exception\x0a\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09if (_xhr) {\x0a\x09\x09\x09\x09\x09\x09return _xhr.status;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09} catch(ex) {}\x0a\x09\x09\x09\x09return 0;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09getResponse: function(responseType) {\x0a\x09\x09\x09\x09var I = this.getRuntime();\x0a\x0a\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09switch (responseType) {\x0a\x09\x09\x09\x09\x09\x09case \x27blob\x27:\x0a\x09\x09\x09\x09\x09\x09\x09var file = new File(I.uid, _xhr.response);\x0a\x09\x09\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09\x09\x09// try to extract file name from content-disposition if possible (might be - not, if CORS for example)\x09\x0a\x09\x09\x09\x09\x09\x09\x09var disposition = _xhr.getResponseHeader(\x27Content-Disposition\x27);\x0a\x09\x09\x09\x09\x09\x09\x09if (disposition) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09// extract filename from response header if available\x0a\x09\x09\x09\x09\x09\x09\x09\x09var match = disposition.match(/filename=([\x5c\x27\x5c\x22\x27])([^\x5c1]+)\x5c1/);\x0a\x09\x09\x09\x09\x09\x09\x09\x09if (match) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09_filename = match[2];\x0a\x09\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09\x09file.name = _filename;\x0a\x0a\x09\x09\x09\x09\x09\x09\x09// pre-webkit Opera doesn\x27t set type property on the blob response\x0a\x09\x09\x09\x09\x09\x09\x09if (!file.type) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09file.type = Mime.getFileMime(_filename);\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09\x09return file;\x0a\x0a\x09\x09\x09\x09\x09\x09case \x27json\x27:\x0a\x09\x09\x09\x09\x09\x09\x09if (!Env.can(\x27return_response_type\x27, \x27json\x27)) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09return _xhr.status === 200 && !!window.JSON ? JSON.parse(_xhr.responseText) : null;\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09\x09return _xhr.response;\x0a\x0a\x09\x09\x09\x09\x09\x09case \x27document\x27:\x0a\x09\x09\x09\x09\x09\x09\x09return _getDocument(_xhr);\x0a\x0a\x09\x09\x09\x09\x09\x09default:\x0a\x09\x09\x09\x09\x09\x09\x09return _xhr.responseText !== \x27\x27 ? _xhr.responseText : null; // against the specs, but for consistency across the runtimes\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09} catch(ex) {\x0a\x09\x09\x09\x09\x09return null;\x0a\x09\x09\x09\x09}\x09\x09\x09\x09\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09getAllResponseHeaders: function() {\x0a\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09return _xhr.getAllResponseHeaders();\x0a\x09\x09\x09\x09} catch(ex) {}\x0a\x09\x09\x09\x09return \x27\x27;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09abort: function() {\x0a\x09\x09\x09\x09if (_xhr) {\x0a\x09\x09\x09\x09\x09_xhr.abort();\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09destroy: function() {\x0a\x09\x09\x09\x09self = _filename = null;\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x0a\x09\x09// here we go... ugly fix for ugly bug\x0a\x09\x09function _preloadAndSend(meta, data) {\x0a\x09\x09\x09var target = this, blob, fr;\x0a\x09\x09\x09\x09\x0a\x09\x09\x09// get original blob\x0a\x09\x09\x09blob = data.getBlob().getSource();\x0a\x09\x09\x09\x0a\x09\x09\x09// preload blob in memory to be sent as binary string\x0a\x09\x09\x09fr = new window.FileReader();\x0a\x09\x09\x09fr.onload = function() {\x0a\x09\x09\x09\x09// overwrite original blob\x0a\x09\x09\x09\x09data.append(data.getBlobName(), new Blob(null, {\x0a\x09\x09\x09\x09\x09type: blob.type,\x0a\x09\x09\x09\x09\x09data: fr.result\x0a\x09\x09\x09\x09}));\x0a\x09\x09\x09\x09// invoke send operation again\x0a\x09\x09\x09\x09self.send.call(target, meta, data);\x0a\x09\x09\x09};\x0a\x09\x09\x09fr.readAsBinaryString(blob);\x0a\x09\x09}\x0a\x0a\x09\x09\x0a\x09\x09function _getNativeXHR() {\x0a\x09\x09\x09if (window.XMLHttpRequest && !(Env.browser === \x27IE\x27 && Env.verComp(Env.version, 8, \x27\x3c\x27))) { // IE7 has native XHR but it\x27s buggy\x0a\x09\x09\x09\x09return new window.XMLHttpRequest();\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09return (function() {\x0a\x09\x09\x09\x09\x09var progIDs = [\x27Msxml2.XMLHTTP.6.0\x27, \x27Microsoft.XMLHTTP\x27]; // if 6.0 available, use it, otherwise failback to default 3.0\x0a\x09\x09\x09\x09\x09for (var i = 0; i \x3c progIDs.length; i++) {\x0a\x09\x09\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09\x09\x09return new ActiveXObject(progIDs[i]);\x0a\x09\x09\x09\x09\x09\x09} catch (ex) {}\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09})();\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x09\x09\x0a\x09\x09// @credits Sergey Ilinsky\x09(http://www.ilinsky.com/)\x0a\x09\x09function _getDocument(xhr) {\x0a\x09\x09\x09var rXML = xhr.responseXML;\x0a\x09\x09\x09var rText = xhr.responseText;\x0a\x09\x09\x09\x0a\x09\x09\x09// Try parsing responseText (@see: http://www.ilinsky.com/articles/XMLHttpRequest/#bugs-ie-responseXML-content-type)\x0a\x09\x09\x09if (Env.browser === \x27IE\x27 && rText && rXML && !rXML.documentElement && /[^\x5c/]+\x5c/[^\x5c+]+\x5c+xml/.test(xhr.getResponseHeader(\x22Content-Type\x22))) {\x0a\x09\x09\x09\x09rXML = new window.ActiveXObject(\x22Microsoft.XMLDOM\x22);\x0a\x09\x09\x09\x09rXML.async = false;\x0a\x09\x09\x09\x09rXML.validateOnParse = false;\x0a\x09\x09\x09\x09rXML.loadXML(rText);\x0a\x09\x09\x09}\x0a\x09\x0a\x09\x09\x09// Check if there is no error in document\x0a\x09\x09\x09if (rXML) {\x0a\x09\x09\x09\x09if ((Env.browser === \x27IE\x27 && rXML.parseError !== 0) || !rXML.documentElement || rXML.documentElement.tagName === \x22parsererror\x22) {\x0a\x09\x09\x09\x09\x09return null;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x09\x09\x09return rXML;\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _prepareMultipart(fd) {\x0a\x09\x09\x09var boundary = \x27----moxieboundary\x27 + new Date().getTime()\x0a\x09\x09\x09, dashdash = \x27--\x27\x0a\x09\x09\x09, crlf = \x27\x5cr\x5cn\x27\x0a\x09\x09\x09, multipart = \x27\x27\x0a\x09\x09\x09, I = this.getRuntime()\x0a\x09\x09\x09;\x0a\x0a\x09\x09\x09if (!I.can(\x27send_binary_string\x27)) {\x0a\x09\x09\x09\x09throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09_xhr.setRequestHeader(\x27Content-Type\x27, \x27multipart/form-data; boundary=\x27 + boundary);\x0a\x0a\x09\x09\x09// append multipart parameters\x0a\x09\x09\x09fd.each(function(value, name) {\x0a\x09\x09\x09\x09// Firefox 3.6 failed to convert multibyte characters to UTF-8 in sendAsBinary(), \x0a\x09\x09\x09\x09// so we try it here ourselves with: unescape(encodeURIComponent(value))\x0a\x09\x09\x09\x09if (value instanceof Blob) {\x0a\x09\x09\x09\x09\x09// Build RFC2388 blob\x0a\x09\x09\x09\x09\x09multipart += dashdash + boundary + crlf +\x0a\x09\x09\x09\x09\x09\x09\x27Content-Disposition: form-data; name=\x22\x27 + name + \x27\x22; filename=\x22\x27 + unescape(encodeURIComponent(value.name || \x27blob\x27)) + \x27\x22\x27 + crlf +\x0a\x09\x09\x09\x09\x09\x09\x27Content-Type: \x27 + (value.type || \x27application/octet-stream\x27) + crlf + crlf +\x0a\x09\x09\x09\x09\x09\x09value.getSource() + crlf;\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09multipart += dashdash + boundary + crlf +\x0a\x09\x09\x09\x09\x09\x09\x27Content-Disposition: form-data; name=\x22\x27 + name + \x27\x22\x27 + crlf + crlf +\x0a\x09\x09\x09\x09\x09\x09unescape(encodeURIComponent(value)) + crlf;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09});\x0a\x0a\x09\x09\x09multipart += dashdash + boundary + dashdash + crlf;\x0a\x0a\x09\x09\x09return multipart;\x0a\x09\x09}\x0a\x09}\x0a\x0a\x09return (extensions.XMLHttpRequest = XMLHttpRequest);\x0a});\x0a\x0a// Included from: src/javascript/runtime/html5/utils/BinaryReader.js\x0a\x0a/**\x0a * BinaryReader.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/**\x0a@class moxie/runtime/html5/utils/BinaryReader\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html5/utils/BinaryReader\x22, [\x0a\x09\x22moxie/core/utils/Basic\x22\x0a], function(Basic) {\x0a\x0a\x09\x0a\x09function BinaryReader(data) {\x0a\x09\x09if (data instanceof ArrayBuffer) {\x0a\x09\x09\x09ArrayBufferReader.apply(this, arguments);\x0a\x09\x09} else {\x0a\x09\x09\x09UTF16StringReader.apply(this, arguments);\x0a\x09\x09}\x0a\x09}\x0a\x09\xc2\xa0\x0a\x0a\x09Basic.extend(BinaryReader.prototype, {\x0a\x09\x09\x0a\x09\x09littleEndian: false,\x0a\x0a\x0a\x09\x09read: function(idx, size) {\x0a\x09\x09\x09var sum, mv, i;\x0a\x0a\x09\x09\x09if (idx + size \x3e this.length()) {\x0a\x09\x09\x09\x09throw new Error(\x22You are trying to read outside the source boundaries.\x22);\x0a\x09\x09\x09}\x0a\x09\x09\x09\x0a\x09\x09\x09mv = this.littleEndian \x0a\x09\x09\x09\x09? 0 \x0a\x09\x09\x09\x09: -8 * (size - 1)\x0a\x09\x09\x09;\x0a\x0a\x09\x09\x09for (i = 0, sum = 0; i \x3c size; i++) {\x0a\x09\x09\x09\x09sum |= (this.readByteAt(idx + i) \x3c\x3c Math.abs(mv + i*8));\x0a\x09\x09\x09}\x0a\x09\x09\x09return sum;\x0a\x09\x09},\x0a\x0a\x0a\x09\x09write: function(idx, num, size) {\x0a\x09\x09\x09var mv, i, str = \x27\x27;\x0a\x0a\x09\x09\x09if (idx \x3e this.length()) {\x0a\x09\x09\x09\x09throw new Error(\x22You are trying to write outside the source boundaries.\x22);\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09mv = this.littleEndian \x0a\x09\x09\x09\x09? 0 \x0a\x09\x09\x09\x09: -8 * (size - 1)\x0a\x09\x09\x09;\x0a\x0a\x09\x09\x09for (i = 0; i \x3c size; i++) {\x0a\x09\x09\x09\x09this.writeByteAt(idx + i, (num \x3e\x3e Math.abs(mv + i*8)) & 255);\x0a\x09\x09\x09}\x0a\x09\x09},\x0a\x0a\x0a\x09\x09BYTE: function(idx) {\x0a\x09\x09\x09return this.read(idx, 1);\x0a\x09\x09},\x0a\x0a\x0a\x09\x09SHORT: function(idx) {\x0a\x09\x09\x09return this.read(idx, 2);\x0a\x09\x09},\x0a\x0a\x0a\x09\x09LONG: function(idx) {\x0a\x09\x09\x09return this.read(idx, 4);\x0a\x09\x09},\x0a\x0a\x0a\x09\x09SLONG: function(idx) { // 2\x27s complement notation\x0a\x09\x09\x09var num = this.read(idx, 4);\x0a\x09\x09\x09return (num \x3e 2147483647 ? num - 4294967296 : num);\x0a\x09\x09},\x0a\x0a\x0a\x09\x09CHAR: function(idx) {\x0a\x09\x09\x09return String.fromCharCode(this.read(idx, 1));\x0a\x09\x09},\x0a\x0a\x0a\x09\x09STRING: function(idx, count) {\x0a\x09\x09\x09return this.asArray(\x27CHAR\x27, idx, count).join(\x27\x27);\x0a\x09\x09},\x0a\x0a\x0a\x09\x09asArray: function(type, idx, count) {\x0a\x09\x09\x09var values = [];\x0a\x0a\x09\x09\x09for (var i = 0; i \x3c count; i++) {\x0a\x09\x09\x09\x09values[i] = this[type](idx + i);\x0a\x09\x09\x09}\x0a\x09\x09\x09return values;\x0a\x09\x09}\x0a\x09});\x0a\x0a\x0a\x09function ArrayBufferReader(data) {\x0a\x09\x09var _dv = new DataView(data);\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09\x0a\x09\x09\x09readByteAt: function(idx) {\x0a\x09\x09\x09\x09return _dv.getUint8(idx);\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09writeByteAt: function(idx, value) {\x0a\x09\x09\x09\x09_dv.setUint8(idx, value);\x0a\x09\x09\x09},\x0a\x09\x09\x09\x0a\x0a\x09\x09\x09SEGMENT: function(idx, size, value) {\x0a\x09\x09\x09\x09switch (arguments.length) {\x0a\x09\x09\x09\x09\x09case 2:\x0a\x09\x09\x09\x09\x09\x09return data.slice(idx, idx + size);\x0a\x0a\x09\x09\x09\x09\x09case 1:\x0a\x09\x09\x09\x09\x09\x09return data.slice(idx);\x0a\x0a\x09\x09\x09\x09\x09case 3:\x0a\x09\x09\x09\x09\x09\x09if (value === null) {\x0a\x09\x09\x09\x09\x09\x09\x09value = new ArrayBuffer();\x0a\x09\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09\x09if (value instanceof ArrayBuffer) {\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09\x09\x09var arr = new Uint8Array(this.length() - size + value.byteLength);\x0a\x09\x09\x09\x09\x09\x09\x09if (idx \x3e 0) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09arr.set(new Uint8Array(data.slice(0, idx)), 0);\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09\x09arr.set(new Uint8Array(value), idx);\x0a\x09\x09\x09\x09\x09\x09\x09arr.set(new Uint8Array(data.slice(idx + size)), idx + value.byteLength);\x0a\x0a\x09\x09\x09\x09\x09\x09\x09this.clear();\x0a\x09\x09\x09\x09\x09\x09\x09data = arr.buffer;\x0a\x09\x09\x09\x09\x09\x09\x09_dv = new DataView(data);\x0a\x09\x09\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09default: return data;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09length: function() {\x0a\x09\x09\x09\x09return data ? data.byteLength : 0;\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09clear: function() {\x0a\x09\x09\x09\x09_dv = data = null;\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x09}\x0a\x0a\x0a\x09function UTF16StringReader(data) {\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09\x0a\x09\x09\x09readByteAt: function(idx) {\x0a\x09\x09\x09\x09return data.charCodeAt(idx);\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09writeByteAt: function(idx, value) {\x0a\x09\x09\x09\x09putstr(String.fromCharCode(value), idx, 1);\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09SEGMENT: function(idx, length, segment) {\x0a\x09\x09\x09\x09switch (arguments.length) {\x0a\x09\x09\x09\x09\x09case 1:\x0a\x09\x09\x09\x09\x09\x09return data.substr(idx);\x0a\x09\x09\x09\x09\x09case 2:\x0a\x09\x09\x09\x09\x09\x09return data.substr(idx, length);\x0a\x09\x09\x09\x09\x09case 3:\x0a\x09\x09\x09\x09\x09\x09putstr(segment !== null ? segment : \x27\x27, idx, length);\x0a\x09\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09\x09default: return data;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09length: function() {\x0a\x09\x09\x09\x09return data ? data.length : 0;\x0a\x09\x09\x09}, \x0a\x0a\x09\x09\x09clear: function() {\x0a\x09\x09\x09\x09data = null;\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x0a\x09\x09function putstr(segment, idx, length) {\x0a\x09\x09\x09length = arguments.length === 3 ? length : data.length - idx - 1;\x0a\x09\x09\x09data = data.substr(0, idx) + segment + data.substr(length + idx);\x0a\x09\x09}\x0a\x09}\x0a\x0a\x0a\x09return BinaryReader;\x0a});\x0a\x0a// Included from: src/javascript/runtime/html5/image/JPEGHeaders.js\x0a\x0a/**\x0a * JPEGHeaders.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a \x0a/**\x0a@class moxie/runtime/html5/image/JPEGHeaders\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html5/image/JPEGHeaders\x22, [\x0a\x09\x22moxie/runtime/html5/utils/BinaryReader\x22,\x0a\x09\x22moxie/core/Exceptions\x22\x0a], function(BinaryReader, x) {\x0a\x09\x0a\x09return function JPEGHeaders(data) {\x0a\x09\x09var headers = [], _br, idx, marker, length = 0;\x0a\x0a\x09\x09_br = new BinaryReader(data);\x0a\x0a\x09\x09// Check if data is jpeg\x0a\x09\x09if (_br.SHORT(0) !== 0xFFD8) {\x0a\x09\x09\x09_br.clear();\x0a\x09\x09\x09throw new x.ImageError(x.ImageError.WRONG_FORMAT);\x0a\x09\x09}\x0a\x0a\x09\x09idx = 2;\x0a\x0a\x09\x09while (idx \x3c= _br.length()) {\x0a\x09\x09\x09marker = _br.SHORT(idx);\x0a\x0a\x09\x09\x09// omit RST (restart) markers\x0a\x09\x09\x09if (marker \x3e= 0xFFD0 && marker \x3c= 0xFFD7) {\x0a\x09\x09\x09\x09idx += 2;\x0a\x09\x09\x09\x09continue;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09// no headers allowed after SOS marker\x0a\x09\x09\x09if (marker === 0xFFDA || marker === 0xFFD9) {\x0a\x09\x09\x09\x09break;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09length = _br.SHORT(idx + 2) + 2;\x0a\x0a\x09\x09\x09// APPn marker detected\x0a\x09\x09\x09if (marker \x3e= 0xFFE1 && marker \x3c= 0xFFEF) {\x0a\x09\x09\x09\x09headers.push({\x0a\x09\x09\x09\x09\x09hex: marker,\x0a\x09\x09\x09\x09\x09name: \x27APP\x27 + (marker & 0x000F),\x0a\x09\x09\x09\x09\x09start: idx,\x0a\x09\x09\x09\x09\x09length: length,\x0a\x09\x09\x09\x09\x09segment: _br.SEGMENT(idx, length)\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09idx += length;\x0a\x09\x09}\x0a\x0a\x09\x09_br.clear();\x0a\x0a\x09\x09return {\x0a\x09\x09\x09headers: headers,\x0a\x0a\x09\x09\x09restore: function(data) {\x0a\x09\x09\x09\x09var max, i, br;\x0a\x0a\x09\x09\x09\x09br = new BinaryReader(data);\x0a\x0a\x09\x09\x09\x09idx = br.SHORT(2) == 0xFFE0 ? 4 + br.SHORT(4) : 2;\x0a\x0a\x09\x09\x09\x09for (i = 0, max = headers.length; i \x3c max; i++) {\x0a\x09\x09\x09\x09\x09br.SEGMENT(idx, 0, headers[i].segment);\x0a\x09\x09\x09\x09\x09idx += headers[i].length;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09data = br.SEGMENT();\x0a\x09\x09\x09\x09br.clear();\x0a\x09\x09\x09\x09return data;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09strip: function(data) {\x0a\x09\x09\x09\x09var br, headers, jpegHeaders, i;\x0a\x0a\x09\x09\x09\x09jpegHeaders = new JPEGHeaders(data);\x0a\x09\x09\x09\x09headers = jpegHeaders.headers;\x0a\x09\x09\x09\x09jpegHeaders.purge();\x0a\x0a\x09\x09\x09\x09br = new BinaryReader(data);\x0a\x0a\x09\x09\x09\x09i = headers.length;\x0a\x09\x09\x09\x09while (i--) {\x0a\x09\x09\x09\x09\x09br.SEGMENT(headers[i].start, headers[i].length, \x27\x27);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09data = br.SEGMENT();\x0a\x09\x09\x09\x09br.clear();\x0a\x09\x09\x09\x09return data;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09get: function(name) {\x0a\x09\x09\x09\x09var array = [];\x0a\x0a\x09\x09\x09\x09for (var i = 0, max = headers.length; i \x3c max; i++) {\x0a\x09\x09\x09\x09\x09if (headers[i].name === name.toUpperCase()) {\x0a\x09\x09\x09\x09\x09\x09array.push(headers[i].segment);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09return array;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09set: function(name, segment) {\x0a\x09\x09\x09\x09var array = [], i, ii, max;\x0a\x0a\x09\x09\x09\x09if (typeof(segment) === \x27string\x27) {\x0a\x09\x09\x09\x09\x09array.push(segment);\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09array = segment;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09for (i = ii = 0, max = headers.length; i \x3c max; i++) {\x0a\x09\x09\x09\x09\x09if (headers[i].name === name.toUpperCase()) {\x0a\x09\x09\x09\x09\x09\x09headers[i].segment = array[ii];\x0a\x09\x09\x09\x09\x09\x09headers[i].length = array[ii].length;\x0a\x09\x09\x09\x09\x09\x09ii++;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09if (ii \x3e= array.length) {\x0a\x09\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09purge: function() {\x0a\x09\x09\x09\x09this.headers = headers = [];\x0a\x09\x09\x09}\x0a\x09\x09};\x0a\x09};\x0a});\x0a\x0a// Included from: src/javascript/runtime/html5/image/ExifParser.js\x0a\x0a/**\x0a * ExifParser.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/**\x0a@class moxie/runtime/html5/image/ExifParser\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html5/image/ExifParser\x22, [\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/runtime/html5/utils/BinaryReader\x22,\x0a\x09\x22moxie/core/Exceptions\x22\x0a], function(Basic, BinaryReader, x) {\x0a\x09\x0a\x09function ExifParser(data) {\x0a\x09\x09var __super__, tags, tagDescs, offsets, idx, Tiff;\x0a\x09\x09\x0a\x09\x09BinaryReader.call(this, data);\x0a\x0a\x09\x09tags = {\x0a\x09\x09\x09tiff: {\x0a\x09\x09\x09\x09/*\x0a\x09\x09\x09\x09The image orientation viewed in terms of rows and columns.\x0a\x0a\x09\x09\x09\x091 = The 0th row is at the visual top of the image, and the 0th column is the visual left-hand side.\x0a\x09\x09\x09\x092 = The 0th row is at the visual top of the image, and the 0th column is the visual right-hand side.\x0a\x09\x09\x09\x093 = The 0th row is at the visual bottom of the image, and the 0th column is the visual right-hand side.\x0a\x09\x09\x09\x094 = The 0th row is at the visual bottom of the image, and the 0th column is the visual left-hand side.\x0a\x09\x09\x09\x095 = The 0th row is the visual left-hand side of the image, and the 0th column is the visual top.\x0a\x09\x09\x09\x096 = The 0th row is the visual right-hand side of the image, and the 0th column is the visual top.\x0a\x09\x09\x09\x097 = The 0th row is the visual right-hand side of the image, and the 0th column is the visual bottom.\x0a\x09\x09\x09\x098 = The 0th row is the visual left-hand side of the image, and the 0th column is the visual bottom.\x0a\x09\x09\x09\x09*/\x0a\x09\x09\x09\x090x0112: \x27Orientation\x27,\x0a\x09\x09\x09\x090x010E: \x27ImageDescription\x27,\x0a\x09\x09\x09\x090x010F: \x27Make\x27,\x0a\x09\x09\x09\x090x0110: \x27Model\x27,\x0a\x09\x09\x09\x090x0131: \x27Software\x27,\x0a\x09\x09\x09\x090x8769: \x27ExifIFDPointer\x27,\x0a\x09\x09\x09\x090x8825:\x09\x27GPSInfoIFDPointer\x27\x0a\x09\x09\x09},\x0a\x09\x09\x09exif: {\x0a\x09\x09\x09\x090x9000: \x27ExifVersion\x27,\x0a\x09\x09\x09\x090xA001: \x27ColorSpace\x27,\x0a\x09\x09\x09\x090xA002: \x27PixelXDimension\x27,\x0a\x09\x09\x09\x090xA003: \x27PixelYDimension\x27,\x0a\x09\x09\x09\x090x9003: \x27DateTimeOriginal\x27,\x0a\x09\x09\x09\x090x829A: \x27ExposureTime\x27,\x0a\x09\x09\x09\x090x829D: \x27FNumber\x27,\x0a\x09\x09\x09\x090x8827: \x27ISOSpeedRatings\x27,\x0a\x09\x09\x09\x090x9201: \x27ShutterSpeedValue\x27,\x0a\x09\x09\x09\x090x9202: \x27ApertureValue\x27\x09,\x0a\x09\x09\x09\x090x9207: \x27MeteringMode\x27,\x0a\x09\x09\x09\x090x9208: \x27LightSource\x27,\x0a\x09\x09\x09\x090x9209: \x27Flash\x27,\x0a\x09\x09\x09\x090x920A: \x27FocalLength\x27,\x0a\x09\x09\x09\x090xA402: \x27ExposureMode\x27,\x0a\x09\x09\x09\x090xA403: \x27WhiteBalance\x27,\x0a\x09\x09\x09\x090xA406: \x27SceneCaptureType\x27,\x0a\x09\x09\x09\x090xA404: \x27DigitalZoomRatio\x27,\x0a\x09\x09\x09\x090xA408: \x27Contrast\x27,\x0a\x09\x09\x09\x090xA409: \x27Saturation\x27,\x0a\x09\x09\x09\x090xA40A: \x27Sharpness\x27\x0a\x09\x09\x09},\x0a\x09\x09\x09gps: {\x0a\x09\x09\x09\x090x0000: \x27GPSVersionID\x27,\x0a\x09\x09\x09\x090x0001: \x27GPSLatitudeRef\x27,\x0a\x09\x09\x09\x090x0002: \x27GPSLatitude\x27,\x0a\x09\x09\x09\x090x0003: \x27GPSLongitudeRef\x27,\x0a\x09\x09\x09\x090x0004: \x27GPSLongitude\x27\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09thumb: {\x0a\x09\x09\x09\x090x0201: \x27JPEGInterchangeFormat\x27,\x0a\x09\x09\x09\x090x0202: \x27JPEGInterchangeFormatLength\x27\x0a\x09\x09\x09}\x0a\x09\x09};\x0a\x0a\x09\x09tagDescs = {\x0a\x09\x09\x09\x27ColorSpace\x27: {\x0a\x09\x09\x09\x091: \x27sRGB\x27,\x0a\x09\x09\x09\x090: \x27Uncalibrated\x27\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09\x27MeteringMode\x27: {\x0a\x09\x09\x09\x090: \x27Unknown\x27,\x0a\x09\x09\x09\x091: \x27Average\x27,\x0a\x09\x09\x09\x092: \x27CenterWeightedAverage\x27,\x0a\x09\x09\x09\x093: \x27Spot\x27,\x0a\x09\x09\x09\x094: \x27MultiSpot\x27,\x0a\x09\x09\x09\x095: \x27Pattern\x27,\x0a\x09\x09\x09\x096: \x27Partial\x27,\x0a\x09\x09\x09\x09255: \x27Other\x27\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09\x27LightSource\x27: {\x0a\x09\x09\x09\x091: \x27Daylight\x27,\x0a\x09\x09\x09\x092: \x27Fliorescent\x27,\x0a\x09\x09\x09\x093: \x27Tungsten\x27,\x0a\x09\x09\x09\x094: \x27Flash\x27,\x0a\x09\x09\x09\x099: \x27Fine weather\x27,\x0a\x09\x09\x09\x0910: \x27Cloudy weather\x27,\x0a\x09\x09\x09\x0911: \x27Shade\x27,\x0a\x09\x09\x09\x0912: \x27Daylight fluorescent (D 5700 - 7100K)\x27,\x0a\x09\x09\x09\x0913: \x27Day white fluorescent (N 4600 -5400K)\x27,\x0a\x09\x09\x09\x0914: \x27Cool white fluorescent (W 3900 - 4500K)\x27,\x0a\x09\x09\x09\x0915: \x27White fluorescent (WW 3200 - 3700K)\x27,\x0a\x09\x09\x09\x0917: \x27Standard light A\x27,\x0a\x09\x09\x09\x0918: \x27Standard light B\x27,\x0a\x09\x09\x09\x0919: \x27Standard light C\x27,\x0a\x09\x09\x09\x0920: \x27D55\x27,\x0a\x09\x09\x09\x0921: \x27D65\x27,\x0a\x09\x09\x09\x0922: \x27D75\x27,\x0a\x09\x09\x09\x0923: \x27D50\x27,\x0a\x09\x09\x09\x0924: \x27ISO studio tungsten\x27,\x0a\x09\x09\x09\x09255: \x27Other\x27\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09\x27Flash\x27: {\x0a\x09\x09\x09\x090x0000: \x27Flash did not fire\x27,\x0a\x09\x09\x09\x090x0001: \x27Flash fired\x27,\x0a\x09\x09\x09\x090x0005: \x27Strobe return light not detected\x27,\x0a\x09\x09\x09\x090x0007: \x27Strobe return light detected\x27,\x0a\x09\x09\x09\x090x0009: \x27Flash fired, compulsory flash mode\x27,\x0a\x09\x09\x09\x090x000D: \x27Flash fired, compulsory flash mode, return light not detected\x27,\x0a\x09\x09\x09\x090x000F: \x27Flash fired, compulsory flash mode, return light detected\x27,\x0a\x09\x09\x09\x090x0010: \x27Flash did not fire, compulsory flash mode\x27,\x0a\x09\x09\x09\x090x0018: \x27Flash did not fire, auto mode\x27,\x0a\x09\x09\x09\x090x0019: \x27Flash fired, auto mode\x27,\x0a\x09\x09\x09\x090x001D: \x27Flash fired, auto mode, return light not detected\x27,\x0a\x09\x09\x09\x090x001F: \x27Flash fired, auto mode, return light detected\x27,\x0a\x09\x09\x09\x090x0020: \x27No flash function\x27,\x0a\x09\x09\x09\x090x0041: \x27Flash fired, red-eye reduction mode\x27,\x0a\x09\x09\x09\x090x0045: \x27Flash fired, red-eye reduction mode, return light not detected\x27,\x0a\x09\x09\x09\x090x0047: \x27Flash fired, red-eye reduction mode, return light detected\x27,\x0a\x09\x09\x09\x090x0049: \x27Flash fired, compulsory flash mode, red-eye reduction mode\x27,\x0a\x09\x09\x09\x090x004D: \x27Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected\x27,\x0a\x09\x09\x09\x090x004F: \x27Flash fired, compulsory flash mode, red-eye reduction mode, return light detected\x27,\x0a\x09\x09\x09\x090x0059: \x27Flash fired, auto mode, red-eye reduction mode\x27,\x0a\x09\x09\x09\x090x005D: \x27Flash fired, auto mode, return light not detected, red-eye reduction mode\x27,\x0a\x09\x09\x09\x090x005F: \x27Flash fired, auto mode, return light detected, red-eye reduction mode\x27\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09\x27ExposureMode\x27: {\x0a\x09\x09\x09\x090: \x27Auto exposure\x27,\x0a\x09\x09\x09\x091: \x27Manual exposure\x27,\x0a\x09\x09\x09\x092: \x27Auto bracket\x27\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09\x27WhiteBalance\x27: {\x0a\x09\x09\x09\x090: \x27Auto white balance\x27,\x0a\x09\x09\x09\x091: \x27Manual white balance\x27\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09\x27SceneCaptureType\x27: {\x0a\x09\x09\x09\x090: \x27Standard\x27,\x0a\x09\x09\x09\x091: \x27Landscape\x27,\x0a\x09\x09\x09\x092: \x27Portrait\x27,\x0a\x09\x09\x09\x093: \x27Night scene\x27\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09\x27Contrast\x27: {\x0a\x09\x09\x09\x090: \x27Normal\x27,\x0a\x09\x09\x09\x091: \x27Soft\x27,\x0a\x09\x09\x09\x092: \x27Hard\x27\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09\x27Saturation\x27: {\x0a\x09\x09\x09\x090: \x27Normal\x27,\x0a\x09\x09\x09\x091: \x27Low saturation\x27,\x0a\x09\x09\x09\x092: \x27High saturation\x27\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09\x27Sharpness\x27: {\x0a\x09\x09\x09\x090: \x27Normal\x27,\x0a\x09\x09\x09\x091: \x27Soft\x27,\x0a\x09\x09\x09\x092: \x27Hard\x27\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09// GPS related\x0a\x09\x09\x09\x27GPSLatitudeRef\x27: {\x0a\x09\x09\x09\x09N: \x27North latitude\x27,\x0a\x09\x09\x09\x09S: \x27South latitude\x27\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09\x27GPSLongitudeRef\x27: {\x0a\x09\x09\x09\x09E: \x27East longitude\x27,\x0a\x09\x09\x09\x09W: \x27West longitude\x27\x0a\x09\x09\x09}\x0a\x09\x09};\x0a\x0a\x09\x09offsets = {\x0a\x09\x09\x09tiffHeader: 10\x0a\x09\x09};\x0a\x09\x09\x0a\x09\x09idx = offsets.tiffHeader;\x0a\x0a\x09\x09__super__ = {\x0a\x09\x09\x09clear: this.clear\x0a\x09\x09};\x0a\x0a\x09\x09// Public functions\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09\x0a\x09\x09\x09read: function() {\x0a\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09return ExifParser.prototype.read.apply(this, arguments);\x0a\x09\x09\x09\x09} catch (ex) {\x0a\x09\x09\x09\x09\x09throw new x.ImageError(x.ImageError.INVALID_META_ERR);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09write: function() {\x0a\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09return ExifParser.prototype.write.apply(this, arguments);\x0a\x09\x09\x09\x09} catch (ex) {\x0a\x09\x09\x09\x09\x09throw new x.ImageError(x.ImageError.INVALID_META_ERR);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09UNDEFINED: function() {\x0a\x09\x09\x09\x09return this.BYTE.apply(this, arguments);\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09RATIONAL: function(idx) {\x0a\x09\x09\x09\x09return this.LONG(idx) / this.LONG(idx + 4)\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09SRATIONAL: function(idx) {\x0a\x09\x09\x09\x09return this.SLONG(idx) / this.SLONG(idx + 4)\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09ASCII: function(idx) {\x0a\x09\x09\x09\x09return this.CHAR(idx);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09TIFF: function() {\x0a\x09\x09\x09\x09return Tiff || null;\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09EXIF: function() {\x0a\x09\x09\x09\x09var Exif = null;\x0a\x0a\x09\x09\x09\x09if (offsets.exifIFD) {\x0a\x09\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09\x09Exif = extractTags.call(this, offsets.exifIFD, tags.exif);\x0a\x09\x09\x09\x09\x09} catch(ex) {\x0a\x09\x09\x09\x09\x09\x09return null;\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09// Fix formatting of some tags\x0a\x09\x09\x09\x09\x09if (Exif.ExifVersion && Basic.typeOf(Exif.ExifVersion) === \x27array\x27) {\x0a\x09\x09\x09\x09\x09\x09for (var i = 0, exifVersion = \x27\x27; i \x3c Exif.ExifVersion.length; i++) {\x0a\x09\x09\x09\x09\x09\x09\x09exifVersion += String.fromCharCode(Exif.ExifVersion[i]);\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09Exif.ExifVersion = exifVersion;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09return Exif;\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09GPS: function() {\x0a\x09\x09\x09\x09var GPS = null;\x0a\x0a\x09\x09\x09\x09if (offsets.gpsIFD) {\x0a\x09\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09\x09GPS = extractTags.call(this, offsets.gpsIFD, tags.gps);\x0a\x09\x09\x09\x09\x09} catch (ex) {\x0a\x09\x09\x09\x09\x09\x09return null;\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09// iOS devices (and probably some others) do not put in GPSVersionID tag (why?..)\x0a\x09\x09\x09\x09\x09if (GPS.GPSVersionID && Basic.typeOf(GPS.GPSVersionID) === \x27array\x27) {\x0a\x09\x09\x09\x09\x09\x09GPS.GPSVersionID = GPS.GPSVersionID.join(\x27.\x27);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09return GPS;\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09thumb: function() {\x0a\x09\x09\x09\x09if (offsets.IFD1) {\x0a\x09\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09\x09var IFD1Tags = extractTags.call(this, offsets.IFD1, tags.thumb);\x0a\x09\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09\x09if (\x27JPEGInterchangeFormat\x27 in IFD1Tags) {\x0a\x09\x09\x09\x09\x09\x09\x09return this.SEGMENT(offsets.tiffHeader + IFD1Tags.JPEGInterchangeFormat, IFD1Tags.JPEGInterchangeFormatLength);\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09} catch (ex) {}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09return null;\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09setExif: function(tag, value) {\x0a\x09\x09\x09\x09// Right now only setting of width/height is possible\x0a\x09\x09\x09\x09if (tag !== \x27PixelXDimension\x27 && tag !== \x27PixelYDimension\x27) { return false; }\x0a\x0a\x09\x09\x09\x09return setTag.call(this, \x27exif\x27, tag, value);\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09clear: function() {\x0a\x09\x09\x09\x09__super__.clear();\x0a\x09\x09\x09\x09data = tags = tagDescs = Tiff = offsets = __super__ = null;\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x0a\x09\x09// Check if that\x27s APP1 and that it has EXIF\x0a\x09\x09if (this.SHORT(0) !== 0xFFE1 || this.STRING(4, 5).toUpperCase() !== \x22EXIF\x5c0\x22) {\x0a\x09\x09\x09throw new x.ImageError(x.ImageError.INVALID_META_ERR);\x0a\x09\x09}\x0a\x0a\x09\x09// Set read order of multi-byte data\x0a\x09\x09this.littleEndian = (this.SHORT(idx) == 0x4949);\x0a\x0a\x09\x09// Check if always present bytes are indeed present\x0a\x09\x09if (this.SHORT(idx+=2) !== 0x002A) {\x0a\x09\x09\x09throw new x.ImageError(x.ImageError.INVALID_META_ERR);\x0a\x09\x09}\x0a\x0a\x09\x09offsets.IFD0 = offsets.tiffHeader + this.LONG(idx += 2);\x0a\x09\x09Tiff = extractTags.call(this, offsets.IFD0, tags.tiff);\x0a\x0a\x09\x09if (\x27ExifIFDPointer\x27 in Tiff) {\x0a\x09\x09\x09offsets.exifIFD = offsets.tiffHeader + Tiff.ExifIFDPointer;\x0a\x09\x09\x09delete Tiff.ExifIFDPointer;\x0a\x09\x09}\x0a\x0a\x09\x09if (\x27GPSInfoIFDPointer\x27 in Tiff) {\x0a\x09\x09\x09offsets.gpsIFD = offsets.tiffHeader + Tiff.GPSInfoIFDPointer;\x0a\x09\x09\x09delete Tiff.GPSInfoIFDPointer;\x0a\x09\x09}\x0a\x0a\x09\x09if (Basic.isEmptyObj(Tiff)) {\x0a\x09\x09\x09Tiff = null;\x0a\x09\x09}\x0a\x0a\x09\x09// check if we have a thumb as well\x0a\x09\x09var IFD1Offset = this.LONG(offsets.IFD0 + this.SHORT(offsets.IFD0) * 12 + 2);\x0a\x09\x09if (IFD1Offset) {\x0a\x09\x09\x09offsets.IFD1 = offsets.tiffHeader + IFD1Offset;\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function extractTags(IFD_offset, tags2extract) {\x0a\x09\x09\x09var data = this;\x0a\x09\x09\x09var length, i, tag, type, count, size, offset, value, values = [], hash = {};\x0a\x09\x09\x09\x0a\x09\x09\x09var types = {\x0a\x09\x09\x09\x091 : \x27BYTE\x27,\x0a\x09\x09\x09\x097 : \x27UNDEFINED\x27,\x0a\x09\x09\x09\x092 : \x27ASCII\x27,\x0a\x09\x09\x09\x093 : \x27SHORT\x27,\x0a\x09\x09\x09\x094 : \x27LONG\x27,\x0a\x09\x09\x09\x095 : \x27RATIONAL\x27,\x0a\x09\x09\x09\x099 : \x27SLONG\x27,\x0a\x09\x09\x09\x0910: \x27SRATIONAL\x27\x0a\x09\x09\x09};\x0a\x0a\x09\x09\x09var sizes = {\x0a\x09\x09\x09\x09\x27BYTE\x27 \x09\x09: 1,\x0a\x09\x09\x09\x09\x27UNDEFINED\x27\x09: 1,\x0a\x09\x09\x09\x09\x27ASCII\x27\x09\x09: 1,\x0a\x09\x09\x09\x09\x27SHORT\x27\x09\x09: 2,\x0a\x09\x09\x09\x09\x27LONG\x27 \x09\x09: 4,\x0a\x09\x09\x09\x09\x27RATIONAL\x27 \x09: 8,\x0a\x09\x09\x09\x09\x27SLONG\x27\x09\x09: 4,\x0a\x09\x09\x09\x09\x27SRATIONAL\x27\x09: 8\x0a\x09\x09\x09};\x0a\x0a\x09\x09\x09length = data.SHORT(IFD_offset);\x0a\x0a\x09\x09\x09// The size of APP1 including all these elements shall not exceed the 64 Kbytes specified in the JPEG standard.\x0a\x0a\x09\x09\x09for (i = 0; i \x3c length; i++) {\x0a\x09\x09\x09\x09values = [];\x0a\x0a\x09\x09\x09\x09// Set binary reader pointer to beginning of the next tag\x0a\x09\x09\x09\x09offset = IFD_offset + 2 + i*12;\x0a\x0a\x09\x09\x09\x09tag = tags2extract[data.SHORT(offset)];\x0a\x0a\x09\x09\x09\x09if (tag === undefined) {\x0a\x09\x09\x09\x09\x09continue; // Not the tag we requested\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09type = types[data.SHORT(offset+=2)];\x0a\x09\x09\x09\x09count = data.LONG(offset+=2);\x0a\x09\x09\x09\x09size = sizes[type];\x0a\x0a\x09\x09\x09\x09if (!size) {\x0a\x09\x09\x09\x09\x09throw new x.ImageError(x.ImageError.INVALID_META_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09offset += 4;\x0a\x0a\x09\x09\x09\x09// tag can only fit 4 bytes of data, if data is larger we should look outside\x0a\x09\x09\x09\x09if (size * count \x3e 4) {\x0a\x09\x09\x09\x09\x09// instead of data tag contains an offset of the data\x0a\x09\x09\x09\x09\x09offset = data.LONG(offset) + offsets.tiffHeader;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// in case we left the boundaries of data throw an early exception\x0a\x09\x09\x09\x09if (offset + size * count \x3e= this.length()) {\x0a\x09\x09\x09\x09\x09throw new x.ImageError(x.ImageError.INVALID_META_ERR);\x0a\x09\x09\x09\x09} \x0a\x0a\x09\x09\x09\x09// special care for the string\x0a\x09\x09\x09\x09if (type === \x27ASCII\x27) {\x0a\x09\x09\x09\x09\x09hash[tag] = Basic.trim(data.STRING(offset, count).replace(/\x5c0$/, \x27\x27)); // strip trailing NULL\x0a\x09\x09\x09\x09\x09continue;\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09values = data.asArray(type, offset, count);\x0a\x09\x09\x09\x09\x09value = (count == 1 ? values[0] : values);\x0a\x0a\x09\x09\x09\x09\x09if (tagDescs.hasOwnProperty(tag) && typeof value != \x27object\x27) {\x0a\x09\x09\x09\x09\x09\x09hash[tag] = tagDescs[tag][value];\x0a\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09hash[tag] = value;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09return hash;\x0a\x09\x09}\x0a\x0a\x09\x09// At the moment only setting of simple (LONG) values, that do not require offset recalculation, is supported\x0a\x09\x09function setTag(ifd, tag, value) {\x0a\x09\x09\x09var offset, length, tagOffset, valueOffset = 0;\x0a\x0a\x09\x09\x09// If tag name passed translate into hex key\x0a\x09\x09\x09if (typeof(tag) === \x27string\x27) {\x0a\x09\x09\x09\x09var tmpTags = tags[ifd.toLowerCase()];\x0a\x09\x09\x09\x09for (var hex in tmpTags) {\x0a\x09\x09\x09\x09\x09if (tmpTags[hex] === tag) {\x0a\x09\x09\x09\x09\x09\x09tag = hex;\x0a\x09\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x09\x09\x09offset = offsets[ifd.toLowerCase() + \x27IFD\x27];\x0a\x09\x09\x09length = this.SHORT(offset);\x0a\x0a\x09\x09\x09for (var i = 0; i \x3c length; i++) {\x0a\x09\x09\x09\x09tagOffset = offset + 12 * i + 2;\x0a\x0a\x09\x09\x09\x09if (this.SHORT(tagOffset) == tag) {\x0a\x09\x09\x09\x09\x09valueOffset = tagOffset + 8;\x0a\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09if (!valueOffset) {\x0a\x09\x09\x09\x09return false;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09try {\x0a\x09\x09\x09\x09this.write(valueOffset, value, 4);\x0a\x09\x09\x09} catch(ex) {\x0a\x09\x09\x09\x09return false;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09return true;\x0a\x09\x09}\x0a\x09}\x0a\x0a\x09ExifParser.prototype = BinaryReader.prototype;\x0a\x0a\x09return ExifParser;\x0a});\x0a\x0a// Included from: src/javascript/runtime/html5/image/JPEG.js\x0a\x0a/**\x0a * JPEG.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/**\x0a@class moxie/runtime/html5/image/JPEG\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html5/image/JPEG\x22, [\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/core/Exceptions\x22,\x0a\x09\x22moxie/runtime/html5/image/JPEGHeaders\x22,\x0a\x09\x22moxie/runtime/html5/utils/BinaryReader\x22,\x0a\x09\x22moxie/runtime/html5/image/ExifParser\x22\x0a], function(Basic, x, JPEGHeaders, BinaryReader, ExifParser) {\x0a\x09\x0a\x09function JPEG(data) {\x0a\x09\x09var _br, _hm, _ep, _info;\x0a\x0a\x09\x09_br = new BinaryReader(data);\x0a\x0a\x09\x09// check if it is jpeg\x0a\x09\x09if (_br.SHORT(0) !== 0xFFD8) {\x0a\x09\x09\x09throw new x.ImageError(x.ImageError.WRONG_FORMAT);\x0a\x09\x09}\x0a\x0a\x09\x09// backup headers\x0a\x09\x09_hm = new JPEGHeaders(data);\x0a\x0a\x09\x09// extract exif info\x0a\x09\x09try {\x0a\x09\x09\x09_ep = new ExifParser(_hm.get(\x27app1\x27)[0]);\x0a\x09\x09} catch(ex) {}\x0a\x0a\x09\x09// get dimensions\x0a\x09\x09_info = _getDimensions.call(this);\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09type: \x27image/jpeg\x27,\x0a\x0a\x09\x09\x09size: _br.length(),\x0a\x0a\x09\x09\x09width: _info && _info.width || 0,\x0a\x0a\x09\x09\x09height: _info && _info.height || 0,\x0a\x0a\x09\x09\x09setExif: function(tag, value) {\x0a\x09\x09\x09\x09if (!_ep) {\x0a\x09\x09\x09\x09\x09return false; // or throw an exception\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if (Basic.typeOf(tag) === \x27object\x27) {\x0a\x09\x09\x09\x09\x09Basic.each(tag, function(value, tag) {\x0a\x09\x09\x09\x09\x09\x09_ep.setExif(tag, value);\x0a\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09_ep.setExif(tag, value);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// update internal headers\x0a\x09\x09\x09\x09_hm.set(\x27app1\x27, _ep.SEGMENT());\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09writeHeaders: function() {\x0a\x09\x09\x09\x09if (!arguments.length) {\x0a\x09\x09\x09\x09\x09// if no arguments passed, update headers internally\x0a\x09\x09\x09\x09\x09return _hm.restore(data);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09return _hm.restore(arguments[0]);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09stripHeaders: function(data) {\x0a\x09\x09\x09\x09return _hm.strip(data);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09purge: function() {\x0a\x09\x09\x09\x09_purge.call(this);\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09if (_ep) {\x0a\x09\x09\x09this.meta = {\x0a\x09\x09\x09\x09tiff: _ep.TIFF(),\x0a\x09\x09\x09\x09exif: _ep.EXIF(),\x0a\x09\x09\x09\x09gps: _ep.GPS(),\x0a\x09\x09\x09\x09thumb: _getThumb()\x0a\x09\x09\x09};\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _getDimensions(br) {\x0a\x09\x09\x09var idx = 0\x0a\x09\x09\x09, marker\x0a\x09\x09\x09, length\x0a\x09\x09\x09;\x0a\x0a\x09\x09\x09if (!br) {\x0a\x09\x09\x09\x09br = _br;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09// examine all through the end, since some images might have very large APP segments\x0a\x09\x09\x09while (idx \x3c= br.length()) {\x0a\x09\x09\x09\x09marker = br.SHORT(idx += 2);\x0a\x0a\x09\x09\x09\x09if (marker \x3e= 0xFFC0 && marker \x3c= 0xFFC3) { // SOFn\x0a\x09\x09\x09\x09\x09idx += 5; // marker (2 bytes) + length (2 bytes) + Sample precision (1 byte)\x0a\x09\x09\x09\x09\x09return {\x0a\x09\x09\x09\x09\x09\x09height: br.SHORT(idx),\x0a\x09\x09\x09\x09\x09\x09width: br.SHORT(idx += 2)\x0a\x09\x09\x09\x09\x09};\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09length = br.SHORT(idx += 2);\x0a\x09\x09\x09\x09idx += length - 2;\x0a\x09\x09\x09}\x0a\x09\x09\x09return null;\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _getThumb() {\x0a\x09\x09\x09var data =  _ep.thumb()\x0a\x09\x09\x09, br\x0a\x09\x09\x09, info\x0a\x09\x09\x09;\x0a\x0a\x09\x09\x09if (data) {\x0a\x09\x09\x09\x09br = new BinaryReader(data);\x0a\x09\x09\x09\x09info = _getDimensions(br);\x0a\x09\x09\x09\x09br.clear();\x0a\x0a\x09\x09\x09\x09if (info) {\x0a\x09\x09\x09\x09\x09info.data = data;\x0a\x09\x09\x09\x09\x09return info;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x09\x09\x09return null;\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _purge() {\x0a\x09\x09\x09if (!_ep || !_hm || !_br) { \x0a\x09\x09\x09\x09return; // ignore any repeating purge requests\x0a\x09\x09\x09}\x0a\x09\x09\x09_ep.clear();\x0a\x09\x09\x09_hm.purge();\x0a\x09\x09\x09_br.clear();\x0a\x09\x09\x09_info = _hm = _ep = _br = null;\x0a\x09\x09}\x0a\x09}\x0a\x0a\x09return JPEG;\x0a});\x0a\x0a// Included from: src/javascript/runtime/html5/image/PNG.js\x0a\x0a/**\x0a * PNG.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/**\x0a@class moxie/runtime/html5/image/PNG\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html5/image/PNG\x22, [\x0a\x09\x22moxie/core/Exceptions\x22,\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/runtime/html5/utils/BinaryReader\x22\x0a], function(x, Basic, BinaryReader) {\x0a\x09\x0a\x09function PNG(data) {\x0a\x09\x09var _br, _hm, _ep, _info;\x0a\x0a\x09\x09_br = new BinaryReader(data);\x0a\x0a\x09\x09// check if it\x27s png\x0a\x09\x09(function() {\x0a\x09\x09\x09var idx = 0, i = 0\x0a\x09\x09\x09, signature = [0x8950, 0x4E47, 0x0D0A, 0x1A0A]\x0a\x09\x09\x09;\x0a\x0a\x09\x09\x09for (i = 0; i \x3c signature.length; i++, idx += 2) {\x0a\x09\x09\x09\x09if (signature[i] != _br.SHORT(idx)) {\x0a\x09\x09\x09\x09\x09throw new x.ImageError(x.ImageError.WRONG_FORMAT);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x09\x09}());\x0a\x0a\x09\x09function _getDimensions() {\x0a\x09\x09\x09var chunk, idx;\x0a\x0a\x09\x09\x09chunk = _getChunkAt.call(this, 8);\x0a\x0a\x09\x09\x09if (chunk.type == \x27IHDR\x27) {\x0a\x09\x09\x09\x09idx = chunk.start;\x0a\x09\x09\x09\x09return {\x0a\x09\x09\x09\x09\x09width: _br.LONG(idx),\x0a\x09\x09\x09\x09\x09height: _br.LONG(idx += 4)\x0a\x09\x09\x09\x09};\x0a\x09\x09\x09}\x0a\x09\x09\x09return null;\x0a\x09\x09}\x0a\x0a\x09\x09function _purge() {\x0a\x09\x09\x09if (!_br) {\x0a\x09\x09\x09\x09return; // ignore any repeating purge requests\x0a\x09\x09\x09}\x0a\x09\x09\x09_br.clear();\x0a\x09\x09\x09data = _info = _hm = _ep = _br = null;\x0a\x09\x09}\x0a\x0a\x09\x09_info = _getDimensions.call(this);\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09type: \x27image/png\x27,\x0a\x0a\x09\x09\x09size: _br.length(),\x0a\x0a\x09\x09\x09width: _info.width,\x0a\x0a\x09\x09\x09height: _info.height,\x0a\x0a\x09\x09\x09purge: function() {\x0a\x09\x09\x09\x09_purge.call(this);\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09// for PNG we can safely trigger purge automatically, as we do not keep any data for later\x0a\x09\x09_purge.call(this);\x0a\x0a\x09\x09function _getChunkAt(idx) {\x0a\x09\x09\x09var length, type, start, CRC;\x0a\x0a\x09\x09\x09length = _br.LONG(idx);\x0a\x09\x09\x09type = _br.STRING(idx += 4, 4);\x0a\x09\x09\x09start = idx += 4;\x0a\x09\x09\x09CRC = _br.LONG(idx + length);\x0a\x0a\x09\x09\x09return {\x0a\x09\x09\x09\x09length: length,\x0a\x09\x09\x09\x09type: type,\x0a\x09\x09\x09\x09start: start,\x0a\x09\x09\x09\x09CRC: CRC\x0a\x09\x09\x09};\x0a\x09\x09}\x0a\x09}\x0a\x0a\x09return PNG;\x0a});\x0a\x0a// Included from: src/javascript/runtime/html5/image/ImageInfo.js\x0a\x0a/**\x0a * ImageInfo.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/**\x0a@class moxie/runtime/html5/image/ImageInfo\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html5/image/ImageInfo\x22, [\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/core/Exceptions\x22,\x0a\x09\x22moxie/runtime/html5/image/JPEG\x22,\x0a\x09\x22moxie/runtime/html5/image/PNG\x22\x0a], function(Basic, x, JPEG, PNG) {\x0a\x09/**\x0a\x09Optional image investigation tool for HTML5 runtime. Provides the following features:\x0a\x09- ability to distinguish image type (JPEG or PNG) by signature\x0a\x09- ability to extract image width/height directly from it\x27s internals, without preloading in memory (fast)\x0a\x09- ability to extract APP headers from JPEGs (Exif, GPS, etc)\x0a\x09- ability to replace width/height tags in extracted JPEG headers\x0a\x09- ability to restore APP headers, that were for example stripped during image manipulation\x0a\x0a\x09@class ImageInfo\x0a\x09@constructor\x0a\x09@param {String} data Image source as binary string\x0a\x09*/\x0a\x09return function(data) {\x0a\x09\x09var _cs = [JPEG, PNG], _img;\x0a\x0a\x09\x09// figure out the format, throw: ImageError.WRONG_FORMAT if not supported\x0a\x09\x09_img = (function() {\x0a\x09\x09\x09for (var i = 0; i \x3c _cs.length; i++) {\x0a\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09return new _cs[i](data);\x0a\x09\x09\x09\x09} catch (ex) {\x0a\x09\x09\x09\x09\x09// console.info(ex);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x09\x09\x09throw new x.ImageError(x.ImageError.WRONG_FORMAT);\x0a\x09\x09}());\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09/**\x0a\x09\x09\x09Image Mime Type extracted from it\x27s depths\x0a\x0a\x09\x09\x09@property type\x0a\x09\x09\x09@type {String}\x0a\x09\x09\x09@default \x27\x27\x0a\x09\x09\x09*/\x0a\x09\x09\x09type: \x27\x27,\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Image size in bytes\x0a\x0a\x09\x09\x09@property size\x0a\x09\x09\x09@type {Number}\x0a\x09\x09\x09@default 0\x0a\x09\x09\x09*/\x0a\x09\x09\x09size: 0,\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Image width extracted from image source\x0a\x0a\x09\x09\x09@property width\x0a\x09\x09\x09@type {Number}\x0a\x09\x09\x09@default 0\x0a\x09\x09\x09*/\x0a\x09\x09\x09width: 0,\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Image height extracted from image source\x0a\x0a\x09\x09\x09@property height\x0a\x09\x09\x09@type {Number}\x0a\x09\x09\x09@default 0\x0a\x09\x09\x09*/\x0a\x09\x09\x09height: 0,\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Sets Exif tag. Currently applicable only for width and height tags. Obviously works only with JPEGs.\x0a\x0a\x09\x09\x09@method setExif\x0a\x09\x09\x09@param {String} tag Tag to set\x0a\x09\x09\x09@param {Mixed} value Value to assign to the tag\x0a\x09\x09\x09*/\x0a\x09\x09\x09setExif: function() {},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Restores headers to the source.\x0a\x0a\x09\x09\x09@method writeHeaders\x0a\x09\x09\x09@param {String} data Image source as binary string\x0a\x09\x09\x09@return {String} Updated binary string\x0a\x09\x09\x09*/\x0a\x09\x09\x09writeHeaders: function(data) {\x0a\x09\x09\x09\x09return data;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Strip all headers from the source.\x0a\x0a\x09\x09\x09@method stripHeaders\x0a\x09\x09\x09@param {String} data Image source as binary string\x0a\x09\x09\x09@return {String} Updated binary string\x0a\x09\x09\x09*/\x0a\x09\x09\x09stripHeaders: function(data) {\x0a\x09\x09\x09\x09return data;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x09Dispose resources.\x0a\x0a\x09\x09\x09@method purge\x0a\x09\x09\x09*/\x0a\x09\x09\x09purge: function() {\x0a\x09\x09\x09\x09data = null;\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09Basic.extend(this, _img);\x0a\x0a\x09\x09this.purge = function() {\x0a\x09\x09\x09_img.purge();\x0a\x09\x09\x09_img = null;\x0a\x09\x09};\x0a\x09};\x0a});\x0a\x0a// Included from: src/javascript/runtime/html5/image/MegaPixel.js\x0a\x0a/**\x0a(The MIT License)\x0a\x0aCopyright (c) 2012 Shinichi Tomita \x3cshinichi.tomita@gmail.com\x3e;\x0a\x0aPermission is hereby granted, free of charge, to any person obtaining\x0aa copy of this software and associated documentation files (the\x0a\x27Software\x27), to deal in the Software without restriction, including\x0awithout limitation the rights to use, copy, modify, merge, publish,\x0adistribute, sublicense, and/or sell copies of the Software, and to\x0apermit persons to whom the Software is furnished to do so, subject to\x0athe following conditions:\x0a\x0aThe above copyright notice and this permission notice shall be\x0aincluded in all copies or substantial portions of the Software.\x0a\x0aTHE SOFTWARE IS PROVIDED \x27AS IS\x27, WITHOUT WARRANTY OF ANY KIND,\x0aEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\x0aMERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\x0aIN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\x0aCLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\x0aTORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\x0aSOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\x0a*/\x0a\x0a/**\x0a * Mega pixel image rendering library for iOS6 Safari\x0a *\x0a * Fixes iOS6 Safari\x27s image file rendering issue for large size image (over mega-pixel),\x0a * which causes unexpected subsampling when drawing it in canvas.\x0a * By using this library, you can safely render the image with proper stretching.\x0a *\x0a * Copyright (c) 2012 Shinichi Tomita \x3cshinichi.tomita@gmail.com\x3e\x0a * Released under the MIT license\x0a */\x0a\x0a/**\x0a@class moxie/runtime/html5/image/MegaPixel\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html5/image/MegaPixel\x22, [], function() {\x0a\x0a\x09/**\x0a\x09 * Rendering image element (with resizing) into the canvas element\x0a\x09 */\x0a\x09function renderImageToCanvas(img, canvas, options) {\x0a\x09\x09var iw = img.naturalWidth, ih = img.naturalHeight;\x0a\x09\x09var width = options.width, height = options.height;\x0a\x09\x09var x = options.x || 0, y = options.y || 0;\x0a\x09\x09var ctx = canvas.getContext(\x272d\x27);\x0a\x09\x09if (detectSubsampling(img)) {\x0a\x09\x09\x09iw /= 2;\x0a\x09\x09\x09ih /= 2;\x0a\x09\x09}\x0a\x09\x09var d = 1024; // size of tiling canvas\x0a\x09\x09var tmpCanvas = document.createElement(\x27canvas\x27);\x0a\x09\x09tmpCanvas.width = tmpCanvas.height = d;\x0a\x09\x09var tmpCtx = tmpCanvas.getContext(\x272d\x27);\x0a\x09\x09var vertSquashRatio = detectVerticalSquash(img, iw, ih);\x0a\x09\x09var sy = 0;\x0a\x09\x09while (sy \x3c ih) {\x0a\x09\x09\x09var sh = sy + d \x3e ih ? ih - sy : d;\x0a\x09\x09\x09var sx = 0;\x0a\x09\x09\x09while (sx \x3c iw) {\x0a\x09\x09\x09\x09var sw = sx + d \x3e iw ? iw - sx : d;\x0a\x09\x09\x09\x09tmpCtx.clearRect(0, 0, d, d);\x0a\x09\x09\x09\x09tmpCtx.drawImage(img, -sx, -sy);\x0a\x09\x09\x09\x09var dx = (sx * width / iw + x) \x3c\x3c 0;\x0a\x09\x09\x09\x09var dw = Math.ceil(sw * width / iw);\x0a\x09\x09\x09\x09var dy = (sy * height / ih / vertSquashRatio + y) \x3c\x3c 0;\x0a\x09\x09\x09\x09var dh = Math.ceil(sh * height / ih / vertSquashRatio);\x0a\x09\x09\x09\x09ctx.drawImage(tmpCanvas, 0, 0, sw, sh, dx, dy, dw, dh);\x0a\x09\x09\x09\x09sx += d;\x0a\x09\x09\x09}\x0a\x09\x09\x09sy += d;\x0a\x09\x09}\x0a\x09\x09tmpCanvas = tmpCtx = null;\x0a\x09}\x0a\x0a\x09/**\x0a\x09 * Detect subsampling in loaded image.\x0a\x09 * In iOS, larger images than 2M pixels may be subsampled in rendering.\x0a\x09 */\x0a\x09function detectSubsampling(img) {\x0a\x09\x09var iw = img.naturalWidth, ih = img.naturalHeight;\x0a\x09\x09if (iw * ih \x3e 1024 * 1024) { // subsampling may happen over megapixel image\x0a\x09\x09\x09var canvas = document.createElement(\x27canvas\x27);\x0a\x09\x09\x09canvas.width = canvas.height = 1;\x0a\x09\x09\x09var ctx = canvas.getContext(\x272d\x27);\x0a\x09\x09\x09ctx.drawImage(img, -iw + 1, 0);\x0a\x09\x09\x09// subsampled image becomes half smaller in rendering size.\x0a\x09\x09\x09// check alpha channel value to confirm image is covering edge pixel or not.\x0a\x09\x09\x09// if alpha value is 0 image is not covering, hence subsampled.\x0a\x09\x09\x09return ctx.getImageData(0, 0, 1, 1).data[3] === 0;\x0a\x09\x09} else {\x0a\x09\x09\x09return false;\x0a\x09\x09}\x0a\x09}\x0a\x0a\x0a\x09/**\x0a\x09 * Detecting vertical squash in loaded image.\x0a\x09 * Fixes a bug which squash image vertically while drawing into canvas for some images.\x0a\x09 */\x0a\x09function detectVerticalSquash(img, iw, ih) {\x0a\x09\x09var canvas = document.createElement(\x27canvas\x27);\x0a\x09\x09canvas.width = 1;\x0a\x09\x09canvas.height = ih;\x0a\x09\x09var ctx = canvas.getContext(\x272d\x27);\x0a\x09\x09ctx.drawImage(img, 0, 0);\x0a\x09\x09var data = ctx.getImageData(0, 0, 1, ih).data;\x0a\x09\x09// search image edge pixel position in case it is squashed vertically.\x0a\x09\x09var sy = 0;\x0a\x09\x09var ey = ih;\x0a\x09\x09var py = ih;\x0a\x09\x09while (py \x3e sy) {\x0a\x09\x09\x09var alpha = data[(py - 1) * 4 + 3];\x0a\x09\x09\x09if (alpha === 0) {\x0a\x09\x09\x09\x09ey = py;\x0a\x09\x09\x09} else {\x0a\x09\x09\x09sy = py;\x0a\x09\x09\x09}\x0a\x09\x09\x09py = (ey + sy) \x3e\x3e 1;\x0a\x09\x09}\x0a\x09\x09canvas = null;\x0a\x09\x09var ratio = (py / ih);\x0a\x09\x09return (ratio === 0) ? 1 : ratio;\x0a\x09}\x0a\x0a\x09return {\x0a\x09\x09isSubsampled: detectSubsampling,\x0a\x09\x09renderTo: renderImageToCanvas\x0a\x09};\x0a});\x0a\x0a// Included from: src/javascript/runtime/html5/image/Image.js\x0a\x0a/**\x0a * Image.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/**\x0a@class moxie/runtime/html5/image/Image\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html5/image/Image\x22, [\x0a\x09\x22moxie/runtime/html5/Runtime\x22,\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/core/Exceptions\x22,\x0a\x09\x22moxie/core/utils/Encode\x22,\x0a\x09\x22moxie/file/Blob\x22,\x0a\x09\x22moxie/file/File\x22,\x0a\x09\x22moxie/runtime/html5/image/ImageInfo\x22,\x0a\x09\x22moxie/runtime/html5/image/MegaPixel\x22,\x0a\x09\x22moxie/core/utils/Mime\x22,\x0a\x09\x22moxie/core/utils/Env\x22\x0a], function(extensions, Basic, x, Encode, Blob, File, ImageInfo, MegaPixel, Mime, Env) {\x0a\x09\x0a\x09function HTML5Image() {\x0a\x09\x09var me = this\x0a\x09\x09, _img, _imgInfo, _canvas, _binStr, _blob\x0a\x09\x09, _modified = false // is set true whenever image is modified\x0a\x09\x09, _preserveHeaders = true\x0a\x09\x09;\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09loadFromBlob: function(blob) {\x0a\x09\x09\x09\x09var comp = this, I = comp.getRuntime()\x0a\x09\x09\x09\x09, asBinary = arguments.length \x3e 1 ? arguments[1] : true\x0a\x09\x09\x09\x09;\x0a\x0a\x09\x09\x09\x09if (!I.can(\x27access_binary\x27)) {\x0a\x09\x09\x09\x09\x09throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09_blob = blob;\x0a\x0a\x09\x09\x09\x09if (blob.isDetached()) {\x0a\x09\x09\x09\x09\x09_binStr = blob.getSource();\x0a\x09\x09\x09\x09\x09_preload.call(this, _binStr);\x0a\x09\x09\x09\x09\x09return;\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09_readAsDataUrl.call(this, blob.getSource(), function(dataUrl) {\x0a\x09\x09\x09\x09\x09\x09if (asBinary) {\x0a\x09\x09\x09\x09\x09\x09\x09_binStr = _toBinary(dataUrl);\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09_preload.call(comp, dataUrl);\x0a\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09loadFromImage: function(img, exact) {\x0a\x09\x09\x09\x09this.meta = img.meta;\x0a\x0a\x09\x09\x09\x09_blob = new File(null, {\x0a\x09\x09\x09\x09\x09name: img.name,\x0a\x09\x09\x09\x09\x09size: img.size,\x0a\x09\x09\x09\x09\x09type: img.type\x0a\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09_preload.call(this, exact ? (_binStr = img.getAsBinaryString()) : img.getAsDataURL());\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09getInfo: function() {\x0a\x09\x09\x09\x09var I = this.getRuntime(), info;\x0a\x0a\x09\x09\x09\x09if (!_imgInfo && _binStr && I.can(\x27access_image_binary\x27)) {\x0a\x09\x09\x09\x09\x09_imgInfo = new ImageInfo(_binStr);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09info = {\x0a\x09\x09\x09\x09\x09width: _getImg().width || 0,\x0a\x09\x09\x09\x09\x09height: _getImg().height || 0,\x0a\x09\x09\x09\x09\x09type: _blob.type || Mime.getFileMime(_blob.name),\x0a\x09\x09\x09\x09\x09size: _binStr && _binStr.length || _blob.size || 0,\x0a\x09\x09\x09\x09\x09name: _blob.name || \x27\x27,\x0a\x09\x09\x09\x09\x09meta: _imgInfo && _imgInfo.meta || this.meta || {}\x0a\x09\x09\x09\x09};\x0a\x0a\x09\x09\x09\x09// store thumbnail data as blob\x0a\x09\x09\x09\x09if (info.meta && info.meta.thumb && !(info.meta.thumb.data instanceof Blob)) {\x0a\x09\x09\x09\x09\x09info.meta.thumb.data = new Blob(null, {\x0a\x09\x09\x09\x09\x09\x09type: \x27image/jpeg\x27,\x0a\x09\x09\x09\x09\x09\x09data: info.meta.thumb.data\x0a\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09return info;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09downsize: function() {\x0a\x09\x09\x09\x09_downsize.apply(this, arguments);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09getAsCanvas: function() {\x0a\x09\x09\x09\x09if (_canvas) {\x0a\x09\x09\x09\x09\x09_canvas.id = this.uid + \x27_canvas\x27;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09return _canvas;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09getAsBlob: function(type, quality) {\x0a\x09\x09\x09\x09if (type !== this.type) {\x0a\x09\x09\x09\x09\x09// if different mime type requested prepare image for conversion\x0a\x09\x09\x09\x09\x09_downsize.call(this, this.width, this.height, false);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09return new File(null, {\x0a\x09\x09\x09\x09\x09name: _blob.name || \x27\x27,\x0a\x09\x09\x09\x09\x09type: type,\x0a\x09\x09\x09\x09\x09data: me.getAsBinaryString.call(this, type, quality)\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09getAsDataURL: function(type) {\x0a\x09\x09\x09\x09var quality = arguments[1] || 90;\x0a\x0a\x09\x09\x09\x09// if image has not been modified, return the source right away\x0a\x09\x09\x09\x09if (!_modified) {\x0a\x09\x09\x09\x09\x09return _img.src;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if (\x27image/jpeg\x27 !== type) {\x0a\x09\x09\x09\x09\x09return _canvas.toDataURL(\x27image/png\x27);\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09\x09// older Geckos used to result in an exception on quality argument\x0a\x09\x09\x09\x09\x09\x09return _canvas.toDataURL(\x27image/jpeg\x27, quality/100);\x0a\x09\x09\x09\x09\x09} catch (ex) {\x0a\x09\x09\x09\x09\x09\x09return _canvas.toDataURL(\x27image/jpeg\x27);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09getAsBinaryString: function(type, quality) {\x0a\x09\x09\x09\x09// if image has not been modified, return the source right away\x0a\x09\x09\x09\x09if (!_modified) {\x0a\x09\x09\x09\x09\x09// if image was not loaded from binary string\x0a\x09\x09\x09\x09\x09if (!_binStr) {\x0a\x09\x09\x09\x09\x09\x09_binStr = _toBinary(me.getAsDataURL(type, quality));\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09return _binStr;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if (\x27image/jpeg\x27 !== type) {\x0a\x09\x09\x09\x09\x09_binStr = _toBinary(me.getAsDataURL(type, quality));\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09var dataUrl;\x0a\x0a\x09\x09\x09\x09\x09// if jpeg\x0a\x09\x09\x09\x09\x09if (!quality) {\x0a\x09\x09\x09\x09\x09\x09quality = 90;\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09\x09// older Geckos used to result in an exception on quality argument\x0a\x09\x09\x09\x09\x09\x09dataUrl = _canvas.toDataURL(\x27image/jpeg\x27, quality/100);\x0a\x09\x09\x09\x09\x09} catch (ex) {\x0a\x09\x09\x09\x09\x09\x09dataUrl = _canvas.toDataURL(\x27image/jpeg\x27);\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09_binStr = _toBinary(dataUrl);\x0a\x0a\x09\x09\x09\x09\x09if (_imgInfo) {\x0a\x09\x09\x09\x09\x09\x09_binStr = _imgInfo.stripHeaders(_binStr);\x0a\x0a\x09\x09\x09\x09\x09\x09if (_preserveHeaders) {\x0a\x09\x09\x09\x09\x09\x09\x09// update dimensions info in exif\x0a\x09\x09\x09\x09\x09\x09\x09if (_imgInfo.meta && _imgInfo.meta.exif) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09_imgInfo.setExif({\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09PixelXDimension: this.width,\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09PixelYDimension: this.height\x0a\x09\x09\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09\x09\x09// re-inject the headers\x0a\x09\x09\x09\x09\x09\x09\x09_binStr = _imgInfo.writeHeaders(_binStr);\x0a\x09\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09\x09// will be re-created from fresh on next getInfo call\x0a\x09\x09\x09\x09\x09\x09_imgInfo.purge();\x0a\x09\x09\x09\x09\x09\x09_imgInfo = null;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09_modified = false;\x0a\x0a\x09\x09\x09\x09return _binStr;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09destroy: function() {\x0a\x09\x09\x09\x09me = null;\x0a\x09\x09\x09\x09_purge.call(this);\x0a\x09\x09\x09\x09this.getRuntime().getShim().removeInstance(this.uid);\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x0a\x09\x09function _getImg() {\x0a\x09\x09\x09if (!_canvas && !_img) {\x0a\x09\x09\x09\x09throw new x.ImageError(x.DOMException.INVALID_STATE_ERR);\x0a\x09\x09\x09}\x0a\x09\x09\x09return _canvas || _img;\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _toBinary(str) {\x0a\x09\x09\x09return Encode.atob(str.substring(str.indexOf(\x27base64,\x27) + 7));\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _toDataUrl(str, type) {\x0a\x09\x09\x09return \x27data:\x27 + (type || \x27\x27) + \x27;base64,\x27 + Encode.btoa(str);\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _preload(str) {\x0a\x09\x09\x09var comp = this;\x0a\x0a\x09\x09\x09_img = new Image();\x0a\x09\x09\x09_img.onerror = function() {\x0a\x09\x09\x09\x09_purge.call(this);\x0a\x09\x09\x09\x09comp.trigger(\x27error\x27, x.ImageError.WRONG_FORMAT);\x0a\x09\x09\x09};\x0a\x09\x09\x09_img.onload = function() {\x0a\x09\x09\x09\x09comp.trigger(\x27load\x27);\x0a\x09\x09\x09};\x0a\x0a\x09\x09\x09_img.src = str.substr(0, 5) == \x27data:\x27 ? str : _toDataUrl(str, _blob.type);\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _readAsDataUrl(file, callback) {\x0a\x09\x09\x09var comp = this, fr;\x0a\x0a\x09\x09\x09// use FileReader if it\x27s available\x0a\x09\x09\x09if (window.FileReader) {\x0a\x09\x09\x09\x09fr = new FileReader();\x0a\x09\x09\x09\x09fr.onload = function() {\x0a\x09\x09\x09\x09\x09callback(this.result);\x0a\x09\x09\x09\x09};\x0a\x09\x09\x09\x09fr.onerror = function() {\x0a\x09\x09\x09\x09\x09comp.trigger(\x27error\x27, x.ImageError.WRONG_FORMAT);\x0a\x09\x09\x09\x09};\x0a\x09\x09\x09\x09fr.readAsDataURL(file);\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09return callback(file.getAsDataURL());\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x0a\x09\x09function _downsize(width, height, crop, preserveHeaders) {\x0a\x09\x09\x09var self = this\x0a\x09\x09\x09, scale\x0a\x09\x09\x09, mathFn\x0a\x09\x09\x09, x = 0\x0a\x09\x09\x09, y = 0\x0a\x09\x09\x09, img\x0a\x09\x09\x09, destWidth\x0a\x09\x09\x09, destHeight\x0a\x09\x09\x09, orientation\x0a\x09\x09\x09;\x0a\x0a\x09\x09\x09_preserveHeaders = preserveHeaders; // we will need to check this on export (see getAsBinaryString())\x0a\x0a\x09\x09\x09// take into account orientation tag\x0a\x09\x09\x09orientation = (this.meta && this.meta.tiff && this.meta.tiff.Orientation) || 1;\x0a\x0a\x09\x09\x09if (Basic.inArray(orientation, [5,6,7,8]) !== -1) { // values that require 90 degree rotation\x0a\x09\x09\x09\x09// swap dimensions\x0a\x09\x09\x09\x09var tmp = width;\x0a\x09\x09\x09\x09width = height;\x0a\x09\x09\x09\x09height = tmp;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09img = _getImg();\x0a\x0a\x09\x09\x09// unify dimensions\x0a\x09\x09\x09if (!crop) {\x0a\x09\x09\x09\x09scale = Math.min(width/img.width, height/img.height);\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09// one of the dimensions may exceed the actual image dimensions - we need to take the smallest value\x0a\x09\x09\x09\x09width = Math.min(width, img.width);\x0a\x09\x09\x09\x09height = Math.min(height, img.height);\x0a\x0a\x09\x09\x09\x09scale = Math.max(width/img.width, height/img.height);\x0a\x09\x09\x09}\x0a\x09\x09\x0a\x09\x09\x09// we only downsize here\x0a\x09\x09\x09if (scale \x3e 1 && !crop && preserveHeaders) {\x0a\x09\x09\x09\x09this.trigger(\x27Resize\x27);\x0a\x09\x09\x09\x09return;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09// prepare canvas if necessary\x0a\x09\x09\x09if (!_canvas) {\x0a\x09\x09\x09\x09_canvas = document.createElement(\x22canvas\x22);\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09// calculate dimensions of proportionally resized image\x0a\x09\x09\x09destWidth = Math.round(img.width * scale);\x09\x0a\x09\x09\x09destHeight = Math.round(img.height * scale);\x0a\x0a\x09\x09\x09// scale image and canvas\x0a\x09\x09\x09if (crop) {\x0a\x09\x09\x09\x09_canvas.width = width;\x0a\x09\x09\x09\x09_canvas.height = height;\x0a\x0a\x09\x09\x09\x09// if dimensions of the resulting image still larger than canvas, center it\x0a\x09\x09\x09\x09if (destWidth \x3e width) {\x0a\x09\x09\x09\x09\x09x = Math.round((destWidth - width) / 2);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if (destHeight \x3e height) {\x0a\x09\x09\x09\x09\x09y = Math.round((destHeight - height) / 2);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09_canvas.width = destWidth;\x0a\x09\x09\x09\x09_canvas.height = destHeight;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09// rotate if required, according to orientation tag\x0a\x09\x09\x09if (!_preserveHeaders) {\x0a\x09\x09\x09\x09_rotateToOrientaion(_canvas.width, _canvas.height, orientation);\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09_drawToCanvas.call(this, img, _canvas, -x, -y, destWidth, destHeight);\x0a\x0a\x09\x09\x09this.width = _canvas.width;\x0a\x09\x09\x09this.height = _canvas.height;\x0a\x0a\x09\x09\x09_modified = true;\x0a\x09\x09\x09self.trigger(\x27Resize\x27);\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _drawToCanvas(img, canvas, x, y, w, h) {\x0a\x09\x09\x09if (Env.OS === \x27iOS\x27) { \x0a\x09\x09\x09\x09// avoid squish bug in iOS6\x0a\x09\x09\x09\x09MegaPixel.renderTo(img, canvas, { width: w, height: h, x: x, y: y });\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09var ctx = canvas.getContext(\x272d\x27);\x0a\x09\x09\x09\x09ctx.drawImage(img, x, y, w, h);\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x0a\x0a\x09\x09/**\x0a\x09\x09* Transform canvas coordination according to specified frame size and orientation\x0a\x09\x09* Orientation value is from EXIF tag\x0a\x09\x09* @author Shinichi Tomita \x3cshinichi.tomita@gmail.com\x3e\x0a\x09\x09*/\x0a\x09\x09function _rotateToOrientaion(width, height, orientation) {\x0a\x09\x09\x09switch (orientation) {\x0a\x09\x09\x09\x09case 5:\x0a\x09\x09\x09\x09case 6:\x0a\x09\x09\x09\x09case 7:\x0a\x09\x09\x09\x09case 8:\x0a\x09\x09\x09\x09\x09_canvas.width = height;\x0a\x09\x09\x09\x09\x09_canvas.height = width;\x0a\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09default:\x0a\x09\x09\x09\x09\x09_canvas.width = width;\x0a\x09\x09\x09\x09\x09_canvas.height = height;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09/**\x0a\x09\x09\x091 = The 0th row is at the visual top of the image, and the 0th column is the visual left-hand side.\x0a\x09\x09\x092 = The 0th row is at the visual top of the image, and the 0th column is the visual right-hand side.\x0a\x09\x09\x093 = The 0th row is at the visual bottom of the image, and the 0th column is the visual right-hand side.\x0a\x09\x09\x094 = The 0th row is at the visual bottom of the image, and the 0th column is the visual left-hand side.\x0a\x09\x09\x095 = The 0th row is the visual left-hand side of the image, and the 0th column is the visual top.\x0a\x09\x09\x096 = The 0th row is the visual right-hand side of the image, and the 0th column is the visual top.\x0a\x09\x09\x097 = The 0th row is the visual right-hand side of the image, and the 0th column is the visual bottom.\x0a\x09\x09\x098 = The 0th row is the visual left-hand side of the image, and the 0th column is the visual bottom.\x0a\x09\x09\x09*/\x0a\x0a\x09\x09\x09var ctx = _canvas.getContext(\x272d\x27);\x0a\x09\x09\x09switch (orientation) {\x0a\x09\x09\x09\x09case 2:\x0a\x09\x09\x09\x09\x09// horizontal flip\x0a\x09\x09\x09\x09\x09ctx.translate(width, 0);\x0a\x09\x09\x09\x09\x09ctx.scale(-1, 1);\x0a\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09case 3:\x0a\x09\x09\x09\x09\x09// 180 rotate left\x0a\x09\x09\x09\x09\x09ctx.translate(width, height);\x0a\x09\x09\x09\x09\x09ctx.rotate(Math.PI);\x0a\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09case 4:\x0a\x09\x09\x09\x09\x09// vertical flip\x0a\x09\x09\x09\x09\x09ctx.translate(0, height);\x0a\x09\x09\x09\x09\x09ctx.scale(1, -1);\x0a\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09case 5:\x0a\x09\x09\x09\x09\x09// vertical flip + 90 rotate right\x0a\x09\x09\x09\x09\x09ctx.rotate(0.5 * Math.PI);\x0a\x09\x09\x09\x09\x09ctx.scale(1, -1);\x0a\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09case 6:\x0a\x09\x09\x09\x09\x09// 90 rotate right\x0a\x09\x09\x09\x09\x09ctx.rotate(0.5 * Math.PI);\x0a\x09\x09\x09\x09\x09ctx.translate(0, -height);\x0a\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09case 7:\x0a\x09\x09\x09\x09\x09// horizontal flip + 90 rotate right\x0a\x09\x09\x09\x09\x09ctx.rotate(0.5 * Math.PI);\x0a\x09\x09\x09\x09\x09ctx.translate(width, -height);\x0a\x09\x09\x09\x09\x09ctx.scale(-1, 1);\x0a\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09case 8:\x0a\x09\x09\x09\x09\x09// 90 rotate left\x0a\x09\x09\x09\x09\x09ctx.rotate(-0.5 * Math.PI);\x0a\x09\x09\x09\x09\x09ctx.translate(-width, 0);\x0a\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x0a\x0a\x09\x09function _purge() {\x0a\x09\x09\x09if (_imgInfo) {\x0a\x09\x09\x09\x09_imgInfo.purge();\x0a\x09\x09\x09\x09_imgInfo = null;\x0a\x09\x09\x09}\x0a\x09\x09\x09_binStr = _img = _canvas = _blob = null;\x0a\x09\x09\x09_modified = false;\x0a\x09\x09}\x0a\x09}\x0a\x0a\x09return (extensions.Image = HTML5Image);\x0a});\x0a\x0a/**\x0a * Stub for moxie/runtime/flash/Runtime\x0a * @private\x0a */\x0adefine(\x22moxie/runtime/flash/Runtime\x22, [\x0a], function() {\x0a\x09return {};\x0a});\x0a\x0a/**\x0a * Stub for moxie/runtime/silverlight/Runtime\x0a * @private\x0a */\x0adefine(\x22moxie/runtime/silverlight/Runtime\x22, [\x0a], function() {\x0a\x09return {};\x0a});\x0a\x0a// Included from: src/javascript/runtime/html4/Runtime.js\x0a\x0a/**\x0a * Runtime.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/*global File:true */\x0a\x0a/**\x0aDefines constructor for HTML4 runtime.\x0a\x0a@class moxie/runtime/html4/Runtime\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html4/Runtime\x22, [\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/core/Exceptions\x22,\x0a\x09\x22moxie/runtime/Runtime\x22,\x0a\x09\x22moxie/core/utils/Env\x22\x0a], function(Basic, x, Runtime, Env) {\x0a\x09\x0a\x09var type = \x27html4\x27, extensions = {};\x0a\x0a\x09function Html4Runtime(options) {\x0a\x09\x09var I = this\x0a\x09\x09, Test = Runtime.capTest\x0a\x09\x09, True = Runtime.capTrue\x0a\x09\x09;\x0a\x0a\x09\x09Runtime.call(this, options, type, {\x0a\x09\x09\x09access_binary: Test(window.FileReader || window.File && File.getAsDataURL),\x0a\x09\x09\x09access_image_binary: false,\x0a\x09\x09\x09display_media: Test(extensions.Image && (Env.can(\x27create_canvas\x27) || Env.can(\x27use_data_uri_over32kb\x27))),\x0a\x09\x09\x09do_cors: false,\x0a\x09\x09\x09drag_and_drop: false,\x0a\x09\x09\x09filter_by_extension: Test(function() { // if you know how to feature-detect this, please suggest\x0a\x09\x09\x09\x09return (Env.browser === \x27Chrome\x27 && Env.verComp(Env.version, 28, \x27\x3e=\x27)) || \x0a\x09\x09\x09\x09\x09(Env.browser === \x27IE\x27 && Env.verComp(Env.version, 10, \x27\x3e=\x27)) || \x0a\x09\x09\x09\x09\x09(Env.browser === \x27Safari\x27 && Env.verComp(Env.version, 7, \x27\x3e=\x27));\x0a\x09\x09\x09}()),\x0a\x09\x09\x09resize_image: function() {\x0a\x09\x09\x09\x09return extensions.Image && I.can(\x27access_binary\x27) && Env.can(\x27create_canvas\x27);\x0a\x09\x09\x09},\x0a\x09\x09\x09report_upload_progress: false,\x0a\x09\x09\x09return_response_headers: false,\x0a\x09\x09\x09return_response_type: function(responseType) {\x0a\x09\x09\x09\x09if (responseType === \x27json\x27 && !!window.JSON) {\x0a\x09\x09\x09\x09\x09return true;\x0a\x09\x09\x09\x09} \x0a\x09\x09\x09\x09return !!~Basic.inArray(responseType, [\x27text\x27, \x27document\x27, \x27\x27]);\x0a\x09\x09\x09},\x0a\x09\x09\x09return_status_code: function(code) {\x0a\x09\x09\x09\x09return !Basic.arrayDiff(code, [200, 404]);\x0a\x09\x09\x09},\x0a\x09\x09\x09select_file: function() {\x0a\x09\x09\x09\x09return Env.can(\x27use_fileinput\x27);\x0a\x09\x09\x09},\x0a\x09\x09\x09select_multiple: false,\x0a\x09\x09\x09send_binary_string: false,\x0a\x09\x09\x09send_custom_headers: false,\x0a\x09\x09\x09send_multipart: true,\x0a\x09\x09\x09slice_blob: false,\x0a\x09\x09\x09stream_upload: function() {\x0a\x09\x09\x09\x09return I.can(\x27select_file\x27);\x0a\x09\x09\x09},\x0a\x09\x09\x09summon_file_dialog: function() { // yeah... some dirty sniffing here...\x0a\x09\x09\x09\x09return I.can(\x27select_file\x27) && (\x0a\x09\x09\x09\x09\x09(Env.browser === \x27Firefox\x27 && Env.verComp(Env.version, 4, \x27\x3e=\x27)) ||\x0a\x09\x09\x09\x09\x09(Env.browser === \x27Opera\x27 && Env.verComp(Env.version, 12, \x27\x3e=\x27)) ||\x0a\x09\x09\x09\x09\x09(Env.browser === \x27IE\x27 && Env.verComp(Env.version, 10, \x27\x3e=\x27)) ||\x0a\x09\x09\x09\x09\x09!!~Basic.inArray(Env.browser, [\x27Chrome\x27, \x27Safari\x27])\x0a\x09\x09\x09\x09);\x0a\x09\x09\x09},\x0a\x09\x09\x09upload_filesize: True,\x0a\x09\x09\x09use_http_method: function(methods) {\x0a\x09\x09\x09\x09return !Basic.arrayDiff(methods, [\x27GET\x27, \x27POST\x27]);\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09init : function() {\x0a\x09\x09\x09\x09this.trigger(\x22Init\x22);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09destroy: (function(destroy) { // extend default destroy method\x0a\x09\x09\x09\x09return function() {\x0a\x09\x09\x09\x09\x09destroy.call(I);\x0a\x09\x09\x09\x09\x09destroy = I = null;\x0a\x09\x09\x09\x09};\x0a\x09\x09\x09}(this.destroy))\x0a\x09\x09});\x0a\x0a\x09\x09Basic.extend(this.getShim(), extensions);\x0a\x09}\x0a\x0a\x09Runtime.addConstructor(type, Html4Runtime);\x0a\x0a\x09return extensions;\x0a});\x0a\x0a// Included from: src/javascript/runtime/html4/file/FileInput.js\x0a\x0a/**\x0a * FileInput.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/**\x0a@class moxie/runtime/html4/file/FileInput\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html4/file/FileInput\x22, [\x0a\x09\x22moxie/runtime/html4/Runtime\x22,\x0a\x09\x22moxie/file/File\x22,\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/core/utils/Dom\x22,\x0a\x09\x22moxie/core/utils/Events\x22,\x0a\x09\x22moxie/core/utils/Mime\x22,\x0a\x09\x22moxie/core/utils/Env\x22\x0a], function(extensions, File, Basic, Dom, Events, Mime, Env) {\x0a\x09\x0a\x09function FileInput() {\x0a\x09\x09var _uid, _mimes = [], _options;\x0a\x0a\x09\x09function addInput() {\x0a\x09\x09\x09var comp = this, I = comp.getRuntime(), shimContainer, browseButton, currForm, form, input, uid;\x0a\x0a\x09\x09\x09uid = Basic.guid(\x27uid_\x27);\x0a\x0a\x09\x09\x09shimContainer = I.getShimContainer(); // we get new ref everytime to avoid memory leaks in IE\x0a\x0a\x09\x09\x09if (_uid) { // move previous form out of the view\x0a\x09\x09\x09\x09currForm = Dom.get(_uid + \x27_form\x27);\x0a\x09\x09\x09\x09if (currForm) {\x0a\x09\x09\x09\x09\x09Basic.extend(currForm.style, { top: \x27100%\x27 });\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09// build form in DOM, since innerHTML version not able to submit file for some reason\x0a\x09\x09\x09form = document.createElement(\x27form\x27);\x0a\x09\x09\x09form.setAttribute(\x27id\x27, uid + \x27_form\x27);\x0a\x09\x09\x09form.setAttribute(\x27method\x27, \x27post\x27);\x0a\x09\x09\x09form.setAttribute(\x27enctype\x27, \x27multipart/form-data\x27);\x0a\x09\x09\x09form.setAttribute(\x27encoding\x27, \x27multipart/form-data\x27);\x0a\x0a\x09\x09\x09Basic.extend(form.style, {\x0a\x09\x09\x09\x09overflow: \x27hidden\x27,\x0a\x09\x09\x09\x09position: \x27absolute\x27,\x0a\x09\x09\x09\x09top: 0,\x0a\x09\x09\x09\x09left: 0,\x0a\x09\x09\x09\x09width: \x27100%\x27,\x0a\x09\x09\x09\x09height: \x27100%\x27\x0a\x09\x09\x09});\x0a\x0a\x09\x09\x09input = document.createElement(\x27input\x27);\x0a\x09\x09\x09input.setAttribute(\x27id\x27, uid);\x0a\x09\x09\x09input.setAttribute(\x27type\x27, \x27file\x27);\x0a\x09\x09\x09input.setAttribute(\x27name\x27, _options.name || \x27Filedata\x27);\x0a\x09\x09\x09input.setAttribute(\x27accept\x27, _mimes.join(\x27,\x27));\x0a\x0a\x09\x09\x09Basic.extend(input.style, {\x0a\x09\x09\x09\x09fontSize: \x27999px\x27,\x0a\x09\x09\x09\x09opacity: 0\x0a\x09\x09\x09});\x0a\x0a\x09\x09\x09form.appendChild(input);\x0a\x09\x09\x09shimContainer.appendChild(form);\x0a\x0a\x09\x09\x09// prepare file input to be placed underneath the browse_button element\x0a\x09\x09\x09Basic.extend(input.style, {\x0a\x09\x09\x09\x09position: \x27absolute\x27,\x0a\x09\x09\x09\x09top: 0,\x0a\x09\x09\x09\x09left: 0,\x0a\x09\x09\x09\x09width: \x27100%\x27,\x0a\x09\x09\x09\x09height: \x27100%\x27\x0a\x09\x09\x09});\x0a\x0a\x09\x09\x09if (Env.browser === \x27IE\x27 && Env.verComp(Env.version, 10, \x27\x3c\x27)) {\x0a\x09\x09\x09\x09Basic.extend(input.style, {\x0a\x09\x09\x09\x09\x09filter : \x22progid:DXImageTransform.Microsoft.Alpha(opacity=0)\x22\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09input.onchange = function() { // there should be only one handler for this\x0a\x09\x09\x09\x09var file;\x0a\x0a\x09\x09\x09\x09if (!this.value) {\x0a\x09\x09\x09\x09\x09return;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if (this.files) { // check if browser is fresh enough\x0a\x09\x09\x09\x09\x09file = this.files[0];\x0a\x0a\x09\x09\x09\x09\x09// ignore empty files (IE10 for example hangs if you try to send them via XHR)\x0a\x09\x09\x09\x09\x09if (file.size === 0) {\x0a\x09\x09\x09\x09\x09\x09form.parentNode.removeChild(form);\x0a\x09\x09\x09\x09\x09\x09return;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09file = {\x0a\x09\x09\x09\x09\x09\x09name: this.value\x0a\x09\x09\x09\x09\x09};\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09file = new File(I.uid, file);\x0a\x0a\x09\x09\x09\x09// clear event handler\x0a\x09\x09\x09\x09this.onchange = function() {}; \x0a\x09\x09\x09\x09addInput.call(comp); \x0a\x0a\x09\x09\x09\x09comp.files = [file];\x0a\x0a\x09\x09\x09\x09// substitute all ids with file uids (consider file.uid read-only - we cannot do it the other way around)\x0a\x09\x09\x09\x09input.setAttribute(\x27id\x27, file.uid);\x0a\x09\x09\x09\x09form.setAttribute(\x27id\x27, file.uid + \x27_form\x27);\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09comp.trigger(\x27change\x27);\x0a\x0a\x09\x09\x09\x09input = form = null;\x0a\x09\x09\x09};\x0a\x0a\x0a\x09\x09\x09// route click event to the input\x0a\x09\x09\x09if (I.can(\x27summon_file_dialog\x27)) {\x0a\x09\x09\x09\x09browseButton = Dom.get(_options.browse_button);\x0a\x09\x09\x09\x09Events.removeEvent(browseButton, \x27click\x27, comp.uid);\x0a\x09\x09\x09\x09Events.addEvent(browseButton, \x27click\x27, function(e) {\x0a\x09\x09\x09\x09\x09if (input && !input.disabled) { // for some reason FF (up to 8.0.1 so far) lets to click disabled input[type=file]\x0a\x09\x09\x09\x09\x09\x09input.click();\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09e.preventDefault();\x0a\x09\x09\x09\x09}, comp.uid);\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09_uid = uid;\x0a\x0a\x09\x09\x09shimContainer = currForm = browseButton = null;\x0a\x09\x09}\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09init: function(options) {\x0a\x09\x09\x09\x09var comp = this, I = comp.getRuntime(), shimContainer;\x0a\x0a\x09\x09\x09\x09// figure out accept string\x0a\x09\x09\x09\x09_options = options;\x0a\x09\x09\x09\x09_mimes = options.accept.mimes || Mime.extList2mimes(options.accept, I.can(\x27filter_by_extension\x27));\x0a\x0a\x09\x09\x09\x09shimContainer = I.getShimContainer();\x0a\x0a\x09\x09\x09\x09(function() {\x0a\x09\x09\x09\x09\x09var browseButton, zIndex, top;\x0a\x0a\x09\x09\x09\x09\x09browseButton = Dom.get(options.browse_button);\x0a\x0a\x09\x09\x09\x09\x09// Route click event to the input[type=file] element for browsers that support such behavior\x0a\x09\x09\x09\x09\x09if (I.can(\x27summon_file_dialog\x27)) {\x0a\x09\x09\x09\x09\x09\x09if (Dom.getStyle(browseButton, \x27position\x27) === \x27static\x27) {\x0a\x09\x09\x09\x09\x09\x09\x09browseButton.style.position = \x27relative\x27;\x0a\x09\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09\x09zIndex = parseInt(Dom.getStyle(browseButton, \x27z-index\x27), 10) || 1;\x0a\x0a\x09\x09\x09\x09\x09\x09browseButton.style.zIndex = zIndex;\x0a\x09\x09\x09\x09\x09\x09shimContainer.style.zIndex = zIndex - 1;\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09/* Since we have to place input[type=file] on top of the browse_button for some browsers,\x0a\x09\x09\x09\x09\x09browse_button loses interactivity, so we restore it here */\x0a\x09\x09\x09\x09\x09top = I.can(\x27summon_file_dialog\x27) ? browseButton : shimContainer;\x0a\x0a\x09\x09\x09\x09\x09Events.addEvent(top, \x27mouseover\x27, function() {\x0a\x09\x09\x09\x09\x09\x09comp.trigger(\x27mouseenter\x27);\x0a\x09\x09\x09\x09\x09}, comp.uid);\x0a\x0a\x09\x09\x09\x09\x09Events.addEvent(top, \x27mouseout\x27, function() {\x0a\x09\x09\x09\x09\x09\x09comp.trigger(\x27mouseleave\x27);\x0a\x09\x09\x09\x09\x09}, comp.uid);\x0a\x0a\x09\x09\x09\x09\x09Events.addEvent(top, \x27mousedown\x27, function() {\x0a\x09\x09\x09\x09\x09\x09comp.trigger(\x27mousedown\x27);\x0a\x09\x09\x09\x09\x09}, comp.uid);\x0a\x0a\x09\x09\x09\x09\x09Events.addEvent(Dom.get(options.container), \x27mouseup\x27, function() {\x0a\x09\x09\x09\x09\x09\x09comp.trigger(\x27mouseup\x27);\x0a\x09\x09\x09\x09\x09}, comp.uid);\x0a\x0a\x09\x09\x09\x09\x09browseButton = null;\x0a\x09\x09\x09\x09}());\x0a\x0a\x09\x09\x09\x09addInput.call(this);\x0a\x0a\x09\x09\x09\x09shimContainer = null;\x0a\x0a\x09\x09\x09\x09// trigger ready event asynchronously\x0a\x09\x09\x09\x09comp.trigger({\x0a\x09\x09\x09\x09\x09type: \x27ready\x27,\x0a\x09\x09\x09\x09\x09async: true\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09},\x0a\x0a\x0a\x09\x09\x09disable: function(state) {\x0a\x09\x09\x09\x09var input;\x0a\x0a\x09\x09\x09\x09if ((input = Dom.get(_uid))) {\x0a\x09\x09\x09\x09\x09input.disabled = !!state;\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09destroy: function() {\x0a\x09\x09\x09\x09var I = this.getRuntime()\x0a\x09\x09\x09\x09, shim = I.getShim()\x0a\x09\x09\x09\x09, shimContainer = I.getShimContainer()\x0a\x09\x09\x09\x09;\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09Events.removeAllEvents(shimContainer, this.uid);\x0a\x09\x09\x09\x09Events.removeAllEvents(_options && Dom.get(_options.container), this.uid);\x0a\x09\x09\x09\x09Events.removeAllEvents(_options && Dom.get(_options.browse_button), this.uid);\x0a\x09\x09\x09\x09\x0a\x09\x09\x09\x09if (shimContainer) {\x0a\x09\x09\x09\x09\x09shimContainer.innerHTML = \x27\x27;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09shim.removeInstance(this.uid);\x0a\x0a\x09\x09\x09\x09_uid = _mimes = _options = shimContainer = shim = null;\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x09}\x0a\x0a\x09return (extensions.FileInput = FileInput);\x0a});\x0a\x0a// Included from: src/javascript/runtime/html4/file/FileReader.js\x0a\x0a/**\x0a * FileReader.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/**\x0a@class moxie/runtime/html4/file/FileReader\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html4/file/FileReader\x22, [\x0a\x09\x22moxie/runtime/html4/Runtime\x22,\x0a\x09\x22moxie/runtime/html5/file/FileReader\x22\x0a], function(extensions, FileReader) {\x0a\x09return (extensions.FileReader = FileReader);\x0a});\x0a\x0a// Included from: src/javascript/runtime/html4/xhr/XMLHttpRequest.js\x0a\x0a/**\x0a * XMLHttpRequest.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/**\x0a@class moxie/runtime/html4/xhr/XMLHttpRequest\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html4/xhr/XMLHttpRequest\x22, [\x0a\x09\x22moxie/runtime/html4/Runtime\x22,\x0a\x09\x22moxie/core/utils/Basic\x22,\x0a\x09\x22moxie/core/utils/Dom\x22,\x0a\x09\x22moxie/core/utils/Url\x22,\x0a\x09\x22moxie/core/Exceptions\x22,\x0a\x09\x22moxie/core/utils/Events\x22,\x0a\x09\x22moxie/file/Blob\x22,\x0a\x09\x22moxie/xhr/FormData\x22\x0a], function(extensions, Basic, Dom, Url, x, Events, Blob, FormData) {\x0a\x09\x0a\x09function XMLHttpRequest() {\x0a\x09\x09var _status, _response, _iframe;\x0a\x0a\x09\x09function cleanup(cb) {\x0a\x09\x09\x09var target = this, uid, form, inputs, i, hasFile = false;\x0a\x0a\x09\x09\x09if (!_iframe) {\x0a\x09\x09\x09\x09return;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09uid = _iframe.id.replace(/_iframe$/, \x27\x27);\x0a\x0a\x09\x09\x09form = Dom.get(uid + \x27_form\x27);\x0a\x09\x09\x09if (form) {\x0a\x09\x09\x09\x09inputs = form.getElementsByTagName(\x27input\x27);\x0a\x09\x09\x09\x09i = inputs.length;\x0a\x0a\x09\x09\x09\x09while (i--) {\x0a\x09\x09\x09\x09\x09switch (inputs[i].getAttribute(\x27type\x27)) {\x0a\x09\x09\x09\x09\x09\x09case \x27hidden\x27:\x0a\x09\x09\x09\x09\x09\x09\x09inputs[i].parentNode.removeChild(inputs[i]);\x0a\x09\x09\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09\x09\x09case \x27file\x27:\x0a\x09\x09\x09\x09\x09\x09\x09hasFile = true; // flag the case for later\x0a\x09\x09\x09\x09\x09\x09\x09break;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09inputs = [];\x0a\x0a\x09\x09\x09\x09if (!hasFile) { // we need to keep the form for sake of possible retries\x0a\x09\x09\x09\x09\x09form.parentNode.removeChild(form);\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09form = null;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09// without timeout, request is marked as canceled (in console)\x0a\x09\x09\x09setTimeout(function() {\x0a\x09\x09\x09\x09Events.removeEvent(_iframe, \x27load\x27, target.uid);\x0a\x09\x09\x09\x09if (_iframe.parentNode) { // #382\x0a\x09\x09\x09\x09\x09_iframe.parentNode.removeChild(_iframe);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// check if shim container has any other children, if - not, remove it as well\x0a\x09\x09\x09\x09var shimContainer = target.getRuntime().getShimContainer();\x0a\x09\x09\x09\x09if (!shimContainer.children.length) {\x0a\x09\x09\x09\x09\x09shimContainer.parentNode.removeChild(shimContainer);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09shimContainer = _iframe = null;\x0a\x09\x09\x09\x09cb();\x0a\x09\x09\x09}, 1);\x0a\x09\x09}\x0a\x0a\x09\x09Basic.extend(this, {\x0a\x09\x09\x09send: function(meta, data) {\x0a\x09\x09\x09\x09var target = this, I = target.getRuntime(), uid, form, input, blob;\x0a\x0a\x09\x09\x09\x09_status = _response = null;\x0a\x0a\x09\x09\x09\x09function createIframe() {\x0a\x09\x09\x09\x09\x09var container = I.getShimContainer() || document.body\x0a\x09\x09\x09\x09\x09, temp = document.createElement(\x27div\x27)\x0a\x09\x09\x09\x09\x09;\x0a\x0a\x09\x09\x09\x09\x09// IE 6 won\x27t be able to set the name using setAttribute or iframe.name\x0a\x09\x09\x09\x09\x09temp.innerHTML = \x27\x3ciframe id=\x22\x27 + uid + \x27_iframe\x22 name=\x22\x27 + uid + \x27_iframe\x22 src=\x22javascript:&quot;&quot;\x22 style=\x22display:none\x22\x3e\x3c/iframe\x3e\x27;\x0a\x09\x09\x09\x09\x09_iframe = temp.firstChild;\x0a\x09\x09\x09\x09\x09container.appendChild(_iframe);\x0a\x0a\x09\x09\x09\x09\x09/* _iframe.onreadystatechange = function() {\x0a\x09\x09\x09\x09\x09\x09console.info(_iframe.readyState);\x0a\x09\x09\x09\x09\x09};*/\x0a\x0a\x09\x09\x09\x09\x09Events.addEvent(_iframe, \x27load\x27, function() { // _iframe.onload doesn\x27t work in IE lte 8\x0a\x09\x09\x09\x09\x09\x09var el;\x0a\x0a\x09\x09\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09\x09\x09el = _iframe.contentWindow.document || _iframe.contentDocument || window.frames[_iframe.id].document;\x0a\x0a\x09\x09\x09\x09\x09\x09\x09// try to detect some standard error pages\x0a\x09\x09\x09\x09\x09\x09\x09if (/^4(0[0-9]|1[0-7]|2[2346])\x5cs/.test(el.title)) { // test if title starts with 4xx HTTP error\x0a\x09\x09\x09\x09\x09\x09\x09\x09_status = el.title.replace(/^(\x5cd+).*$/, \x27$1\x27);\x0a\x09\x09\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09\x09\x09_status = 200;\x0a\x09\x09\x09\x09\x09\x09\x09\x09// get result\x0a\x09\x09\x09\x09\x09\x09\x09\x09_response = Basic.trim(el.body.innerHTML);\x0a\x0a\x09\x09\x09\x09\x09\x09\x09\x09// we need to fire these at least once\x0a\x09\x09\x09\x09\x09\x09\x09\x09target.trigger({\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09type: \x27progress\x27,\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09loaded: _response.length,\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09total: _response.length\x0a\x09\x09\x09\x09\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09\x09\x09\x09\x09if (blob) { // if we were uploading a file\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09target.trigger({\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09type: \x27uploadprogress\x27,\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09loaded: blob.size || 1025,\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09total: blob.size || 1025\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09} catch (ex) {\x0a\x09\x09\x09\x09\x09\x09\x09if (Url.hasSameOrigin(meta.url)) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09// if response is sent with error code, iframe in IE gets redirected to res://ieframe.dll/http_x.htm\x0a\x09\x09\x09\x09\x09\x09\x09\x09// which obviously results to cross domain error (wtf?)\x0a\x09\x09\x09\x09\x09\x09\x09\x09_status = 404;\x0a\x09\x09\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09\x09\x09cleanup.call(target, function() {\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09target.trigger(\x27error\x27);\x0a\x09\x09\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09\x09\x09\x09return;\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09}\x09\x0a\x09\x09\x09\x09\x09\x0a\x09\x09\x09\x09\x09\x09cleanup.call(target, function() {\x0a\x09\x09\x09\x09\x09\x09\x09target.trigger(\x27load\x27);\x0a\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09\x09}, target.uid);\x0a\x09\x09\x09\x09} // end createIframe\x0a\x0a\x09\x09\x09\x09// prepare data to be sent and convert if required\x0a\x09\x09\x09\x09if (data instanceof FormData && data.hasBlob()) {\x0a\x09\x09\x09\x09\x09blob = data.getBlob();\x0a\x09\x09\x09\x09\x09uid = blob.uid;\x0a\x09\x09\x09\x09\x09input = Dom.get(uid);\x0a\x09\x09\x09\x09\x09form = Dom.get(uid + \x27_form\x27);\x0a\x09\x09\x09\x09\x09if (!form) {\x0a\x09\x09\x09\x09\x09\x09throw new x.DOMException(x.DOMException.NOT_FOUND_ERR);\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09uid = Basic.guid(\x27uid_\x27);\x0a\x0a\x09\x09\x09\x09\x09form = document.createElement(\x27form\x27);\x0a\x09\x09\x09\x09\x09form.setAttribute(\x27id\x27, uid + \x27_form\x27);\x0a\x09\x09\x09\x09\x09form.setAttribute(\x27method\x27, meta.method);\x0a\x09\x09\x09\x09\x09form.setAttribute(\x27enctype\x27, \x27multipart/form-data\x27);\x0a\x09\x09\x09\x09\x09form.setAttribute(\x27encoding\x27, \x27multipart/form-data\x27);\x0a\x0a\x09\x09\x09\x09\x09I.getShimContainer().appendChild(form);\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// set upload target\x0a\x09\x09\x09\x09form.setAttribute(\x27target\x27, uid + \x27_iframe\x27);\x0a\x0a\x09\x09\x09\x09if (data instanceof FormData) {\x0a\x09\x09\x09\x09\x09data.each(function(value, name) {\x0a\x09\x09\x09\x09\x09\x09if (value instanceof Blob) {\x0a\x09\x09\x09\x09\x09\x09\x09if (input) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09input.setAttribute(\x27name\x27, name);\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09\x09var hidden = document.createElement(\x27input\x27);\x0a\x0a\x09\x09\x09\x09\x09\x09\x09Basic.extend(hidden, {\x0a\x09\x09\x09\x09\x09\x09\x09\x09type : \x27hidden\x27,\x0a\x09\x09\x09\x09\x09\x09\x09\x09name : name,\x0a\x09\x09\x09\x09\x09\x09\x09\x09value : value\x0a\x09\x09\x09\x09\x09\x09\x09});\x0a\x0a\x09\x09\x09\x09\x09\x09\x09// make sure that input[type=\x22file\x22], if it\x27s there, comes last\x0a\x09\x09\x09\x09\x09\x09\x09if (input) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09form.insertBefore(hidden, input);\x0a\x09\x09\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09\x09\x09form.appendChild(hidden);\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// set destination url\x0a\x09\x09\x09\x09form.setAttribute(\x22action\x22, meta.url);\x0a\x0a\x09\x09\x09\x09createIframe();\x0a\x09\x09\x09\x09form.submit();\x0a\x09\x09\x09\x09target.trigger(\x27loadstart\x27);\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09getStatus: function() {\x0a\x09\x09\x09\x09return _status;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09getResponse: function(responseType) {\x0a\x09\x09\x09\x09if (\x27json\x27 === responseType) {\x0a\x09\x09\x09\x09\x09// strip off \x3cpre\x3e..\x3c/pre\x3e tags that might be enclosing the response\x0a\x09\x09\x09\x09\x09if (Basic.typeOf(_response) === \x27string\x27 && !!window.JSON) {\x0a\x09\x09\x09\x09\x09\x09try {\x0a\x09\x09\x09\x09\x09\x09\x09return JSON.parse(_response.replace(/^\x5cs*\x3cpre[^\x3e]*\x3e/, \x27\x27).replace(/\x3c\x5c/pre\x3e\x5cs*$/, \x27\x27));\x0a\x09\x09\x09\x09\x09\x09} catch (ex) {\x0a\x09\x09\x09\x09\x09\x09\x09return null;\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09} \x0a\x09\x09\x09\x09} else if (\x27document\x27 === responseType) {\x0a\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09\x09return _response;\x0a\x09\x09\x09},\x0a\x0a\x09\x09\x09abort: function() {\x0a\x09\x09\x09\x09var target = this;\x0a\x0a\x09\x09\x09\x09if (_iframe && _iframe.contentWindow) {\x0a\x09\x09\x09\x09\x09if (_iframe.contentWindow.stop) { // FireFox/Safari/Chrome\x0a\x09\x09\x09\x09\x09\x09_iframe.contentWindow.stop();\x0a\x09\x09\x09\x09\x09} else if (_iframe.contentWindow.document.execCommand) { // IE\x0a\x09\x09\x09\x09\x09\x09_iframe.contentWindow.document.execCommand(\x27Stop\x27);\x0a\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09_iframe.src = \x22about:blank\x22;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09cleanup.call(this, function() {\x0a\x09\x09\x09\x09\x09// target.dispatchEvent(\x27readystatechange\x27);\x0a\x09\x09\x09\x09\x09target.dispatchEvent(\x27abort\x27);\x0a\x09\x09\x09\x09});\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x09}\x0a\x0a\x09return (extensions.XMLHttpRequest = XMLHttpRequest);\x0a});\x0a\x0a// Included from: src/javascript/runtime/html4/image/Image.js\x0a\x0a/**\x0a * Image.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/**\x0a@class moxie/runtime/html4/image/Image\x0a@private\x0a*/\x0adefine(\x22moxie/runtime/html4/image/Image\x22, [\x0a\x09\x22moxie/runtime/html4/Runtime\x22,\x0a\x09\x22moxie/runtime/html5/image/Image\x22\x0a], function(extensions, Image) {\x0a\x09return (extensions.Image = Image);\x0a});\x0a\x0aexpose([\x22moxie/core/utils/Basic\x22,\x22moxie/core/utils/Env\x22,\x22moxie/core/I18n\x22,\x22moxie/core/utils/Mime\x22,\x22moxie/core/utils/Dom\x22,\x22moxie/core/Exceptions\x22,\x22moxie/core/EventTarget\x22,\x22moxie/runtime/Runtime\x22,\x22moxie/runtime/RuntimeClient\x22,\x22moxie/file/FileInput\x22,\x22moxie/core/utils/Encode\x22,\x22moxie/file/Blob\x22,\x22moxie/file/File\x22,\x22moxie/file/FileDrop\x22,\x22moxie/file/FileReader\x22,\x22moxie/core/utils/Url\x22,\x22moxie/runtime/RuntimeTarget\x22,\x22moxie/file/FileReaderSync\x22,\x22moxie/xhr/FormData\x22,\x22moxie/xhr/XMLHttpRequest\x22,\x22moxie/runtime/Transporter\x22,\x22moxie/image/Image\x22,\x22moxie/core/utils/Events\x22]);\x0a})(this);\x0a/**\x0a * o.js\x0a *\x0a * Copyright 2013, Moxiecode Systems AB\x0a * Released under GPL License.\x0a *\x0a * License: http://www.plupload.com/license\x0a * Contributing: http://www.plupload.com/contributing\x0a */\x0a\x0a/*global moxie:true */\x0a\x0a/**\x0aGlobally exposed namespace with the most frequently used public classes and handy methods.\x0a\x0a@class o\x0a@static\x0a@private\x0a*/\x0a(function(exports) {\x0a\x09\x22use strict\x22;\x0a\x0a\x09var o = {}, inArray = exports.moxie.core.utils.Basic.inArray;\x0a\x0a\x09// directly add some public classes\x0a\x09// (we do it dynamically here, since for custom builds we cannot know beforehand what modules were included)\x0a\x09(function addAlias(ns) {\x0a\x09\x09var name, itemType;\x0a\x09\x09for (name in ns) {\x0a\x09\x09\x09itemType = typeof(ns[name]);\x0a\x09\x09\x09if (itemType === \x27object\x27 && !~inArray(name, [\x27Exceptions\x27, \x27Env\x27, \x27Mime\x27])) {\x0a\x09\x09\x09\x09addAlias(ns[name]);\x0a\x09\x09\x09} else if (itemType === \x27function\x27) {\x0a\x09\x09\x09\x09o[name] = ns[name];\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x09})(exports.moxie);\x0a\x0a\x09// add some manually\x0a\x09o.Env = exports.moxie.core.utils.Env;\x0a\x09o.Mime = exports.moxie.core.utils.Mime;\x0a\x09o.Exceptions = exports.moxie.core.Exceptions;\x0a\x0a\x09// expose globally\x0a\x09exports.mOxie = o;\x0a\x09if (!exports.o) {\x0a\x09\x09exports.o = o;\x0a\x09}\x0a\x09return o;\x0a})(this);\x0a'}