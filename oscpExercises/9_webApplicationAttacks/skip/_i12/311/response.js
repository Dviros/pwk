var res = {'data':'HTTP/1.1 200 Partial Content\x0aDate: Sun, 20 Sep 2020 14:56:08 GMT\x0aServer: Apache/2.4.29 (Ubuntu)\x0aLast-Modified: Thu, 24 Jan 2019 11:21:50 GMT\x0aETag: \x2244be-580326aad0f80-gzip\x22\x0aAccept-Ranges: bytes\x0aVary: Accept-Encoding\x0aContent-Encoding: gzip\x0aContent-Range: bytes 0-5212/5213\x0aContent-Length: 5213\x0aKeep-Alive: timeout=5, max=48\x0aConnection: Keep-Alive\x0aContent-Type: application/javascript\x0a\x0a( function( tinymce ) {\x0a\x09tinymce.ui.Factory.add( \x27WPLinkPreview\x27, tinymce.ui.Control.extend( {\x0a\x09\x09url: \x27#\x27,\x0a\x09\x09renderHtml: function() {\x0a\x09\x09\x09return (\x0a\x09\x09\x09\x09\x27\x3cdiv id=\x22\x27 + this._id + \x27\x22 class=\x22wp-link-preview\x22\x3e\x27 +\x0a\x09\x09\x09\x09\x09\x27\x3ca href=\x22\x27 + this.url + \x27\x22 target=\x22_blank\x22 rel=\x22noopener\x22 tabindex=\x22-1\x22\x3e\x27 + this.url + \x27\x3c/a\x3e\x27 +\x0a\x09\x09\x09\x09\x27\x3c/div\x3e\x27\x0a\x09\x09\x09);\x0a\x09\x09},\x0a\x09\x09setURL: function( url ) {\x0a\x09\x09\x09var index, lastIndex;\x0a\x0a\x09\x09\x09if ( this.url !== url ) {\x0a\x09\x09\x09\x09this.url = url;\x0a\x0a\x09\x09\x09\x09url = window.decodeURIComponent( url );\x0a\x0a\x09\x09\x09\x09url = url.replace( /^(?:https?:)?\x5c/\x5c/(?:www\x5c.)?/, \x27\x27 );\x0a\x0a\x09\x09\x09\x09if ( ( index = url.indexOf( \x27?\x27 ) ) !== -1 ) {\x0a\x09\x09\x09\x09\x09url = url.slice( 0, index );\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if ( ( index = url.indexOf( \x27#\x27 ) ) !== -1 ) {\x0a\x09\x09\x09\x09\x09url = url.slice( 0, index );\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09url = url.replace( /(?:index)?\x5c.html$/, \x27\x27 );\x0a\x0a\x09\x09\x09\x09if ( url.charAt( url.length - 1 ) === \x27/\x27 ) {\x0a\x09\x09\x09\x09\x09url = url.slice( 0, -1 );\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// If nothing\x27s left (maybe the URL was just a fragment), use the whole URL.\x0a\x09\x09\x09\x09if ( url === \x27\x27 ) {\x0a\x09\x09\x09\x09\x09url = this.url;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09// If the URL is longer that 40 chars, concatenate the beginning (after the domain) and ending with ...\x0a\x09\x09\x09\x09if ( url.length \x3e 40 && ( index = url.indexOf( \x27/\x27 ) ) !== -1 && ( lastIndex = url.lastIndexOf( \x27/\x27 ) ) !== -1 && lastIndex !== index ) {\x0a\x09\x09\x09\x09\x09// If the beginning + ending are shorter that 40 chars, show more of the ending\x0a\x09\x09\x09\x09\x09if ( index + url.length - lastIndex \x3c 40 ) {\x0a\x09\x09\x09\x09\x09\x09lastIndex = -( 40 - ( index + 1 ) );\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09url = url.slice( 0, index + 1 ) + \x27\x5cu2026\x27 + url.slice( lastIndex );\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09tinymce.$( this.getEl().firstChild ).attr( \x27href\x27, this.url ).text( url );\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x09} ) );\x0a\x0a\x09tinymce.ui.Factory.add( \x27WPLinkInput\x27, tinymce.ui.Control.extend( {\x0a\x09\x09renderHtml: function() {\x0a\x09\x09\x09return (\x0a\x09\x09\x09\x09\x27\x3cdiv id=\x22\x27 + this._id + \x27\x22 class=\x22wp-link-input\x22\x3e\x27 +\x0a\x09\x09\x09\x09\x09\x27\x3cinput type=\x22text\x22 value=\x22\x22 placeholder=\x22\x27 + tinymce.translate( \x27Paste URL or type to search\x27 ) + \x27\x22 /\x3e\x27 +\x0a\x09\x09\x09\x09\x09\x27\x3cinput type=\x22text\x22 style=\x22display:none\x22 value=\x22\x22 /\x3e\x27 +\x0a\x09\x09\x09\x09\x27\x3c/div\x3e\x27\x0a\x09\x09\x09);\x0a\x09\x09},\x0a\x09\x09setURL: function( url ) {\x0a\x09\x09\x09this.getEl().firstChild.value = url;\x0a\x09\x09},\x0a\x09\x09getURL: function() {\x0a\x09\x09\x09return tinymce.trim( this.getEl().firstChild.value );\x0a\x09\x09},\x0a\x09\x09getLinkText: function() {\x0a\x09\x09\x09var text = this.getEl().firstChild.nextSibling.value;\x0a\x0a\x09\x09\x09if ( ! tinymce.trim( text ) ) {\x0a\x09\x09\x09\x09return \x27\x27;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09return text.replace( /[\x5cr\x5cn\x5ct ]+/g, \x27 \x27 );\x0a\x09\x09},\x0a\x09\x09reset: function() {\x0a\x09\x09\x09var urlInput = this.getEl().firstChild;\x0a\x0a\x09\x09\x09urlInput.value = \x27\x27;\x0a\x09\x09\x09urlInput.nextSibling.value = \x27\x27;\x0a\x09\x09}\x0a\x09} ) );\x0a\x0a\x09tinymce.PluginManager.add( \x27wplink\x27, function( editor ) {\x0a\x09\x09var toolbar;\x0a\x09\x09var editToolbar;\x0a\x09\x09var previewInstance;\x0a\x09\x09var inputInstance;\x0a\x09\x09var linkNode;\x0a\x09\x09var doingUndoRedo;\x0a\x09\x09var doingUndoRedoTimer;\x0a\x09\x09var $ = window.jQuery;\x0a\x09\x09var emailRegex = /^(mailto:)?[a-z0-9._%+-]+@[a-z0-9][a-z0-9.-]*\x5c.[a-z]{2,63}$/i;\x0a\x09\x09var urlRegex1 = /^https?:\x5c/\x5c/([^\x5cs/?.#-][^\x5cs\x5c/?.#]*\x5c.?)+(\x5c/[^\x5cs\x22]*)?$/i;\x0a\x09\x09var urlRegex2 = /^https?:\x5c/\x5c/[^\x5c/]+\x5c.[^\x5c/]+($|\x5c/)/i;\x0a\x09\x09var speak = ( typeof window.wp !== \x27undefined\x27 && window.wp.a11y && window.wp.a11y.speak ) ? window.wp.a11y.speak : function() {};\x0a\x09\x09var hasLinkError = false;\x0a\x0a\x09\x09function getSelectedLink() {\x0a\x09\x09\x09var href, html,\x0a\x09\x09\x09\x09node = editor.selection.getStart(),\x0a\x09\x09\x09\x09link = editor.dom.getParent( node, \x27a[href]\x27 );\x0a\x0a\x09\x09\x09if ( ! link ) {\x0a\x09\x09\x09\x09html = editor.selection.getContent({ format: \x27raw\x27 });\x0a\x0a\x09\x09\x09\x09if ( html && html.indexOf( \x27\x3c/a\x3e\x27 ) !== -1 ) {\x0a\x09\x09\x09\x09\x09href = html.match( /href=\x22([^\x22\x3e]+)\x22/ );\x0a\x0a\x09\x09\x09\x09\x09if ( href && href[1] ) {\x0a\x09\x09\x09\x09\x09\x09link = editor.$( \x27a[href=\x22\x27 + href[1] + \x27\x22]\x27, node )[0];\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09if ( link ) {\x0a\x09\x09\x09\x09\x09\x09editor.selection.select( link );\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09return link;\x0a\x09\x09}\x0a\x0a\x09\x09function removePlaceholders() {\x0a\x09\x09\x09editor.$( \x27a\x27 ).each( function( i, element ) {\x0a\x09\x09\x09\x09var $element = editor.$( element );\x0a\x0a\x09\x09\x09\x09if ( $element.attr( \x27href\x27 ) === \x27_wp_link_placeholder\x27 ) {\x0a\x09\x09\x09\x09\x09editor.dom.remove( element, true );\x0a\x09\x09\x09\x09} else if ( $element.attr( \x27data-wplink-edit\x27 ) ) {\x0a\x09\x09\x09\x09\x09$element.attr( \x27data-wplink-edit\x27, null );\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09});\x0a\x09\x09}\x0a\x0a\x09\x09function removePlaceholderStrings( content, dataAttr ) {\x0a\x09\x09\x09return content.replace( /(\x3ca [^\x3e]+\x3e)([\x5cs\x5cS]*?)\x3c\x5c/a\x3e/g, function( all, tag, text ) {\x0a\x09\x09\x09\x09if ( tag.indexOf( \x27 href=\x22_wp_link_placeholder\x22\x27 ) \x3e -1 ) {\x0a\x09\x09\x09\x09\x09return text;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if ( dataAttr ) {\x0a\x09\x09\x09\x09\x09tag = tag.replace( / data-wplink-edit=\x22true\x22/g, \x27\x27 );\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09tag = tag.replace( / data-wplink-url-error=\x22true\x22/g, \x27\x27 );\x0a\x0a\x09\x09\x09\x09return tag + text + \x27\x3c/a\x3e\x27;\x0a\x09\x09\x09});\x0a\x09\x09}\x0a\x0a\x09\x09function checkLink( node ) {\x0a\x09\x09\x09var $link = editor.$( node );\x0a\x09\x09\x09var href = $link.attr( \x27href\x27 );\x0a\x0a\x09\x09\x09if ( ! href || typeof $ === \x27undefined\x27 ) {\x0a\x09\x09\x09\x09return;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09hasLinkError = false;\x0a\x0a\x09\x09\x09if ( /^http/i.test( href ) && ( ! urlRegex1.test( href ) || ! urlRegex2.test( href ) ) ) {\x0a\x09\x09\x09\x09hasLinkError = true;\x0a\x09\x09\x09\x09$link.attr( \x27data-wplink-url-error\x27, \x27true\x27 );\x0a\x09\x09\x09\x09speak( editor.translate( \x27Warning: the link has been inserted but may have errors. Please test it.\x27 ), \x27assertive\x27 );\x0a\x09\x09\x09} else {\x0a\x09\x09\x09\x09$link.removeAttr( \x27data-wplink-url-error\x27 );\x0a\x09\x09\x09}\x0a\x09\x09}\x0a\x0a\x09\x09editor.on( \x27preinit\x27, function() {\x0a\x09\x09\x09if ( editor.wp && editor.wp._createToolbar ) {\x0a\x09\x09\x09\x09toolbar = editor.wp._createToolbar( [\x0a\x09\x09\x09\x09\x09\x27wp_link_preview\x27,\x0a\x09\x09\x09\x09\x09\x27wp_link_edit\x27,\x0a\x09\x09\x09\x09\x09\x27wp_link_remove\x27\x0a\x09\x09\x09\x09], true );\x0a\x0a\x09\x09\x09\x09var editButtons = [\x0a\x09\x09\x09\x09\x09\x27wp_link_input\x27,\x0a\x09\x09\x09\x09\x09\x27wp_link_apply\x27\x0a\x09\x09\x09\x09];\x0a\x0a\x09\x09\x09\x09if ( typeof window.wpLink !== \x27undefined\x27 ) {\x0a\x09\x09\x09\x09\x09editButtons.push( \x27wp_link_advanced\x27 );\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09editToolbar = editor.wp._createToolbar( editButtons, true );\x0a\x0a\x09\x09\x09\x09editToolbar.on( \x27show\x27, function() {\x0a\x09\x09\x09\x09\x09if ( typeof window.wpLink === \x27undefined\x27 || ! window.wpLink.modalOpen ) {\x0a\x09\x09\x09\x09\x09\x09window.setTimeout( function() {\x0a\x09\x09\x09\x09\x09\x09\x09var element = editToolbar.$el.find( \x27input.ui-autocomplete-input\x27 )[0],\x0a\x09\x09\x09\x09\x09\x09\x09\x09selection = linkNode && ( linkNode.textContent || linkNode.innerText );\x0a\x0a\x09\x09\x09\x09\x09\x09\x09if ( element ) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09if ( ! element.value && selection && typeof window.wpLink !== \x27undefined\x27 ) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09element.value = window.wpLink.getUrlFromSelection( selection );\x0a\x09\x09\x09\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09\x09\x09\x09if ( ! doingUndoRedo ) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09element.focus();\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09element.select();\x0a\x09\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09} );\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09} );\x0a\x0a\x09\x09\x09\x09editToolbar.on( \x27hide\x27, function() {\x0a\x09\x09\x09\x09\x09if ( ! editToolbar.scrolling ) {\x0a\x09\x09\x09\x09\x09\x09editor.execCommand( \x27wp_link_cancel\x27 );\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09} );\x0a\x09\x09\x09}\x0a\x09\x09} );\x0a\x0a\x09\x09editor.addCommand( \x27WP_Link\x27, function() {\x0a\x09\x09\x09if ( tinymce.Env.ie && tinymce.Env.ie \x3c 10 && typeof window.wpLink !== \x27undefined\x27 ) {\x0a\x09\x09\x09\x09window.wpLink.open( editor.id );\x0a\x09\x09\x09\x09return;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09linkNode = getSelectedLink();\x0a\x09\x09\x09editToolbar.tempHide = false;\x0a\x0a\x09\x09\x09if ( ! linkNode ) {\x0a\x09\x09\x09\x09removePlaceholders();\x0a\x09\x09\x09\x09editor.execCommand( \x27mceInsertLink\x27, false, { href: \x27_wp_link_placeholder\x27 } );\x0a\x0a\x09\x09\x09\x09linkNode = editor.$( \x27a[href=\x22_wp_link_placeholder\x22]\x27 )[0];\x0a\x09\x09\x09\x09editor.nodeChanged();\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09editor.dom.setAttribs( linkNode, { \x27data-wplink-edit\x27: true } );\x0a\x09\x09} );\x0a\x0a\x09\x09editor.addCommand( \x27wp_link_apply\x27, function() {\x0a\x09\x09\x09if ( editToolbar.scrolling ) {\x0a\x09\x09\x09\x09return;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09var href, text;\x0a\x0a\x09\x09\x09if ( linkNode ) {\x0a\x09\x09\x09\x09href = inputInstance.getURL();\x0a\x09\x09\x09\x09text = inputInstance.getLinkText();\x0a\x09\x09\x09\x09editor.focus();\x0a\x0a\x09\x09\x09\x09var parser = document.createElement( \x27a\x27 );\x0a\x09\x09\x09\x09parser.href = href;\x0a\x0a\x09\x09\x09\x09if ( \x27javascript:\x27 === parser.protocol || \x27data:\x27 === parser.protocol ) { // jshint ignore:line\x0a\x09\x09\x09\x09\x09href = \x27\x27;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if ( ! href ) {\x0a\x09\x09\x09\x09\x09editor.dom.remove( linkNode, true );\x0a\x09\x09\x09\x09\x09return;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09if ( ! /^(?:[a-z]+:|#|\x5c?|\x5c.|\x5c/)/.test( href ) && ! emailRegex.test( href ) ) {\x0a\x09\x09\x09\x09\x09href = \x27http://\x27 + href;\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09editor.dom.setAttribs( linkNode, { href: href, \x27data-wplink-edit\x27: null } );\x0a\x0a\x09\x09\x09\x09if ( ! tinymce.trim( linkNode.innerHTML ) ) {\x0a\x09\x09\x09\x09\x09editor.$( linkNode ).text( text || href );\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09checkLink( linkNode );\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09inputInstance.reset();\x0a\x09\x09\x09editor.nodeChanged();\x0a\x0a\x09\x09\x09// Audible confirmation message when a link has been inserted in the Editor.\x0a\x09\x09\x09if ( typeof window.wpLinkL10n !== \x27undefined\x27 && ! hasLinkError ) {\x0a\x09\x09\x09\x09speak( window.wpLinkL10n.linkInserted );\x0a\x09\x09\x09}\x0a\x09\x09} );\x0a\x0a\x09\x09editor.addCommand( \x27wp_link_cancel\x27, function() {\x0a\x09\x09\x09inputInstance.reset();\x0a\x0a\x09\x09\x09if ( ! editToolbar.tempHide ) {\x0a\x09\x09\x09\x09removePlaceholders();\x0a\x09\x09\x09}\x0a\x09\x09} );\x0a\x0a\x09\x09editor.addCommand( \x27wp_unlink\x27, function() {\x0a\x09\x09\x09editor.execCommand( \x27unlink\x27 );\x0a\x09\x09\x09editToolbar.tempHide = false;\x0a\x09\x09\x09editor.execCommand( \x27wp_link_cancel\x27 );\x0a\x09\x09} );\x0a\x0a\x09\x09// WP default shortcuts\x0a\x09\x09editor.addShortcut( \x27access+a\x27, \x27\x27, \x27WP_Link\x27 );\x0a\x09\x09editor.addShortcut( \x27access+s\x27, \x27\x27, \x27wp_unlink\x27 );\x0a\x09\x09// The \x22de-facto standard\x22 shortcut, see #27305\x0a\x09\x09editor.addShortcut( \x27meta+k\x27, \x27\x27, \x27WP_Link\x27 );\x0a\x0a\x09\x09editor.addButton( \x27link\x27, {\x0a\x09\x09\x09icon: \x27link\x27,\x0a\x09\x09\x09tooltip: \x27Insert/edit link\x27,\x0a\x09\x09\x09cmd: \x27WP_Link\x27,\x0a\x09\x09\x09stateSelector: \x27a[href]\x27\x0a\x09\x09});\x0a\x0a\x09\x09editor.addButton( \x27unlink\x27, {\x0a\x09\x09\x09icon: \x27unlink\x27,\x0a\x09\x09\x09tooltip: \x27Remove link\x27,\x0a\x09\x09\x09cmd: \x27unlink\x27\x0a\x09\x09});\x0a\x0a\x09\x09editor.addMenuItem( \x27link\x27, {\x0a\x09\x09\x09icon: \x27link\x27,\x0a\x09\x09\x09text: \x27Insert/edit link\x27,\x0a\x09\x09\x09cmd: \x27WP_Link\x27,\x0a\x09\x09\x09stateSelector: \x27a[href]\x27,\x0a\x09\x09\x09context: \x27insert\x27,\x0a\x09\x09\x09prependToContext: true\x0a\x09\x09});\x0a\x0a\x09\x09editor.on( \x27pastepreprocess\x27, function( event ) {\x0a\x09\x09\x09var pastedStr = event.content,\x0a\x09\x09\x09\x09regExp = /^(?:https?:)?\x5c/\x5c/\x5cS+$/i;\x0a\x0a\x09\x09\x09if ( ! editor.selection.isCollapsed() && ! regExp.test( editor.selection.getContent() ) ) {\x0a\x09\x09\x09\x09pastedStr = pastedStr.replace( /\x3c[^\x3e]+\x3e/g, \x27\x27 );\x0a\x09\x09\x09\x09pastedStr = tinymce.trim( pastedStr );\x0a\x0a\x09\x09\x09\x09if ( regExp.test( pastedStr ) ) {\x0a\x09\x09\x09\x09\x09editor.execCommand( \x27mceInsertLink\x27, false, {\x0a\x09\x09\x09\x09\x09\x09href: editor.dom.decode( pastedStr )\x0a\x09\x09\x09\x09\x09} );\x0a\x0a\x09\x09\x09\x09\x09event.preventDefault();\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x09\x09} );\x0a\x0a\x09\x09// Remove any remaining placeholders on saving.\x0a\x09\x09editor.on( \x27savecontent\x27, function( event ) {\x0a\x09\x09\x09event.content = removePlaceholderStrings( event.content, true );\x0a\x09\x09});\x0a\x0a\x09\x09// Prevent adding undo levels on inserting link placeholder.\x0a\x09\x09editor.on( \x27BeforeAddUndo\x27, function( event ) {\x0a\x09\x09\x09if ( event.lastLevel && event.lastLevel.content && event.level.content &&\x0a\x09\x09\x09\x09event.lastLevel.content === removePlaceholderStrings( event.level.content ) ) {\x0a\x0a\x09\x09\x09\x09event.preventDefault();\x0a\x09\x09\x09}\x0a\x09\x09});\x0a\x0a\x09\x09// When doing undo and redo with keyboard shortcuts (Ctrl|Cmd+Z, Ctrl|Cmd+Shift+Z, Ctrl|Cmd+Y),\x0a\x09\x09// set a flag to not focus the inline dialog. The editor has to remain focused so the users can do consecutive undo/redo.\x0a\x09\x09editor.on( \x27keydown\x27, function( event ) {\x0a\x09\x09\x09if ( event.keyCode === 27 ) { // Esc\x0a\x09\x09\x09\x09editor.execCommand( \x27wp_link_cancel\x27 );\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09if ( event.altKey || ( tinymce.Env.mac && ( ! event.metaKey || event.ctrlKey ) ) ||\x0a\x09\x09\x09\x09( ! tinymce.Env.mac && ! event.ctrlKey ) ) {\x0a\x0a\x09\x09\x09\x09return;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09if ( event.keyCode === 89 || event.keyCode === 90 ) { // Y or Z\x0a\x09\x09\x09\x09doingUndoRedo = true;\x0a\x0a\x09\x09\x09\x09window.clearTimeout( doingUndoRedoTimer );\x0a\x09\x09\x09\x09doingUndoRedoTimer = window.setTimeout( function() {\x0a\x09\x09\x09\x09\x09doingUndoRedo = false;\x0a\x09\x09\x09\x09}, 500 );\x0a\x09\x09\x09}\x0a\x09\x09} );\x0a\x0a\x09\x09editor.addButton( \x27wp_link_preview\x27, {\x0a\x09\x09\x09type: \x27WPLinkPreview\x27,\x0a\x09\x09\x09onPostRender: function() {\x0a\x09\x09\x09\x09previewInstance = this;\x0a\x09\x09\x09}\x0a\x09\x09} );\x0a\x0a\x09\x09editor.addButton( \x27wp_link_input\x27, {\x0a\x09\x09\x09type: \x27WPLinkInput\x27,\x0a\x09\x09\x09onPostRender: function() {\x0a\x09\x09\x09\x09var element = this.getEl(),\x0a\x09\x09\x09\x09\x09input = element.firstChild,\x0a\x09\x09\x09\x09\x09$input, cache, last;\x0a\x0a\x09\x09\x09\x09inputInstance = this;\x0a\x0a\x09\x09\x09\x09if ( $ && $.ui && $.ui.autocomplete ) {\x0a\x09\x09\x09\x09\x09$input = $( input );\x0a\x0a\x09\x09\x09\x09\x09$input.on( \x27keydown\x27, function() {\x0a\x09\x09\x09\x09\x09\x09$input.removeAttr( \x27aria-activedescendant\x27 );\x0a\x09\x09\x09\x09\x09} )\x0a\x09\x09\x09\x09\x09.autocomplete( {\x0a\x09\x09\x09\x09\x09\x09source: function( request, response ) {\x0a\x09\x09\x09\x09\x09\x09\x09if ( last === request.term ) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09response( cache );\x0a\x09\x09\x09\x09\x09\x09\x09\x09return;\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09\x09\x09if ( /^https?:/.test( request.term ) || request.term.indexOf( \x27.\x27 ) !== -1 ) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09return response();\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09\x09\x09$.post( window.ajaxurl, {\x0a\x09\x09\x09\x09\x09\x09\x09\x09action: \x27wp-link-ajax\x27,\x0a\x09\x09\x09\x09\x09\x09\x09\x09page: 1,\x0a\x09\x09\x09\x09\x09\x09\x09\x09search: request.term,\x0a\x09\x09\x09\x09\x09\x09\x09\x09_ajax_linking_nonce: $( \x27#_ajax_linking_nonce\x27 ).val()\x0a\x09\x09\x09\x09\x09\x09\x09}, function( data ) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09cache = data;\x0a\x09\x09\x09\x09\x09\x09\x09\x09response( data );\x0a\x09\x09\x09\x09\x09\x09\x09}, \x27json\x27 );\x0a\x0a\x09\x09\x09\x09\x09\x09\x09last = request.term;\x0a\x09\x09\x09\x09\x09\x09},\x0a\x09\x09\x09\x09\x09\x09focus: function( event, ui ) {\x0a\x09\x09\x09\x09\x09\x09\x09$input.attr( \x27aria-activedescendant\x27, \x27mce-wp-autocomplete-\x27 + ui.item.ID );\x0a\x09\x09\x09\x09\x09\x09\x09/*\x0a\x09\x09\x09\x09\x09\x09\x09 * Don\x27t empty the URL input field, when using the arrow keys to\x0a\x09\x09\x09\x09\x09\x09\x09 * highlight items. See api.jqueryui.com/autocomplete/#event-focus\x0a\x09\x09\x09\x09\x09\x09\x09 */\x0a\x09\x09\x09\x09\x09\x09\x09event.preventDefault();\x0a\x09\x09\x09\x09\x09\x09},\x0a\x09\x09\x09\x09\x09\x09select: function( event, ui ) {\x0a\x09\x09\x09\x09\x09\x09\x09$input.val( ui.item.permalink );\x0a\x09\x09\x09\x09\x09\x09\x09$( element.firstChild.nextSibling ).val( ui.item.title );\x0a\x0a\x09\x09\x09\x09\x09\x09\x09if ( 9 === event.keyCode && typeof window.wpLinkL10n !== \x27undefined\x27 ) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09// Audible confirmation message when a link has been selected.\x0a\x09\x09\x09\x09\x09\x09\x09\x09speak( window.wpLinkL10n.linkSelected );\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09\x09\x09return false;\x0a\x09\x09\x09\x09\x09\x09},\x0a\x09\x09\x09\x09\x09\x09open: function() {\x0a\x09\x09\x09\x09\x09\x09\x09$input.attr( \x27aria-expanded\x27, \x27true\x27 );\x0a\x09\x09\x09\x09\x09\x09\x09editToolbar.blockHide = true;\x0a\x09\x09\x09\x09\x09\x09},\x0a\x09\x09\x09\x09\x09\x09close: function() {\x0a\x09\x09\x09\x09\x09\x09\x09$input.attr( \x27aria-expanded\x27, \x27false\x27 );\x0a\x09\x09\x09\x09\x09\x09\x09editToolbar.blockHide = false;\x0a\x09\x09\x09\x09\x09\x09},\x0a\x09\x09\x09\x09\x09\x09minLength: 2,\x0a\x09\x09\x09\x09\x09\x09position: {\x0a\x09\x09\x09\x09\x09\x09\x09my: \x27left top+2\x27\x0a\x09\x09\x09\x09\x09\x09},\x0a\x09\x09\x09\x09\x09\x09messages: {\x0a\x09\x09\x09\x09\x09\x09\x09noResults: ( typeof window.uiAutocompleteL10n !== \x27undefined\x27 ) ? window.uiAutocompleteL10n.noResults : \x27\x27,\x0a\x09\x09\x09\x09\x09\x09\x09results: function( number ) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09if ( typeof window.uiAutocompleteL10n !== \x27undefined\x27 ) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09if ( number \x3e 1 ) {\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09return window.uiAutocompleteL10n.manyResults.replace( \x27%d\x27, number );\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09return window.uiAutocompleteL10n.oneResult;\x0a\x09\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09} ).autocomplete( \x27instance\x27 )._renderItem = function( ul, item ) {\x0a\x09\x09\x09\x09\x09\x09var fallbackTitle = ( typeof window.wpLinkL10n !== \x27undefined\x27 ) ? window.wpLinkL10n.noTitle : \x27\x27,\x0a\x09\x09\x09\x09\x09\x09\x09title = item.title ? item.title : fallbackTitle;\x0a\x0a\x09\x09\x09\x09\x09\x09return $( \x27\x3cli role=\x22option\x22 id=\x22mce-wp-autocomplete-\x27 + item.ID + \x27\x22\x3e\x27 )\x0a\x09\x09\x09\x09\x09\x09.append( \x27\x3cspan\x3e\x27 + title + \x27\x3c/span\x3e&nbsp;\x3cspan class=\x22wp-editor-float-right\x22\x3e\x27 + item.info + \x27\x3c/span\x3e\x27 )\x0a\x09\x09\x09\x09\x09\x09.appendTo( ul );\x0a\x09\x09\x09\x09\x09};\x0a\x0a\x09\x09\x09\x09\x09$input.attr( {\x0a\x09\x09\x09\x09\x09\x09\x27role\x27: \x27combobox\x27,\x0a\x09\x09\x09\x09\x09\x09\x27aria-autocomplete\x27: \x27list\x27,\x0a\x09\x09\x09\x09\x09\x09\x27aria-expanded\x27: \x27false\x27,\x0a\x09\x09\x09\x09\x09\x09\x27aria-owns\x27: $input.autocomplete( \x27widget\x27 ).attr( \x27id\x27 )\x0a\x09\x09\x09\x09\x09} )\x0a\x09\x09\x09\x09\x09.on( \x27focus\x27, function() {\x0a\x09\x09\x09\x09\x09\x09var inputValue = $input.val();\x0a\x09\x09\x09\x09\x09\x09/*\x0a\x09\x09\x09\x09\x09\x09 * Don\x27t trigger a search if the URL field already has a link or is empty.\x0a\x09\x09\x09\x09\x09\x09 * Also, avoids screen readers announce `No search results`.\x0a\x09\x09\x09\x09\x09\x09 */\x0a\x09\x09\x09\x09\x09\x09if ( inputValue && ! /^https?:/.test( inputValue ) ) {\x0a\x09\x09\x09\x09\x09\x09\x09$input.autocomplete( \x27search\x27 );\x0a\x09\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09\x09} )\x0a\x09\x09\x09\x09\x09// Returns a jQuery object containing the menu element.\x0a\x09\x09\x09\x09\x09.autocomplete( \x27widget\x27 )\x0a\x09\x09\x09\x09\x09\x09.addClass( \x27wplink-autocomplete\x27 )\x0a\x09\x09\x09\x09\x09\x09.attr( \x27role\x27, \x27listbox\x27 )\x0a\x09\x09\x09\x09\x09\x09.removeAttr( \x27tabindex\x27 ) // Remove the `tabindex=0` attribute added by jQuery UI.\x0a\x09\x09\x09\x09\x09\x09/*\x0a\x09\x09\x09\x09\x09\x09 * Looks like Safari and VoiceOver need an `aria-selected` attribute. See ticket #33301.\x0a\x09\x09\x09\x09\x09\x09 * The `menufocus` and `menublur` events are the same events used to add and remove\x0a\x09\x09\x09\x09\x09\x09 * the `ui-state-focus` CSS class on the menu items. See jQuery UI Menu Widget.\x0a\x09\x09\x09\x09\x09\x09 */\x0a\x09\x09\x09\x09\x09\x09.on( \x27menufocus\x27, function( event, ui ) {\x0a\x09\x09\x09\x09\x09\x09\x09ui.item.attr( \x27aria-selected\x27, \x27true\x27 );\x0a\x09\x09\x09\x09\x09\x09})\x0a\x09\x09\x09\x09\x09\x09.on( \x27menublur\x27, function() {\x0a\x09\x09\x09\x09\x09\x09\x09/*\x0a\x09\x09\x09\x09\x09\x09\x09 * The `menublur` event returns an object where the item is `null`\x0a\x09\x09\x09\x09\x09\x09\x09 * so we need to find the active item with other means.\x0a\x09\x09\x09\x09\x09\x09\x09 */\x0a\x09\x09\x09\x09\x09\x09\x09$( this ).find( \x27[aria-selected=\x22true\x22]\x27 ).removeAttr( \x27aria-selected\x27 );\x0a\x09\x09\x09\x09\x09\x09});\x0a\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09tinymce.$( input ).on( \x27keydown\x27, function( event ) {\x0a\x09\x09\x09\x09\x09if ( event.keyCode === 13 ) {\x0a\x09\x09\x09\x09\x09\x09editor.execCommand( \x27wp_link_apply\x27 );\x0a\x09\x09\x09\x09\x09\x09event.preventDefault();\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09} );\x0a\x09\x09\x09}\x0a\x09\x09} );\x0a\x0a\x09\x09editor.on( \x27wptoolbar\x27, function( event ) {\x0a\x09\x09\x09var linkNode = editor.dom.getParent( event.element, \x27a\x27 ),\x0a\x09\x09\x09\x09$linkNode, href, edit;\x0a\x0a\x09\x09\x09if ( typeof window.wpLink !== \x27undefined\x27 && window.wpLink.modalOpen ) {\x0a\x09\x09\x09\x09editToolbar.tempHide = true;\x0a\x09\x09\x09\x09return;\x0a\x09\x09\x09}\x0a\x0a\x09\x09\x09editToolbar.tempHide = false;\x0a\x0a\x09\x09\x09if ( linkNode ) {\x0a\x09\x09\x09\x09$linkNode = editor.$( linkNode );\x0a\x09\x09\x09\x09href = $linkNode.attr( \x27href\x27 );\x0a\x09\x09\x09\x09edit = $linkNode.attr( \x27data-wplink-edit\x27 );\x0a\x0a\x09\x09\x09\x09if ( href === \x27_wp_link_placeholder\x27 || edit ) {\x0a\x09\x09\x09\x09\x09if ( href !== \x27_wp_link_placeholder\x27 && ! inputInstance.getURL() ) {\x0a\x09\x09\x09\x09\x09\x09inputInstance.setURL( href );\x0a\x09\x09\x09\x09\x09}\x0a\x0a\x09\x09\x09\x09\x09event.element = linkNode;\x0a\x09\x09\x09\x09\x09event.toolbar = editToolbar;\x0a\x09\x09\x09\x09} else if ( href && ! $linkNode.find( \x27img\x27 ).length ) {\x0a\x09\x09\x09\x09\x09previewInstance.setURL( href );\x0a\x09\x09\x09\x09\x09event.element = linkNode;\x0a\x09\x09\x09\x09\x09event.toolbar = toolbar;\x0a\x0a\x09\x09\x09\x09\x09if ( $linkNode.attr( \x27data-wplink-url-error\x27 ) === \x27true\x27 ) {\x0a\x09\x09\x09\x09\x09\x09toolbar.$el.find( \x27.wp-link-preview a\x27 ).addClass( \x27wplink-url-error\x27 );\x0a\x09\x09\x09\x09\x09} else {\x0a\x09\x09\x09\x09\x09\x09toolbar.$el.find( \x27.wp-link-preview a\x27 ).removeClass( \x27wplink-url-error\x27 );\x0a\x09\x09\x09\x09\x09\x09hasLinkError = false;\x0a\x09\x09\x09\x09\x09}\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09} else if ( editToolbar.visible() ) {\x0a\x09\x09\x09\x09editor.execCommand( \x27wp_link_cancel\x27 );\x0a\x09\x09\x09}\x0a\x09\x09} );\x0a\x0a\x09\x09editor.addButton( \x27wp_link_edit\x27, {\x0a\x09\x09\x09tooltip: \x27Edit|button\x27, // \x27|button\x27 is not displayed, only used for context\x0a\x09\x09\x09icon: \x27dashicon dashicons-edit\x27,\x0a\x09\x09\x09cmd: \x27WP_Link\x27\x0a\x09\x09} );\x0a\x0a\x09\x09editor.addButton( \x27wp_link_remove\x27, {\x0a\x09\x09\x09tooltip: \x27Remove link\x27,\x0a\x09\x09\x09icon: \x27dashicon dashicons-editor-unlink\x27,\x0a\x09\x09\x09cmd: \x27wp_unlink\x27\x0a\x09\x09} );\x0a\x0a\x09\x09editor.addButton( \x27wp_link_advanced\x27, {\x0a\x09\x09\x09tooltip: \x27Link options\x27,\x0a\x09\x09\x09icon: \x27dashicon dashicons-admin-generic\x27,\x0a\x09\x09\x09onclick: function() {\x0a\x09\x09\x09\x09if ( typeof window.wpLink !== \x27undefined\x27 ) {\x0a\x09\x09\x09\x09\x09var url = inputInstance.getURL() || null,\x0a\x09\x09\x09\x09\x09\x09text = inputInstance.getLinkText() || null;\x0a\x0a\x09\x09\x09\x09\x09window.wpLink.open( editor.id, url, text );\x0a\x0a\x09\x09\x09\x09\x09editToolbar.tempHide = true;\x0a\x09\x09\x09\x09\x09editToolbar.hide();\x0a\x09\x09\x09\x09}\x0a\x09\x09\x09}\x0a\x09\x09} );\x0a\x0a\x09\x09editor.addButton( \x27wp_link_apply\x27, {\x0a\x09\x09\x09tooltip: \x27Apply\x27,\x0a\x09\x09\x09icon: \x27dashicon dashicons-editor-break\x27,\x0a\x09\x09\x09cmd: \x27wp_link_apply\x27,\x0a\x09\x09\x09classes: \x27widget btn primary\x27\x0a\x09\x09} );\x0a\x0a\x09\x09return {\x0a\x09\x09\x09close: function() {\x0a\x09\x09\x09\x09editToolbar.tempHide = false;\x0a\x09\x09\x09\x09editor.execCommand( \x27wp_link_cancel\x27 );\x0a\x09\x09\x09},\x0a\x09\x09\x09checkLink: checkLink\x0a\x09\x09};\x0a\x09} );\x0a} )( window.tinymce );\x0a'}